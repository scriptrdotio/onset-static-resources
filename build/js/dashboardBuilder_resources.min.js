!function(a,b){"function"==typeof define&&define.amd?define(["angular","objectpath","tv4"],b):"object"==typeof exports?module.exports=b(require("angular"),require("objectpath"),require("tv4")):a.schemaForm=b(a.angular,a.objectpath,a.tv4)}(this,function(a,b,c){var d=[];try{a.module("ngSanitize"),d.push("ngSanitize")}catch(a){}try{a.module("ui.sortable"),d.push("ui.sortable")}catch(a){}try{a.module("angularSpectrumColorpicker"),d.push("angularSpectrumColorpicker")}catch(a){}var e=a.module("schemaForm",d);return a.module("schemaForm").provider("sfPath",[function(){var c=window.ObjectPath||b,d={parse:c.parse};1===a.version.major&&a.version.minor<3?d.stringify=function(a){return Array.isArray(a)?a.join("."):a.toString()}:d.stringify=c.stringify,d.normalize=function(a,b){return d.stringify(Array.isArray(a)?a:d.parse(a),b)},this.parse=d.parse,this.stringify=d.stringify,this.normalize=d.normalize,this.$get=function(){return d}}]),a.module("schemaForm").provider("sfBuilder",["sfPathProvider",function(b){var c=/[A-Z]/g,d=function(a,b){return b=b||"_",a.replace(c,function(a,c){return(c?b:"")+a.toLowerCase()})},e=0,f={sfField:function(a){a.fieldFrag.firstChild.setAttribute("sf-field",e),a.lookup["f"+e]=a.form,e++},ngModel:function(a){if(a.form.key){var c=a.form.key;a.state.keyRedaction&&(c=c.slice(a.state.keyRedaction));var d;if(a.state.modelValue)d=a.state.modelValue;else{var e=b.stringify(c).replace(/"/g,"&quot;");d=a.state.modelName||"model",e&&(d+=("["!==e[0]?".":"")+e)}for(var f=a.fieldFrag.querySelectorAll("[sf-field-model]"),g=0;g<f.length;g++){var h=f[g],i=h.getAttribute("sf-field-model");if(i&&""!==i)if("replaceAll"===i)for(var j=h.attributes,k=0;k<j.length;k++)j[k].value&&-1!==j[k].value.indexOf("$$value")&&(j[k].value=j[k].value.replace(/\$\$value\$\$/g,d));else{var l=h.getAttribute(i);l&&l.indexOf("$$value$$")?h.setAttribute(i,l.replace(/\$\$value\$\$/g,d)):h.setAttribute(i,d)}else h.setAttribute("ng-model",d)}}},simpleTransclusion:function(a){var b=a.build(a.form.items,a.path+".items",a.state);a.fieldFrag.firstChild.appendChild(b)},ngModelOptions:function(a){a.form.ngModelOptions&&Object.keys(a.form.ngModelOptions).length>0&&a.fieldFrag.firstChild.setAttribute("ng-model-options",JSON.stringify(a.form.ngModelOptions))},transclusion:function(a){var b=a.fieldFrag.querySelectorAll("[sf-field-transclude]");if(b.length)for(var c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("sf-field-transclude")||"items",f=a.form[e];if(f){var g=a.build(f,a.path+"."+e,a.state);d.appendChild(g)}}},condition:function(a){if(a.form.condition){var c="evalExpr("+a.path+'.condition, { model: model, "arrayIndex": $index})';if(a.form.key){var d=b.stringify(a.form.key);c="evalExpr("+a.path+'.condition,{ model: model, "arrayIndex": $index, "modelValue": model'+("["===d[0]?"":".")+d+"})"}for(var e=a.fieldFrag.children||a.fieldFrag.childNodes,f=0;f<e.length;f++){var g=e[f],h=g.getAttribute("ng-if");g.setAttribute("ng-if",h?"("+h+") || ("+c+")":c)}}},array:function(c){var d=c.fieldFrag.querySelector("[schema-form-array-items]");if(d){if(state=a.copy(c.state),state.keyRedaction=state.keyRedaction||0,state.keyRedaction+=c.form.key.length+1,c.form.schema&&c.form.schema.items&&c.form.schema.items.type&&-1===c.form.schema.items.type.indexOf("object")&&-1===c.form.schema.items.type.indexOf("array")){b.stringify(c.form.key).replace(/"/g,"&quot;");state.modelValue="modelArray[$index]"}else state.modelName="item";state.arrayCompatFlag=!0;var e=c.build(c.form.items,c.path+".items",state);d.appendChild(e)}}};this.builders=f;var g=[f.sfField,f.ngModel,f.ngModelOptions,f.condition];this.stdBuilders=g,this.$get=["$templateCache","schemaFormDecorators","sfPath",function(a,b,c){var e=function(a,b){if(a.key){var d=b[c.stringify(a.key)];if(d){for(;d.firstChild;)d.removeChild(d.firstChild);return d}}},h=function(a,b,c,f,g,i,j){i=i||{},j=j||Object.create(null),g=g||"schemaForm.form";var k=document.createDocumentFragment();return a.reduce(function(a,k,l){if(!k.type)return a;var m=b[k.type]||b.default;if(m.replace){var n;i.arrayCompatFlag=!1;var o=document.createElement("div"),p=c(k,m)||c(k,b.default);for(o.innerHTML=p,n=document.createDocumentFragment();o.childNodes.length>0;)n.appendChild(o.childNodes[0]);var q={fieldFrag:n,form:k,lookup:j,state:i,path:g+"["+l+"]",build:function(a,d,e){return h(a,b,c,f,d,e,j)}},r=k.builder||m.builder;"function"==typeof r?r(q):r.forEach(function(a){a(q)}),(e(k,f)||a).appendChild(n)}else{var s=document.createElement(d(b.__name,"-"));i.arrayCompatFlag?s.setAttribute("form","copyWithIndex($index)"):s.setAttribute("form",g+"["+l+"]"),(e(k,f)||a).appendChild(s)}return a},k),k};return{build:function(b,c,d,e){return h(b,c,function(b,c){return"template"===b.type?b.template:a.get(c.template)},d,void 0,void 0,e)},builder:f,stdBuilders:g,internalBuild:h}}]}]),a.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(b,c){var d="",e={},f=function(a,b){"sfDecorator"===a&&(a=d);var c=e[a];return c[b.type]?c[b.type].template:c.default.template},g=function(d){b.directive(d,["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(b,e,g,h,i,j,k,l,m){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(b,n,o,p){b.$on("schemaFormPropagateNgModelController",function(a,c){a.stopPropagation(),a.preventDefault(),b.ngModel=c}),b.showTitle=function(){return b.form&&!0!==b.form.notitle&&b.form.title},b.listToCheckboxValues=function(b){var c={};return a.forEach(b,function(a){c[a]=!0}),c},b.checkboxValuesToList=function(b){var c=[];return a.forEach(b,function(a,b){a&&c.push(b)}),c},b.buttonClick=function(c,d){a.isFunction(d.onClick)?d.onClick(c,d):a.isString(d.onClick)&&(p?p.evalInParentScope(d.onClick,{$event:c,form:d}):b.$eval(d.onClick,{$event:c,form:d}))},b.evalExpr=function(a,c){return p?p.evalInParentScope(a,c):b.$eval(a,c)},b.evalInScope=function(a,c){if(a)return b.$eval(a,c)},b.interp=function(a,b){return a&&i(a)(b)},b.hasSuccess=function(){return!!b.ngModel&&(b.ngModel.$valid&&(!b.ngModel.$pristine||!b.ngModel.$isEmpty(b.ngModel.$modelValue)))},b.hasError=function(){return!!b.ngModel&&(b.ngModel.$invalid&&!b.ngModel.$pristine)},b.errorMessage=function(a){return k.interpolate(a&&a.code+""||"default",b.ngModel&&b.ngModel.$modelValue||"",b.ngModel&&b.ngModel.$viewValue||"",b.form,b.options&&b.options.validationMessage)};var q=b.$watch(o.form,function(i){if(i){i.ngModelOptions=i.ngModelOptions||{},b.form=i;var k;if("template"===i.type&&i.template)k=j.when(i.template);else{var o="template"===i.type?i.templateUrl:f(d,i);k=g.get(o,{cache:h}).then(function(a){return a.data})}k.then(function(d){if(i.key){var f=i.key?c.stringify(i.key).replace(/"/g,"&quot;"):"";d=d.replace(/\$\$value\$\$/g,"model"+("["!==f[0]?".":"")+f)}if(n.html(d),i.condition){var g='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex})';i.key&&(g='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex, "modelValue": model'+l.stringify(i.key)+"})"),a.forEach(n.children(),function(a){var b=a.getAttribute("ng-if");a.setAttribute("ng-if",b?"("+b+") || ("+g+")":g)})}e(n.contents())(b)}),i.key&&(b.$on("schemaForm.error."+i.key.join("."),function(a,c,d,e){!0!==d&&!1!==d||(e=d,d=void 0),b.ngModel&&c&&(b.ngModel.$setDirty?b.ngModel.$setDirty():(b.ngModel.$dirty=!0,b.ngModel.$pristine=!1),d&&(i.validationMessage||(i.validationMessage={}),i.validationMessage[c]=d),b.ngModel.$setValidity(c,!0===e),!0===e&&(b.ngModel.$validate(),b.$broadcast("schemaFormValidate")))}),b.$on("$destroy",function(){if(!b.externalDestructionInProgress){var a=i.destroyStrategy||b.options&&b.options.destroyStrategy||"remove";if(i.key&&"retain"!==a){var c=b.model;if(i.key.length>1&&(c=m(i.key.slice(0,i.key.length-1),c)),void 0===c)return;var d=i.schema&&i.schema.type||"";"empty"===a&&-1!==d.indexOf("string")?c[i.key.slice(-1)]="":"empty"===a&&-1!==d.indexOf("object")?c[i.key.slice(-1)]={}:"empty"===a&&-1!==d.indexOf("array")?c[i.key.slice(-1)]=[]:"null"===a?c[i.key.slice(-1)]=null:delete c[i.key.slice(-1)]}}})),q()}})}}}])},h=function(c,d,e){e=!!a.isDefined(e)&&e,b.directive("sf"+a.uppercase(c[0])+c.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:e,template:'<sf-decorator form="form"></sf-decorator>',link:function(b,d,e){var f={items:"c",titleMap:"c",schema:"c"},g={type:c},h=!0;a.forEach(e,function(c,d){if("$"!==d[0]&&0!==d.indexOf("ng")&&"sfField"!==d){var i=function(c){a.isDefined(c)&&c!==g[d]&&(g[d]=c,h&&g.type&&(g.key||a.isUndefined(e.key))&&(b.form=g,h=!1))};"model"===d?b.$watch(c,function(a){a&&b.model!==a&&(b.model=a)}):"c"===f[d]?b.$watchCollection(c,i):e.$observe(d,i)}})}}})};this.createDecorator=function(b,c){e[b]={__name:b},a.forEach(c,function(a,c){e[b][c]={template:a,replace:!1,builder:[]}}),e[d]||(d=b),g(b)},this.defineDecorator=function(b,c){e[b]={__name:b},a.forEach(c,function(c,d){c.builder=c.builder||[],c.replace=!a.isDefined(c.replace)||c.replace,e[b][d]=c}),e[d]||(d=b),g(b)},this.createDirective=h,this.createDirectives=function(b){a.forEach(b,function(a,b){h(b)})},this.decorator=function(a){return a=a||d,e[a]},this.addMapping=function(a,b,c,d,f){e[a]&&(e[a][b]={template:c,builder:d,replace:!!f})},this.defineAddOn=function(a,b,c,d){e[a]&&(e[a][b]={template:c,builder:d,replace:!0})},this.$get=function(){return{decorator:function(a){return e[a]||e[d]},defaultDecorator:d}},g("sfDecorator")}]),a.module("schemaForm").provider("sfErrorMessage",function(){var b={default:"Field does not validate",0:"Invalid type, expected {{schema.type}}",1:"No enum match for: {{viewValue}}",10:'Data does not match any schemas from "anyOf"',11:'Data does not match any schemas from "oneOf"',12:'Data is valid against more than one schema from "oneOf"',13:'Data matches schema from "not"',100:"Value is not a multiple of {{schema.multipleOf}}",101:"{{viewValue}} is less than the allowed minimum of {{schema.minimum}}",102:"{{viewValue}} is equal to the exclusive minimum {{schema.minimum}}",103:"{{viewValue}} is greater than the allowed maximum of {{schema.maximum}}",104:"{{viewValue}} is equal to the exclusive maximum {{schema.maximum}}",105:"Value is not a valid number",200:"String is too short ({{viewValue.length}} chars), minimum {{schema.minLength}}",201:"String is too long ({{viewValue.length}} chars), maximum {{schema.maxLength}}",202:"String does not match pattern: {{schema.pattern}}",300:"Too few properties defined, minimum {{schema.minProperties}}",301:"Too many properties defined, maximum {{schema.maxProperties}}",302:"Required",303:"Additional properties not allowed",304:"Dependency failed - key must exist",400:"Array is too short ({{value.length}}), minimum {{schema.minItems}}",401:"Array is too long ({{value.length}}), maximum {{schema.maxItems}}",402:"Array items are not unique",403:"Additional items not allowed",500:"Format validation failed",501:'Keyword failed: "{{title}}"',600:"Circular $refs",1e3:"Unknown property (not in schema)"};b.number=b[105],b.required=b[302],b.min=b[101],b.max=b[103],b.maxlength=b[201],b.minlength=b[200],b.pattern=b[202],this.setDefaultMessages=function(a){b=a},this.getDefaultMessages=function(){return b},this.setDefaultMessage=function(a,c){b[a]=c},this.$get=["$interpolate",function(c){var d={};return d.defaultMessages=b,d.interpolate=function(d,e,f,g,h){h=h||{};var i=g.validationMessage||{};0===d.indexOf("tv4-")&&(d=d.substring(4));var j=i.default||h.default||"";[i,h,b].some(function(b){return a.isString(b)||a.isFunction(b)?(j=b,!0):b&&b[d]?(j=b[d],!0):void 0});var k={error:d,value:e,viewValue:f,form:g,schema:g.schema,title:g.title||g.schema&&g.schema.title};return a.isFunction(j)?j(k):c(j)(k)},d}]}),a.module("schemaForm").provider("schemaForm",["sfPathProvider",function(b){var c=function(a){if(Array.isArray(a)&&2==a.length){if("null"===a[0])return a[1];if("null"===a[1])return a[0]}return a},d=function(a){var b=[];return a.forEach(function(a){b.push({name:a,value:a})}),b},e=function(b,c){if(!a.isArray(b)){var d=[];return c?a.forEach(c,function(a,c){d.push({name:b[a],value:a})}):a.forEach(b,function(a,b){d.push({name:a,value:b})}),d}return b},f=function(b,d,e){var f=p[c(d.type)];if(f)for(var g,h=0;h<f.length;h++)if(g=f[h](b,d,e))return g.schema["x-schema-form"]&&a.isObject(g.schema["x-schema-form"])&&(g=a.extend(g,g.schema["x-schema-form"])),g},g=function(b,c,d){d=d||{};var f=d.global&&d.global.formDefaults?a.copy(d.global.formDefaults):{};return d.global&&!0===d.global.supressPropertyTitles?f.title=c.title:f.title=c.title||b,c.description&&(f.description=c.description),!0!==d.required&&!0!==c.required||(f.required=!0),c.maxLength&&(f.maxlength=c.maxLength),c.minLength&&(f.minlength=c.minLength),(c.readOnly||c.readonly)&&(f.readonly=!0),c.minimum&&(f.minimum=c.minimum+(c.exclusiveMinimum?1:0)),c.maximum&&(f.maximum=c.maximum-(c.exclusiveMaximum?1:0)),c.validationMessage&&(f.validationMessage=c.validationMessage),c.enumNames&&(f.titleMap=e(c.enumNames,c.enum)),f.schema=c,f.ngModelOptions=f.ngModelOptions||{},f},h=function(a,d,e){if("string"===c(d.type)&&!d.enum){var f=g(a,d,e);return f.key=e.path,f.type="text",e.lookup[b.stringify(e.path)]=f,f}},i=function(a,d,e){if("number"===c(d.type)){var f=g(a,d,e);return f.key=e.path,f.type="number",e.lookup[b.stringify(e.path)]=f,f}},j=function(a,d,e){if("integer"===c(d.type)){var f=g(a,d,e);return f.key=e.path,f.type="number",e.lookup[b.stringify(e.path)]=f,f}},k=function(a,d,e){if("boolean"===c(d.type)){var f=g(a,d,e);return f.key=e.path,f.type="checkbox",e.lookup[b.stringify(e.path)]=f,f}},l=function(a,e,f){if("string"===c(e.type)&&e.enum){var h=g(a,e,f);return h.key=f.path,h.type="select",h.titleMap||(h.titleMap=d(e.enum)),f.lookup[b.stringify(f.path)]=h,h}},m=function(a,e,f){if("array"===c(e.type)&&e.items&&e.items.enum){var h=g(a,e,f);return h.key=f.path,h.type="checkboxes",h.titleMap||(h.titleMap=d(e.items.enum)),f.lookup[b.stringify(f.path)]=h,h}},n=function(d,e,h){if("object"===c(e.type)){var i=g(d,e,h);return i.type="fieldset",i.items=[],h.lookup[b.stringify(h.path)]=i,a.forEach(e.properties,function(a,c){var d=h.path.slice();if(d.push(c),!0!==h.ignore[b.stringify(d)]){var g=e.required&&-1!==e.required.indexOf(c),j=f(c,a,{path:d,required:g||!1,lookup:h.lookup,ignore:h.ignore,global:h.global});j&&i.items.push(j)}}),i}},o=function(a,d,e){if("array"===c(d.type)){var h=g(a,d,e);h.type="array",h.key=e.path,e.lookup[b.stringify(e.path)]=h;var i=d.required&&-1!==d.required.indexOf(e.path[e.path.length-1]),j=e.path.slice();return j.push(""),h.items=[f(a,d.items,{path:j,required:i||!1,lookup:e.lookup,ignore:e.ignore,global:e.global})],h}},p={string:[l,h],object:[n],number:[i],integer:[j],boolean:[k],array:[m,o]},q=function(a){return a};this.defaults=p,this.stdFormObj=g,this.defaultFormDefinition=f,this.postProcess=function(a){q=a},this.appendRule=function(a,b){p[a]||(p[a]=[]),p[a].push(b)},this.prependRule=function(a,b){p[a]||(p[a]=[]),p[a].unshift(b)},this.createStandardForm=g,this.$get=function(){var d={};return d.merge=function(c,f,g,h,i,j){f=f||["*"],h=h||{},i=i||c.readonly||c.readOnly;var k=d.defaults(c,g,h),l=f.indexOf("*");-1!==l&&(f=f.slice(0,l).concat(k.form).concat(f.slice(l+1)));var m=k.lookup;return q(f.map(function(f){if("string"==typeof f&&(f={key:f}),f.key&&"string"==typeof f.key&&(f.key=b.parse(f.key)),f.titleMap&&(f.titleMap=e(f.titleMap)),f.itemForm){f.items=[];var k=b.stringify(f.key),l=m[k];a.forEach(l.items,function(b){var c=a.copy(f.itemForm);c.key=b.key,f.items.push(c)})}if(f.key){var n=b.stringify(f.key);if(m[n]){var o=m[n];a.forEach(o,function(a,b){void 0===f[b]&&(f[b]=o[b])})}}return!0===i&&(f.readonly=!0),f.items&&(f.items=d.merge(c,f.items,g,h,f.readonly,j)),f.tabs&&a.forEach(f.tabs,function(a){a.items=d.merge(c,a.items,g,h,f.readonly,j)}),"checkbox"===f.type&&a.isUndefined(f.schema.default)&&(f.schema.default=!1),j&&"template"===f.type&&!f.template&&f.templateUrl&&j.push(f),f}))},d.defaults=function(b,d,e){var g=[],h={};if(d=d||{},e=e||{},"object"!==c(b.type))throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return a.forEach(b.properties,function(a,c){if(!0!==d[c]){var i=b.required&&-1!==b.required.indexOf(c),j=f(c,a,{path:[c],lookup:h,ignore:d,required:i,global:e});j&&g.push(j)}}),{form:g,lookup:h}},d.traverseSchema=function(b,c,d,e){e=!a.isDefined(e)||e,d=d||[];var f=function(b,c,d){if(c(b,d),a.forEach(b.properties,function(a,b){var e=d.slice();e.push(b),f(a,c,e)}),!e&&b.items){var g=d.slice();g.push(""),f(b.items,c,g)}};f(b,c,d||[])},d.traverseForm=function(b,c){c(b),a.forEach(b.items,function(a){d.traverseForm(a,c)}),b.tabs&&a.forEach(b.tabs,function(b){a.forEach(b.items,function(a){d.traverseForm(a,c)})})},d}}]),a.module("schemaForm").factory("sfSelect",["sfPath",function(a){var b=/^\d+$/;return function(c,d,e){d||(d=this);var f="string"==typeof c?a.parse(c):c;if(void 0!==e&&1===f.length)return d[f[0]]=e,d;void 0!==e&&void 0===d[f[0]]&&(d[f[0]]=f.length>2&&b.test(f[1])?[]:{});for(var g=d[f[0]],h=1;h<f.length;h++){if(""===f[h])return;if(void 0!==e){if(h===f.length-1)return g[f[h]]=e,e;var i=g[f[h]];void 0!==i&&null!==i||(i=b.test(f[h+1])?[]:{},g[f[h]]=i),g=i}else g&&(g=g[f[h]])}return g}}]),a.module("schemaForm").factory("sfValidator",[function(){var b={};return b.validate=function(b,d){if(!b)return{valid:!0};var e=b.schema;if(!e)return{valid:!0};""===d&&(d=void 0),"number"===b.type&&null===d&&(d=void 0);var f={type:"object",properties:{}},g=b.key[b.key.length-1];f.properties[g]=e,b.required&&(f.required=[g]);var h={};return a.isDefined(d)&&(h[g]=d),c.validateResult(h,f)},b}]),a.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator","sfPath",function(b,c,d,e){var f=function(a){return function(b){b.key&&(b.key[b.key.indexOf("")]=a)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(g,h,i,j){var k={};g.validateArray=a.noop,j&&g.$emit("schemaFormPropagateNgModelController",j);var l=g.$watch(i.sfArray,function(h){if(h){var i=b(h.key,g.model),m=e.normalize(h.key);if(g.$watch("model"+("["!==m[0]?".":"")+m,function(a){i=g.modelArray=a}),a.isUndefined(i)&&(i=[],b(h.key,g.model,i)),g.modelArray=i,h.items){var n=h.items[0];h.items.length>1&&(n={type:"section",items:h.items.map(function(b){return b.ngModelOptions=h.ngModelOptions,a.isUndefined(b.readonly)&&(b.readonly=h.readonly),b})})}if(g.copyWithIndex=function(b){if(!k[b]&&n){var d=a.copy(n);d.arrayIndex=b,c.traverseForm(d,f(b)),k[b]=d}return k[b]},g.appendToArray=function(){var d=i.length,e=g.copyWithIndex(d);if(c.traverseForm(e,function(c){if(c.key){var d;a.isDefined(c.default)&&(d=c.default),a.isDefined(c.schema)&&a.isDefined(c.schema.default)&&(d=c.schema.default),a.isDefined(d)&&b(c.key,g.model,d)}}),d===i.length){var f,j=b("schema.items.type",h);"object"===j?f={}:"array"===j&&(f=[]),i.push(f)}return g.validateArray(),i},g.deleteFromArray=function(a){return i.splice(a,1),g.validateArray(),j&&j.$setDirty&&j.$setDirty(),i},h.titleMap||!0===h.startEmpty||0!==i.length||g.appendToArray(),h.titleMap&&h.titleMap.length>0){g.titleMapValues=[];var o=function(a){g.titleMapValues=[],a=a||[],h.titleMap.forEach(function(b){g.titleMapValues.push(-1!==a.indexOf(b.value))})};o(g.modelArray),g.$watchCollection("modelArray",o),g.$watchCollection("titleMapValues",function(a,b){if(a&&a!==b){for(var c=g.modelArray;c.length>0;)c.pop();h.titleMap.forEach(function(b,d){a[d]&&c.push(b.value)}),g.validateArray()}})}if(j){var p;g.validateArray=function(){var a=d.validate(h,g.modelArray.length>0?g.modelArray:void 0);Object.keys(j.$error).filter(function(a){return 0===a.indexOf("tv4-")}).forEach(function(a){j.$setValidity(a,!0)}),!1!==a.valid||!a.error||""!==a.error.dataPath&&a.error.dataPath!=="/"+h.key[h.key.length-1]||(j.$setViewValue(g.modelArray),p=a.error,j.$setValidity("tv4-"+a.error.code,!1))},g.$on("schemaFormValidate",g.validateArray),g.hasSuccess=function(){return g.options&&g.options.pristine&&!1===g.options.pristine.success?j.$valid&&!j.$pristine&&!j.$isEmpty(j.$modelValue):j.$valid&&(!j.$pristine||!j.$isEmpty(j.$modelValue))},g.hasError=function(){return g.options&&g.options.pristine&&!1===g.options.pristine.errors?j.$invalid&&!j.$pristine:j.$invalid},g.schemaError=function(){return p}}l()}})}}}]),a.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(b,c,d,e){var f=b.$eval(d.sfChanged);f&&f.onChange&&e.$viewChangeListeners.push(function(){a.isFunction(f.onChange)?f.onChange(e.$modelValue,f,b.model):b.evalExpr(f.onChange,{modelValue:e.$modelValue,form:f,model:b.model})})}}}),a.module("schemaForm").directive("sfField",["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(b,c,d,e,f,g,h,i,j){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"^sfSchema",link:{pre:function(a,b,c,d){a.$on("schemaFormPropagateNgModelController",function(b,c){b.stopPropagation(),b.preventDefault(),a.ngModel=c}),a.form=d.lookup["f"+c.sfField]},post:function(b,c,d,e){b.showTitle=function(){return b.form&&!0!==b.form.notitle&&b.form.title},b.listToCheckboxValues=function(b){var c={};return a.forEach(b,function(a){c[a]=!0}),c},b.checkboxValuesToList=function(b){var c=[];return a.forEach(b,function(a,b){a&&c.push(b)}),c},b.buttonClick=function(c,d){a.isFunction(d.onClick)?d.onClick(c,d):a.isString(d.onClick)&&(e?e.evalInParentScope(d.onClick,{$event:c,form:d}):b.$eval(d.onClick,{$event:c,form:d}))},b.evalExpr=function(a,c){return e?e.evalInParentScope(a,c):b.$eval(a,c)},b.evalInScope=function(a,c){if(a)return b.$eval(a,c)},b.interp=function(a,b){return a&&f(a)(b)},b.hasSuccess=function(){return!!b.ngModel&&(b.options&&b.options.pristine&&!1===b.options.pristine.success?b.ngModel.$valid&&!b.ngModel.$pristine&&!b.ngModel.$isEmpty(b.ngModel.$modelValue):b.ngModel.$valid&&(!b.ngModel.$pristine||!b.ngModel.$isEmpty(b.ngModel.$modelValue)))},b.hasError=function(){return!!b.ngModel&&(b.options&&b.options.pristine&&!1===b.options.pristine.errors?b.ngModel.$invalid&&!b.ngModel.$pristine:b.ngModel.$invalid)},b.errorMessage=function(a){return h.interpolate(a&&a.code+""||"default",b.ngModel&&b.ngModel.$modelValue||"",b.ngModel&&b.ngModel.$viewValue||"",b.form,b.options&&b.options.validationMessage)};var g=b.form;g.key&&(b.$on("schemaForm.error."+g.key.join("."),function(a,c,d,e){!0!==d&&!1!==d||(e=d,d=void 0),b.ngModel&&c&&(b.ngModel.$setDirty?b.ngModel.$setDirty():(b.ngModel.$dirty=!0,b.ngModel.$pristine=!1),d&&(g.validationMessage||(g.validationMessage={}),g.validationMessage[c]=d),b.ngModel.$setValidity(c,!0===e),!0===e&&(b.ngModel.$validate(),b.$broadcast("schemaFormValidate")))}),b.$on("$destroy",function(){if(!b.externalDestructionInProgress){var a=g.destroyStrategy||b.options&&b.options.destroyStrategy||"remove";if(g.key&&"retain"!==a){var c=b.model;if(g.key.length>1&&(c=j(g.key.slice(0,g.key.length-1),c)),void 0===c)return;var d=g.schema&&g.schema.type||"";"empty"===a&&-1!==d.indexOf("string")?c[g.key.slice(-1)]="":"empty"===a&&-1!==d.indexOf("object")?c[g.key.slice(-1)]={}:"empty"===a&&-1!==d.indexOf("array")?c[g.key.slice(-1)]=[]:"null"===a?c[g.key.slice(-1)]=null:delete c[g.key.slice(-1)]}}}))}}}}]),a.module("schemaForm").directive("sfMessage",["$injector","sfErrorMessage",function(b,c){var d=b.has("$sanitize")?b.get("$sanitize"):function(a){return a};return{scope:!1,restrict:"EA",link:function(b,e,f){var g="";f.sfMessage&&b.$watch(f.sfMessage,function(a){a&&(g=d(a),j(!!b.ngModel))});var h,i=function(a){a!==h&&(e.html(a),h=a)},j=function(d){if(d)if(b.hasError()){var e=[];a.forEach(b.ngModel&&b.ngModel.$error,function(a,b){a&&e.push(b)}),e=e.filter(function(a){return"schemaForm"!==a});var f=e[0];i(f?c.interpolate(f,b.ngModel.$modelValue,b.ngModel.$viewValue,b.form,b.options&&b.options.validationMessage):g)}else i(g);else i(g)};j();var k=b.$watch("ngModel",function(a){a&&(a.$parsers.push(function(a){return j(!0),a}),a.$formatters.push(function(a){return j(!0),a}),k())});b.$watchCollection("ngModel.$error",function(){j(!!b.ngModel)})}}}]),a.module("schemaForm").directive("sfNewArray",["sfSelect","sfPath","schemaForm",function(b,c,d){return{scope:!1,link:function(e,f,g){e.min=0,e.modelArray=e.$eval(g.sfNewArray);var h=function(){e.modelArray=e.$eval(g.sfNewArray),e.ngModel&&e.ngModel.$pristine&&e.firstDigest&&(!e.options||!0!==e.options.validateOnRender)||e.validateField&&e.validateField()},i=function(){e.form&&e.form.onChange&&(a.isFunction(e.form.onChange)?e.form.onChange(e.modelArray,e.form):e.evalExpr(e.form.onChange,{modelValue:e.modelArray,form:e.form}))},j=function(){var a=e.modelArray;if(!a){var d=c.parse(g.sfNewArray);a=[],b(d,e,a),e.modelArray=a}return a},k=e.$watch("form",function(a){if(a){if(a.titleMap||!0===a.startEmpty||e.modelArray&&0!==e.modelArray.length||e.appendToArray(),e.form&&e.form.schema&&!0===e.form.schema.uniqueItems?(e.$watch(g.sfNewArray,h,!0),e.$watch([g.sfNewArray,g.sfNewArray+".length"],i)):e.$watchGroup?e.$watchGroup([g.sfNewArray,g.sfNewArray+".length"],function(){h(),i()}):(e.$watch(g.sfNewArray,function(){h(),i()}),e.$watch(g.sfNewArray+".length",function(){h(),i()})),a.titleMap&&a.titleMap.length>0){e.titleMapValues=[];var b=function(b){e.titleMapValues=[],b=b||[],a.titleMap.forEach(function(a){e.titleMapValues.push(-1!==b.indexOf(a.value))})};b(e.modelArray),e.$watchCollection("modelArray",b),e.$watchCollection("titleMapValues",function(b,c){if(b&&b!==c){for(var d=j();d.length>0;)d.pop();a.titleMap.forEach(function(a,c){b[c]&&d.push(a.value)}),e.validateField&&e.validateField()}})}k()}});e.appendToArray=function(){var c,f=j();if(e.form&&e.form.schema&&e.form.schema.items){var g=e.form.schema.items;g.type&&-1!==g.type.indexOf("object")?(c={},e.options&&!1===e.options.setSchemaDefaults||(c=a.isDefined(g.default)?g.default:c)&&d.traverseSchema(g,function(d,e){a.isDefined(d.default)&&b(e,c,d.default)})):g.type&&-1!==g.type.indexOf("array")?(c=[],e.options&&!1===e.options.setSchemaDefaults||(c=g.default||c)):e.options&&!1===e.options.setSchemaDefaults||(c=g.default||c)}return f.push(c),f},e.deleteFromArray=function(a){var b=e.modelArray;return b&&b.splice(a,1),b};var l=function(a){return function(b){b.key&&(b.key[b.key.indexOf("")]=a)}},m={};e.copyWithIndex=function(b){var c=e.form;if(!m[b]){var f=c.items[0];if(c.items.length>1&&(f={type:"section",items:c.items.map(function(b){return b.ngModelOptions=c.ngModelOptions,a.isUndefined(b.readonly)&&(b.readonly=c.readonly),b})}),f){var g=a.copy(f);g.arrayIndex=b,d.traverseForm(g,l(b)),m[b]=g}}return m[b]}}}}]),a.module("schemaForm").directive("sfSchema",["$compile","$http","$templateCache","$q","schemaForm","schemaFormDecorators","sfSelect","sfPath","sfBuilder",function(b,c,d,e,f,g,h,i,j){return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(a){this.evalInParentScope=function(b,c){return a.$parent.$eval(b,c)};var b=this;a.lookup=function(a){return a&&(b.lookup=a),b.lookup}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(i,k,l,m,n){i.formCtrl=m;var o={};n(i,function(a){if(a.addClass("schema-form-ignore"),k.prepend(a),k[0].querySelectorAll){var b=k[0].querySelectorAll("[ng-model]");if(b)for(var c=0;c<b.length;c++){var d=b[c].getAttribute("ng-model");o[d.substring(d.indexOf(".")+1)]=!0}}});var p,q={},r=function(a,b){var g=[],h=f.merge(a,b,o,i.options,void 0,g);g.length>0?e.all(g.map(function(a){return c.get(a.templateUrl,{cache:d}).then(function(b){a.template=b.data})})).then(function(){s(a,b,h)}):s(a,b,h)},s=function(c,d,e){p&&(i.externalDestructionInProgress=!0,p.$destroy(),i.externalDestructionInProgress=!1),p=i.$new(),p.schemaForm={form:e,schema:c},k.children(":not(.schema-form-ignore)").remove();for(var m={},n=k[0].querySelectorAll("*[sf-insert-field]"),o=0;o<n.length;o++)m[n[o].getAttribute("sf-insert-field")]=n[o];var q=g.decorator(l.sfUseDecorator),r=Object.create(null);i.lookup(r),k[0].appendChild(j.build(e,q,m,r)),p.firstDigest=!0,setTimeout(function(){p.firstDigest=!1},0),b(k.children())(p),i.options&&!1===i.options.setSchemaDefaults||f.traverseSchema(c,function(b,c){if(a.isDefined(b.default)){var d=h(c,i.model);a.isUndefined(d)&&h(c,i.model,b.default)}}),i.$emit("sf-render-finished",k)},t=["*"];i.$watch(function(){var a=i.schema,b=i.initialForm||t;b&&a&&a.type&&(q.form!==b||q.schema!==a)&&Object.keys(a.properties).length>0&&(q.schema=a,q.form=b,r(a,b))}),i.$on("schemaFormRedraw",function(){var b=i.schema,c=i.initialForm?a.copy(i.initialForm):["*"];b&&r(b,c)}),i.$on("$destroy",function(){i.externalDestructionInProgress=!0}),i.evalExpr=function(a,b){return i.$parent.$eval(a,b)}}}}]),a.module("schemaForm").directive("schemaValidate",["sfValidator","$parse","sfSelect",function(b,c,d){return{restrict:"A",scope:!1,priority:500,require:"ngModel",link:function(c,e,f,g){c.$emit("schemaFormPropagateNgModelController",g);var h=null,i=c.$eval(f.schemaValidate);i.copyValueTo&&g.$viewChangeListeners.push(function(){var b=i.copyValueTo;a.forEach(b,function(a){d(a,c.model,g.$modelValue)})}),i.onFieldLoad&&(a.isFunction(i.onFieldLoad)?i.onFieldLoad(g.$modelValue,i,c.model):c.evalExpr(i.onFieldLoad,{modelValue:g.$modelValue,form:i,model:c.model}));var j=function(a){if(!i)return a;if(c.options&&!1===c.options.tv4Validation)return a;var d=b.validate(i,a);Object.keys(g.$error).filter(function(a){return 0===a.indexOf("tv4-")}).forEach(function(a){g.$setValidity(a,!0)});{if(d.valid||g.$pristine)return a;if(g.$setValidity("tv4-"+d.error.code,!1),h=d.error,g.$validators)return a}};"function"==typeof i.ngModel&&i.ngModel(g),["$parsers","$viewChangeListeners","$formatters"].forEach(function(a){i[a]&&g[a]&&i[a].forEach(function(b){g[a].push(b)})}),["$validators","$asyncValidators"].forEach(function(b){i[b]&&g[b]&&a.forEach(i[b],function(a,c){g[b][c]=a})}),g.$parsers.push(j),g.$validators&&(g.$validators.schemaForm=function(){return!Object.keys(g.$error).some(function(a){return"schemaForm"!==a})});var k=i.schema;c.validateField=function(a){void 0!=a&&g.$$parentForm.$name!==a||(k&&-1!==k.type.indexOf("array")&&j(g.$modelValue),g.$setDirty?(g.$setDirty(),g.$setViewValue(g.$viewValue),g.$commitViewValue(),i.required&&g.$isEmpty(g.$modelValue)&&g.$setValidity("tv4-302",!1)):g.$setViewValue(g.$viewValue))},g.$formatters.push(function(a){return!g.$pristine||!c.firstDigest||c.options&&!0===c.options.validateOnRender?(j(g.$modelValue),a):a}),c.$on("schemaFormValidate",function(a,b){c.validateField(b)}),c.schemaError=function(){return h}}}}]),e}),function(a,b){"function"==typeof define&&define.amd?define(["schemaForm"],b):"object"==typeof exports?module.exports=b(require("schemaForm")):a.bootstrapDecorator=b(a.schemaForm)}(this,function(a){return angular.module("schemaForm").run(["$templateCache",function(a){a.put("directives/decorators/bootstrap/actions-trcl.html",'<div class="btn-group schema-form-actions {{form.htmlClass}}" ng-transclude=""></div>'),a.put("directives/decorators/bootstrap/actions.html",'<div class="btn-group schema-form-actions {{form.htmlClass}}"><input ng-repeat-start="item in form.items" type="submit" class="btn {{ item.style || \'btn-default\' }} {{form.fieldHtmlClass}}" value="{{item.title}}" ng-if="item.type === \'submit\'"> <button ng-repeat-end="" class="btn {{ item.style || \'btn-default\' }} {{form.fieldHtmlClass}}" type="button" ng-disabled="form.readonly" ng-if="item.type !== \'submit\'" ng-click="buttonClick($event,item)"><span ng-if="item.icon" class="{{item.icon}}"></span>{{item.title}}</button></div>'),
a.put("directives/decorators/bootstrap/array.html",'<div sf-array="form" class="schema-form-array {{form.htmlClass}}" ng-model="$$value$$" ng-model-options="form.ngModelOptions"><label class="control-label" ng-show="showTitle()">{{ form.title }}</label><ol class="list-group" ng-model="modelArray" ui-sortable=""><li class="list-group-item {{form.fieldHtmlClass}}" ng-repeat="item in modelArray track by $index"><button ng-hide="form.readonly || form.remove === null" ng-click="deleteFromArray($index)" style="position: relative; z-index: 20;" type="button" class="close pull-right"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><sf-decorator ng-init="arrayIndex = $index" form="copyWithIndex($index)"></sf-decorator></li></ol><div class="clearfix" style="padding: 15px;"><button ng-hide="form.readonly || form.add === null" ng-click="appendToArray()" type="button" class="btn {{ form.style.add || \'btn-default\' }} pull-right"><i class="glyphicon glyphicon-plus"></i> {{ form.add || \'Add\'}}</button></div><div class="help-block" ng-show="(hasError() && errorMessage(schemaError())) || form.description" ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></div></div>'),a.put("directives/decorators/bootstrap/checkbox.html",'<div class="checkbox schema-form-checkbox {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess()}"><label class="{{form.labelHtmlClass}}"><input type="checkbox" sf-changed="form" ng-disabled="form.readonly" ng-model="$$value$$" ng-model-options="form.ngModelOptions" schema-validate="form" class="{{form.fieldHtmlClass}}" name="{{form.key.slice(-1)[0]}}"> <span ng-bind-html="form.title"></span></label><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/checkboxes.html",'<div sf-array="form" ng-model="$$value$$" class="form-group schema-form-checkboxes {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess()}"><label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><div class="checkbox" ng-repeat="val in titleMapValues track by $index"><label><input type="checkbox" ng-disabled="form.readonly" sf-changed="form" class="{{form.fieldHtmlClass}}" ng-model="titleMapValues[$index]" name="{{form.key.slice(-1)[0]}}"> <span ng-bind-html="form.titleMap[$index].name"></span></label></div><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/default.html",'<div class="form-group schema-form-{{form.type}} {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false }"><label class="control-label {{form.labelHtmlClass}}" ng-class="{\'sr-only\': !showTitle()}" for="{{form.key.slice(-1)[0]}}">{{form.title}}</label> <input ng-if="!form.fieldAddonLeft && !form.fieldAddonRight" ng-show="form.key" type="{{form.type}}" step="{{form.step || \'any\'}}" sf-changed="form" placeholder="{{form.placeholder}}" class="form-control {{form.fieldHtmlClass}}" id="{{form.key.slice(-1)[0]}}" ng-model-options="form.ngModelOptions" ng-model="$$value$$" ng-disabled="form.readonly" schema-validate="form" name="{{form.key.slice(-1)[0]}}" aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}"><div ng-if="form.fieldAddonLeft || form.fieldAddonRight" ng-class="{\'input-group\': (form.fieldAddonLeft || form.fieldAddonRight)}"><span ng-if="form.fieldAddonLeft" class="input-group-addon" ng-bind-html="form.fieldAddonLeft"></span> <input ng-show="form.key" type="{{form.type}}" step="{{form.step}}" sf-changed="form" placeholder="{{form.placeholder}}" class="form-control {{form.fieldHtmlClass}}" id="{{form.key.slice(-1)[0]}}" ng-model-options="form.ngModelOptions" ng-model="$$value$$" ng-disabled="form.readonly" schema-validate="form" name="{{form.key.slice(-1)[0]}}" aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}"> <span ng-if="form.fieldAddonRight" class="input-group-addon" ng-bind-html="form.fieldAddonRight"></span></div><span ng-if="form.feedback !== false" class="form-control-feedback" ng-class="evalInScope(form.feedback) || {\'glyphicon\': true, \'glyphicon-ok\': hasSuccess(), \'glyphicon-remove\': hasError() }" aria-hidden="true"></span> <span ng-if="hasError() || hasSuccess()" id="{{form.key.slice(-1)[0] + \'Status\'}}" class="sr-only">{{ hasSuccess() ? \'(success)\' : \'(error)\' }}</span><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/fieldset-trcl.html",'<fieldset ng-disabled="form.readonly" class="schema-form-fieldset {{form.htmlClass}}"><legend ng-class="{\'sr-only\': !showTitle() }">{{ form.title }}</legend><div class="help-block" ng-show="form.description" ng-bind-html="form.description"></div><div ng-transclude=""></div></fieldset>'),a.put("directives/decorators/bootstrap/fieldset.html",'<fieldset ng-disabled="form.readonly" class="schema-form-fieldset {{form.htmlClass}}"><legend ng-class="{\'sr-only\': !showTitle() }">{{ form.title }}</legend><div class="help-block" ng-show="form.description" ng-bind-html="form.description"></div><sf-decorator ng-repeat="item in form.items" form="item"></sf-decorator></fieldset>'),a.put("directives/decorators/bootstrap/help.html",'<div class="helpvalue schema-form-helpvalue {{form.htmlClass}}" ng-bind-html="form.helpvalue"></div>'),a.put("directives/decorators/bootstrap/radio-buttons.html",'<div class="form-group schema-form-radiobuttons {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess()}"><div><label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label></div><div class="btn-group"><label class="btn {{ (item.value === $$value$$) ? form.style.selected || \'btn-default\' : form.style.unselected || \'btn-default\'; }}" ng-class="{ active: item.value === $$value$$ }" ng-repeat="item in form.titleMap"><input type="radio" class="{{form.fieldHtmlClass}}" sf-changed="form" style="display: none;" ng-disabled="form.readonly" ng-model="$$value$$" ng-model-options="form.ngModelOptions" schema-validate="form" ng-value="item.value" name="{{form.key.join(\'.\')}}"> <span ng-bind-html="item.name"></span></label></div><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/radios-inline.html",'<div class="form-group schema-form-radios-inline {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess()}"><label ng-model="$$value$$" ng-model-options="form.ngModelOptions" schema-validate="form" class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><div><label class="radio-inline" ng-repeat="item in form.titleMap"><input type="radio" class="{{form.fieldHtmlClass}}" sf-changed="form" ng-disabled="form.readonly" ng-model="$$value$$" ng-value="item.value" name="{{form.key.join(\'.\')}}"> <span ng-bind-html="item.name"></span></label></div><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/radios.html",'<div class="form-group schema-form-radios {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess()}"><label ng-model="$$value$$" ng-model-options="form.ngModelOptions" schema-validate="form" class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><div class="radio" ng-repeat="item in form.titleMap"><label><input type="radio" class="{{form.fieldHtmlClass}}" sf-changed="form" ng-disabled="form.readonly" ng-model="$$value$$" ng-value="item.value" name="{{form.key.join(\'.\')}}"> <span ng-bind-html="item.name"></span></label></div><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/section.html",'<div class="schema-form-section {{form.htmlClass}}"><sf-decorator ng-repeat="item in form.items" form="item"></sf-decorator></div>'),a.put("directives/decorators/bootstrap/select.html",'<div class="form-group {{form.htmlClass}} schema-form-select" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false}"><label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><select ng-model="$$value$$" ng-model-options="form.ngModelOptions" ng-disabled="form.readonly" sf-changed="form" class="form-control {{form.fieldHtmlClass}}" schema-validate="form" ng-options="item.value as item.name group by item.group for item in form.titleMap" name="{{form.key.slice(-1)[0]}}"></select><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/submit.html",'<div class="form-group schema-form-submit {{form.htmlClass}}"><input type="submit" class="btn {{ form.style || \'btn-primary\' }} {{form.fieldHtmlClass}}" value="{{form.title}}" ng-disabled="form.readonly" ng-if="form.type === \'submit\'"> <button class="btn {{ form.style || \'btn-default\' }}" type="button" ng-click="buttonClick($event,form)" ng-disabled="form.readonly" ng-if="form.type !== \'submit\'"><span ng-if="form.icon" class="{{form.icon}}"></span> {{form.title}}</button></div>'),a.put("directives/decorators/bootstrap/tabarray.html",'<div sf-array="form" ng-init="selected = { tab: 0 }" class="clearfix schema-form-tabarray schema-form-tabarray-{{form.tabType || \'left\'}} {{form.htmlClass}}"><div ng-if="!form.tabType || form.tabType !== \'right\'" ng-class="{\'col-xs-3\': !form.tabType || form.tabType === \'left\'}"><ul class="nav nav-tabs" ng-class="{ \'tabs-left\': !form.tabType || form.tabType === \'left\'}"><li ng-repeat="item in modelArray track by $index" ng-click="$event.preventDefault() || (selected.tab = $index)" ng-class="{active: selected.tab === $index}"><a href="#">{{interp(form.title,{\'$index\':$index, value: item}) || $index}}</a></li><li ng-hide="form.readonly" ng-click="$event.preventDefault() || (selected.tab = appendToArray().length - 1)"><a href="#"><i class="glyphicon glyphicon-plus"></i> {{ form.add || \'Add\'}}</a></li></ul></div><div ng-class="{\'col-xs-9\': !form.tabType || form.tabType === \'left\' || form.tabType === \'right\'}"><div class="tab-content {{form.fieldHtmlClass}}"><div class="tab-pane clearfix" ng-repeat="item in modelArray track by $index" ng-show="selected.tab === $index" ng-class="{active: selected.tab === $index}"><sf-decorator ng-init="arrayIndex = $index" form="copyWithIndex($index)"></sf-decorator><button ng-hide="form.readonly" ng-click="selected.tab = deleteFromArray($index).length - 1" type="button" class="btn {{ form.style.remove || \'btn-default\' }} pull-right"><i class="glyphicon glyphicon-trash"></i> {{ form.remove || \'Remove\'}}</button></div></div></div><div ng-if="form.tabType === \'right\'" class="col-xs-3"><ul class="nav nav-tabs tabs-right"><li ng-repeat="item in modelArray track by $index" ng-click="$event.preventDefault() || (selected.tab = $index)" ng-class="{active: selected.tab === $index}"><a href="#">{{interp(form.title,{\'$index\':$index, value: item}) || $index}}</a></li><li ng-hide="form.readonly" ng-click="$event.preventDefault() || appendToArray()"><a href="#"><i class="glyphicon glyphicon-plus"></i> {{ form.add || \'Add\'}}</a></li></ul></div></div>'),a.put("directives/decorators/bootstrap/tabs.html",'<div ng-init="selected = { tab: form.selectedTabIndex }" class="schema-form-tabs {{form.htmlClass}}"><ul class="nav nav-tabs"><li ng-repeat="tab in form.tabs" ng-disabled="form.readonly" ng-show="tab.hidden !== true" ng-click="$event.preventDefault() || (selected.tab = $index)" ng-class="{active: selected.tab === $index}"><a href="#">{{ tab.title }}</a></li></ul><div class="tab-content {{form.fieldHtmlClass}}"><div class="tab-pane" ng-disabled="form.readonly" ng-repeat="tab in form.tabs" ng-show="selected.tab === $index" ng-class="{active: selected.tab === $index}"><bootstrap-decorator ng-repeat="item in tab.items" form="item"></bootstrap-decorator></div></div></div>'),a.put("directives/decorators/bootstrap/textarea.html",'<div class="form-group has-feedback {{form.htmlClass}} schema-form-textarea" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess()}"><label class="{{form.labelHtmlClass}}" ng-class="{\'sr-only\': !showTitle()}" for="{{form.key.slice(-1)[0]}}">{{form.title}}</label> <textarea ng-if="!form.fieldAddonLeft && !form.fieldAddonRight" class="form-control {{form.fieldHtmlClass}}" id="{{form.key.slice(-1)[0]}}" sf-changed="form" placeholder="{{form.placeholder}}" ng-disabled="form.readonly" ng-model="$$value$$" ng-model-options="form.ngModelOptions" schema-validate="form" name="{{form.key.slice(-1)[0]}}"></textarea><div ng-if="form.fieldAddonLeft || form.fieldAddonRight" ng-class="{\'input-group\': (form.fieldAddonLeft || form.fieldAddonRight)}"><span ng-if="form.fieldAddonLeft" class="input-group-addon" ng-bind-html="form.fieldAddonLeft"></span> <textarea class="form-control {{form.fieldHtmlClass}}" id="{{form.key.slice(-1)[0]}}" sf-changed="form" placeholder="{{form.placeholder}}" ng-disabled="form.readonly" ng-model="$$value$$" ng-model-options="form.ngModelOptions" schema-validate="form" name="{{form.key.slice(-1)[0]}}"></textarea> <span ng-if="form.fieldAddonRight" class="input-group-addon" ng-bind-html="form.fieldAddonRight"></span></div><span class="help-block" sf-message="form.description"></span></div>')}]),angular.module("schemaForm").config(["schemaFormDecoratorsProvider",function(a){var b="directives/decorators/bootstrap/";a.defineDecorator("bootstrapDecorator",{textarea:{template:b+"textarea.html",replace:!1},fieldset:{template:b+"fieldset.html",replace:!1},array:{template:b+"array.html",replace:!1},tabarray:{template:b+"tabarray.html",replace:!1},tabs:{template:b+"tabs.html",replace:!1},section:{template:b+"section.html",replace:!1},conditional:{template:b+"section.html",replace:!1},actions:{template:b+"actions.html",replace:!1},select:{template:b+"select.html",replace:!1},checkbox:{template:b+"checkbox.html",replace:!1},checkboxes:{template:b+"checkboxes.html",replace:!1},number:{template:b+"default.html",replace:!1},password:{template:b+"default.html",replace:!1},submit:{template:b+"submit.html",replace:!1},button:{template:b+"submit.html",replace:!1},radios:{template:b+"radios.html",replace:!1},"radios-inline":{template:b+"radios-inline.html",replace:!1},radiobuttons:{template:b+"radio-buttons.html",replace:!1},help:{template:b+"help.html",replace:!1},default:{template:b+"default.html",replace:!1}},[]),a.createDirectives({textarea:b+"textarea.html",select:b+"select.html",checkbox:b+"checkbox.html",checkboxes:b+"checkboxes.html",number:b+"default.html",submit:b+"submit.html",button:b+"submit.html",text:b+"default.html",date:b+"default.html",password:b+"default.html",datepicker:b+"datepicker.html",input:b+"default.html",radios:b+"radios.html","radios-inline":b+"radios-inline.html",radiobuttons:b+"radio-buttons.html"})}]).directive("sfFieldset",function(){return{transclude:!0,scope:!0,templateUrl:"directives/decorators/bootstrap/fieldset-trcl.html",link:function(a,b,c){a.title=a.$eval(c.title)}}}),a}),angular.module("schemaForm").run(["$templateCache",function(a){a.put("directives/decorators/bootstrap/colorpicker/colorpicker.html","<div class=\"form-group\" ng-class=\"{'has-error': hasError()}\">\n  <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n  <div ng-init=\"defaultSpectrumOptions = {\n                  showInput: true,\n                  showAlpha: true,\n                  allowEmpty: true,\n                  showPalette: true,\n                  preferredFormat: form.colorFormat || 'rgb',\n                  palette: [['#fce94f', '#fcaf3e', '#e9b96e'],\n                  ['#8ae234', '#729fcf', '#ad7fa8'],\n                  ['#ef2929', '#888a85', '#deface']]\n                }\">\n    <spectrum-colorpicker\n      ng-model=\"$$value$$\"\n      format=\"form.colorFormat || 'rgb'\"\n      style=\"background-color: white\"\n      type=\"color\"\n      schema-validate=\"form\"\n      options=\"form.spectrumOptions || defaultSpectrumOptions\"></spectrum-colorpicker>\n</div>\n  <span class=\"help-block\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\n</div>\n")}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(a,b,c){var d=function(b,d,e){if(("string"===d.type||"array"===d.type)&&"color"==d.format){var f=a.stdFormObj(b,d,e);return f.key=e.path,f.type="colorpicker",e.lookup[c.stringify(e.path)]=f,f}};a.defaults.string.unshift(d),b.addMapping("bootstrapDecorator","colorpicker","directives/decorators/bootstrap/colorpicker/colorpicker.html"),b.createDirective("colorpicker","directives/decorators/bootstrap/colorpicker/colorpicker.html")}]),angular.module("schemaForm").run(["$templateCache",function(a){a.put("directives/decorators/bootstrap/codemirror/codemirror.html",'<div class="form-group" ng-class="{\'has-error\': hasError()}" ng-init="codemirrorOptions = {foo: \'bar\'}"><label class="control-label" ng-show="showTitle()">{{form.title}}</label><div ng-if="form.codemirrorButtons" class="cm-buttons"><span class="btn-group" ng-repeat="buttonGroup in form.codemirrorButtons"><button ng-repeat="button in buttonGroup" ng-click="evalInScope(button.onClick)" type="button" class="btn btn-sm btn-default" id="btnBold" title="{{ button.title }}"><span ng-if="button.icon" class="glyphicon" ng-class="\'glyphicon-\' + button.icon"></span> <span ng-if="button.label" ng-bind-html="button.label"></span></button></span></div><div codemirror-buttons="" ui-codemirror="" ui-codemirror-opts="getCodemirrorOptions()" ng-style="form.style" ng-model="$$value$$" schema-validate="form"></div><span class="help-block">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span></div>')}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider",function(a,b){b.addMapping("bootstrapDecorator","codemirror","directives/decorators/bootstrap/codemirror/codemirror.html"),b.createDirective("codemirror","directives/decorators/bootstrap/codemirror/codemirror.html")}]).directive("codemirrorButtons",function(){return{controller:["$scope",function(a){a.getCodemirrorOptions=function(){var b=angular.copy(a.form.codemirrorOptions);return b.onLoad=function(b){a.cm=b},b}}]}}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function b(b,d){function e(){b.display.wrapper.offsetHeight?(c(b,d),b.display.lastWrapHeight!=b.display.wrapper.clientHeight&&b.refresh()):d.timeout=setTimeout(e,d.delay)}d.timeout=setTimeout(e,d.delay),d.hurry=function(){clearTimeout(d.timeout),d.timeout=setTimeout(e,50)},a.on(window,"mouseup",d.hurry),a.on(window,"keyup",d.hurry)}function c(b,c){clearTimeout(c.timeout),a.off(window,"mouseup",c.hurry),a.off(window,"keyup",c.hurry)}a.defineOption("autoRefresh",!1,function(a,d){a.state.autoRefresh&&(c(a,a.state.autoRefresh),a.state.autoRefresh=null),d&&0==a.display.wrapper.offsetHeight&&b(a,a.state.autoRefresh={delay:d.delay||250})})}),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(a,b,c){var d=function(b,d,e){if("array"===d.type&&"singlefile"===d.format){d.pattern&&d.pattern.mimeType&&!d.pattern.validationMessage&&(d.pattern.validationMessage="Wrong file type. Allowed types are "),d.maxSize&&d.maxSize.maximum&&!d.maxSize.validationMessage&&(d.maxSize.validationMessage="This file is too large. Maximum size allowed is ",d.maxSize.validationMessage2="Current file size:"),d.minItems&&d.minItems.minimum&&!d.minItems.validationMessage&&(d.minItems.validationMessage="You have to upload at least one file"),d.maxItems&&d.maxItems.maximum&&!d.maxItems.validationMessage&&(d.maxItems.validationMessage="You can't upload more than one file.");var f=a.stdFormObj(b,d,e);return f.key=e.path,f.type="nwpFileUpload",e.lookup[c.stringify(e.path)]=f,f}};a.defaults.array.unshift(d);var e=function(b,d,e){if("array"===d.type&&"multifile"===d.format){d.pattern&&d.pattern.mimeType&&!d.pattern.validationMessage&&(d.pattern.validationMessage="Wrong file type. Allowed types are "),d.maxSize&&d.maxSize.maximum&&!d.maxSize.validationMessage&&(d.maxSize.validationMessage="This file is too large. Maximum size allowed is ",d.maxSize.validationMessage2="Current file size:"),d.minItems&&d.minItems.minimum&&!d.minItems.validationMessage&&(d.minItems.validationMessage="You have to upload at least one file"),d.maxItems&&d.maxItems.maximum&&!d.maxItems.validationMessage&&(d.maxItems.validationMessage="You can't upload more than one file.");var f=a.stdFormObj(b,d,e);return f.key=e.path,f.type="nwpFileUpload",e.lookup[c.stringify(e.path)]=f,f}};a.defaults.array.unshift(e),b.addMapping("bootstrapDecorator","nwpFileUpload","/UIComponents/dashboardBuilder/lib/schemaForm/nwp-file.html")}]),angular.module("ngSchemaFormFile",["ngFileUpload","ngMessages"]).directive("ngSchemaFile",["Upload","$timeout","$q",function(a,b,c){return{restrict:"A",scope:!0,require:"ngModel",link:function(c,d,e,f){function g(d){if(d&&!d.$error&&c.url){var e={url:c.url,file:{}};e.file[c.form.fileName||"file"]=d,d.upload=a.upload(e),d.upload.then(function(a){b(function(){d.result=a.data});var e=c.form.post?c.form.post(a.data):a.data;f.$setViewValue(e),f.$commitViewValue()},function(a){a.status>0&&(c.errorMsg=a.status+": "+a.data)}),d.upload.progress(function(a){d.progress=Math.min(100,parseInt(100*a.loaded/a.total))})}}c.url=c.form&&c.form.endpoint,c.isSinglefileUpload=c.form&&c.form.schema&&"singlefile"===c.form.schema.format,c.cdnImagesPath=cdnImagesPath,c.selectFile=function(a){c.picFile=a,c.$parent.model.image=a},c.removeFile=function(){c.picFile=null,c.$parent.model.image=null,c.uploadForm.file.$setDirty(!0)},c.selectFiles=function(a){c.picFiles=a},c.uploadFile=function(a){a&&g(a)},c.uploadFiles=function(a){a.length&&angular.forEach(a,function(a){g(a)})},c.validateField=function(){c.uploadForm.file&&c.uploadForm.file.$valid&&c.picFile&&!c.picFile.$error||c.uploadForm.files&&c.uploadForm.files.$valid&&c.picFiles&&c.picFiles.$error},c.submit=function(){c.uploadForm.file&&c.uploadForm.file.$valid&&c.picFile&&!c.picFile.$error?c.uploadFile(c.picFile):c.uploadForm.files&&c.uploadForm.files.$valid&&c.picFiles&&!c.picFiles.$error&&c.uploadFiles(c.picFiles)},c.$on("schemaFormValidate",c.validateField),c.$on("schemaFormFileUploadSubmit",c.submit)}}}]),function(a,b,c){"use strict";function d(a,c,d,e,f,g){function h(a,c){return angular.element((c||b).querySelectorAll(a))}function i(a){return j[a]?j[a]:j[a]=c.get(a,{cache:g}).then(function(a){return a.data})}this.compile=function(b){b.template&&/\.html$/.test(b.template)&&(console.warn("Deprecated use of `template` option to pass a file. Please use the `templateUrl` option instead."),b.templateUrl=b.template,b.template="");var c=b.templateUrl,g=b.template||"",j=b.controller,k=b.controllerAs,l=b.resolve||{},m=b.locals||{},n=b.transformTemplate||angular.identity,o=b.bindToController;if(angular.forEach(l,function(a,b){angular.isString(a)?l[b]=d.get(a):l[b]=d.invoke(a)}),angular.extend(l,m),g)l.$template=a.when(g);else{if(!c)throw new Error("Missing `template` / `templateUrl` option.");l.$template=i(c)}return b.titleTemplate&&(l.$template=a.all([l.$template,i(b.titleTemplate)]).then(function(a){var b=angular.element(a[0]);return h('[ng-bind="title"]',b[0]).removeAttr("ng-bind").html(a[1]),b[0].outerHTML})),b.contentTemplate&&(l.$template=a.all([l.$template,i(b.contentTemplate)]).then(function(a){var c=angular.element(a[0]),d=h('[ng-bind="content"]',c[0]).removeAttr("ng-bind").html(a[1]);return b.templateUrl||d.next().remove(),c[0].outerHTML})),a.all(l).then(function(a){var c=n(a.$template);b.html&&(c=c.replace(/ng-bind="/gi,'ng-bind-html="'));var d=angular.element("<div>").html(c.trim()).contents(),g=e(d);return{locals:a,element:d,link:function(b){if(a.$scope=b,j){var c=f(j,a,!0);o&&angular.extend(c.instance,a);var e=angular.isObject(c)?c:c();d.data("$ngControllerController",e),d.children().data("$ngControllerController",e),k&&(b[k]=e)}return g.apply(null,arguments)}}})};var j={}}d.$inject=["$q","$http","$injector","$compile","$controller","$templateCache"],angular.module("mgcrea.ngStrap.typeahead",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$typeahead",function(){var a=this.defaults={animation:"am-fade",prefixClass:"typeahead",prefixEvent:"$typeahead",placement:"bottom-left",templateUrl:"typeahead/typeahead.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,minLength:1,filter:"bsAsyncFilter",limit:6,autoSelect:!1,comparator:"",trimValue:!0};this.$get=["$window","$rootScope","$tooltip","$$rAF","$timeout",function(b,c,d,e,f){function g(b,c,g){var i={},j=angular.extend({},a,g);i=d(b,j);var k=g.scope,l=i.$scope;l.$resetMatches=function(){l.$matches=[],l.$activeIndex=j.autoSelect?0:-1},l.$resetMatches(),l.$activate=function(a){l.$$postDigest(function(){i.activate(a)})},l.$select=function(a,b){l.$$postDigest(function(){i.select(a)})},l.$isVisible=function(){return i.$isVisible()},i.update=function(a){l.$matches=a,l.$activeIndex>=a.length&&(l.$activeIndex=j.autoSelect?0:-1),h(l),e(i.$applyPlacement)},i.activate=function(a){l.$activeIndex=a},i.select=function(a){if(-1!==a){var b=l.$matches[a].value;c.$setViewValue(b),c.$render(),l.$resetMatches(),k&&k.$digest(),l.$emit(j.prefixEvent+".select",b,a,i),angular.isDefined(j.onSelect)&&angular.isFunction(j.onSelect)&&j.onSelect(b,a,i)}},i.$isVisible=function(){return j.minLength&&c?l.$matches.length&&angular.isString(c.$viewValue)&&c.$viewValue.length>=j.minLength:!!l.$matches.length},i.$getIndex=function(a){var b;for(b=l.$matches.length;b--&&!angular.equals(l.$matches[b].value,a););return b},i.$onMouseDown=function(a){a.preventDefault(),a.stopPropagation()},i.$$updateScrollTop=function(a,b){if(b>-1&&b<a.children.length){var c=a.children[b],d=c.offsetTop,e=c.offsetTop+c.clientHeight,f=a.scrollTop,g=a.scrollTop+a.clientHeight;e>=f&&d<f?a.scrollTop=Math.max(0,a.scrollTop-a.clientHeight):e>g&&(a.scrollTop=d)}},i.$onKeyDown=function(a){/(38|40|13)/.test(a.keyCode)&&(!i.$isVisible()||13===a.keyCode&&-1===l.$activeIndex||(a.preventDefault(),a.stopPropagation()),13===a.keyCode&&l.$matches.length?i.select(l.$activeIndex):38===a.keyCode&&l.$activeIndex>0?l.$activeIndex--:40===a.keyCode&&l.$activeIndex<l.$matches.length-1?l.$activeIndex++:angular.isUndefined(l.$activeIndex)&&(l.$activeIndex=0),i.$$updateScrollTop(i.$element[0],l.$activeIndex),l.$digest())};var m=i.show;i.show=function(){m(),f(function(){i.$element&&(i.$element.on("mousedown",i.$onMouseDown),j.keyboard&&b&&b.on("keydown",i.$onKeyDown))},0,!1)};var n=i.hide;return i.hide=function(){i.$element&&i.$element.off("mousedown",i.$onMouseDown),j.keyboard&&b&&b.off("keydown",i.$onKeyDown),j.autoSelect||i.activate(-1),n()},i}function h(a){a.$$phase||a.$root&&a.$root.$$phase||a.$digest()}return g.defaults=a,g}]}).filter("bsAsyncFilter",["$filter",function(a){return function(b,c,d){return b&&angular.isFunction(b.then)?b.then(function(b){return a("filter")(b,c,d)}):a("filter")(b,c,d)}}]).directive("bsTypeahead",["$window","$parse","$q","$typeahead","$parseOptions",function(a,b,c,d,e){var f=d.defaults;return{restrict:"EAC",require:"ngModel",link:function(a,b,c,g){b.off("change");var h={scope:a};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","filter","limit","minLength","watchOptions","selectMode","autoSelect","comparator","id","prefixEvent","prefixClass"],function(a){angular.isDefined(c[a])&&(h[a]=c[a])});var i=/^(false|0|)$/i;angular.forEach(["html","container","trimValue","filter"],function(a){angular.isDefined(c[a])&&i.test(c[a])&&(h[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide","onSelect"],function(b){var d="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(c[d])&&(h[b]=a.$eval(c[d]))}),b.attr("autocomplete")||b.attr("autocomplete","off");var j=angular.isDefined(h.filter)?h.filter:f.filter,k=h.limit||f.limit,l=h.comparator||f.comparator,m=c.bsOptions;j&&(m+=" | "+j+":$viewValue",l&&(m+=":"+l)),k&&(m+=" | limitTo:"+k);var n=e(m),o=d(b,g,h);if(h.watchOptions){var p=n.$match[7].replace(/\|.+/,"").replace(/\(.*\)/g,"").trim();a.$watchCollection(p,function(b,c){n.valuesFn(a,g).then(function(a){o.update(a),g.$render()})})}a.$watch(c.ngModel,function(b,c){a.$modelValue=b,n.valuesFn(a,g).then(function(a){if(h.selectMode&&!a.length&&b.length>0)return void g.$setViewValue(g.$viewValue.substring(0,g.$viewValue.length-1));a.length>k&&(a=a.slice(0,k)),o.update(a),g.$render()})}),g.$formatters.push(function(a){var b=n.displayValue(a);return b||(angular.isDefined(a)&&"object"!=typeof a?a:"")}),g.$render=function(){if(g.$isEmpty(g.$viewValue))return b.val("");var a=o.$getIndex(g.$modelValue),c=-1!==a?o.$scope.$matches[a].label:g.$viewValue;c=angular.isObject(c)?n.displayValue(c):c;var d=c?c.toString().replace(/<(?:.|\n)*?>/gm,""):"",e=b[0].selectionStart,f=b[0].selectionEnd;b.val(!1===h.trimValue?d:d.trim()),b[0].setSelectionRange(e,f)},a.$on("$destroy",function(){o&&o.destroy(),h=null,o=null})}}}]),angular.module("mgcrea.ngStrap.tooltip",["mgcrea.ngStrap.core","mgcrea.ngStrap.helpers.dimensions"]).provider("$tooltip",function(){var a=this.defaults={animation:"am-fade",customClass:"",prefixClass:"tooltip",prefixEvent:"tooltip",container:!1,target:!1,placement:"top",templateUrl:"tooltip/tooltip.tpl.html",template:"",titleTemplate:!1,trigger:"hover focus",keyboard:!1,html:!1,show:!1,title:"",type:"",delay:0,autoClose:!1,bsEnabled:!0,mouseDownPreventDefault:!0,mouseDownStopPropagation:!0,viewport:{selector:"body",padding:0}};this.$get=["$window","$rootScope","$bsCompiler","$q","$templateCache","$http","$animate","$sce","dimensions","$$rAF","$timeout",function(c,d,e,f,g,h,i,j,k,l,m){function n(f,g){function h(){I.$emit(G.prefixEvent+".show",F),angular.isDefined(G.onShow)&&angular.isFunction(G.onShow)&&G.onShow(F)}function n(){if(I.$emit(G.prefixEvent+".hide",F),angular.isDefined(G.onHide)&&angular.isFunction(G.onHide)&&G.onHide(F),O===S){if(R&&"focus"===G.trigger)return f[0].blur();E()}}function q(){var a=G.trigger.split(" ");angular.forEach(a,function(a){"click"===a||"contextmenu"===a?f.on(a,F.toggle):"manual"!==a&&(f.on("hover"===a?"mouseenter":"focus",F.enter),f.on("hover"===a?"mouseleave":"blur",F.leave),"button"===J&&"hover"!==a&&f.on(r?"touchstart":"mousedown",F.$onFocusElementMouseDown))})}function t(){for(var a=G.trigger.split(" "),b=a.length;b--;){var c=a[b];"click"===c||"contextmenu"===c?f.off(c,F.toggle):"manual"!==c&&(f.off("hover"===c?"mouseenter":"focus",F.enter),f.off("hover"===c?"mouseleave":"blur",F.leave),"button"===J&&"hover"!==c&&f.off(r?"touchstart":"mousedown",F.$onFocusElementMouseDown))}}function u(){"focus"!==G.trigger?O.on("keyup",F.$onKeyUp):f.on("keyup",F.$onFocusKeyUp)}function v(){"focus"!==G.trigger?O.off("keyup",F.$onKeyUp):f.off("keyup",F.$onFocusKeyUp)}function w(){m(function(){O.on("click",y),s.on("click",F.hide),T=!0},0,!1)}function x(){T&&(O.off("click",y),s.off("click",F.hide),T=!1)}
function y(a){a.stopPropagation()}function z(a){a=a||G.target||f;var d=a[0],e="BODY"===d.tagName,g=d.getBoundingClientRect(),h={};for(var i in g)h[i]=g[i];null===h.width&&(h=angular.extend({},h,{width:g.right-g.left,height:g.bottom-g.top}));var j=e?{top:0,left:0}:k.offset(d),l={scroll:e?b.documentElement.scrollTop||b.body.scrollTop:a.prop("scrollTop")||0},m=e?{width:b.documentElement.clientWidth,height:c.innerHeight}:null;return angular.extend({},h,l,m,j)}function A(a,b,c,d){var e,f=a.split("-");switch(f[0]){case"right":e={top:b.top+b.height/2-d/2,left:b.left+b.width};break;case"bottom":e={top:b.top+b.height,left:b.left+b.width/2-c/2};break;case"left":e={top:b.top+b.height/2-d/2,left:b.left-c};break;default:e={top:b.top-d,left:b.left+b.width/2-c/2}}if(!f[1])return e;if("top"===f[0]||"bottom"===f[0])switch(f[1]){case"left":e.left=b.left;break;case"right":e.left=b.left+b.width-c}else if("left"===f[0]||"right"===f[0])switch(f[1]){case"top":e.top=b.top-d+b.height;break;case"bottom":e.top=b.top}return e}function B(a,b){var c=O[0],d=c.offsetWidth,e=c.offsetHeight,f=parseInt(k.css(c,"margin-top"),10),g=parseInt(k.css(c,"margin-left"),10);isNaN(f)&&(f=0),isNaN(g)&&(g=0),a.top=a.top+f,a.left=a.left+g,k.setOffset(c,angular.extend({using:function(a){O.css({top:Math.round(a.top)+"px",left:Math.round(a.left)+"px",right:""})}},a),0);var h=c.offsetWidth,i=c.offsetHeight;if("top"===b&&i!==e&&(a.top=a.top+e-i),!/top-left|top-right|bottom-left|bottom-right/.test(b)){var j=C(b,a,h,i);if(j.left?a.left+=j.left:a.top+=j.top,k.setOffset(c,a),/top|right|bottom|left/.test(b)){var l=/top|bottom/.test(b);D(l?2*j.left-d+h:2*j.top-e+i,c[l?"offsetWidth":"offsetHeight"],l)}}}function C(a,b,c,d){var e={top:0,left:0};if(!F.$viewport)return e;var f=G.viewport&&G.viewport.padding||0,g=z(F.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e}function D(a,b,c){p(".tooltip-arrow, .arrow",O[0]).css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")}function E(){clearTimeout(L),F.$isShown&&null!==O&&(G.autoClose&&x(),G.keyboard&&v()),Q&&(Q.$destroy(),Q=null),O&&(O.remove(),O=F.$element=null)}var F={},G=F.$options=angular.extend({},a,g),H=F.$promise=e.compile(G),I=F.$scope=G.scope&&G.scope.$new()||d.$new(),J=f[0].nodeName.toLowerCase();if(G.delay&&angular.isString(G.delay)){var K=G.delay.split(",").map(parseFloat);G.delay=K.length>1?{show:K[0],hide:K[1]}:K[0]}F.$id=G.id||f.attr("id")||"",G.title&&(I.title=j.trustAsHtml(G.title)),I.$setEnabled=function(a){I.$$postDigest(function(){F.setEnabled(a)})},I.$hide=function(){I.$$postDigest(function(){F.hide()})},I.$show=function(){I.$$postDigest(function(){F.show()})},I.$toggle=function(){I.$$postDigest(function(){F.toggle()})},F.$isShown=I.$isShown=!1;var L,M,N,O,P,Q;H.then(function(a){N=a,F.init()}),F.init=function(){G.delay&&angular.isNumber(G.delay)&&(G.delay={show:G.delay,hide:G.delay}),"self"===G.container?P=f:angular.isElement(G.container)?P=G.container:G.container&&(P=p(G.container)),q(),G.target&&(G.target=angular.isElement(G.target)?G.target:p(G.target)),G.show&&I.$$postDigest(function(){"focus"===G.trigger?f[0].focus():F.show()})},F.destroy=function(){t(),E(),I.$destroy()},F.enter=function(){if(clearTimeout(L),M="in",!G.delay||!G.delay.show)return F.show();L=setTimeout(function(){"in"===M&&F.show()},G.delay.show)},F.show=function(){if(G.bsEnabled&&!F.$isShown){I.$emit(G.prefixEvent+".show.before",F),angular.isDefined(G.onBeforeShow)&&angular.isFunction(G.onBeforeShow)&&G.onBeforeShow(F);var a,b;G.container?(a=P,b=P[0].lastChild?angular.element(P[0].lastChild):null):(a=null,b=f),O&&E(),Q=F.$scope.$new(),O=F.$element=N.link(Q,function(a,b){}),O.css({top:"-9999px",left:"-9999px",right:"auto",display:"block",visibility:"hidden"}),G.animation&&O.addClass(G.animation),G.type&&O.addClass(G.prefixClass+"-"+G.type),G.customClass&&O.addClass(G.customClass),b?b.after(O):a.prepend(O),F.$isShown=I.$isShown=!0,o(I),F.$applyPlacement(),angular.version.minor<=2?i.enter(O,a,b,h):i.enter(O,a,b).then(h),o(I),l(function(){O&&O.css({visibility:"visible"}),G.keyboard&&("focus"!==G.trigger&&F.focus(),u())}),G.autoClose&&w()}},F.leave=function(){if(clearTimeout(L),M="out",!G.delay||!G.delay.hide)return F.hide();L=setTimeout(function(){"out"===M&&F.hide()},G.delay.hide)};var R,S;F.hide=function(a){F.$isShown&&(I.$emit(G.prefixEvent+".hide.before",F),angular.isDefined(G.onBeforeHide)&&angular.isFunction(G.onBeforeHide)&&G.onBeforeHide(F),R=a,S=O,null!==O&&(angular.version.minor<=2?i.leave(O,n):i.leave(O).then(n)),F.$isShown=I.$isShown=!1,o(I),G.keyboard&&null!==O&&v(),G.autoClose&&null!==O&&x())},F.toggle=function(a){a&&a.preventDefault(),F.$isShown?F.leave():F.enter()},F.focus=function(){O[0].focus()},F.setEnabled=function(a){G.bsEnabled=a},F.setViewport=function(a){G.viewport=a},F.$applyPlacement=function(){if(O){var b=G.placement,c=/\s?auto?\s?/i,d=c.test(b);d&&(b=b.replace(c,"")||a.placement),O.addClass(G.placement);var e=z(),f=O.prop("offsetWidth"),g=O.prop("offsetHeight");if(F.$viewport=G.viewport&&p(G.viewport.selector||G.viewport),d){var h=b,i=z(F.$viewport);/bottom/.test(h)&&e.bottom+g>i.bottom?b=h.replace("bottom","top"):/top/.test(h)&&e.top-g<i.top&&(b=h.replace("top","bottom")),/left/.test(h)&&e.left-f<i.left?b=b.replace("left","right"):/right/.test(h)&&e.right+f>i.width&&(b=b.replace("right","left")),O.removeClass(h).addClass(b)}B(A(b,e,f,g),b)}},F.$onKeyUp=function(a){27===a.which&&F.$isShown&&(F.hide(),a.stopPropagation())},F.$onFocusKeyUp=function(a){27===a.which&&(f[0].blur(),a.stopPropagation())},F.$onFocusElementMouseDown=function(a){G.mouseDownPreventDefault&&a.preventDefault(),G.mouseDownStopPropagation&&a.stopPropagation(),F.$isShown?f[0].blur():f[0].focus()};var T=!1;return F}function o(a){a.$$phase||a.$root&&a.$root.$$phase||a.$digest()}function p(a,c){return angular.element((c||b).querySelectorAll(a))}var q=/(ip[ao]d|iphone|android)/gi.test(c.navigator.userAgent),r="createTouch"in c.document&&q,s=angular.element(c.document);return n}]}).directive("bsTooltip",["$window","$location","$sce","$parse","$tooltip","$$rAF",function(a,b,c,d,e,f){return{restrict:"EAC",scope:!0,link:function(a,b,d,g){var h,i={scope:a};angular.forEach(["template","templateUrl","controller","controllerAs","titleTemplate","placement","container","delay","trigger","html","animation","backdropAnimation","type","customClass","id"],function(a){angular.isDefined(d[a])&&(i[a]=d[a])});var j=/^(false|0|)$/i;angular.forEach(["html","container"],function(a){angular.isDefined(d[a])&&j.test(d[a])&&(i[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(d[c])&&(i[b]=a.$eval(d[c]))});var k=b.attr("data-target");angular.isDefined(k)&&(j.test(k)?i.target=!1:i.target=k),a.hasOwnProperty("title")||(a.title=""),d.$observe("title",function(b){if(angular.isDefined(b)||!a.hasOwnProperty("title")){var d=a.title;a.title=c.trustAsHtml(b),angular.isDefined(d)&&f(function(){h&&h.$applyPlacement()})}}),d.$observe("disabled",function(a){a&&h.$isShown&&h.hide()}),d.bsTooltip&&a.$watch(d.bsTooltip,function(b,c){angular.isObject(b)?angular.extend(a,b):a.title=b,angular.isDefined(c)&&f(function(){h&&h.$applyPlacement()})},!0),d.bsShow&&a.$watch(d.bsShow,function(a,b){h&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|,?(tooltip),?/i)),!0===a?h.show():h.hide())}),d.bsEnabled&&a.$watch(d.bsEnabled,function(a,b){h&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|1|,?(tooltip),?/i)),!1===a?h.setEnabled(!1):h.setEnabled(!0))}),d.viewport&&a.$watch(d.viewport,function(a){h&&angular.isDefined(a)&&h.setViewport(a)}),h=e(b,i),a.$on("$destroy",function(){h&&h.destroy(),i=null,h=null})}}}]),angular.module("mgcrea.ngStrap.timepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.helpers.dateFormatter","mgcrea.ngStrap.tooltip"]).provider("$timepicker",function(){var a=this.defaults={animation:"am-fade",defaultDate:"auto",prefixClass:"timepicker",placement:"bottom-left",templateUrl:"timepicker/timepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!0,timeType:"date",timeFormat:"shortTime",timezone:null,modelTimeFormat:null,autoclose:!1,minTime:-1/0,maxTime:1/0,length:5,hourStep:1,minuteStep:5,secondStep:5,roundDisplay:!1,iconUp:"glyphicon glyphicon-chevron-up",iconDown:"glyphicon glyphicon-chevron-down",arrowBehavior:"pager"};this.$get=["$window","$document","$rootScope","$sce","$dateFormatter","$tooltip","$timeout",function(b,c,d,e,f,g,h){function i(b,c,d){function e(a,c){var d=a+c;if(b[0].createTextRange){var e=b[0].createTextRange();e.collapse(!0),e.moveStart("character",a),e.moveEnd("character",d),e.select()}else b[0].setSelectionRange?b[0].setSelectionRange(a,d):angular.isUndefined(b[0].selectionStart)&&(b[0].selectionStart=a,b[0].selectionEnd=d)}function i(){b[0].focus()}var l=g(b,angular.extend({},a,d)),m=d.scope,n=l.$options,o=l.$scope,p=n.lang,q=function(a,b,c){return f.formatDate(a,b,p,c)},r=0,s=n.roundDisplay?function(a){var b=6e4*n.minuteStep;return new Date(Math.floor(a.getTime()/b)*b)}(new Date):new Date,t=c.$dateValue||s,u={hour:t.getHours(),meridian:t.getHours()<12,minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds()},v=f.getDatetimeFormat(n.timeFormat,p),w=f.hoursFormat(v),x=f.timeSeparator(v),y=f.minutesFormat(v),z=f.secondsFormat(v),A=f.showSeconds(v),B=f.showAM(v);o.$iconUp=n.iconUp,o.$iconDown=n.iconDown,o.$select=function(a,b){l.select(a,b)},o.$moveIndex=function(a,b){l.$moveIndex(a,b)},o.$switchMeridian=function(a){l.switchMeridian(a)},l.update=function(a){angular.isDate(a)&&!isNaN(a.getTime())?(l.$date=a,angular.extend(u,{hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds(),millisecond:a.getMilliseconds()}),l.$build()):l.$isBuilt||l.$build()},l.select=function(a,b,d){c.$dateValue&&!isNaN(c.$dateValue.getTime())||(c.$dateValue="today"===n.defaultDate?new Date:new Date(1970,0,1)),angular.isDate(a)||(a=new Date(a)),0===b?c.$dateValue.setHours(a.getHours()):1===b?c.$dateValue.setMinutes(a.getMinutes()):2===b&&c.$dateValue.setSeconds(a.getSeconds()),c.$setViewValue(angular.copy(c.$dateValue)),c.$render(),n.autoclose&&!d&&h(function(){l.hide(!0)})},l.switchMeridian=function(a){if(c.$dateValue&&!isNaN(c.$dateValue.getTime())){var b=(a||c.$dateValue).getHours();c.$dateValue.setHours(b<12?b+12:b-12),c.$setViewValue(angular.copy(c.$dateValue)),c.$render()}},l.$build=function(){var a,b,c=o.midIndex=parseInt(n.length/2,10),d=[];for(a=0;a<n.length;a++)b=new Date(1970,0,1,u.hour-(c-a)*n.hourStep),d.push({date:b,label:q(b,w),selected:l.$date&&l.$isSelected(b,0),disabled:l.$isDisabled(b,0)});var e,f=[];for(a=0;a<n.length;a++)e=new Date(1970,0,1,0,u.minute-(c-a)*n.minuteStep),f.push({date:e,label:q(e,y),selected:l.$date&&l.$isSelected(e,1),disabled:l.$isDisabled(e,1)});var g,h=[];for(a=0;a<n.length;a++)g=new Date(1970,0,1,0,0,u.second-(c-a)*n.secondStep),h.push({date:g,label:q(g,z),selected:l.$date&&l.$isSelected(g,2),disabled:l.$isDisabled(g,2)});var i=[];for(a=0;a<n.length;a++)A?i.push([d[a],f[a],h[a]]):i.push([d[a],f[a]]);o.rows=i,o.showSeconds=A,o.showAM=B,o.isAM=(l.$date||d[c].date).getHours()<12,o.timeSeparator=x,l.$isBuilt=!0},l.$isSelected=function(a,b){return!!l.$date&&(0===b?a.getHours()===l.$date.getHours():1===b?a.getMinutes()===l.$date.getMinutes():2===b?a.getSeconds()===l.$date.getSeconds():void 0)},l.$isDisabled=function(a,b){var c;return 0===b?c=a.getTime()+6e4*u.minute+1e3*u.second:1===b?c=a.getTime()+36e5*u.hour+1e3*u.second:2===b&&(c=a.getTime()+36e5*u.hour+6e4*u.minute),c<1*n.minTime||c>1*n.maxTime},o.$arrowAction=function(a,b){"picker"===n.arrowBehavior?l.$setTimeByStep(a,b):l.$moveIndex(a,b)},l.$setTimeByStep=function(a,b){var c=new Date(l.$date||t),d=c.getHours(),e=c.getMinutes(),f=c.getSeconds();0===b?c.setHours(d-parseInt(n.hourStep,10)*a):1===b?c.setMinutes(e-parseInt(n.minuteStep,10)*a):2===b&&c.setSeconds(f-parseInt(n.secondStep,10)*a),l.select(c,b,!0)},l.$moveIndex=function(a,b){var c;0===b?(c=new Date(1970,0,1,u.hour+a*n.length,u.minute,u.second),angular.extend(u,{hour:c.getHours()})):1===b?(c=new Date(1970,0,1,u.hour,u.minute+a*n.length*n.minuteStep,u.second),angular.extend(u,{minute:c.getMinutes()})):2===b&&(c=new Date(1970,0,1,u.hour,u.minute,u.second+a*n.length*n.secondStep),angular.extend(u,{second:c.getSeconds()})),l.$build()},l.$onMouseDown=function(a){if("input"!==a.target.nodeName.toLowerCase()&&a.preventDefault(),a.stopPropagation(),k){var b=angular.element(a.target);"button"!==b[0].nodeName.toLowerCase()&&(b=b.parent()),b.triggerHandler("click")}},l.$onKeyDown=function(a){if(/(38|37|39|40|13)/.test(a.keyCode)&&!a.shiftKey&&!a.altKey){if(a.preventDefault(),a.stopPropagation(),13===a.keyCode)return void l.hide(!0);var b=new Date(l.$date),c=b.getHours(),d=q(b,w).length,f=b.getMinutes(),g=q(b,y).length,h=b.getSeconds(),i=q(b,z).length,j=/(37|39)/.test(a.keyCode),k=2+1*A+1*B;j&&(37===a.keyCode?r=r<1?k-1:r-1:39===a.keyCode&&(r=r<k-1?r+1:0));var o=[0,d],p=0;38===a.keyCode&&(p=-1),40===a.keyCode&&(p=1);var s=2===r&&A,t=2===r&&!A||3===r&&A;0===r?(b.setHours(c+p*parseInt(n.hourStep,10)),d=q(b,w).length,o=[0,d]):1===r?(b.setMinutes(f+p*parseInt(n.minuteStep,10)),g=q(b,y).length,o=[d+1,g]):s?(b.setSeconds(h+p*parseInt(n.secondStep,10)),i=q(b,z).length,o=[d+1+g+1,i]):t&&(j||l.switchMeridian(),o=[d+1+g+1+(i+1)*A,2]),l.select(b,r,!0),e(o[0],o[1]),m.$digest()}};var C=l.init;l.init=function(){if(j&&n.useNative)return b.prop("type","time"),void b.css("-webkit-appearance","textfield");k&&(b.prop("type","text"),b.attr("readonly","true"),b.on("click",i)),C()};var D=l.destroy;l.destroy=function(){j&&n.useNative&&b.off("click",i),D()};var E=l.show;l.show=function(){!k&&b.attr("readonly")||b.attr("disabled")||(E(),h(function(){l.$element&&l.$element.on(k?"touchstart":"mousedown",l.$onMouseDown),n.keyboard&&b&&b.on("keydown",l.$onKeyDown)},0,!1))};var F=l.hide;return l.hide=function(a){l.$isShown&&(l.$element&&l.$element.off(k?"touchstart":"mousedown",l.$onMouseDown),n.keyboard&&b&&b.off("keydown",l.$onKeyDown),F(a))},l}var j=/(ip[ao]d|iphone|android)/gi.test(b.navigator.userAgent),k="createTouch"in b.document&&j;return a.lang||(a.lang=f.getDefaultLocale()),i.defaults=a,i}]}).directive("bsTimepicker",["$window","$parse","$q","$dateFormatter","$dateParser","$timepicker",function(a,b,d,e,f,g){var h=g.defaults,i=/(ip[ao]d|iphone|android)/gi.test(a.navigator.userAgent);return{restrict:"EAC",require:"ngModel",link:function(a,b,d,j){function k(a){if(angular.isDate(a)){var b=isNaN(m.minTime)||new Date(a.getTime()).setFullYear(1970,0,1)>=m.minTime,c=isNaN(m.maxTime)||new Date(a.getTime()).setFullYear(1970,0,1)<=m.maxTime,d=b&&c;j.$setValidity("date",d),j.$setValidity("min",b),j.$setValidity("max",c),d&&(j.$dateValue=a)}}function l(){return!j.$dateValue||isNaN(j.$dateValue.getTime())?"":q(j.$dateValue,m.timeFormat)}var m={scope:a};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","autoclose","timeType","timeFormat","timezone","modelTimeFormat","useNative","hourStep","minuteStep","secondStep","length","arrowBehavior","iconUp","iconDown","roundDisplay","id","prefixClass","prefixEvent","defaultDate"],function(a){angular.isDefined(d[a])&&(m[a]=d[a])});var n=/^(false|0|)$/i;angular.forEach(["html","container","autoclose","useNative","roundDisplay"],function(a){angular.isDefined(d[a])&&n.test(d[a])&&(m[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(d[c])&&(m[b]=a.$eval(d[c]))}),i&&(m.useNative||h.useNative)&&(m.timeFormat="HH:mm");var o=g(b,j,m);m=o.$options;var p=m.lang,q=function(a,b,c){return e.formatDate(a,b,p,c)};d.bsShow&&a.$watch(d.bsShow,function(a,b){o&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|,?(timepicker),?/i)),!0===a?o.show():o.hide())});var r=f({format:m.timeFormat,lang:p});angular.forEach(["minTime","maxTime"],function(a){angular.isDefined(d[a])&&d.$observe(a,function(b){o.$options[a]=r.getTimeForAttribute(a,b),isNaN(o.$options[a])||o.$build(),k(j.$dateValue)})}),a.$watch(d.ngModel,function(a,b){o.update(j.$dateValue)},!0),j.$parsers.unshift(function(a){var b;if(!a)return j.$setValidity("date",!0),null;var d=angular.isDate(a)?a:r.parse(a,j.$dateValue);return!d||isNaN(d.getTime())?(j.$setValidity("date",!1),c):(k(d),"string"===m.timeType?(b=r.timezoneOffsetAdjust(d,m.timezone,!0),q(b,m.modelTimeFormat||m.timeFormat)):(b=r.timezoneOffsetAdjust(j.$dateValue,m.timezone,!0),"number"===m.timeType?b.getTime():"unix"===m.timeType?b.getTime()/1e3:"iso"===m.timeType?b.toISOString():new Date(b)))}),j.$formatters.push(function(a){var b;return b=angular.isUndefined(a)||null===a?NaN:angular.isDate(a)?a:"string"===m.timeType?r.parse(a,null,m.modelTimeFormat):"unix"===m.timeType?new Date(1e3*a):new Date(a),j.$dateValue=r.timezoneOffsetAdjust(b,m.timezone),l()}),j.$render=function(){b.val(l())},a.$on("$destroy",function(){o&&o.destroy(),m=null,o=null})}}}]),angular.module("mgcrea.ngStrap.tab",[]).provider("$tab",function(){var a=this.defaults={animation:"am-fade",template:"tab/tab.tpl.html",navClass:"nav-tabs",activeClass:"active"},b=this.controller=function(b,c,d){var e=this;e.$options=angular.copy(a),angular.forEach(["animation","navClass","activeClass"],function(a){angular.isDefined(d[a])&&(e.$options[a]=d[a])}),b.$navClass=e.$options.navClass,b.$activeClass=e.$options.activeClass,e.$panes=b.$panes=[],e.$activePaneChangeListeners=e.$viewChangeListeners=[],e.$push=function(a){angular.isUndefined(e.$panes.$active)&&b.$setActive(a.name||0),e.$panes.push(a)},e.$remove=function(a){var b,c=e.$panes.indexOf(a),d=e.$panes.$active;b=angular.isString(d)?e.$panes.map(function(a){return a.name}).indexOf(d):e.$panes.$active,e.$panes.splice(c,1),c<b?b--:c===b&&b===e.$panes.length&&b--,b>=0&&b<e.$panes.length?e.$setActive(e.$panes[b].name||b):e.$setActive()},e.$setActive=b.$setActive=function(a){e.$panes.$active=a,e.$activePaneChangeListeners.forEach(function(a){a()})},e.$isActive=b.$isActive=function(a,b){return e.$panes.$active===a.name||e.$panes.$active===b}};this.$get=function(){var c={};return c.defaults=a,c.controller=b,c}}).directive("bsTabs",["$window","$animate","$tab","$parse",function(a,b,c,d){var e=c.defaults;return{require:["?ngModel","bsTabs"],transclude:!0,scope:!0,controller:["$scope","$element","$attrs",c.controller],templateUrl:function(a,b){return b.template||e.template},link:function(a,b,c,e){var f=e[0],g=e[1];if(f&&(g.$activePaneChangeListeners.push(function(){f.$setViewValue(g.$panes.$active)}),f.$formatters.push(function(a){return g.$setActive(a),a})),c.bsActivePane){var h=d(c.bsActivePane);g.$activePaneChangeListeners.push(function(){h.assign(a,g.$panes.$active)}),a.$watch(c.bsActivePane,function(a,b){g.$setActive(a)},!0)}}}}]).directive("bsPane",["$window","$animate","$sce",function(a,b,c){return{require:["^?ngModel","^bsTabs"],scope:!0,link:function(a,d,e,f){function g(){var c=h.$panes.indexOf(a);b[h.$isActive(a,c)?"addClass":"removeClass"](d,h.$options.activeClass)}var h=f[1];d.addClass("tab-pane"),e.$observe("title",function(b,d){a.title=c.trustAsHtml(b)}),a.name=e.name,h.$options.animation&&d.addClass(h.$options.animation),e.$observe("disabled",function(b,c){a.disabled=a.$eval(b)}),h.$push(a),a.$on("$destroy",function(){h.$remove(a)}),h.$activePaneChangeListeners.push(function(){g()}),g()}}}]),angular.module("mgcrea.ngStrap.select",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$select",function(){var a=this.defaults={animation:"am-fade",prefixClass:"select",prefixEvent:"$select",placement:"bottom-left",templateUrl:"select/select.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,multiple:!1,allNoneButtons:!1,sort:!0,caretHtml:'&nbsp;<span class="caret"></span>',placeholder:"Choose among the following...",allText:"All",noneText:"None",maxLength:3,maxLengthHtml:"selected",iconCheckmark:"glyphicon glyphicon-ok",toggle:!1};this.$get=["$window","$document","$rootScope","$tooltip","$timeout",function(b,d,e,f,g){function h(e,h,i){var k={},l=angular.extend({},a,i);k=f(e,l);var m=k.$scope;m.$matches=[],l.multiple?m.$activeIndex=[]:m.$activeIndex=-1,m.$isMultiple=l.multiple,m.$showAllNoneButtons=l.allNoneButtons&&l.multiple,m.$iconCheckmark=l.iconCheckmark,m.$allText=l.allText,m.$noneText=l.noneText,m.$activate=function(a){m.$$postDigest(function(){k.activate(a)})},m.$select=function(a,b){m.$$postDigest(function(){k.select(a)})},m.$isVisible=function(){return k.$isVisible()},m.$isActive=function(a){return k.$isActive(a)},m.$selectAll=function(){for(var a=0;a<m.$matches.length;a++)m.$isActive(a)||m.$select(a)},m.$selectNone=function(){for(var a=0;a<m.$matches.length;a++)m.$isActive(a)&&m.$select(a)},k.update=function(a){m.$matches=a,k.$updateActiveIndex()},k.activate=function(a){return l.multiple?(k.$isActive(a)?m.$activeIndex.splice(m.$activeIndex.indexOf(a),1):m.$activeIndex.push(a),l.sort&&m.$activeIndex.sort(function(a,b){return a-b})):m.$activeIndex=a,m.$activeIndex},k.select=function(a){if(!(angular.isUndefined(a)||a<0||a>=m.$matches.length)){var b=m.$matches[a].value;m.$apply(function(){k.activate(a),l.multiple?h.$setViewValue(m.$activeIndex.map(function(a){return angular.isUndefined(m.$matches[a])?null:m.$matches[a].value})):(l.toggle?h.$setViewValue(b===h.$modelValue?c:b):h.$setViewValue(b),k.hide())}),m.$emit(l.prefixEvent+".select",b,a,k),angular.isDefined(l.onSelect)&&angular.isFunction(l.onSelect)&&l.onSelect(b,a,k)}},k.$updateActiveIndex=function(){l.multiple?angular.isArray(h.$modelValue)?m.$activeIndex=h.$modelValue.map(function(a){return k.$getIndex(a)}):m.$activeIndex=[]:angular.isDefined(h.$modelValue)&&m.$matches.length?m.$activeIndex=k.$getIndex(h.$modelValue):m.$activeIndex=-1},k.$isVisible=function(){return l.minLength&&h?m.$matches.length&&h.$viewValue.length>=l.minLength:m.$matches.length},k.$isActive=function(a){return l.multiple?-1!==m.$activeIndex.indexOf(a):m.$activeIndex===a},k.$getIndex=function(a){var b;for(b=m.$matches.length;b--&&!angular.equals(m.$matches[b].value,a););return b},k.$onMouseDown=function(a){if(a.preventDefault(),a.stopPropagation(),j){var b,c=angular.element(a.target);if("A"!==a.target.nodeName)for(var d=c.parent();!b&&d.length>0;)"A"===d[0].nodeName&&(b=d),d=d.parent();b?angular.element(b).triggerHandler("click"):c.triggerHandler("click")}},k.$onKeyDown=function(a){if(/(9|13|38|40)/.test(a.keyCode))return 9!==a.keyCode&&(a.preventDefault(),a.stopPropagation()),l.multiple&&9===a.keyCode?k.hide():l.multiple||13!==a.keyCode&&9!==a.keyCode?void(l.multiple||(38===a.keyCode&&m.$activeIndex>0?m.$activeIndex--:38===a.keyCode&&m.$activeIndex<0?m.$activeIndex=m.$matches.length-1:40===a.keyCode&&m.$activeIndex<m.$matches.length-1?m.$activeIndex++:angular.isUndefined(m.$activeIndex)&&(m.$activeIndex=0),m.$digest())):k.select(m.$activeIndex)},k.$isIE=function(){var a=b.navigator.userAgent;return a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0},k.$selectScrollFix=function(a){"UL"===d[0].activeElement.tagName&&(a.preventDefault(),a.stopImmediatePropagation(),a.target.focus())};var n=k.show;k.show=function(){n(),l.multiple&&k.$element.addClass("select-multiple"),g(function(){k.$element.on(j?"touchstart":"mousedown",k.$onMouseDown),l.keyboard&&e.on("keydown",k.$onKeyDown)},0,!1)};var o=k.hide;return k.hide=function(){!l.multiple&&angular.isUndefined(h.$modelValue)&&(m.$activeIndex=-1),k.$element.off(j?"touchstart":"mousedown",k.$onMouseDown),l.keyboard&&e.off("keydown",k.$onKeyDown),o(!0)},k}var i=/(ip[ao]d|iphone|android)/gi.test(b.navigator.userAgent),j="createTouch"in b.document&&i;return h.defaults=a,h}]}).directive("bsSelect",["$window","$parse","$q","$select","$parseOptions",function(a,b,c,d,e){var f=d.defaults;return{restrict:"EAC",require:"ngModel",link:function(a,b,c,g){var h={scope:a,placeholder:f.placeholder};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","placeholder","allNoneButtons","maxLength","maxLengthHtml","allText","noneText","iconCheckmark","autoClose","id","sort","caretHtml","prefixClass","prefixEvent","toggle"],function(a){angular.isDefined(c[a])&&(h[a]=c[a])});var i=/^(false|0|)$/i;angular.forEach(["html","container","allNoneButtons","sort"],function(a){angular.isDefined(c[a])&&i.test(c[a])&&(h[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide","onSelect"],function(b){var d="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(c[d])&&(h[b]=a.$eval(c[d]))});var j=b.attr("data-multiple");if(angular.isDefined(j)&&(i.test(j)?h.multiple=!1:h.multiple=j),"select"===b[0].nodeName.toLowerCase()){var k=b;k.css("display","none"),b=angular.element('<button type="button" class="btn btn-default"></button>'),k.after(b)}var l=e(c.bsOptions),m=d(b,g,h);m.$isIE()&&b[0].addEventListener("blur",m.$selectScrollFix);var n=l.$match[7].replace(/\|.+/,"").trim();a.$watch(n,function(b,c){l.valuesFn(a,g).then(function(a){m.update(a),g.$render()})},!0),a.$watch(c.ngModel,function(a,b){m.$updateActiveIndex(),g.$render()},!0),g.$render=function(){var a,c;h.multiple&&angular.isArray(g.$modelValue)?(a=g.$modelValue.map(function(a){return-1!==(c=m.$getIndex(a))&&m.$scope.$matches[c].label}).filter(angular.isDefined),a=a.length>(h.maxLength||f.maxLength)?a.length+" "+(h.maxLengthHtml||f.maxLengthHtml):a.join(", ")):(c=m.$getIndex(g.$modelValue),a=-1!==c&&m.$scope.$matches[c].label),b.html((a||h.placeholder)+(h.caretHtml||f.caretHtml))},h.multiple&&(g.$isEmpty=function(a){return!a||0===a.length}),a.$on("$destroy",function(){m&&m.destroy(),h=null,m=null})}}}]),angular.module("mgcrea.ngStrap.scrollspy",["mgcrea.ngStrap.helpers.debounce","mgcrea.ngStrap.helpers.dimensions"]).provider("$scrollspy",function(){var a=this.$$spies={},c=this.defaults={debounce:150,throttle:100,offset:100};this.$get=["$window","$document","$rootScope","dimensions","debounce","throttle",function(d,e,f,g,h,i){function j(a,b){return a[0].nodeName&&a[0].nodeName.toLowerCase()===b.toLowerCase()}function k(e){var k=angular.extend({},c,e);k.element||(k.element=n);var o=j(k.element,"body"),p=o?l:k.element,q=o?"window":k.id;if(a[q])return a[q].$$count++,a[q];var r,s,t,u,v,w,x,y,z={},A=z.$trackedElements=[],B=[];return z.init=function(){this.$$count=1,u=h(this.checkPosition,k.debounce),v=i(this.checkPosition,k.throttle),p.on("click",this.checkPositionWithEventLoop),l.on("resize",u),p.on("scroll",v),w=h(this.checkOffsets,k.debounce),r=f.$on("$viewContentLoaded",w),s=f.$on("$includeContentLoaded",w),w(),q&&(a[q]=z)},z.destroy=function(){--this.$$count>0||(p.off("click",this.checkPositionWithEventLoop),l.off("resize",u),p.off("scroll",v),r(),s(),q&&delete a[q])},z.checkPosition=function(){if(B.length){if(y=(o?d.pageYOffset:p.prop("scrollTop"))||0,x=Math.max(d.innerHeight,m.prop("clientHeight")),y<B[0].offsetTop&&t!==B[0].target)return z.$activateElement(B[0]);for(var a=B.length;a--;)if(!angular.isUndefined(B[a].offsetTop)&&null!==B[a].offsetTop&&t!==B[a].target&&!(y<B[a].offsetTop||B[a+1]&&y>B[a+1].offsetTop))return z.$activateElement(B[a])}},z.checkPositionWithEventLoop=function(){setTimeout(z.checkPosition,1)},z.$activateElement=function(a){if(t){var b=z.$getTrackedElement(t);b&&(b.source.removeClass("active"),j(b.source,"li")&&j(b.source.parent().parent(),"li")&&b.source.parent().parent().removeClass("active"))}t=a.target,a.source.addClass("active"),j(a.source,"li")&&j(a.source.parent().parent(),"li")&&a.source.parent().parent().addClass("active")},z.$getTrackedElement=function(a){return A.filter(function(b){return b.target===a})[0]},z.checkOffsets=function(){angular.forEach(A,function(a){var c=b.querySelector(a.target);a.offsetTop=c?g.offset(c).top:null,k.offset&&null!==a.offsetTop&&(a.offsetTop-=1*k.offset)}),B=A.filter(function(a){return null!==a.offsetTop}).sort(function(a,b){return a.offsetTop-b.offsetTop}),u()},z.trackElement=function(a,b){A.push({target:a,source:b})},z.untrackElement=function(a,b){for(var c,d=A.length;d--;)if(A[d].target===a&&A[d].source===b){c=d;break}A.splice(c,1)},z.activate=function(a){A[a].addClass("active")},z.init(),z}var l=angular.element(d),m=angular.element(e.prop("documentElement")),n=angular.element(d.document.body);return k}]}).directive("bsScrollspy",["$rootScope","debounce","dimensions","$scrollspy",function(a,b,c,d){return{restrict:"EAC",link:function(a,b,c){var e={scope:a};angular.forEach(["offset","target"],function(a){angular.isDefined(c[a])&&(e[a]=c[a])});var f=d(e);f.trackElement(e.target,b),a.$on("$destroy",function(){f&&(f.untrackElement(e.target,b),f.destroy()),e=null,f=null})}}}]).directive("bsScrollspyList",["$rootScope","debounce","dimensions","$scrollspy",function(a,b,c,d){return{restrict:"A",compile:function(a,b){var c=a[0].querySelectorAll("li > a[href]");angular.forEach(c,function(a){var b=angular.element(a);b.parent().attr("bs-scrollspy","").attr("data-target",b.attr("href"))})}}}]),angular.module("mgcrea.ngStrap.popover",["mgcrea.ngStrap.tooltip"]).provider("$popover",function(){var a=this.defaults={animation:"am-fade",customClass:"",container:!1,target:!1,placement:"right",templateUrl:"popover/popover.tpl.html",contentTemplate:!1,trigger:"click",keyboard:!0,html:!1,title:"",content:"",delay:0,autoClose:!1};this.$get=["$tooltip",function(b){function c(c,d){var e=angular.extend({},a,d),f=b(c,e);return e.content&&(f.$scope.content=e.content),f}return c}]}).directive("bsPopover",["$window","$sce","$popover",function(a,b,c){var d=a.requestAnimationFrame||a.setTimeout;return{restrict:"EAC",scope:!0,link:function(a,e,f){var g,h={scope:a};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","container","delay","trigger","html","animation","customClass","autoClose","id","prefixClass","prefixEvent","bsEnabled"],function(a){angular.isDefined(f[a])&&(h[a]=f[a])});var i=/^(false|0|)$/i;angular.forEach(["html","container","autoClose"],function(a){angular.isDefined(f[a])&&i.test(f[a])&&(h[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(f[c])&&(h[b]=a.$eval(f[c]))});var j=e.attr("data-target");angular.isDefined(j)&&(i.test(j)?h.target=!1:h.target=j),angular.forEach(["title","content"],function(c){f[c]&&f.$observe(c,function(e,f){a[c]=b.trustAsHtml(e),angular.isDefined(f)&&d(function(){g&&g.$applyPlacement()})})}),f.bsPopover&&a.$watch(f.bsPopover,function(b,c){angular.isObject(b)?angular.extend(a,b):a.content=b,angular.isDefined(c)&&d(function(){g&&g.$applyPlacement()})},!0),f.bsShow&&a.$watch(f.bsShow,function(a,b){g&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|,?(popover),?/i)),!0===a?g.show():g.hide())}),f.bsEnabled&&a.$watch(f.bsEnabled,function(a){g&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|1|,?(popover),?/i)),!1===a?g.setEnabled(!1):g.setEnabled(!0))}),f.viewport&&a.$watch(f.viewport,function(a){g&&angular.isDefined(a)&&g.setViewport(a)}),g=c(e,h),a.$on("$destroy",function(){g&&g.destroy(),h=null,g=null})}}}]),angular.module("mgcrea.ngStrap.navbar",[]).provider("$navbar",function(){var a=this.defaults={activeClass:"active",routeAttr:"data-match-route",strict:!1};this.$get=function(){return{defaults:a}}}).directive("bsNavbar",["$window","$location","$navbar",function(a,b,c){var d=c.defaults;return{restrict:"A",link:function(a,c,e,f){var g=angular.copy(d);angular.forEach(Object.keys(d),function(a){angular.isDefined(e[a])&&(g[a]=e[a])}),a.$watch(function(){return b.path()},function(a,b){var d=c[0].querySelectorAll("li["+g.routeAttr+"]");angular.forEach(d,function(b){
var c=angular.element(b),d=c.attr(g.routeAttr).replace("/","\\/");g.strict&&(d="^"+d+"$"),new RegExp(d,"i").test(a)?c.addClass(g.activeClass):c.removeClass(g.activeClass)})})}}}]),angular.module("mgcrea.ngStrap.modal",["mgcrea.ngStrap.core","mgcrea.ngStrap.helpers.dimensions"]).provider("$modal",function(){var a=this.defaults={animation:"am-fade",backdropAnimation:"am-fade",customClass:"",prefixClass:"modal",prefixEvent:"modal",placement:"top",templateUrl:"modal/modal.tpl.html",template:"",contentTemplate:!1,container:!1,element:null,backdrop:!0,keyboard:!0,html:!1,show:!0,size:null,zIndex:null};this.$get=["$window","$rootScope","$bsCompiler","$animate","$timeout","$sce","dimensions",function(c,d,e,f,g,h,i){function j(b){function c(){B.$emit(z.prefixEvent+".show",y),angular.isDefined(z.onShow)&&angular.isFunction(z.onShow)&&z.onShow(y)}function g(){B.$emit(z.prefixEvent+".hide",y),angular.isDefined(z.onHide)&&angular.isFunction(z.onHide)&&z.onHide(y),l(".modal").length<=0&&o.removeClass(z.prefixClass+"-open"),z.animation&&o.removeClass(z.prefixClass+"-with-"+z.animation)}function i(){z.backdrop&&(D.on("click",v),F.on("click",v),F.on("wheel",w))}function j(){z.backdrop&&(D.off("click",v),F.off("click",v),F.off("wheel",w))}function t(){z.keyboard&&D.on("keyup",y.$onKeyUp)}function u(){z.keyboard&&D.off("keyup",y.$onKeyUp)}function v(a){a.target===a.currentTarget&&("static"===z.backdrop?y.focus():y.hide())}function w(a){a.preventDefault()}function x(){y.$isShown&&null!==D&&(j(),u()),E&&(E.$destroy(),E=null),D&&(D.remove(),D=y.$element=null)}var y={},z=y.$options=angular.extend({},a,b),A=y.$promise=e.compile(z),B=y.$scope=z.scope&&z.scope.$new()||d.$new();z.element||z.container||(z.container="body"),z.zIndex&&(q=parseInt(z.zIndex,10),r=q-10),y.$id=z.id||z.element&&z.element.attr("id")||"",m(["title","content"],function(a){z[a]&&(B[a]=h.trustAsHtml(z[a]))}),B.$hide=function(){B.$$postDigest(function(){y.hide()})},B.$show=function(){B.$$postDigest(function(){y.show()})},B.$toggle=function(){B.$$postDigest(function(){y.toggle()})},y.$isShown=B.$isShown=!1;var C,D,E,F=angular.element('<div class="'+z.prefixClass+'-backdrop"/>');return F.css({position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px"}),A.then(function(a){C=a,y.init()}),y.init=function(){z.show&&B.$$postDigest(function(){y.show()})},y.destroy=function(){x(),F&&(F.remove(),F=null),B.$destroy()},y.show=function(){if(!y.$isShown){var a,b;if(angular.isElement(z.container)?(a=z.container,b=z.container[0].lastChild?angular.element(z.container[0].lastChild):null):z.container?(a=l(z.container),b=a[0]&&a[0].lastChild?angular.element(a[0].lastChild):null):(a=null,b=z.element),D&&x(),E=y.$scope.$new(),D=y.$element=C.link(E,function(a,b){}),z.backdrop&&(D.css({"z-index":q+20*p}),F.css({"z-index":r+20*p}),p++),!B.$emit(z.prefixEvent+".show.before",y).defaultPrevented){angular.isDefined(z.onBeforeShow)&&angular.isFunction(z.onBeforeShow)&&z.onBeforeShow(y),D.css({display:"block"}).addClass(z.placement),z.customClass&&D.addClass(z.customClass),z.size&&s[z.size]&&angular.element(l(".modal-dialog",D[0])).addClass(s[z.size]),z.animation&&(z.backdrop&&F.addClass(z.backdropAnimation),D.addClass(z.animation)),z.backdrop&&f.enter(F,o,null),angular.version.minor<=2?f.enter(D,a,b,c):f.enter(D,a,b).then(c),y.$isShown=B.$isShown=!0,k(B);var d=D[0];n(function(){d.focus()}),o.addClass(z.prefixClass+"-open"),z.animation&&o.addClass(z.prefixClass+"-with-"+z.animation),i(),t()}}},y.hide=function(){y.$isShown&&(B.$emit(z.prefixEvent+".hide.before",y).defaultPrevented||(angular.isDefined(z.onBeforeHide)&&angular.isFunction(z.onBeforeHide)&&z.onBeforeHide(y),angular.version.minor<=2?f.leave(D,g):f.leave(D).then(g),z.backdrop&&(p--,f.leave(F)),y.$isShown=B.$isShown=!1,k(B),j(),u()))},y.toggle=function(){y.$isShown?y.hide():y.show()},y.focus=function(){D[0].focus()},y.$onKeyUp=function(a){27===a.which&&y.$isShown&&(y.hide(),a.stopPropagation())},y}function k(a){a.$$phase||a.$root&&a.$root.$$phase||a.$digest()}function l(a,c){return angular.element((c||b).querySelectorAll(a))}var m=angular.forEach,n=c.requestAnimationFrame||c.setTimeout,o=angular.element(c.document.body),p=0,q=1050,r=1040,s={lg:"modal-lg",sm:"modal-sm"};return j}]}).directive("bsModal",["$window","$sce","$parse","$modal",function(a,b,c,d){return{restrict:"EAC",scope:!0,link:function(a,c,e,f){var g={scope:a,element:c,show:!1};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","backdrop","keyboard","html","container","animation","backdropAnimation","id","prefixEvent","prefixClass","customClass","modalClass","size","zIndex"],function(a){angular.isDefined(e[a])&&(g[a]=e[a])}),g.modalClass&&(g.customClass=g.modalClass);var h=/^(false|0|)$/i;angular.forEach(["backdrop","keyboard","html","container"],function(a){angular.isDefined(e[a])&&h.test(e[a])&&(g[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(e[c])&&(g[b]=a.$eval(e[c]))}),angular.forEach(["title","content"],function(c){e[c]&&e.$observe(c,function(d,e){a[c]=b.trustAsHtml(d)})}),e.bsModal&&a.$watch(e.bsModal,function(b,c){angular.isObject(b)?angular.extend(a,b):a.content=b},!0);var i=d(g);c.on(e.trigger||"click",i.toggle),a.$on("$destroy",function(){i&&i.destroy(),g=null,i=null})}}}]),angular.version.minor<3&&angular.version.dot<14&&angular.module("ng").factory("$$rAF",["$window","$timeout",function(a,b){var c=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame,d=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelRequestAnimationFrame,e=!!c,f=e?function(a){var b=c(a);return function(){d(b)}}:function(a){var c=b(a,16.66,!1);return function(){b.cancel(c)}};return f.supported=e,f}]),angular.module("mgcrea.ngStrap.helpers.parseOptions",[]).provider("$parseOptions",function(){var a=this.defaults={regexp:/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/};this.$get=["$parse","$q",function(b,c){function d(d,e){function f(a,b){return a.map(function(a,c){var d,e,f={};return f[k]=a,d=j(b,f),e=n(b,f),{label:d,value:e,index:c}})}var g={},h=angular.extend({},a,e);g.$values=[];var i,j,k,l,m,n,o;return g.init=function(){g.$match=i=d.match(h.regexp),j=b(i[2]||i[1]),k=i[4]||i[6],l=i[5],m=b(i[3]||""),n=b(i[2]?i[1]:k),o=b(i[7])},g.valuesFn=function(a,b){return c.when(o(a,b)).then(function(b){return angular.isArray(b)||(b=[]),g.$values=b.length?f(b,a):[],g.$values})},g.displayValue=function(a){var b={};return b[k]=a,j(b)},g.init(),g}return d}]}),angular.module("mgcrea.ngStrap.helpers.dimensions",[]).factory("dimensions",function(){function b(a){var b=a.ownerDocument,e=a.offsetParent||b;if(d(e,"#document"))return b.documentElement;for(;e&&!d(e,"html")&&"static"===c.css(e,"position");)e=e.offsetParent;return e||b.documentElement}var c={},d=c.nodeName=function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()};return c.css=function(b,c,d){var e;return e=b.currentStyle?b.currentStyle[c]:a.getComputedStyle?a.getComputedStyle(b)[c]:b.style[c],!0===d?parseFloat(e)||0:e},c.offset=function(b){var c=b.getBoundingClientRect(),d=b.ownerDocument;return{width:c.width||b.offsetWidth,height:c.height||b.offsetHeight,top:c.top+(a.pageYOffset||d.documentElement.scrollTop)-(d.documentElement.clientTop||0),left:c.left+(a.pageXOffset||d.documentElement.scrollLeft)-(d.documentElement.clientLeft||0)}},c.setOffset=function(a,b,d){var e,f,g,h,i,j,k,l=c.css(a,"position"),m=angular.element(a),n={};"static"===l&&(a.style.position="relative"),i=c.offset(a),g=c.css(a,"top"),j=c.css(a,"left"),k=("absolute"===l||"fixed"===l)&&(g+j).indexOf("auto")>-1,k?(e=c.position(a),h=e.top,f=e.left):(h=parseFloat(g)||0,f=parseFloat(j)||0),angular.isFunction(b)&&(b=b.call(a,d,i)),null!==b.top&&(n.top=b.top-i.top+h),null!==b.left&&(n.left=b.left-i.left+f),"using"in b?b.using.call(m,n):m.css({top:n.top+"px",left:n.left+"px"})},c.position=function(a){var e,f,g={top:0,left:0};return"fixed"===c.css(a,"position")?f=a.getBoundingClientRect():(e=b(a),f=c.offset(a),d(e,"html")||(g=c.offset(e)),g.top+=c.css(e,"borderTopWidth",!0),g.left+=c.css(e,"borderLeftWidth",!0)),{width:a.offsetWidth,height:a.offsetHeight,top:f.top-g.top-c.css(a,"marginTop",!0),left:f.left-g.left-c.css(a,"marginLeft",!0)}},c.height=function(a,b){var d=a.offsetHeight;return b?d+=c.css(a,"marginTop",!0)+c.css(a,"marginBottom",!0):d-=c.css(a,"paddingTop",!0)+c.css(a,"paddingBottom",!0)+c.css(a,"borderTopWidth",!0)+c.css(a,"borderBottomWidth",!0),d},c.width=function(a,b){var d=a.offsetWidth;return b?d+=c.css(a,"marginLeft",!0)+c.css(a,"marginRight",!0):d-=c.css(a,"paddingLeft",!0)+c.css(a,"paddingRight",!0)+c.css(a,"borderLeftWidth",!0)+c.css(a,"borderRightWidth",!0),d},c}),angular.module("mgcrea.ngStrap.helpers.debounce",[]).factory("debounce",["$timeout",function(a){return function(b,c,d){var e=null;return function(){var f=this,g=arguments,h=d&&!e;return e&&a.cancel(e),e=a(function(){e=null,d||b.apply(f,g)},c,!1),h&&b.apply(f,g),e}}}]).factory("throttle",["$timeout",function(a){return function(b,c,d){var e=null;return d||(d={}),function(){var f=this,g=arguments;e||(!1!==d.leading&&b.apply(f,g),e=a(function(){e=null,!1!==d.trailing&&b.apply(f,g)},c,!1))}}}]),angular.module("mgcrea.ngStrap.helpers.dateParser",[]).provider("$dateParser",["$localeProvider",function(a){function b(){this.year=1970,this.month=0,this.day=1,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0}function c(){}function d(a){return!isNaN(parseFloat(a))&&isFinite(a)}function e(a,b){for(var c=a.length,d=b.toString().toLowerCase(),e=0;e<c;e++)if(a[e].toLowerCase()===d)return e;return-1}b.prototype.setMilliseconds=function(a){this.milliseconds=a},b.prototype.setSeconds=function(a){this.seconds=a},b.prototype.setMinutes=function(a){this.minutes=a},b.prototype.setHours=function(a){this.hours=a},b.prototype.getHours=function(){return this.hours},b.prototype.setDate=function(a){this.day=a},b.prototype.setMonth=function(a){this.month=a},b.prototype.setFullYear=function(a){this.year=a},b.prototype.fromDate=function(a){return this.year=a.getFullYear(),this.month=a.getMonth(),this.day=a.getDate(),this.hours=a.getHours(),this.minutes=a.getMinutes(),this.seconds=a.getSeconds(),this.milliseconds=a.getMilliseconds(),this},b.prototype.toDate=function(){return new Date(this.year,this.month,this.day,this.hours,this.minutes,this.seconds,this.milliseconds)};var f=b.prototype,g=this.defaults={format:"shortDate",strict:!1};this.$get=["$locale","dateFilter",function(a,h){return function(i){function j(a){return o(k(a))}function k(a){var b=l(a),c=b.replace(/''/g,"\\'"),d=/('(?:\\'|.)*?')/,e=c.split(d),f=Object.keys(v),g=[];return angular.forEach(e,function(a){if(m(a))a=n(a);else for(var b=0;b<f.length;b++)a=a.split(f[b]).join("${"+b+"}");g.push(a)}),g.join("")}function l(a){return a.replace(/\\/g,"[\\\\]").replace(/-/g,"[-]").replace(/\./g,"[.]").replace(/\*/g,"[*]").replace(/\+/g,"[+]").replace(/\?/g,"[?]").replace(/\$/g,"[$]").replace(/\^/g,"[^]").replace(/\//g,"[/]").replace(/\\s/g,"[\\s]")}function m(a){return/^'.*'$/.test(a)}function n(a){return a.replace(/^'(.*)'$/,"$1")}function o(a){for(var b=Object.keys(v),c=a,d=0;d<b.length;d++)c=c.split("${"+d+"}").join("("+v[b[d]]+")");return new RegExp("^"+c+"$",["i"])}function p(a){return q(k(a))}function q(a){for(var b,c,d,e,f=Object.keys(v),g=new RegExp("\\${(\\d+)}","g"),h=[];null!==(b=g.exec(a));)c=b[1],d=f[c],e=w[d],h.push(e);return h}var r,s,t=angular.extend({},g,i),u={},v={sss:"[0-9]{3}",ss:"[0-5][0-9]",s:t.strict?"[1-5]?[0-9]":"[0-9]|[0-5][0-9]",mm:"[0-5][0-9]",m:t.strict?"[1-5]?[0-9]":"[0-9]|[0-5][0-9]",HH:"[01][0-9]|2[0-3]",H:t.strict?"1?[0-9]|2[0-3]":"[01]?[0-9]|2[0-3]",hh:"[0][1-9]|[1][012]",h:t.strict?"[1-9]|1[012]":"0?[1-9]|1[012]",a:"AM|PM",EEEE:a.DATETIME_FORMATS.DAY.join("|"),EEE:a.DATETIME_FORMATS.SHORTDAY.join("|"),dd:"0[1-9]|[12][0-9]|3[01]",d:t.strict?"[1-9]|[1-2][0-9]|3[01]":"0?[1-9]|[1-2][0-9]|3[01]",MMMM:a.DATETIME_FORMATS.MONTH.join("|"),MMM:a.DATETIME_FORMATS.SHORTMONTH.join("|"),MM:"0[1-9]|1[012]",M:t.strict?"[1-9]|1[012]":"0?[1-9]|1[012]",yyyy:"[1]{1}[0-9]{3}|[2]{1}[0-9]{3}",yy:"[0-9]{2}",y:t.strict?"-?(0|[1-9][0-9]{0,3})":"-?0*[0-9]{1,4}"},w={sss:f.setMilliseconds,ss:f.setSeconds,s:f.setSeconds,mm:f.setMinutes,m:f.setMinutes,HH:f.setHours,H:f.setHours,hh:f.setHours,h:f.setHours,EEEE:c,EEE:c,dd:f.setDate,d:f.setDate,a:function(a){var b=this.getHours()%12;return this.setHours(a.match(/pm/i)?b+12:b)},MMMM:function(b){return this.setMonth(e(a.DATETIME_FORMATS.MONTH,b))},MMM:function(b){return this.setMonth(e(a.DATETIME_FORMATS.SHORTMONTH,b))},MM:function(a){return this.setMonth(1*a-1)},M:function(a){return this.setMonth(1*a-1)},yyyy:f.setFullYear,yy:function(a){return this.setFullYear(2e3+1*a)},y:function(a){return 1*a<=50&&2===a.length?this.setFullYear(2e3+1*a):this.setFullYear(1*a)}};return u.init=function(){u.$format=a.DATETIME_FORMATS[t.format]||t.format,r=j(u.$format),s=p(u.$format)},u.isValid=function(a){return angular.isDate(a)?!isNaN(a.getTime()):r.test(a)},u.parse=function(c,d,e,f){e&&(e=a.DATETIME_FORMATS[e]||e),angular.isDate(c)&&(c=h(c,e||u.$format,f));var g=e?j(e):r,i=e?p(e):s,k=g.exec(c);if(!k)return!1;for(var l=d&&!isNaN(d.getTime())?(new b).fromDate(d):(new b).fromDate(new Date(1970,0,1,0)),m=0;m<k.length-1;m++)i[m]&&i[m].call(l,k[m+1]);var n=l.toDate();return parseInt(l.day,10)===n.getDate()&&n},u.getDateForAttribute=function(a,b){var c;if("today"===b){var e=new Date;c=new Date(e.getFullYear(),e.getMonth(),e.getDate()+("maxDate"===a?1:0),0,0,0,"minDate"===a?0:-1)}else c=angular.isString(b)&&b.match(/^".+"$/)?new Date(b.substr(1,b.length-2)):d(b)?new Date(parseInt(b,10)):angular.isString(b)&&0===b.length?"minDate"===a?-1/0:1/0:new Date(b);return c},u.getTimeForAttribute=function(a,b){return"now"===b?(new Date).setFullYear(1970,0,1):angular.isString(b)&&b.match(/^".+"$/)?new Date(b.substr(1,b.length-2)).setFullYear(1970,0,1):d(b)?new Date(parseInt(b,10)).setFullYear(1970,0,1):angular.isString(b)&&0===b.length?"minTime"===a?-1/0:1/0:u.parse(b,new Date(1970,0,1,0))},u.daylightSavingAdjust=function(a){return a?(a.setHours(a.getHours()>12?a.getHours()+2:0),a):null},u.timezoneOffsetAdjust=function(a,b,c){return a?(b&&"UTC"===b&&(a=new Date(a.getTime()),a.setMinutes(a.getMinutes()+(c?-1:1)*a.getTimezoneOffset())),a):null},u.init(),u}}]}]),angular.module("mgcrea.ngStrap.helpers.dateFormatter",[]).service("$dateFormatter",["$locale","dateFilter",function(a,b){function c(a){return/(h+)([:\.])?(m+)([:\.])?(s*)[ ]?(a?)/i.exec(a).slice(1)}this.getDefaultLocale=function(){return a.id},this.getDatetimeFormat=function(b,c){return a.DATETIME_FORMATS[b]||b},this.weekdaysShort=function(b){return a.DATETIME_FORMATS.SHORTDAY},this.hoursFormat=function(a){return c(a)[0]},this.minutesFormat=function(a){return c(a)[2]},this.secondsFormat=function(a){return c(a)[4]},this.timeSeparator=function(a){return c(a)[1]},this.showSeconds=function(a){return!!c(a)[4]},this.showAM=function(a){return!!c(a)[5]},this.formatDate=function(a,c,d,e){return b(a,c,e)}}]),angular.module("mgcrea.ngStrap.core",[]).service("$bsCompiler",d),angular.module("mgcrea.ngStrap.dropdown",["mgcrea.ngStrap.tooltip"]).provider("$dropdown",function(){var a=this.defaults={animation:"am-fade",prefixClass:"dropdown",prefixEvent:"dropdown",placement:"bottom-left",templateUrl:"dropdown/dropdown.tpl.html",trigger:"click",container:!1,keyboard:!0,html:!1,delay:0};this.$get=["$window","$rootScope","$tooltip","$timeout",function(b,c,d,e){function f(b,f){function i(a){if(a.target!==b[0])return a.target!==b[0]&&j.hide()}var j={},k=angular.extend({},a,f);j.$scope=k.scope&&k.scope.$new()||c.$new(),j=d(b,k);var l=b.parent();j.$onKeyDown=function(a){if(/(38|40)/.test(a.keyCode)){a.preventDefault(),a.stopPropagation();var b=angular.element(j.$element[0].querySelectorAll("li:not(.divider) a"));if(b.length){var c;angular.forEach(b,function(a,b){h&&h.call(a,":focus")&&(c=b)}),38===a.keyCode&&c>0?c--:40===a.keyCode&&c<b.length-1?c++:angular.isUndefined(c)&&(c=0),b.eq(c)[0].focus()}}};var m=j.show;j.show=function(){m(),e(function(){k.keyboard&&j.$element&&j.$element.on("keydown",j.$onKeyDown),g.on("click",i)},0,!1),l.hasClass("dropdown")&&l.addClass("open")};var n=j.hide;j.hide=function(){j.$isShown&&(k.keyboard&&j.$element&&j.$element.off("keydown",j.$onKeyDown),g.off("click",i),l.hasClass("dropdown")&&l.removeClass("open"),n())};var o=j.destroy;return j.destroy=function(){g.off("click",i),o()},j}var g=angular.element(b.document.body),h=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector;return f}]}).directive("bsDropdown",["$window","$sce","$dropdown",function(a,b,d){return{restrict:"EAC",scope:!0,compile:function(a,b){if(!b.bsDropdown){for(var e=a[0].nextSibling;e&&1!==e.nodeType;)e=e.nextSibling;e&&e.className.split(" ").indexOf("dropdown-menu")>=0&&(b.template=e.outerHTML,b.templateUrl=c,e.parentNode.removeChild(e))}return function(a,c,e){var f={scope:a};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","id","autoClose"],function(a){angular.isDefined(b[a])&&(f[a]=b[a])});var g=/^(false|0|)$/i;angular.forEach(["html","container"],function(a){angular.isDefined(e[a])&&g.test(e[a])&&(f[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(e[c])&&(f[b]=a.$eval(e[c]))}),e.bsDropdown&&a.$watch(e.bsDropdown,function(b,c){a.content=b},!0);var h=d(c,f);e.bsShow&&a.$watch(e.bsShow,function(a,b){h&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|,?(dropdown),?/i)),!0===a?h.show():h.hide())}),a.$on("$destroy",function(){h&&h.destroy(),f=null,h=null})}}}}]),angular.module("mgcrea.ngStrap.button",[]).provider("$button",function(){var a=this.defaults={activeClass:"active",toggleEvent:"click"};this.$get=function(){return{defaults:a}}}).directive("bsCheckboxGroup",function(){return{restrict:"A",require:"ngModel",compile:function(a,b){a.attr("data-toggle","buttons"),a.removeAttr("ng-model");var c=a[0].querySelectorAll('input[type="checkbox"]');angular.forEach(c,function(a){var c=angular.element(a);c.attr("bs-checkbox",""),c.attr("ng-model",b.ngModel+"."+c.attr("value"))})}}}).directive("bsCheckbox",["$button","$$rAF",function(a,b){var c=a.defaults,d=/^(true|false|\d+)$/;return{restrict:"A",require:"ngModel",link:function(a,e,f,g){var h=c,i="INPUT"===e[0].nodeName,j=i?e.parent():e,k=!angular.isDefined(f.trueValue)||f.trueValue;d.test(f.trueValue)&&(k=a.$eval(f.trueValue));var l=!!angular.isDefined(f.falseValue)&&f.falseValue;d.test(f.falseValue)&&(l=a.$eval(f.falseValue)),("boolean"!=typeof k||"boolean"!=typeof l)&&(g.$parsers.push(function(a){return a?k:l}),g.$formatters.push(function(a){return angular.equals(a,k)})),g.$render=function(){var a=!!g.$viewValue;b(function(){i&&(e[0].checked=a),j.toggleClass(h.activeClass,a)})},e.bind(h.toggleEvent,function(){a.$apply(function(){i||g.$setViewValue(!j.hasClass("active")),g.$render()})})}}}]).directive("bsRadioGroup",function(){return{restrict:"A",require:"ngModel",compile:function(a,b){a.attr("data-toggle","buttons"),a.removeAttr("ng-model");var c=a[0].querySelectorAll('input[type="radio"]');angular.forEach(c,function(a){angular.element(a).attr("bs-radio",""),angular.element(a).attr("ng-model",b.ngModel)})}}}).directive("bsRadio",["$button","$$rAF",function(a,b){var c=a.defaults,d=/^(true|false|\d+)$/;return{restrict:"A",require:"ngModel",link:function(a,e,f,g){var h,i=c,j="INPUT"===e[0].nodeName,k=j?e.parent():e;f.$observe("value",function(b){h="boolean"!=typeof b&&d.test(b)?a.$eval(b):b,g.$render()}),g.$render=function(){var a=angular.equals(g.$viewValue,h);b(function(){j&&(e[0].checked=a),k.toggleClass(i.activeClass,a)})},e.bind(i.toggleEvent,function(){a.$apply(function(){g.$setViewValue(h),g.$render()})})}}}]),angular.module("mgcrea.ngStrap.datepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.helpers.dateFormatter","mgcrea.ngStrap.tooltip"]).provider("$datepicker",function(){var a=this.defaults={animation:"am-fade",prefixClass:"datepicker",placement:"bottom-left",templateUrl:"datepicker/datepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!1,dateType:"date",dateFormat:"shortDate",timezone:null,modelDateFormat:null,dayFormat:"dd",monthFormat:"MMM",yearFormat:"yyyy",monthTitleFormat:"MMMM yyyy",yearTitleFormat:"yyyy",strictFormat:!1,autoclose:!1,minDate:-1/0,maxDate:1/0,startView:0,minView:0,startWeek:0,daysOfWeekDisabled:"",hasToday:!1,hasClear:!1,iconLeft:"glyphicon glyphicon-chevron-left",iconRight:"glyphicon glyphicon-chevron-right"};this.$get=["$window","$document","$rootScope","$sce","$dateFormatter","datepickerViews","$tooltip","$timeout",function(b,c,d,e,f,g,h,i){function j(b,c,d){function e(a){a.selected=j.$isSelected(a.date)}function f(){b[0].focus()}var j=h(b,angular.extend({},a,d)),m=d.scope,n=j.$options,o=j.$scope;n.startView&&(n.startView-=n.minView);var p=g(j);j.$views=p.views;var q=p.viewDate;o.$mode=n.startView,o.$iconLeft=n.iconLeft,o.$iconRight=n.iconRight,o.$hasToday=n.hasToday,o.$hasClear=n.hasClear;var r=j.$views[o.$mode];o.$select=function(a,b){b||j.select(a)},o.$selectPane=function(a){j.$selectPane(a)},o.$toggleMode=function(){j.setMode((o.$mode+1)%j.$views.length)},o.$setToday=function(){n.autoclose?(j.setMode(0),j.select(new Date)):j.select(new Date,!0)},o.$clear=function(){n.autoclose?(j.setMode(0),j.select(null)):j.select(null,!0)},j.update=function(a){angular.isDate(a)&&!isNaN(a.getTime())&&(j.$date=a,r.update.call(r,a)),j.$build(!0)},j.updateDisabledDates=function(a){n.disabledDateRanges=a;for(var b=0,c=o.rows.length;b<c;b++)angular.forEach(o.rows[b],j.$setDisabledEl)},j.select=function(a,b){angular.isDate(a)?angular.isDate(c.$dateValue)&&!isNaN(c.$dateValue.getTime())||(c.$dateValue=new Date(a)):c.$dateValue=null,!o.$mode||b?(c.$setViewValue(angular.copy(a)),c.$render(),n.autoclose&&!b&&i(function(){j.hide(!0)})):(angular.extend(q,{year:a.getFullYear(),month:a.getMonth(),date:a.getDate()}),j.setMode(o.$mode-1),j.$build())},j.setMode=function(a){o.$mode=a,r=j.$views[o.$mode],j.$build()},j.$build=function(a){!0===a&&r.built||(!1!==a||r.built)&&r.build.call(r)},j.$updateSelected=function(){for(var a=0,b=o.rows.length;a<b;a++)angular.forEach(o.rows[a],e)},j.$isSelected=function(a){return r.isSelected(a)},j.$setDisabledEl=function(a){a.disabled=r.isDisabled(a.date)},j.$selectPane=function(a){var b=r.steps,c=new Date(Date.UTC(q.year+(b.year||0)*a,q.month+(b.month||0)*a,1));angular.extend(q,{year:c.getUTCFullYear(),month:c.getUTCMonth(),date:c.getUTCDate()}),j.$build()},j.$onMouseDown=function(a){if(a.preventDefault(),a.stopPropagation(),l){var b=angular.element(a.target);"button"!==b[0].nodeName.toLowerCase()&&(b=b.parent()),b.triggerHandler("click")}},j.$onKeyDown=function(a){if(/(38|37|39|40|13)/.test(a.keyCode)&&!a.shiftKey&&!a.altKey){if(a.preventDefault(),a.stopPropagation(),13===a.keyCode)return void(o.$mode?o.$apply(function(){j.setMode(o.$mode-1)}):j.hide(!0));r.onKeyDown(a),m.$digest()}};var s=j.init;j.init=function(){if(k&&n.useNative)return b.prop("type","date"),void b.css("-webkit-appearance","textfield");l&&(b.prop("type","text"),b.attr("readonly","true"),b.on("click",f)),s()};var t=j.destroy;j.destroy=function(){k&&n.useNative&&b.off("click",f),t()};var u=j.show;j.show=function(){!l&&b.attr("readonly")||b.attr("disabled")||(u(),i(function(){j.$isShown&&(j.$element.on(l?"touchstart":"mousedown",j.$onMouseDown),n.keyboard&&b.on("keydown",j.$onKeyDown))},0,!1))};var v=j.hide;return j.hide=function(a){j.$isShown&&(j.$element.off(l?"touchstart":"mousedown",j.$onMouseDown),n.keyboard&&b.off("keydown",j.$onKeyDown),v(a))},j}var k=/(ip[ao]d|iphone|android)/gi.test(b.navigator.userAgent),l="createTouch"in b.document&&k;return a.lang||(a.lang=f.getDefaultLocale()),j.defaults=a,j}]}).directive("bsDatepicker",["$window","$parse","$q","$dateFormatter","$dateParser","$datepicker",function(a,b,c,d,e,f){var g=/(ip[ao]d|iphone|android)/gi.test(a.navigator.userAgent);return{restrict:"EAC",require:"ngModel",link:function(a,b,c,h){function i(a){return a&&a.length?a:null}function j(a){if(angular.isDate(a)){var b=isNaN(n.$options.minDate)||a.getTime()>=n.$options.minDate,c=isNaN(n.$options.maxDate)||a.getTime()<=n.$options.maxDate,d=b&&c;h.$setValidity("date",d),h.$setValidity("min",b),h.$setValidity("max",c),d&&(h.$dateValue=a)}}function k(){return!h.$dateValue||isNaN(h.$dateValue.getTime())?"":p(h.$dateValue,l.dateFormat)}var l={scope:a};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","html","animation","autoclose","dateType","dateFormat","timezone","modelDateFormat","dayFormat","strictFormat","startWeek","startDate","useNative","lang","startView","minView","iconLeft","iconRight","daysOfWeekDisabled","id","prefixClass","prefixEvent","hasToday","hasClear"],function(a){angular.isDefined(c[a])&&(l[a]=c[a])});var m=/^(false|0|)$/i;angular.forEach(["html","container","autoclose","useNative","hasToday","hasClear"],function(a){angular.isDefined(c[a])&&m.test(c[a])&&(l[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var d="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(c[d])&&(l[b]=a.$eval(c[d]))});var n=f(b,h,l);l=n.$options,g&&l.useNative&&(l.dateFormat="yyyy-MM-dd");var o=l.lang,p=function(a,b){return d.formatDate(a,b,o)},q=e({format:l.dateFormat,lang:o,strict:l.strictFormat});c.bsShow&&a.$watch(c.bsShow,function(a,b){n&&angular.isDefined(a)&&(angular.isString(a)&&(a=!!a.match(/true|,?(datepicker),?/i)),!0===a?n.show():n.hide())}),angular.forEach(["minDate","maxDate"],function(a){angular.isDefined(c[a])&&c.$observe(a,function(b){n.$options[a]=q.getDateForAttribute(a,b),isNaN(n.$options[a])||n.$build(!1),j(h.$dateValue)})}),angular.isDefined(c.dateFormat)&&c.$observe("dateFormat",function(a){n.$options.dateFormat=a}),a.$watch(c.ngModel,function(a,b){n.update(h.$dateValue)},!0),angular.isDefined(c.disabledDates)&&a.$watch(c.disabledDates,function(a,b){a=i(a),b=i(b),a&&n.updateDisabledDates(a)}),h.$parsers.unshift(function(a){var b;if(!a)return h.$setValidity("date",!0),null;var c=q.parse(a,h.$dateValue);return!c||isNaN(c.getTime())?void h.$setValidity("date",!1):(j(c),"string"===l.dateType?(b=q.timezoneOffsetAdjust(c,l.timezone,!0),p(b,l.modelDateFormat||l.dateFormat)):(b=q.timezoneOffsetAdjust(h.$dateValue,l.timezone,!0),"number"===l.dateType?b.getTime():"unix"===l.dateType?b.getTime()/1e3:"iso"===l.dateType?b.toISOString():new Date(b)))}),h.$formatters.push(function(a){var b;return b=angular.isUndefined(a)||null===a?NaN:angular.isDate(a)?a:"string"===l.dateType?q.parse(a,null,l.modelDateFormat):"unix"===l.dateType?new Date(1e3*a):new Date(a),h.$dateValue=q.timezoneOffsetAdjust(b,l.timezone),k()}),h.$render=function(){b.val(k())},a.$on("$destroy",function(){n&&n.destroy(),l=null,n=null})}}}]).provider("datepickerViews",function(){function a(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c}function b(a,b){return(a%b+b)%b}this.$get=["$dateFormatter","$dateParser","$sce",function(c,d,e){return function(f){var g=f.$scope,h=f.$options,i=h.lang,j=function(a,b){return c.formatDate(a,b,i)},k=d({format:h.dateFormat,lang:i,strict:h.strictFormat}),l=c.weekdaysShort(i),m=l.slice(h.startWeek).concat(l.slice(0,h.startWeek)),n=e.trustAsHtml('<th class="dow text-center">'+m.join('</th><th class="dow text-center">')+"</th>"),o=f.$date||(h.startDate?k.getDateForAttribute("startDate",h.startDate):new Date),p={year:o.getFullYear(),month:o.getMonth(),date:o.getDate()},q=[{format:h.dayFormat,split:7,steps:{month:1},update:function(a,b){!this.built||b||a.getFullYear()!==p.year||a.getMonth()!==p.month?(angular.extend(p,{year:f.$date.getFullYear(),month:f.$date.getMonth(),date:f.$date.getDate()}),f.$build()):a.getDate()===p.date&&1!==a.getDate()||(p.date=f.$date.getDate(),f.$updateSelected())},build:function(){var c=new Date(p.year,p.month,1),d=c.getTimezoneOffset(),e=new Date(+c-864e5*b(c.getDay()-h.startWeek,7)),i=e.getTimezoneOffset(),l=k.timezoneOffsetAdjust(new Date,h.timezone).toDateString();i!==d&&(e=new Date(+e+6e4*(i-d)));for(var m,o=[],q=0;q<42;q++)m=k.daylightSavingAdjust(new Date(e.getFullYear(),e.getMonth(),e.getDate()+q)),o.push({date:m,isToday:m.toDateString()===l,label:j(m,this.format),selected:f.$date&&this.isSelected(m),muted:m.getMonth()!==p.month,disabled:this.isDisabled(m)});g.title=j(c,h.monthTitleFormat),g.showLabels=!0,g.labels=n,g.rows=a(o,this.split),g.isTodayDisabled=this.isDisabled(new Date),this.built=!0},isSelected:function(a){return f.$date&&a.getFullYear()===f.$date.getFullYear()&&a.getMonth()===f.$date.getMonth()&&a.getDate()===f.$date.getDate()},isDisabled:function(a){var b=a.getTime();if(b<h.minDate||b>h.maxDate)return!0;if(-1!==h.daysOfWeekDisabled.indexOf(a.getDay()))return!0;if(h.disabledDateRanges)for(var c=0;c<h.disabledDateRanges.length;c++)if(b>=h.disabledDateRanges[c].start&&b<=h.disabledDateRanges[c].end)return!0;return!1},onKeyDown:function(a){if(f.$date){var b,c=f.$date.getTime();37===a.keyCode?b=new Date(c-864e5):38===a.keyCode?b=new Date(c-6048e5):39===a.keyCode?b=new Date(c+864e5):40===a.keyCode&&(b=new Date(c+6048e5)),this.isDisabled(b)||f.select(b,!0)}}},{name:"month",format:h.monthFormat,split:4,steps:{year:1},update:function(a,b){this.built&&a.getFullYear()===p.year?a.getMonth()!==p.month&&(angular.extend(p,{month:f.$date.getMonth(),date:f.$date.getDate()}),f.$updateSelected()):(angular.extend(p,{year:f.$date.getFullYear(),month:f.$date.getMonth(),date:f.$date.getDate()}),f.$build())},build:function(){for(var b,c=[],d=0;d<12;d++)b=new Date(p.year,d,1),c.push({date:b,label:j(b,this.format),selected:f.$isSelected(b),disabled:this.isDisabled(b)});g.title=j(b,h.yearTitleFormat),g.showLabels=!1,g.rows=a(c,this.split),this.built=!0},isSelected:function(a){return f.$date&&a.getFullYear()===f.$date.getFullYear()&&a.getMonth()===f.$date.getMonth()},isDisabled:function(a){return+new Date(a.getFullYear(),a.getMonth()+1,0)<h.minDate||a.getTime()>h.maxDate},onKeyDown:function(a){if(f.$date){var b=f.$date.getMonth(),c=new Date(f.$date);37===a.keyCode?c.setMonth(b-1):38===a.keyCode?c.setMonth(b-4):39===a.keyCode?c.setMonth(b+1):40===a.keyCode&&c.setMonth(b+4),this.isDisabled(c)||f.select(c,!0)}}},{name:"year",format:h.yearFormat,split:4,steps:{year:12},update:function(a,b){!this.built||b||parseInt(a.getFullYear()/20,10)!==parseInt(p.year/20,10)?(angular.extend(p,{year:f.$date.getFullYear(),month:f.$date.getMonth(),date:f.$date.getDate()}),f.$build()):a.getFullYear()!==p.year&&(angular.extend(p,{year:f.$date.getFullYear(),month:f.$date.getMonth(),date:f.$date.getDate()}),f.$updateSelected())},build:function(){for(var b,c=p.year-p.year%(3*this.split),d=[],e=0;e<12;e++)b=new Date(c+e,0,1),d.push({date:b,label:j(b,this.format),selected:f.$isSelected(b),disabled:this.isDisabled(b)});g.title=d[0].label+"-"+d[d.length-1].label,g.showLabels=!1,g.rows=a(d,this.split),this.built=!0},isSelected:function(a){return f.$date&&a.getFullYear()===f.$date.getFullYear()},isDisabled:function(a){return+new Date(a.getFullYear()+1,0,0)<h.minDate||a.getTime()>h.maxDate},onKeyDown:function(a){if(f.$date){var b=f.$date.getFullYear(),c=new Date(f.$date);37===a.keyCode?c.setYear(b-1):38===a.keyCode?c.setYear(b-4):39===a.keyCode?c.setYear(b+1):40===a.keyCode&&c.setYear(b+4),this.isDisabled(c)||f.select(c,!0)}}}];return{views:h.minView?Array.prototype.slice.call(q,h.minView):q,viewDate:p}}}]}),angular.module("mgcrea.ngStrap.collapse",[]).provider("$collapse",function(){
var a=this.defaults={animation:"am-collapse",disallowToggle:!1,activeClass:"in",startCollapsed:!1,allowMultiple:!1},b=this.controller=function(b,c,d){function e(a){for(var b=i.$targets.$active,c=0;c<b.length;c++)a<b[c]&&(b[c]=b[c]-1),b[c]===i.$targets.length&&(b[c]=i.$targets.length-1)}function f(a){return-1!==i.$targets.$active.indexOf(a)}function g(a){var b=i.$targets.$active.indexOf(a);-1!==b&&i.$targets.$active.splice(b,1)}function h(a){i.$options.allowMultiple||i.$targets.$active.splice(0,1),-1===i.$targets.$active.indexOf(a)&&i.$targets.$active.push(a)}var i=this;i.$options=angular.copy(a),angular.forEach(["animation","disallowToggle","activeClass","startCollapsed","allowMultiple"],function(a){angular.isDefined(d[a])&&(i.$options[a]=d[a])});var j=/^(false|0|)$/i;angular.forEach(["disallowToggle","startCollapsed","allowMultiple"],function(a){angular.isDefined(d[a])&&j.test(d[a])&&(i.$options[a]=!1)}),i.$toggles=[],i.$targets=[],i.$viewChangeListeners=[],i.$registerToggle=function(a){i.$toggles.push(a)},i.$registerTarget=function(a){i.$targets.push(a)},i.$unregisterToggle=function(a){var b=i.$toggles.indexOf(a);i.$toggles.splice(b,1)},i.$unregisterTarget=function(a){var b=i.$targets.indexOf(a);i.$targets.splice(b,1),i.$options.allowMultiple&&g(a),e(b),i.$viewChangeListeners.forEach(function(a){a()})},i.$targets.$active=i.$options.startCollapsed?[]:[0],i.$setActive=b.$setActive=function(a){angular.isArray(a)?i.$targets.$active=a:!i.$options.disallowToggle&&f(a)?g(a):h(a),i.$viewChangeListeners.forEach(function(a){a()})},i.$activeIndexes=function(){return i.$options.allowMultiple?i.$targets.$active:1===i.$targets.$active.length?i.$targets.$active[0]:-1}};this.$get=function(){var c={};return c.defaults=a,c.controller=b,c}}).directive("bsCollapse",["$window","$animate","$collapse",function(a,b,c){return{require:["?ngModel","bsCollapse"],controller:["$scope","$element","$attrs",c.controller],link:function(a,b,c,d){var e=d[0],f=d[1];e&&(f.$viewChangeListeners.push(function(){e.$setViewValue(f.$activeIndexes())}),e.$formatters.push(function(a){if(angular.isArray(a))f.$setActive(a);else{var b=f.$activeIndexes();angular.isArray(b)?-1===b.indexOf(1*a)&&f.$setActive(1*a):b!==1*a&&f.$setActive(1*a)}return a}))}}}]).directive("bsCollapseToggle",function(){return{require:["^?ngModel","^bsCollapse"],link:function(a,b,c,d){var e=d[1];b.attr("data-toggle","collapse"),e.$registerToggle(b),a.$on("$destroy",function(){e.$unregisterToggle(b)}),b.on("click",function(){if(!c.disabled){var d=c.bsCollapseToggle&&"bs-collapse-toggle"!==c.bsCollapseToggle?c.bsCollapseToggle:e.$toggles.indexOf(b);e.$setActive(1*d),a.$apply()}})}}}).directive("bsCollapseTarget",["$animate",function(a){return{require:["^?ngModel","^bsCollapse"],link:function(b,c,d,e){function f(){var b=g.$targets.indexOf(c),d=g.$activeIndexes(),e="removeClass";angular.isArray(d)?-1!==d.indexOf(b)&&(e="addClass"):b===d&&(e="addClass"),a[e](c,g.$options.activeClass)}var g=e[1];c.addClass("collapse"),g.$options.animation&&c.addClass(g.$options.animation),g.$registerTarget(c),b.$on("$destroy",function(){g.$unregisterTarget(c)}),g.$viewChangeListeners.push(function(){f()}),f()}}}]),angular.module("mgcrea.ngStrap.aside",["mgcrea.ngStrap.modal"]).provider("$aside",function(){var a=this.defaults={animation:"am-fade-and-slide-right",prefixClass:"aside",prefixEvent:"aside",placement:"right",templateUrl:"aside/aside.tpl.html",contentTemplate:!1,container:!1,element:null,backdrop:!0,keyboard:!0,html:!1,show:!0};this.$get=["$modal",function(b){function c(c){var d=angular.extend({},a,c);return b(d)}return c}]}).directive("bsAside",["$window","$sce","$aside",function(a,b,c){return{restrict:"EAC",scope:!0,link:function(a,d,e,f){var g={scope:a,element:d,show:!1};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","backdrop","keyboard","html","container","animation"],function(a){angular.isDefined(e[a])&&(g[a]=e[a])});var h=/^(false|0|)$/i;angular.forEach(["backdrop","keyboard","html","container"],function(a){angular.isDefined(e[a])&&h.test(e[a])&&(g[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(e[c])&&(g[b]=a.$eval(e[c]))}),angular.forEach(["title","content"],function(c){e[c]&&e.$observe(c,function(d,e){a[c]=b.trustAsHtml(d)})}),e.bsAside&&a.$watch(e.bsAside,function(b,c){angular.isObject(b)?angular.extend(a,b):a.content=b},!0);var i=c(g);d.on(e.trigger||"click",i.toggle),a.$on("$destroy",function(){i&&i.destroy(),g=null,i=null})}}}]),angular.module("mgcrea.ngStrap.alert",["mgcrea.ngStrap.modal"]).provider("$alert",function(){var a=this.defaults={animation:"am-fade",prefixClass:"alert",prefixEvent:"alert",placement:null,templateUrl:"alert/alert.tpl.html",container:!1,element:null,backdrop:!1,keyboard:!0,show:!0,duration:!1,type:!1,dismissable:!0};this.$get=["$modal","$timeout",function(b,c){function d(d){var e={},f=angular.extend({},a,d);e=b(f),e.$scope.dismissable=!!f.dismissable,f.type&&(e.$scope.type=f.type);var g=e.show;return f.duration&&(e.show=function(){g(),c(function(){e.hide()},1e3*f.duration)}),e}return d}]}).directive("bsAlert",["$window","$sce","$alert",function(a,b,c){return{restrict:"EAC",scope:!0,link:function(a,d,e,f){var g={scope:a,element:d,show:!1};angular.forEach(["template","templateUrl","controller","controllerAs","placement","keyboard","html","container","animation","duration","dismissable"],function(a){angular.isDefined(e[a])&&(g[a]=e[a])});var h=/^(false|0|)$/i;angular.forEach(["keyboard","html","container","dismissable"],function(a){angular.isDefined(e[a])&&h.test(e[a])&&(g[a]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(b){var c="bs"+b.charAt(0).toUpperCase()+b.slice(1);angular.isDefined(e[c])&&(g[b]=a.$eval(e[c]))}),a.hasOwnProperty("title")||(a.title=""),angular.forEach(["title","content","type"],function(c){e[c]&&e.$observe(c,function(d,e){a[c]=b.trustAsHtml(d)})}),e.bsAlert&&a.$watch(e.bsAlert,function(b,c){angular.isObject(b)?angular.extend(a,b):a.content=b},!0);var i=c(g);d.on(e.trigger||"click",i.toggle),a.$on("$destroy",function(){i&&i.destroy(),g=null,i=null})}}}]),angular.module("mgcrea.ngStrap.affix",["mgcrea.ngStrap.helpers.dimensions","mgcrea.ngStrap.helpers.debounce"]).provider("$affix",function(){var a=this.defaults={offsetTop:"auto",inlineStyles:!0,setWidth:!0};this.$get=["$window","debounce","dimensions",function(b,c,d){function e(e,h){function i(a,b,c){var d=j(),e=k();return d<=r?"top":null!==a?d+a<=b.top?"middle":"bottom":null!==s&&b.top+c+p>=e-s?"bottom":"middle"}function j(){return n[0]===b?b.pageYOffset:n[0].scrollTop}function k(){return n[0]===b?b.document.body.scrollHeight:n[0].scrollHeight}var l={},m=angular.extend({},a,h),n=m.target,o=!1,p=0,q=0,r=0,s=0,t=null,u=null,v=e.parent();if(m.offsetParent)if(m.offsetParent.match(/^\d+$/))for(var w=0;w<1*m.offsetParent-1;w++)v=v.parent();else v=angular.element(m.offsetParent);return l.init=function(){this.$parseOffsets(),q=d.offset(e[0]).top+p,o=m.setWidth&&!e[0].style.width,n.on("scroll",this.checkPosition),n.on("click",this.checkPositionWithEventLoop),g.on("resize",this.$debouncedOnResize),this.checkPosition(),this.checkPositionWithEventLoop()},l.destroy=function(){n.off("scroll",this.checkPosition),n.off("click",this.checkPositionWithEventLoop),g.off("resize",this.$debouncedOnResize)},l.checkPositionWithEventLoop=function(){setTimeout(l.checkPosition,1)},l.checkPosition=function(){var a=j(),b=d.offset(e[0]),c=d.height(e[0]),g=i(u,b,c);t!==g&&(t=g,"top"===g?(u=null,o&&e.css("width",""),m.inlineStyles&&(e.css("position",m.offsetParent?"":"relative"),e.css("top",""))):"bottom"===g?(u=m.offsetUnpin?-1*m.offsetUnpin:b.top-a,o&&e.css("width",""),m.inlineStyles&&(e.css("position",m.offsetParent?"":"relative"),e.css("top",m.offsetParent?"":f[0].offsetHeight-s-c-q+"px"))):(u=null,o&&e.css("width",e[0].offsetWidth+"px"),m.inlineStyles&&(e.css("position","fixed"),e.css("top",p+"px"))),e.removeClass("affix affix-top affix-bottom").addClass("affix"+("middle"!==g?"-"+g:"")))},l.$onResize=function(){l.$parseOffsets(),l.checkPosition()},l.$debouncedOnResize=c(l.$onResize,50),l.$parseOffsets=function(){var a=e[0].style.position,b=e[0].style.top;m.inlineStyles&&(e.css("position",m.offsetParent?"":"relative"),e.css("top","")),m.offsetTop&&("auto"===m.offsetTop&&(m.offsetTop="+0"),m.offsetTop.match(/^[-+]\d+$/)?(p=1*-m.offsetTop,r=m.offsetParent?d.offset(v[0]).top+1*m.offsetTop:d.offset(e[0]).top-d.css(e[0],"marginTop",!0)+1*m.offsetTop):r=1*m.offsetTop),m.offsetBottom&&(s=m.offsetParent&&m.offsetBottom.match(/^[-+]\d+$/)?k()-(d.offset(v[0]).top+d.height(v[0]))+1*m.offsetBottom+1:1*m.offsetBottom),m.inlineStyles&&(e.css("position",a),e.css("top",b))},l.init(),l}var f=angular.element(b.document.body),g=angular.element(b);return e}]}).directive("bsAffix",["$affix","$window","$timeout",function(a,b,c){return{restrict:"EAC",require:"^?bsAffixTarget",link:function(d,e,f,g){var h={scope:d,target:g?g.$element:angular.element(b)};angular.forEach(["offsetTop","offsetBottom","offsetParent","offsetUnpin","inlineStyles","setWidth"],function(a){if(angular.isDefined(f[a])){var b=f[a];/true/i.test(b)&&(b=!0),/false/i.test(b)&&(b=!1),h[a]=b}});var i;c(function(){i=a(e,h)}),d.$on("$destroy",function(){i&&i.destroy(),h=null,i=null})}}}]).directive("bsAffixTarget",function(){return{controller:["$element",function(a){this.$element=a}]}}),angular.module("mgcrea.ngStrap",["mgcrea.ngStrap.modal","mgcrea.ngStrap.aside","mgcrea.ngStrap.alert","mgcrea.ngStrap.button","mgcrea.ngStrap.select","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.timepicker","mgcrea.ngStrap.navbar","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.popover","mgcrea.ngStrap.dropdown","mgcrea.ngStrap.typeahead","mgcrea.ngStrap.scrollspy","mgcrea.ngStrap.affix","mgcrea.ngStrap.tab","mgcrea.ngStrap.collapse"])}(window,document),function(a,b,c){"use strict";angular.module("mgcrea.ngStrap.alert").run(["$templateCache",function(a){a.put("alert/alert.tpl.html",'<div class="alert" ng-class="[type ? \'alert-\' + type : null]"><button type="button" class="close" ng-if="dismissable" ng-click="$hide()">&times;</button> <span ng-if="title"><strong ng-bind="title"></strong>&nbsp;<span ng-bind-html="content"></span> </span><span ng-if="!title" ng-bind-html="content"></span></div>')}]),angular.module("mgcrea.ngStrap.aside").run(["$templateCache",function(a){a.put("aside/aside.tpl.html",'<div class="aside" tabindex="-1" role="dialog"><div class="aside-dialog"><div class="aside-content"><div class="aside-header" ng-show="title"><button type="button" class="close" ng-click="$hide()">&times;</button><h4 class="aside-title" ng-bind="title"></h4></div><div class="aside-body" ng-bind="content"></div><div class="aside-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Close</button></div></div></div></div>')}]),angular.module("mgcrea.ngStrap.datepicker").run(["$templateCache",function(a){a.put("datepicker/datepicker.tpl.html",'<div class="dropdown-menu datepicker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px"><table style="table-layout: fixed; height: 100%; width: 100%"><thead><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)"><i class="{{$iconLeft}}"></i></button></th><th colspan="{{ rows[0].length - 2 }}"><button tabindex="-1" type="button" class="btn btn-default btn-block text-strong" ng-click="$toggleMode()"><strong style="text-transform: capitalize" ng-bind="title"></strong></button></th><th><button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)"><i class="{{$iconRight}}"></i></button></th></tr><tr ng-if="showLabels" ng-bind-html="labels"></tr></thead><tbody><tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%"><td class="text-center" ng-repeat="(j, el) in row"><button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected, \'btn-info btn-today\': el.isToday && !el.selected}" ng-click="$select(el.date, el.disabled)" ng-disabled="el.disabled"><span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span></button></td></tr></tbody><tfoot><tr><td colspan="{{ rows[0].length }}"><div class="btn-group btn-group-justified" role="group"><div class="btn-group" role="group" ng-if="$hasToday"><button type="button" class="btn btn-default today" ng-click="$setToday()" ng-disabled="isTodayDisabled"><strong style="text-transform: capitalize">Today</strong></button></div><div class="btn-group" role="group" ng-if="$hasClear"><button type="button" class="btn btn-default clear" ng-click="$clear()"><strong style="text-transform: capitalize">Clear</strong></button></div></div></td></tr></tfoot></table></div>')}]),angular.module("mgcrea.ngStrap.dropdown").run(["$templateCache",function(a){a.put("dropdown/dropdown.tpl.html",'<ul tabindex="-1" class="dropdown-menu" role="menu" ng-show="content && content.length"><li role="presentation" ng-class="{divider: item.divider, active: item.active}" ng-repeat="item in content"><a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && item.href" target="{{item.target || \'\'}}" ng-bind="item.text"></a> <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a></li></ul>')}]),angular.module("mgcrea.ngStrap.modal").run(["$templateCache",function(a){a.put("modal/modal.tpl.html",'<div class="modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header" ng-show="title"><button type="button" class="close" aria-label="Close" ng-click="$hide()"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" ng-bind="title"></h4></div><div class="modal-body" ng-bind="content"></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Close</button></div></div></div></div>')}]),angular.module("mgcrea.ngStrap.popover").run(["$templateCache",function(a){a.put("popover/popover.tpl.html",'<div class="popover" tabindex="-1"><div class="arrow"></div><h3 class="popover-title" ng-bind="title" ng-show="title"></h3><div class="popover-content" ng-bind="content"></div></div>')}]),angular.module("mgcrea.ngStrap.select").run(["$templateCache",function(a){a.put("select/select.tpl.html",'<ul tabindex="-1" class="select dropdown-menu" ng-show="$isVisible()" role="select"><li ng-if="$showAllNoneButtons"><div class="btn-group" style="margin-bottom: 5px; margin-left: 5px"><button type="button" class="btn btn-default btn-xs" ng-click="$selectAll()">{{$allText}}</button> <button type="button" class="btn btn-default btn-xs" ng-click="$selectNone()">{{$noneText}}</button></div></li><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $isActive($index)}"><a role="menuitem" tabindex="-1" ng-click="$select($index, $event)"><i class="{{$iconCheckmark}} pull-right" ng-if="$isMultiple && $isActive($index)"></i> <span ng-bind="match.label"></span></a></li></ul>')}]),angular.module("mgcrea.ngStrap.tab").run(["$templateCache",function(a){a.put("tab/tab.tpl.html",'<ul class="nav" ng-class="$navClass" role="tablist"><li role="presentation" ng-repeat="$pane in $panes track by $index" ng-class="[ $isActive($pane, $index) ? $activeClass : \'\', $pane.disabled ? \'disabled\' : \'\' ]"><a role="tab" data-toggle="tab" ng-click="!$pane.disabled && $setActive($pane.name || $index)" data-index="{{ $index }}" ng-bind-html="$pane.title" aria-controls="$pane.title" href=""></a></li></ul><div ng-transclude class="tab-content"></div>')}]),angular.module("mgcrea.ngStrap.timepicker").run(["$templateCache",function(a){a.put("timepicker/timepicker.tpl.html",'<div class="dropdown-menu timepicker" style="min-width: 0px;width: auto"><table height="100%"><thead><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 0)"><i class="{{ $iconUp }}"></i></button></th><th>&nbsp;</th><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 1)"><i class="{{ $iconUp }}"></i></button></th><th ng-if="showSeconds">&nbsp;</th><th ng-if="showSeconds"><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 2)"><i class="{{ $iconUp }}"></i></button></th></tr></thead><tbody><tr ng-repeat="(i, row) in rows"><td class="text-center"><button tabindex="-1" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[0].selected}" ng-click="$select(row[0].date, 0)" ng-disabled="row[0].disabled"><span ng-class="{\'text-muted\': row[0].muted}" ng-bind="row[0].label"></span></button></td><td><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td class="text-center"><button tabindex="-1" ng-if="row[1].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[1].selected}" ng-click="$select(row[1].date, 1)" ng-disabled="row[1].disabled"><span ng-class="{\'text-muted\': row[1].muted}" ng-bind="row[1].label"></span></button></td><td ng-if="showSeconds"><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td ng-if="showSeconds" class="text-center"><button tabindex="-1" ng-if="row[2].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[2].selected}" ng-click="$select(row[2].date, 2)" ng-disabled="row[2].disabled"><span ng-class="{\'text-muted\': row[2].muted}" ng-bind="row[2].label"></span></button></td><td ng-if="showAM">&nbsp;</td><td ng-if="showAM"><button tabindex="-1" ng-show="i == midIndex - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !!isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">AM</button> <button tabindex="-1" ng-show="i == midIndex + 1 - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">PM</button></td></tr></tbody><tfoot><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 0)"><i class="{{ $iconDown }}"></i></button></th><th>&nbsp;</th><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 1)"><i class="{{ $iconDown }}"></i></button></th><th ng-if="showSeconds">&nbsp;</th><th ng-if="showSeconds"><button ng-if="showSeconds" tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 2)"><i class="{{ $iconDown }}"></i></button></th></tr></tfoot></table></div>')}]),angular.module("mgcrea.ngStrap.tooltip").run(["$templateCache",function(a){a.put("tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show="title"><div class="tooltip-arrow"></div><div class="tooltip-inner" ng-bind="title"></div></div>')}]),angular.module("mgcrea.ngStrap.typeahead").run(["$templateCache",function(a){a.put("typeahead/typeahead.tpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select"><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}"><a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a></li></ul>')}])}(window,document),function(a,b){"function"==typeof define&&define.amd?define(["angular-schema-form"],b):"object"==typeof exports?module.exports=b(require("angular-schema-form")):a.angularSchemaFormDynamicSelect=b(a.schemaForm)}(this,function(a){angular.module("schemaForm").run(["$templateCache",function(a){a.put("directives/decorators/bootstrap/strap/strapmultiselect.html",'<div ng-controller="dynamicSelectController" class="form-group {{form.htmlClass}}"\n     ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n    <label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label>\n\n    <div class="form-group {{form.fieldHtmlClass}}" ng-init="populateTitleMap(form)">\n        <button type="button" class="btn btn-default" sf-changed="form" schema-validate="form" ng-model="$$value$$"\n                data-placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\')}}"\n                data-html="1"\n                data-multiple="1"  data-multiple="1" data-max-length="{{form.options.inlineMaxLength}}"\n                data-max-length-html="{{form.options.inlineMaxLengthHtml}}"\n                bs-options="item.value as item.name for item in form.titleMap | selectFilter:this:$$value$$:&quot;$$value$$&quot;"\n                bs-select>\n        </button>\n        <span class="help-block">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\n    </div>\n</div>\n'),a.put("directives/decorators/bootstrap/strap/strapselect.html",'<div ng-controller="dynamicSelectController" class="select-controller form-group {{form.htmlClass}}"\n     ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n    <label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label>\n\n    <div class="form-group {{form.fieldHtmlClass}}" ng-init="populateTitleMap(form)">\n        <button ng-if="(form.options.multiple == \'true\') || (form.options.multiple == true)"\n                type="button" class="btn btn-default" sf-changed="form" schema-validate="form" ng-model="$$value$$"\n                data-placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\')}}"\n                data-html="1" data-multiple="1" data-max-length="{{form.options.inlineMaxLength}}"\n                data-max-length-html="{{form.options.inlineMaxLengthHtml}}"\n                bs-options="item.value as item.name for item in form.titleMap | selectFilter:this:$$value$$:&quot;$$value$$&quot;"\n                bs-select>\n        </button>\n        <button ng-if="!((form.options.multiple == \'true\') || (form.options.multiple == true))"\n                type="button" class="btn btn-default" sf-changed="form" schema-validate="form" ng-model="$$value$$"\n                data-placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\')}}"\n                data-html="1"\n                bs-options="item.value as item.name for item in form.titleMap | selectFilter:this:$$value$$:&quot;$$value$$&quot;"\n                bs-select>\n        </button>\n        <span class="help-block">{{ (hasError() && errorMessage(schemaError())) || form.description}} </span>\n    </div>\n</div>\n\n')}]),angular.module("schemaForm").run(["$templateCache",function(a){a.put("directives/decorators/bootstrap/uiselect/uiselect.html",'<div ng-controller="dynamicSelectController" class="form-group"\n     ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess(), \'has-feedback\': form.feedback !== false}"\n         ng-init="insideModel=$$value$$;">\n    <label class="control-label" ng-show="showTitle()">{{form.title}}</label>\n\n    <div class="form-group">\n        <ui-select append-to-body="true" ng-model="select_model.selected"\n                   ng-if="!(form.options.tagging||false)" theme="bootstrap" ng-disabled="form.disabled"\n                   on-select="$$value$$=$item.value" class="{{form.options.uiClass}}">\n            <ui-select-match\n                    placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\' | translate)}}">\n                {{select_model.selected.name}}\n            </ui-select-match>\n            <ui-select-choices refresh="populateTitleMap(form, $select.search)"\n                               refresh-delay="form.options.refreshDelay" group-by="form.options.groupBy"\n                               repeat="item in form.titleMap | propsFilter: {name: $select.search, description: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\') }">\n                <div ng-bind-html="item.name | highlight: $select.search"></div>\n                <div ng-if="item.description">\n                    <span ng-bind-html="\'<small>\' + (\'\'+item.description | highlight: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\'))+ \'</small>\'"></span>\n                </div>\n            </ui-select-choices>\n        </ui-select>\n        <ui-select  append-to-body="true" ng-controller="dynamicSelectController" ng-model="select_model.selected"\n                   ng-if="(form.options.tagging||false) && !(form.options.groupBy || false)"\n                   tagging="form.options.tagging||false" tagging-label="form.options.taggingLabel"\n                   tagging-tokens="form.options.taggingTokens"\n                   theme="bootstrap" ng-disabled="form.disabled" on-select="$$value$$=$item.value"\n                   class="{{form.options.uiClass}}">\n            <ui-select-match\n                    placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\' | translate)}}">\n                {{select_model.selected.name}}&nbsp;\n                <small>{{(select_model.selected.isTag===true ? form.options.taggingLabel : \'\')}}</small>\n            </ui-select-match>\n            \x3c!--repeat code because tagging does not display properly under group by but is still useful --\x3e\n            <ui-select-choices refresh="populateTitleMap(form, $select.search))"\n                               refresh-delay="form.options.refreshDelay"\n                               repeat="item in form.titleMap | propsFilter: {name: $select.search, description: (form.options.searchDescription===true ? $select.search : \'NOTSEARCHINGFORTHIS\') }">\n                <div ng-if="item.isTag"\n                     ng-bind-html="\'<div>\' + (item.name   | highlight: $select.search) + \' \' + form.options.taggingLabel + \'</div><div class=&quot;divider&quot;></div>\'"></div>\n                <div ng-if="!item.isTag" ng-bind-html="item.name + item.isTag| highlight: $select.search"></div>\n                <div ng-if="item.description">\n                    <span ng-bind-html="\'<small>\' + (\'\'+item.description | highlight: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\')) + \'</small>\'"></span>\n                </div>\n            </ui-select-choices>\n        </ui-select>\n\n        \x3c!--repeat code because tagging does not display properly under group by but is still useful --\x3e\n\n        <ui-select  append-to-body="true" ng-controller="dynamicSelectController" ng-model="select_model.selected"\n                   ng-if="(form.options.tagging||false) && (form.options.groupBy || false)"\n                   tagging="form.options.tagging||false" tagging-label="form.options.taggingLabel"\n                   tagging-tokens="form.options.taggingTokens"\n                   theme="bootstrap" ng-disabled="form.disabled" on-select="$$value$$=$item.value"\n                   class="{{form.options.uiClass}}">\n            <ui-select-match\n                    placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\' | translate)}}">\n                {{select_model.selected.name}}&nbsp;\n                <small>{{(select_model.selected.isTag===true ? form.options.taggingLabel : \'\')}}</small>\n            </ui-select-match>\n            <ui-select-choices group-by="form.options.groupBy"\n                               refresh="populateTitleMap(form, $select.search)"\n                               refresh-delay="form.options.refreshDelay"\n                               repeat="item in form.titleMap | propsFilter: {name: $select.search, description: (form.options.searchDescription===true ? $select.search : \'NOTSEARCHINGFORTHIS\') }">\n                <div ng-if="item.isTag"\n                     ng-bind-html="\'<div>\' + (item.name  | highlight: $select.search) + \' \' + form.options.taggingLabel + \'</div><div class=&quot;divider&quot;></div>\'"></div>\n                <div ng-if="!item.isTag" ng-bind-html="item.name + item.isTag| highlight: $select.search"></div>\n                <div ng-if="item.description">\n                    <span ng-bind-html="\'<small>\' + (\'\'+item.description | highlight: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\')) + \'</small>\'"></span>\n                </div>\n            </ui-select-choices>\n        </ui-select>\n\n        <input type="hidden" toggle-single-model sf-changed="form" ng-model="insideModel" schema-validate="form"/>\n    <span ng-if="form.feedback !== false"\n          class="form-control-feedback"\n          ng-class="evalInScope(form.feedback) || {\'glyphicon\': true, \'glyphicon-ok\': hasSuccess(), \'glyphicon-remove\': hasError() }"></span>\n\n        <div class="help-block"\n             ng-show="(hasError() && errorMessage(schemaError())) || form.description"\n             ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></div>\n    </div>\n</div>\n'),a.put("directives/decorators/bootstrap/uiselect/uiselectmultiple.html",'\n<div class="form-group" ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess(), \'has-feedback\': form.feedback !== false}"\n       ng-controller="dynamicSelectController" ng-init="$$value$$=$$value$$||[];uiMultiSelectInitInternalModel($$value$$)">\n  <label class="control-label" ng-show="showTitle()">{{form.title}}</label>\n  <div class="form-group">\n    <ui-select  ng-disabled="form.disabled"\n first-item-active="false" skip-focusser="true" remove-selected="true" limit="{{form.options.limit}}" multiple autofocus="true"  close-on-select="{{form.options.closeOnSelect}}" append-to-body="true" sortable-options="{{form.sortableOptions}}" ng-model="internalModel" sf-changed="form" theme="bootstrap"\n  schema-validate="form"             on-select="$$value$$.push($item.value)" on-remove="$$value$$.splice($$value$$.indexOf($item.value), 1)"\n               class="{{form.options.uiClass}}">\n      <ui-select-match placeholder="{{form.placeholder || form.schema.placeholder || (\'placeholders.select\' | translate)}}">{{$item.name}}</ui-select-match>\n      <ui-select-choices first-item-active="false" skip-focusser="true" repeat="item in form.titleMap | propsFilter: {name: $select.search} | limitTo: form.options.limitTo"\n         refresh="populateTitleMap(form, $select.search)"\n         refresh-delay="form.options.refreshDelay"\n         group-by="form.options.groupBy">\n        <div ng-bind-html="item.name | highlight: $select.search"></div>\n      </ui-select-choices>\n    </ui-select>\n    <span ng-if="form.feedback !== false"\n      class="form-control-feedback"\n      ng-class="evalInScope(form.feedback) || {\'glyphicon\': true, \'glyphicon-ok\': hasSuccess(), \'glyphicon-remove\': hasError() }"></span>\n    <div class="help-block"\n      ng-show="(hasError() && errorMessage(schemaError())) || form.description"\n      ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></div>\n  </div>\n</div>\n')}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(a,b,c){var d=function(b,d,e){if("string"===d.type&&"enum"in d){var f=a.stdFormObj(b,d,e);return f.key=e.path,f.type="strapselect",e.lookup[c.stringify(e.path)]=f,f}};a.defaults.string.unshift(d),b.addMapping("bootstrapDecorator","strapselect","directives/decorators/bootstrap/strap/strapselect.html"),b.addMapping("bootstrapDecorator","strapmultiselect","directives/decorators/bootstrap/strap/strapmultiselect.html"),b.addMapping("bootstrapDecorator","strapselectdynamic","directives/decorators/bootstrap/strap/strapselect.html"),
b.addMapping("bootstrapDecorator","strapmultiselectdynamic","directives/decorators/bootstrap/strap/strapmultiselect.html"),b.addMapping("bootstrapDecorator","uiselect","directives/decorators/bootstrap/uiselect/uiselect.html"),b.addMapping("bootstrapDecorator","uiselectmultiple","directives/decorators/bootstrap/uiselect/uiselectmultiple.html")}]).directive("toggleSingleModel",function(){return{require:"ngModel",restrict:"A",scope:{},replace:!0,controller:["$scope",function(a){a.$parent.$watch("select_model.selected",function(){void 0!=a.$parent.select_model.selected&&(a.$parent.insideModel=a.$parent.select_model.selected.value,a.$parent.ngModel.$setViewValue(a.$parent.select_model.selected.value))})}]}}).directive("multipleOn",function(){return{link:function(a,b,c){a.$watch(function(){return b.attr("multiple-on")},function(a){if("true"==a){var c=angular.element(b).scope().$$childTail;c.$isMultiple=!0,c.options.multiple=!0,c.$select.$element.addClass("select-multiple")}else angular.element(b).scope().$$childTail.$isMultiple=!1})}}}).filter("whereMulti",function(){return function(a,b,c){var d=[];return angular.isArray(c)&&void 0!==a?c.forEach(function(c){for(var e=0;e<a.length;e++)if(c==a[e][b]){d.push(a[e]);break}}):d=a,d}}).filter("propsFilter",function(){return function(a,b){var c=[],d=0;return angular.isArray(a)?a.forEach(function(a){for(var e=!1,f=Object.keys(b),g=0;g<f.length;g++){var h=f[g];if(a.hasOwnProperty(h)){var i=b[h].toLowerCase();if((0===a[h].toString().toLowerCase().indexOf(i)||-1!==a[h].toString().toLowerCase().indexOf(" "+i))&&d<2e3){d++,e=!0;break}}}e&&c.push(a)}):c=a,c}}),angular.module("schemaForm").controller("dynamicSelectController",["$scope","$http","$timeout",function(a,b,c){a.form.options||(a.form.options={}),a.select_model={},a.form.options.scope=a,a.triggerTitleMap=function(){a.form.titleMap.push({value:"345890u340598u3405u9",name:"34095u3p4ouij"}),c(function(){a.form.titleMap.pop()})},a.initFiltering=function(b){a.form.options.filterTriggers&&a.form.options.filterTriggers.forEach(function(b){a.$parent.$watch(b,a.triggerTitleMap)}),a.localModelType=Object.prototype.toString.call(b),a.filteringInitialized=!0},a.finalizeTitleMap=function(b,c,d){if(b.titleMap=[],d&&"map"in d&&d.map){var e=d.map.nameProperty.length-1,f=d.map.separatorValue?d.map.separatorValue:" - ";c.forEach(function(a){if(a.value=a[d.map.valueProperty],"string"!=typeof d.map.nameProperty){var c="";for(var g in d.map.nameProperty)c+=a[d.map.nameProperty[g]],g!=e&&(c+=f);a.name=c}else a.name=a[d.map.nameProperty];b.titleMap.push(a)})}else c.forEach(function(a){"text"in a&&(a.name=a.text)}),b.titleMap=c;a.insideModel&&void 0===a.select_model.selected&&(a.select_model.selected=a.find_in_titleMap(a.insideModel)),a.internalModel&&a.uiMultiSelectInitInternalModel(a.externalModel)},a.clone=function(b){if(null==b||"object"!=typeof b)return b;var c=b.constructor();for(var d in b)b[d]!=a&&b.hasOwnProperty(d)&&(c[d]=a.clone(b[d]));return c},a.getCallback=function(b){if("string"==typeof b){var c=a.$parent.evalExpr(b);if("function"==typeof c)return c;throw"A callback string must match name of a function in the parent scope"}if("function"==typeof b)return b;throw"A callback must either be a string matching the name of a function in the parent scope or a direct function reference"},a.getOptions=function(b,c){return b.httpPost&&b.httpPost.optionsCallback?(newOptionInstance=a.clone(b),a.getCallback(b.httpPost.optionsCallback)(newOptionInstance,c)):b.httpGet&&b.httpGet.optionsCallback?(newOptionInstance=a.clone(b),a.getCallback(b.httpGet.optionsCallback)(newOptionInstance,c)):b},a.test=function(a){a.titleMap.pop()},a.populateTitleMap=function(c,d){if(c.schema&&"enum"in c.schema)c.titleMap=[],c.schema.enum.forEach(function(a){c.titleMap.push({value:a,name:a})});else if(c.options)if(c.options.callback)c.titleMap=a.getCallback(c.options.callback)(c.options,d),a.finalizeTitleMap(c,c.titleMap,c.options);else{if(c.options.asyncCallback)return a.getCallback(c.options.asyncCallback)(c.options,d).then(function(b){a.finalizeTitleMap(c,b.data,c.options)},function(a,b){alert("Loading select items failed(Options: '"+String(c.options)+"\nError: "+b)});if(c.options.httpPost){var e=a.getOptions(c.options,d);return b.post(e.httpPost.url,e.httpPost.parameter).then(function(b){a.finalizeTitleMap(c,b.data,e)},function(a,b){alert("Loading select items failed (URL: '"+String(e.httpPost.url)+"' Parameter: "+String(e.httpPost.parameter)+"\nError: "+b)})}if(c.options.httpGet){var e=a.getOptions(c.options,d);return b.get(e.httpGet.url,e.httpGet.parameter).then(function(b){a.finalizeTitleMap(c,b.data,e)},function(a,b){alert("Loading select items failed (URL: '"+String(e.httpGet.url)+"\nError: "+b)})}a.insideModel&&void 0===a.select_model.selected&&(a.select_model.selected=a.find_in_titleMap(a.insideModel)),a.internalModel&&a.uiMultiSelectInitInternalModel(a.externalModel)}else;},a.find_in_titleMap=function(b){for(i=0;i<a.form.titleMap.length;i++)if(a.form.titleMap[i].value==b)return a.form.titleMap[i]},a.uiMultiSelectInitInternalModel=function(b){a.externalModel=b,a.internalModel=[],a.form.titleMap&&void 0!==b&&angular.isArray(b)&&b.forEach(function(b){var c=a.find_in_titleMap(b);if(c)a.internalModel.push(c);else{var d=a.externalModel.indexOf(b);-1!=d&&a.externalModel.splice(d,1)}})}}]),angular.module("schemaForm").filter("selectFilter",[function(a){return function(a,b,c,d){if(!angular.isDefined(a)||!angular.isDefined(b.form.options)||!angular.isDefined(b.form.options.filter)||""==b.form.options.filter)return a;b.filteringInitialized||b.initFiltering(c);var e=[];return angular.forEach(a,function(a){b.$eval(b.form.options.filter,{item:a})?e.push(a):c&&("[object Array]"==b.localModelType&&c.indexOf(a.value)>-1?c.splice(c.indexOf(a.value),1):c==a.value&&(c=null))}),"[object Array]"!=b.localModelType||c||b.$eval(d+"=[]"),e}}])});var underscore=angular.module("underscore",[]);underscore.factory("_",["$window",function(a){return a._}]),angular.module("WsClient",["ngWebSocket","ngCookies","underscore"]).provider("wsClient",function(){var a=this,b="wss://api-onset.scriptrapps.io/",c=null,d=null,e=null,f=null,g=null,h=!1,i={},j=0,k={},l=[];this.setBaseUrl=function(a){b=a},this.setPublishChannel=function(a){c=a},this.setSubscribeChannel=function(a){d=a},this.getSubscribeChannel=function(){return d},this.setToken=function(a){e=a},this.setIgnoreCookie=function(a){h=a};var m=function(){f=b+(e?"/"+e:"")},n=function(a){return j+=1,j>1e4&&(j=0),j},o=function(a,b){return g+"-"+(b?b+"_"+a:a)},p=function(a,b){return b?b+"_"+a:a},q=function(a,b){return g+"-"+(b?b+"_"+a:a)};this.$get=["$websocket","$cookies","$q","$rootScope","$interval","_",function(b,e,j,r,s,t){e.get("token")&&!h&&this.setToken(e.get("token")),m(),s(function(){if(w.promise&&l.length>0){var a=l[0];u.send(a),l.shift()}},700);var u=b(f),v={},w=j.defer(),x=j.defer(),y=j.defer();u.onOpen(function(){z(d)}),u.onMessage(function(a){try{var b=JSON.parse(a.data);if("connected."==b.result&&(g=b.id,w&&w.resolve()),"failure"==b.status&&"429"==b.statusCode);else if("failure"==b.status&&"401"==b.statusCode)return void(window.location="/users");v.data=b,B(b),C(b)}catch(a){}}),u.onClose(function(a){y.resolve(),"4000"==a.code||"4010"==a.code?window.location=onsetLoginUrl+"?action=redirect&url="+window.location.protocol+"//"+window.location.host+window.location.pathname:u.reconnect()}),u.onError(function(a){x.resolve()});var z=function(a){if(a)if("string"==typeof a)u.send(JSON.stringify({method:"Subscribe",params:{channel:a}}));else if("Array"==a.constructor.name)for(var b=0;b<a.length;b++)u.send(JSON.stringify({method:"Subscribe",params:{channel:a[b]}}))},A=function(a){if(a)if("string"==typeof a)u.send(JSON.stringify({method:"Unsubscribe",params:{channel:a}}));else if("Array"==a.constructor.name)for(var b=0;b<a.length;b++)u.send(JSON.stringify({method:"Unscubscribe",params:{channel:a[b]}}))},B=function(a){var b=a.id;b&&i.hasOwnProperty(b)&&(r.$apply(i[b].cb.resolve(a.result)),delete i[b])},C=function(a){var b=a.id;if(b&&k.hasOwnProperty("subscribeToAll"))for(var c=k.subscribeToAll,d=0;d<c.length;d++)c[d].cb(a.result);else if(b&&k.hasOwnProperty(b))for(var c=k[b],d=0;d<c.length;d++)c[d].cb(a.result)};return{getMessage:function(){return v},getStatus:function(){return u.readyState},subscribe:function(a,b,c){if(d){var b={time:new Date,cb:b};c&&(b.id=c),k[a]?k[a].push(b):k[a]=[b]}},unsubscribe:function(a,b,c){if(a&&d)if(!a||b||c){var e={};b&&(e.cb=b),c&&(e.id=c),k[a]=t.difference(k[a],t.where(k[a],e))}else k[a]=[]},publish:function(a,b,d){var e=c;if(d&&(e=d),e){var f=j.defer(),g=n(),h=o(g,b);return i[h]={time:new Date,cb:f},a.id=h,u.send({method:"Publish",params:{channel:e,message:JSON.stringify(a)}}),f.promise}},call:function(a,b,c){var d=j.defer(),e={method:a,params:{body:JSON.stringify(b)}},f=n(),g=q(f,c);return i[g]={time:new Date,cb:d},e.id=p(f,c),l.push(e),d.promise},updateSubscriptionChannel:function(b){A(a.getSubscribeChannel()),a.setSubscribeChannel(b),z(b)},updatePublishingChannel:function(b){a.setPublishChannel(b)},closeSocket:function(a){a?u.close(a):u.close(!1)},onReady:w.promise,onError:x.promise,onClose:y.promise}}]}),angular.module("HttpClient",["ngCookies"]).provider("httpClient",function(){var a="",b=null,c="",d=!1;this.setBaseUrl=function(b){a=b},this.setToken=function(a){b=a},this.setIgnoreCookie=function(a){d=a};var e=function(b){c=a+"/"+b};this.$get=["$cookies","$q","$http",function(a,f,g){a.get("token")&&!d&&(b=a.get("token"));var h=function(a,b,c){return a&&a[b]||(a||(a={}),a[b]=c),a},i=function(a,d){var i=f.defer();return e(a),d.url=c,b&&(d.headers=h(d.headers,"Authorization","Bearer "+b)),g(d).then(function(a){if(a.data&&a.data.response){var b=a.data.response;"200"==b.metadata.statusCode&&"success"==b.metadata.status?"403"==b.result.status?($.removeCookie("token",{path:"/"}),window.localStorage.removeItem("user"),window.localStorage.removeItem("dataMapping"),window.localStorage.removeItem("dataStream"),window.location=onsetLoginUrl+"?action=redirect&url="+window.location.protocol+"//"+window.location.host+window.location.pathname):b.result&&b.result.metadata?"200"==b.result.statusCode&&"success"==b.result.status?i.resolve(b.result.result,a):i.reject(b.result.metadata,a):i.resolve(b.result,a):i.reject(b.metadata,a)}},function(a){"429"==a.status||("400"==a.status||"403"==a.status?window.location=onsetLoginUrl+"?action=redirect&url="+window.location.protocol+"//"+window.location.host+window.location.pathname:"401"==a.status&&(window.location="/users")),i.reject(a)}),i.promise};return{get:function(a,b){var c={method:"GET"};return c.params=b,i(a,c)},post:function(a,b,c,d){var e={method:"POST"};return e.data=b,c&&(e.headers=c),c&&c["Content-Type"]||(e.headers=h(e.headers,"Content-Type","application/json")),d&&(e.headers["Content-Type"]=void 0,e.transformRequest=angular.identity),i(a,e)}}}]}),angular.module("Chart",["angular.morris"]),angular.element(document).ready(function(){Morris.Donut.prototype.resizeHandler=function(){return this.timeoutId=null,this.el&&this.el.width()>0&&this.el.height()>0?(this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()):null},Morris.Donut.prototype.setData=function(a){var b;return this.data=a,this.values=function(){var a,c,d,e;for(d=this.data,e=[],a=0,c=d.length;a<c;a++)b=d[a],e.push(parseFloat(b.value));return e}.call(this),this.el&&this.el.width()>0&&this.el.height()>0?this.redraw():null}}),angular.module("Chart").component("scriptrChart",{bindings:{fetchFromDateParam:"@",fetchFromDateValue:"@",fetchToDateParam:"@",fetchToDateValue:"@",fetchDataInterval:"@",fetchPeriod:"@",displayMetricValue:"@",displayMetricParam:"@",defaultMetricValue:"@",defaultMetricParam:"@",availableUnits:"<?",isScaled:"@",onLoad:"&onLoad",resize:"<?",data:"<?",type:"@",xkey:"@",ykeys:"<?",stacked:"<?",labels:"<?",api:"@",transport:"@",msgTag:"@",apiParams:"<?",onFormatData:"&",lineWidth:"@",pointSize:"@",pointFillColors:"@",pointStrokeColors:"@",ymax:"@",ymin:"@",smooth:"@",hideHover:"@",parseTime:"@",units:"@",postUnits:"@",preUnits:"@",xlabels:"@",xlabelAngle:"<?",goals:"@",goalStrokeWidth:"@",goalLineColors:"@",customGoals:"<?",events:"@",eventStrokeWidth:"@",eventLineColors:"@",customEvents:"<?",continuousLine:"@",axes:"@",grid:"@",gridTextColor:"@",gridTextSize:"@",gridTextFamily:"@",gridTextWeight:"@",fillOpacity:"@",resize:"@",behaveLikeLine:"@",labelColor:"@",donutFormatter:"&",backgroundColor:"@",hoverCallback:"&?",dateFormat:"&?",xlabelFormat:"&?",ylabelFormat:"&?",colorsMapping:"<?",showLegend:"@"},templateUrl:"/UIComponents/dashboard/frontend/components/chart/chart.html",controller:["$rootScope","httpClient","wsClient","$scope","$timeout","$interval",function(a,b,c,d,e,f){var g=this;g.showSelectStream=!g.api,this.$onInit=function(){if(this._apiParams=this.apiParams?angular.copy(this.apiParams):[],void 0===this.api&&void 0===this.msgTag&&(this.data&&0==this.data.length||null==this.data)&&(this.noResults=!0),this.areaBehaveLikeLine=!0,this.ymin=this.ymin?this.ymin:"auto 0",this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=a.currentDashboardUnit,this.defaultMetricParam=this.defaultMetricParam?this.defaultMetricParam:"default_metric",this.defaultMetricValue=this.defaultMetricValue?this.defaultMetricValue:null,(!this.isScaled||"false"==this.isScaled)&&this.defaultMetricValue&&this.displayMetricValue&&this.defaultMetricValue!=this.displayMetricValue&&this.availableUnits&&Object.keys(this.availableUnits).length>=2&&this.runMetricTransformation(),this.customGoals=this.customGoals?this.customGoals:[{"goal-line-colors":"#666633",goals:""},{"goal-line-colors":"#999966",goals:""},{"goal-line-colors":"#cc6666",goals:""},{"goal-line-colors":"#663333",goals:""}],this.goalLineColors=[],this.goals=[],this.customGoals&&this.customGoals.length>0)for(x=0;x<this.customGoals.length;x++)this.customGoals[x]["goal-line-colors"]&&this.customGoals[x].goals&&(this.goalLineColors.push(this.customGoals[x]["goal-line-colors"]),this.goals.push(this.customGoals[x].goals));if(this.customEvents=this.customEvents?this.customEvents:[{"event-line-colors":"#666633",events:""},{"event-line-colors":"#999966",events:""},{"event-line-colors":"#cc6666",events:""},{"event-line-colors":"#663333",events:""}],this.eventLineColors=[],this.events=[],this.customEvents&&this.customEvents.length>0)for(x=0;x<this.customEvents.length;x++)this.customEvents[x]["event-line-colors"]&&this.customEvents[x].events&&(this.eventLineColors.push(this.customEvents[x]["event-line-colors"]),this.events.push(this.customEvents[x].events));if(this.colors=this.colors?this.colors:["#aa241d","#edcfce"],this.colorsMapping&&(this.colors=_.pluck(this.colorsMapping,"colors")),this.colorsMapping){this.labels=_.pluck(this.colorsMapping,"labels");for(var b=0;b<this.labels.length;b++){for(var c=[],e=0;e<this.labels.length;e++)e!=b&&this.labels[b]==this.labels[e]&&c.push(e);for(var e=1;e<=c.length;e++)this.labels[c[e-1]]+="("+e+")"}if(this.units=_.pluck(this.colorsMapping,"unit"),this.scaledStreams=_.pluck(this.colorsMapping,"isScaled"),this.displayMetricValue)for(var b=0;b<this.labels.length;b++)this.scaledStreams&&this.scaledStreams[b]?this.labels[b]=this.labels[b]+" ("+this.units[b].scaled+")":this.labels[b]=this.labels[b]+" ("+this.units[b][this.displayMetricValue]+")"}else this.labels=["Serie A","Serie B"];if(this.colorsMapping?this.ykeys=_.pluck(this.colorsMapping,"ykeys"):this.ykeys=this.ykeys?this.ykeys:["a","b"],this.stacked=!!this.stacked&&this.stacked,this.resize=!this.resize||this.resize,this.labelColor=this.labelColor?this.labelColor:"#eee",this.backgroundColor=this.backgroundColor?this.backgroundColor:"#fff",this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null,this.showLegend=null!=this.showLegend&&"true"==this.showLegend,this.showLegend){this.ref=d.$id,this.legendStructure=[];for(var b=0;b<this.ykeys.length;b++){var c={};c.key=this.ykeys[b],this.labels&&this.labels[b]?c.label=this.labels[b]:c.label=this.ykeys[b],this.colors&&this.colors[b]&&(c.color=this.colors[b]),this.legendStructure.push(c)}}this.fetchFromDateParam=this.fetchFromDateParam?this.fetchFromDateParam:"from_date",this.fetchToDateParam=this.fetchToDateParam?this.fetchToDateParam:"to_date",this.fetchToDateValue=this.fetchToDateValue?this.fetchToDateValue:null,this.fetchFromDateValue=this.fetchFromDateValue?this.fetchFromDateValue:null,this.fetchFromDateValue&&(this._apiParams[this.fetchFromDateParam]=this.fetchFromDateValue),this.fetchToDateValue&&(this._apiParams[this.fetchToDateParam]=this.fetchToDateValue),this.fetchPeriod&&"past_day"!=this.fetchPeriod?(this.dateFormat=function(a){return g.timeZone?moment(a).utcOffset(g.timeZone).format("DD MMM"):moment(a).format("DD MMM")},this.xlabelFormat=function(a){return g.timeZone?moment(a).utcOffset(g.timeZone).format("DD MMM"):moment(a).format("DD MMM")}):(this.dateFormat=function(a,b){return g.timeZone?moment(a).utcOffset(g.timeZone).format("HH:mm"):moment(a).format("HH:mm")},this.xlabelFormat=function(a,b){return g.timeZone?moment(a).utcOffset(g.timeZone).format("HH:mm"):moment(a).format("HH:mm")}),this.delta=!1},this.hoverCallback=function(a,b,c,e){if(g.datas){if(e.date){var f="";f=g.fetchPeriod&&"past_day"!=g.fetchPeriod?g.timeZone?moment(e.date).utcOffset(g.timeZone).format("DD MMM"):moment(e.date).format("DD MMM"):g.timeZone?moment(e.date).utcOffset(g.timeZone).format("DD MMM HH:mm"):moment(e.date).format("DD MMM HH:mm"),d.$ctrl.legendDate=f}_.mapObject(e,function(a,b){var e=_.findIndex(d.$ctrl.legendStructure,{key:"donut"!=g.type?b:a});if(-1!=e){d.$ctrl.legendStructure[e].value="donut"==g.type?c:a;var h=document.getElementById("value_"+e+"_"+g.ref),i=document.getElementById("date_"+g.ref);h&&(h.innerHTML="donut"==g.type?c:a),"donut"!=g.type&&i&&(i.innerHTML=f)}})}},this.runMetricTransformation=function(){if("si"!=this.defaultMetricValue)var a=this.availableUnits.us,b=this.availableUnits.si;else var a=this.availableUnits.si,b=this.availableUnits.us;if(this.customGoals)for(var c=0;c<this.customGoals.length;c++){var d=this.customGoals[c].goals;if(null!=d){var e=getConversionFunction(a,b);e&&(this.customGoals[c].goals=e(d))}}},this.$postLink=function(){h(this.transport),this.data&&!this.api?(g.timeout=!1,e(function(){g.consumeData(g.data)},2e3)):g.timeout=!0,d.$watch(function(a){if(a.$ctrl.data&&1==g.timeout)return a.$ctrl.data},function(a){a&&(g.datas=a,g.noResults=!1)})},this.$onDestroy=function(){console.log("destory chart",g.msgTag,d.$id),g.msgTag&&c.unsubscribe(g.msgTag,null,d.$id),g.refreshTimer&&f.cancel(g.refreshTimer)};var h=function(a){"wss"==a?c.onReady.then(function(){g.msgTag&&c.subscribe(g.msgTag,g.consumeData.bind(g),d.$id),g.api&&c.call(g.api,g._apiParams,g.msgTag).then(function(b,c){g.showSelectStream=!1,g.fetchDataInterval&&!g.refreshTimer&&(g.refreshTimer=f(function(){g.fetchPeriod&&"past_day"!=g.fetchPeriod?("past_week"==g.fetchPeriod&&(g._apiParams[g.fetchFromDateParam]=moment().add(-7,"days").valueOf()),"past_month"==g.fetchPeriod&&(g._apiParams[g.fetchFromDateParam]=moment().add(-30,"days").valueOf())):"donut"==g.type||"bar"==g.type?g._apiParams[g.fetchFromDateParam]=moment().add(-1,"days").startOf("hour").valueOf():(g.delta=!0,g.datas&&g.datas.length>0?g._apiParams[g.fetchFromDateParam]=g.datas[g.datas.length-1].date:g._apiParams[g.fetchFromDateParam]=moment().add(-1,"days").startOf("hour").valueOf()),h.bind(g)(a)},1e3*g.fetchDataInterval)),g.consumeData(b)},function(a){console.log("reject published promise",a),g.consumeData()})}):"https"==a&&g.api&&b.get(g.api,g._apiParams).then(function(a,b){g.consumeData(a)},function(a){console.log("reject published promise",a),g.consumeData()})};this.consumeData=function(a,b){if(a.timeZone&&(g.timeZone=a.timeZone,a=a.data),g.timeout=!0,"function"==typeof g.onFormatData()&&(a=g.onFormatData()(a)),a&&a.length>0&&"object"==typeof a)if(this.fetchDataInterval&&this.fetchDataInterval>0&&this.datas&&this.delta)this.datas=this.datas.concat(a);else{if("bar"==g.type){for(;a.length>24&&"past_day"==g.fetchPeriod;)a.shift();for(;a.length>7&&"past_week"==g.fetchPeriod;)a.shift();for(;a.length>31&&"past_month"==g.fetchPeriod;)a.shift()}this.datas=a,this.noResults=!1}else this.api&&0==a.length&&(!this.datas||this.datas&&0==this.datas.length||_.isEqual(this.datas,this.data))&&(this.datas=[],this.noResults=!0)}}]}),angular.module("Odometer",["ui.odometer"]),angular.module("Odometer").component("scriptrOdometer",{bindings:{availableUnits:"<?",isScaled:"@",displayMetricValue:"@",displayMetricParam:"@",onLoad:"&onLoad",api:"@",enableResize:"<?",theme:"@",duration:"@",animation:"@",transport:"@",odometerValue:"<?",data:"<?",msgTag:"@",apiParams:"<?",size:"<?",onFormatData:"&",fetchDataInterval:"@"},templateUrl:"/UIComponents/dashboard/frontend/components/odometer/odometer.html",controller:["$scope","httpClient","wsClient","$element","$window","$timeout","$interval",function(a,b,c,d,e,f,g){var h=this;h.noResults=!1,h.showSelectStream=!h.api,this.$onInit=function(){this._apiParams=this.apiParams?angular.copy(this.apiParams):[],this.config={duration:this.duration?this.duration:1e3,animation:this.animation?this.animation:"count",theme:this.theme?this.theme:"car"},this.odometerOptions=this.config,this.odometerValue=this.odometerValue?this.odometerValue:this.data?this.data:0,this.size=this.size?this.size:1,this.enableResize=void 0===this.enableResize||this.enableResize,this.style={},this.style["font-size"]=this.size+"em",angular.element(e).on("resize",function(){return null!=h.timeoutId&&f.cancel(h.timeoutId),h.timeoutId=f(h.resize,100)}),this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null,this.fetchDataInterval=this.fetchDataInterval?parseInt(this.fetchDataInterval):null,this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=this.displayMetricValue?this.displayMetricValue:null,!this.displayMetricValue||this.isScaled&&"false"!=this.isScaled?"true"==this.isScaled&&(this.unit=this.availableUnits.scaled):(this._apiParams[this.displayMetricParam]=this.displayMetricValue,this.availableUnits&&(this.unit=this.availableUnits[this.displayMetricValue])),i(this.transport)},h.resize=function(){h.timeoutId=null,h.enableResize&&(h.style["margin-top"]=h.noResults?0:d.parent().outerHeight(!0)/2-$(d.children()[0]).innerHeight()/2)},this.$postLink=function(){f(h.resize,100),null!=h.timeoutId&&f.cancel(h.timeoutId),h.timeoutId=f(h.resize,100),h.refreshTimer&&f.cancel(h.refreshTimer)},this.$onDestroy=function(){angular.element(e).off("resize"),h.msgTag&&c.unsubscribe(h.msgTag,null,a.$id),h.refreshTimer&&g.cancel(h.refreshTimer),console.log("destory odometer")};var i=function(d){"wss"==d?c.onReady.then(function(){h.msgTag&&c.subscribe(h.msgTag,h.consumeData.bind(h),a.$id),h.api&&c.call(h.api,h._apiParams,h.msgTag).then(function(a,b){h.showSelectStream=!1,h.fetchDataInterval&&!h.refreshTimer&&(h.refreshTimer=g(function(){i.bind(h)(d)},1e3*h.fetchDataInterval)),h.consumeData(a)},function(a){console.log("reject published promise",a),h.consumeData()})}):"https"==d&&h.api&&b.get(h.api,h._apiParams).then(function(a,b){h.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof h.onFormatData()&&(a=h.onFormatData()(a)),null!=a?(this.noResults=!1,this.odometerValue=a):this.noResults=!0,h.style["margin-top"]=h.noResults?0:d.parent().outerHeight(!0)/2-$(d.children()[0]).innerHeight()/2}}]}),angular.module("Speedometer",["meterGauge"]),angular.module("Speedometer").component("scriptrSpeedometer",{bindings:{displayMetricValue:"@",displayMetricParam:"@",onLoad:"&onLoad",gaugeRadius:"<?",theme:"@",minValue:"<?",maxValue:"<?",needleVal:"<?",data:"<?",tickSpaceMinVal:"<?",tickSpaceMajVal:"<?",gaugeUnits:"@",tickColMaj:"@",tickColMin:"@",outerEdgeCol:"@",pivotCol:"@",innerCol:"@",unitsLabelCol:"@",tickLabelCol:"@",needleCol:"@",defaultFonts:"@",api:"@",transport:"@",msgTag:"@",apiParams:"<?",onFormatData:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/speedometer/speedometer.html",controller:["httpClient","wsClient","$element","$window","$scope","$compile","$timeout",function(a,b,c,d,e,f,g){var h=this;this.$onInit=function(){this.speedoConfig={},"speed"==this.theme||void 0===this.theme?(this.speedoConfig.gaugeRadius=this.gaugeRadius?this.gaugeRadius:150,this.speedoConfig.minVal=this.minValue?this.minValue:0,this.speedoConfig.maxVal=this.maxValue?this.maxValue:220,this.speedoConfig.needleVal=this.needleVal?Math.round(this.needleVal):this.data?Math.round(this.data):0,this.speedoConfig.tickSpaceMinVal=this.tickSpaceMinVal?this.tickSpaceMinVal:10,this.speedoConfig.tickSpaceMajVal=this.tickSpaceMajVal?this.tickSpaceMajVal:20,this.speedoConfig.gaugeUnits=this.gaugeUnits?this.gaugeUnits:"kmh",this.speedoConfig.tickColMaj=this.tickColMaj?this.tickColMaj:"#C64DFF",this.speedoConfig.tickColMin=this.tickColMin?this.tickColMin:"#999999",this.speedoConfig.outerEdgeCol=this.outerEdgeCol?this.outerEdgeCol:"#f4f4f4",this.speedoConfig.pivotCol=this.pivotCol?this.pivotCol:"#434a54",this.speedoConfig.innerCol=this.innerCol?this.innerCol:"#ffffff",this.speedoConfig.unitsLabelCol=this.unitsLabelCol?this.unitsLabelCol:"#C64DFF",this.speedoConfig.tickLabelCol=this.tickLabelCol?this.tickLabelCol:"#656D78",this.speedoConfig.needleCol=this.needleCol?this.needleCol:"#C64DFF",this.speedoConfig.defaultFonts=this.defaultFonts?this.defaultFonts:""):"rpm"==this.theme&&(this.speedoConfig.gaugeRadius=this.gaugeRadius?this.gaugeRadius:120,this.speedoConfig.minVal=this.minValue?this.minValue:0,this.speedoConfig.maxVal=this.maxValue?this.maxValue:1e3,this.speedoConfig.needleVal=this.needleVal?Math.round(this.needleVal):this.data?Math.round(this.data):0,this.speedoConfig.tickSpaceMinVal=this.tickSpaceMinVal?this.tickSpaceMinVal:10,this.speedoConfig.tickSpaceMajVal=this.tickSpaceMajVal?this.tickSpaceMajVal:100,this.speedoConfig.gaugeUnits=this.gaugeUnits?this.gaugeUnits:"kmh",this.speedoConfig.tickColMaj=this.tickColMaj?this.tickColMaj:"#0194D9",this.speedoConfig.tickColMin=this.tickColMin?this.tickColMin:"#999999",this.speedoConfig.outerEdgeCol=this.outerEdgeCol?this.outerEdgeCol:"#ffffff",this.speedoConfig.pivotCol=this.pivotCol?this.pivotCol:"#434A54",this.speedoConfig.innerCol=this.innerCol?this.innerCol:"#ffffff",this.speedoConfig.unitsLabelCol=this.unitsLabelCol?this.unitsLabelCol:"#0194d9",this.speedoConfig.tickLabelCol=this.tickLabelCol?this.tickLabelCol:"#656D78",this.speedoConfig.needleCol=this.needleCol?this.needleCol:"#0194d9",this.speedoConfig.defaultFonts=this.defaultFonts?this.defaultFonts:""),this.speedoConfig.speedoTag=e.$id,this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=this.displayMetricValue?this.displayMetricValue:null,this.displayMetricValue&&(this.apiParams[this.displayMetricParam]=this.displayMetricValue),this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null},this.calculateGaugeRadius=function(){h.timeoutId=null;var a=c.parent().height(),b=c.parent().width();h.speedoConfig.gaugeRadius=0==a?b/2:b>=a?a/2:b/2},this.$postLink=function(){g(function(){console.log("Calc"),h.gaugeRadius||(h.calculateGaugeRadius(),console.log("Gauge Size",h.speedoConfig.gaugeRadius),angular.element(d).on("resize",function(){null!=h.timeoutId&&g.cancel(h.timeoutId),h.timeoutId=g(h.calculateGaugeRadius,100)})),h.renderGauge(),e.$watch(function(a){return a.$ctrl.needleVal&&(h.speedoConfig.needleVal=a.$ctrl.needleVal),JSON.stringify(h.speedoConfig)},function(a){h.renderGauge()}),i(h.transport)},500)},this.$onDestroy=function(){this.gaugeRadius||angular.element(d).off("resize"),h.msgTag&&b.unsubscribe(h.msgTag,null,e.$id),console.log("destory speedo")},this.renderGauge=function(){angular.element(c).html(""),this.speedo=angular.element(document.createElement("meter-gauge")),this.speedo.attr("gaugeconfig",JSON.stringify(this.speedoConfig));var a=f(this.speedo)(e);angular.element(c).append(a)};var i=function(c){console.log("Gauge Size",h.speedoConfig.gaugeRadius),"wss"==c?b.onReady.then(function(){h.msgTag&&b.subscribe(h.msgTag,h.consumeData.bind(h),e.$id),h.api&&b.call(h.api,h.apiParams,h.msgTag).then(function(a,b){h.consumeData(a)},function(a){console.log("reject published promise",a),h.consumeData()})}):"https"==c&&h.api&&a.get(h.api,h.apiParams).then(function(a,b){h.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof h.onFormatData()&&(a=h.onFormatData()(a)),a=parseInt(a),a="number"==typeof a&&"NaN"!=a.toString()?a:0,this.speedoConfig.needleVal=Math.round(a)}}]}),angular.module("SearchBox",["angularBootstrapNavTree"]).component("scriptrSearchbox",{bindings:{treeControl:"<?",calculatedChannels:"<?",treeData:"<?",searchText:"@",iconLeaf:"@",paramName:"@",iconExpand:"@",iconCollapse:"@",onSelect:"&onSelect",expandLevel:"@",initialSelection:"@",apiParams:"<?",loadTree:"<?",treeSearchCriteria:"@",transport:"@",api:"@",onFormatData:"&",childrenTag:"@",labelTag:"@",widgetsConfig:"<?"},templateUrl:"/UIComponents/dashboard/frontend/components/searchBox/searchBox.html",controller:["wsClient","$uibModal","httpClient","$timeout","$scope","scriptrService",function(a,b,c,d,e,f){var g=this;g.cdnImagesPath=cdnImagesPath,this.iconExpand=this.iconExpand?this.iconExpand:null,this.$onInit=function(){this.iconLeaf=this.iconLeaf&&"$ctrl.iconLeaf"!=this.iconLeaf?this.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file",this.iconExpand=this.iconExpand&&"$ctrl.iconExpand"!=this.iconExpand?this.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus",this.iconCollapse=this.iconCollapse&&"$ctrl.iconCollapse"!=this.iconCollapse?this.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus",this.paramName=this.paramName?this.paramName:"criteria",this.searchText=this.searchText?this.searchText:"Type to search",this.treeData=this.treeData?this.treeData:[],this.iconLeaf=this.iconLeaf?this.iconLeaf:null,this.transport=this.transport?this.transport:"wss",e.$on("reload-dataStreams",function(){g.initDataService()}),this.loadTree&&(this.searching=!0,this.loadCalculatedChannelFormulasMapping(),this.consolidateCalculatedChannels(),this.loadCalculatedChannels(),g.initDataService(this.transport))},this.loadCalculatedChannelFormulasMapping=function(){f.getCalculatedChannelFormulaMapping({}).then(function(a,b){if(a){var c=a.formulasTitleMap;window.localStorage.calculatedChannelformulaMapping=JSON.stringify(c);var d=a.calculatedChannelFieldConfig;window.localStorage.calculatedChannelFieldConfig=JSON.stringify(d)}},function(a){})},this.deleteCalculatedChannel=function(a,c){b.open({animation:!0,component:"confirmationModal",backdrop:"static",size:"md",scope:e,resolve:{data:function(){return{title:"Delete this Calculated Channel?",body:'Are you sure you want to delete this Calculated Channel "'+c+'"?',btnCancelTitle:"Cancel",btnSubmitTitle:"Delete"}}}}).result.then(function(b){b&&f.deleteCalculatedChannel({calculatedChannelKey:a,calculatedChannelName:c}).then(function(a,b){"success"==a.status?(g.showAlert("success","The Calculated Channel was deleted successfully."),g.calculatedChannels=a.documents,e.$emit("render-dataStreams")):g.showAlert("danger","The Calculated Channel could not be deleted. Please try again")},function(a){g.loading=!1})},function(){})},this.editCalculatedChannel=function(a){f.getCalculatedChannelDocument({calculatedChannelKey:a}).then(function(a,c){if(a){var d={},f=a.documents[0];d.key=f.key,d.calculatedChannelName=f.calculatedChannelName,d.calculatedChannelFormula="'"+f.selectedFormula+"'";var h=JSON.parse(f.params);for(var i in h)d[i]=h[i];b.open({animation:!0,component:"calculatedChannel",backdrop:"static",size:"lg",scope:e,resolve:{model:function(){return d}}}).result.then(function(a){g.loadCalculatedChannels(),
e.$emit("render-dataStreams")},function(){})}},function(a){g.loading=!1})},this.createCalculatedChannel=function(){var a=this;b.open({animation:!0,component:"calculatedChannel",backdrop:"static",size:"lg",scope:e}).result.then(function(b){a.loadCalculatedChannels(),e.$emit("render-dataStreams")},function(){})},this.onFilterChanged=function(){if(null!=this.searchValue&&""!=this.searchValue&&this.originalData){this.searching=!0;for(var a=angular.copy(this.originalData),b=[],c=0;c<a.length;c++){var d=a[c],e=d.sensors;if(-1==d.label.toLowerCase().indexOf(this.searchValue.toLowerCase())){for(var f=!1,g=[],h=0;h<e.length;h++){-1==e[h].display.toLowerCase().indexOf(this.searchValue.toLowerCase())?g.push(h):f=!0}for(var i=g.length-1,h=i;h>=0;h--)e.splice(g[h],1);f||b.push(c)}}for(var i=b.length-1,c=i;c>=0;c--)a.splice(b[c],1)}else a=angular.copy(this.originalData);this.consumeData(a,null,!0)},this.loadCalculatedChannels=function(){f.loadCalculatedChannels({}).then(function(a,b){a&&(g.calculatedChannels=a,0==a.length&&(g.noCalculatedChannels=!0))},function(a){g.loading=!1})},this.consolidateCalculatedChannels=function(){f.consolidateCalculatedChannels({}).then(function(a,b){setTimeout(function(){g.loadCalculatedChannels()},3e4)},function(a){})},g.initDataService=function(){var b={};if(g.apiParams)for(var d in g.apiParams)b[d]=g.apiParams[d];"wss"==g.transport?a.onReady.then(function(){a.subscribe(g.msgTag,g.consumeData.bind(g)),g.api&&a.call(g.api,b,g.msgTag).then(function(a,b){g.consumeData(a)},function(a){g.consumeData()})}):"https"==g.transport&&g.api&&c.get(g.api,b).then(function(a,b){},function(a){g.consumeData()})},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){this.closeAlert(),this.message={type:a,content:b},this.show=!0},this.consumeData=function(a,b,c){if("function"==typeof g.onFormatData()&&(a=g.onFormatData()(a)),!c&&a&&"string"!=typeof a){window.localStorage.setItem("dataStream",JSON.stringify(a.dataStream)),window.localStorage.setItem("dataMapping",JSON.stringify(a.dataMapping)),a=a.dataStream;for(var d=g.widgetsConfig,e={},f=0;f<d.length;f++)e[d[f].name]=d[f];for(var h=0;h<a.length;h++)if(a[h].sensors)for(var i=0;i<a[h].sensors.length;i++){var j=a[h].sensors[i].sectionData,k=angular.copy(e[j]),l=a[h].sensors[i].measurement_type;l=l.split(" ").join("_"),k.selectedStreamValue=a[h].sensors[i].selectedStreamValue,k.selectedStreamUnits=a[h].sensors[i].selectedStreamUnits,a[h].sensors[i].fieldName&&(k.selectedStreamFieldName=a[h].sensors[i].fieldName),k.selectedStreamLabel=a[h].sensors[i].label,k.selectedStreamDisplay=a[h].sensors[i].display,k.isScaled=a[h].sensors[i].is_scaled,a[h].sensors[i].sectionData=JSON.stringify(k),e[j].imgSrc&&(a[h].sensors[i].imgSrc=g.cdnImagesPath+e[j].imgSrc)}}"object"==typeof a&&a.length>0?(g.treeData=a,g.noResults=!1):(g.treeData=[],g.noResults=!0),g.originalData||(g.originalData=angular.copy(g.treeData)),g.searching=!1}}]}),angular.module("Gauge",["frapontillo.gage"]),angular.module("Gauge").component("scriptrGauge",{bindings:{displayMetricValue:"@",displayMetricParam:"@",defaultMetricValue:"@",defaultMetricParam:"@",availableUnits:"<?",isScaled:"@",onLoad:"&onLoad",api:"@",transport:"@",msgTag:"@",apiParams:"<?",valueFontColor:"@",min:"@",max:"@",hideMinMax:"@",hideValue:"@",showInnerShadow:"<?",gaugeColor:"@",gaugeValue:"<?",data:"<?",customSectors:"<?",shadowSize:"@",shadowOpacity:"@",label:"@",labelFontColor:"@",startAnimationType:"@",refreshAnimationType:"@",valueFontFamily:"@",relativeGaugeSize:"@",valueMinFontSize:"@",hideMinMax:"@",labelMinFontSize:"@",minLabelMinFontSize:"@",maxLabelMinFontSize:"@",gaugeWidthScale:"@",shadowVerticalOffset:"@",levelColors:"@",noGradient:"@",startAnimationTime:"@",refreshAnimationTime:"@",donut:"@",donutStartAngle:"@",reverse:"@",decimals:"@",symbol:"@",formatNumber:"@",humanFriendly:"@",humanFriendlyDecimal:"@",textRenderer:"&",onAnimationEnd:"&",pointer:"<?",onFormatData:"&",heightUnit:"@",counter:"@",width:"@",height:"@",fetchDataInterval:"@"},templateUrl:"/UIComponents/dashboard/frontend/components/gauge/gauge.html",controller:["$rootScope","$scope","httpClient","wsClient","$timeout","$interval",function(a,b,c,d,e,f){var g=this;g.noResults=!1,g.showSelectStream=!g.api,this.$onInit=function(){this._apiParams=this.apiParams?angular.copy(this.apiParams):[],this.gaugeValue?this.consumeData(this.gaugeValue):this.data&&this.consumeData(this.data),this.heightUnit=this.heightUnit?this.heightUnit:"px",this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=a.currentDashboardUnit,this.defaultMetricParam=this.defaultMetricParam?this.defaultMetricParam:"default_metric",this.defaultMetricValue=this.defaultMetricValue?this.defaultMetricValue:null,this.customSectors=this.customSectors?this.customSectors:{percents:!0,ranges:[{color:"#A3CD3B",lo:0,hi:25},{color:"#FF4A43",lo:25,hi:100}]},this.min=this.min?Number.isInteger(parseFloat(this.min))?this.min:parseFloat(this.min).toFixed(2):0,this.gaugeMax=this.max?Number.isInteger(parseFloat(this.max))?this.max:parseFloat(this.max).toFixed(2):0,(!this.isScaled||"false"==this.isScaled)&&this.defaultMetricValue&&this.displayMetricValue&&this.defaultMetricValue!=this.displayMetricValue&&this.availableUnits&&Object.keys(this.availableUnits).length>=2&&this.runMetricTransformation(),this.heightUnit=this.heightUnit?this.heightUnit:"px",this.valueFontColor=this.valueFontColor?this.valueFontColor:"#999",this.hideMinMax=!!this.hideMinMax&&this.hideMinMax,this.hideValue=!!this.hideValue&&this.hideValue,this.gaugeColor=this.gaugeColor?this.gaugeColor:"#e9e9e9",this.shadowSize=this.shadowSize?this.shadowSize:0,this.label=this.label?this.label:"",this.labelFontColor=this.labelFontColor?this.labelFontColor:"#666",this.startAnimationType=this.startAnimationType?this.startAnimationType:"linear",this.refreshAnimationType=this.refreshAnimationType?this.refreshAnimationType:"linear",this.counter=!this.counter||this.counter,this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null,this.fetchDataInterval=this.fetchDataInterval?parseInt(this.fetchDataInterval):null,this.isScaled&&"false"!=this.isScaled?this.symbol=this.availableUnits?this.availableUnits.scaled:this.symbol?this.symbol:"":this.symbol=this.availableUnits?this.availableUnits[this.displayMetricValue]:this.symbol?this.symbol:"",h(this.transport)},this.runMetricTransformation=function(){if("si"!=this.defaultMetricValue)var a=this.availableUnits.us,b=this.availableUnits.si;else var a=this.availableUnits.si,b=this.availableUnits.us;var c=getConversionFunction(a,b);if(this.customSectors)for(var d=0;d<this.customSectors.ranges.length;d++){var e=this.customSectors.ranges[d].lo,f=this.customSectors.ranges[d].hi;"function"==typeof c&&(this.customSectors.ranges[d].lo=c(e),this.customSectors.ranges[d].hi=c(f))}if("function"==typeof c){var g=c(this.min);this.min=Number.isInteger(parseFloat(g))?g:parseFloat(g).toFixed(2);var h=c(this.max);this.gaugeMax=Number.isInteger(parseFloat(h))?h:parseFloat(h).toFixed(2)}},this.$onDestroy=function(){console.log("destory gauge"),g.msgTag&&d.unsubscribe(g.msgTag,null,b.$id),g.refreshTimer&&f.cancel(g.refreshTimer)};var h=function(a){"wss"==a?d.onReady.then(function(){g.msgTag&&d.subscribe(g.msgTag,g.consumeData.bind(g),b.$id),g.api&&d.call(g.api,g._apiParams,g.msgTag).then(function(b,c){g.showSelectStream=!1,g.fetchDataInterval&&!g.refreshTimer&&(g.refreshTimer=f(function(){h.bind(g)(a)},1e3*g.fetchDataInterval)),g.consumeData(b)},function(a){console.log("reject published promise",a),g.consumeData()})}):"https"==a&&g.api&&c.get(g.api,g._apiParams).then(function(a,b){g.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof this.onFormatData()&&(a=this.onFormatData()(a)),a=parseFloat(a),"number"==typeof a&&"NaN"!=a.toString()?(this.noResults=!1,a=a,this.gaugeValue=a):this.noResults=!0}}]}),angular.module("angular-scriptrui",[]).directive("ngDisplayBox",function(){return{restrict:"E",require:"ngModel",scope:{msg:"=ngModel",type:"@"},template:'<div class="alert alert-{{type}}" role="alert"><span ng-bind="msg"></span></div>',replace:!0}}),angular.module("Message",["angular-scriptrui"]),angular.module("Message").component("scriptrDisplaybox",{bindings:{data:"@",type:"@",api:"@",transport:"@",msgTag:"@",apiParams:"<?",onFormatData:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/message/message.html",controller:["httpClient","wsClient",function(a,b){var c=this;this.$onInit=function(){this.data=this.data?this.data:"Waiting for info...",this.type=this.type?this.type:"info"},this.$postLink=function(){d(this.transport)};var d=function(d){"wss"==d?b.onReady.then(function(){b.subscribe(c.msgTag,c.consumeData.bind(c)),c.api&&b.call(c.api,c.apiParams,c.msgTag).then(function(a,b){c.consumeData(a)},function(a){console.log("reject published promise",a)})}):"https"==d&&c.api&&a.get(c.api,c.apiParams).then(function(a,b){c.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof c.onFormatData()&&(a=c.onFormatData()(a)),"object"==typeof a&&(a&&a.data&&"string"==typeof a.data&&(this.data=a.data),a&&a.type&&(this.type=a.type)),"string"==typeof a&&(this.data=a)}}]}),angular.module("Display",[]),angular.module("Display").component("scriptrDisplaycount",{bindings:{fetchPeriod:"@",fetchDataInterval:"@",widgetLayout:"@",data:"@",message:"@",borderSize:"@",borderColor:"@",numberFontFamily:"@",numberFontSize:"@",numberCellSize:"@",numberFontWeight:"@",numberTextColor:"@",numberBackgroundColor:"@",numberTextAlignment:"@",messageFontFamily:"@",messageFontSize:"@",messageFontWeight:"@",messageTextColor:"@",messageBackgroundColor:"@",messageTextAlignment:"@",api:"@",enableResize:"<?",transport:"@",msgTag:"@",apiParams:"<?",onFormatData:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/displayCount/displayCount.html",controller:["$scope","httpClient","wsClient","$element","$window","$timeout","$interval",function(a,b,c,d,e,f,g){var h=this;h.isLoading=!0,this.$onInit=function(){this.fetchPeriod=a.$root.period?a.$root.period:"past_day",this._apiParams=this.apiParams?angular.copy(this.apiParams):[],this.widgetLayout="vertical"==this.widgetLayout?this.widgetLayout:"horizontal",this.data=this.data?isNaN(this.data)?"0":this.data:"0",this.message=this.message?this.message:"Items",this.borderSize=this.borderSize?this.borderSize:"1",this.numberCellSize=this.numberCellSize?this.numberCellSize:"",this.borderColor=this.borderColor?this.borderColor:"#d7d7d7",this.numberFontFamily=this.numberFontFamily?this.numberFontFamily:"Arial",this.numberFontSize=this.numberFontSize?this.numberFontSize:"42",this.numberFontWeight=this.numberFontWeight?this.numberFontWeight:"600",this.numberTextColor=this.numberTextColor?this.numberTextColor:"#ffffff",this.numberTextAlignment=this.numberTextAlignment?this.numberTextAlignment:"center",this.numberBackgroundColor=this.numberBackgroundColor?this.numberBackgroundColor:"#005588",this.messageFontFamily=this.messageFontFamily?this.messageFontFamily:"Arial",this.messageFontSize=this.messageFontSize?this.messageFontSize:"18",this.messageFontWeight=this.messageFontWeight?this.messageFontWeight:"600",this.messageTextColor=this.messageTextColor?this.messageTextColor:"#686868",this.messageBackgroundColor=this.messageBackgroundColor?this.messageBackgroundColor:"white",this.messageTextAlignment=this.messageTextAlignment?this.messageTextAlignment:"center",this.enableResize=void 0===this.enableResize||this.enableResize,angular.element(e).on("resize",function(){return null!=h.timeoutId&&f.cancel(h.timeoutId),h.timeoutId=f(h.resize,100)}),this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null,this.style={}},this.$postLink=function(){f(h.resize,100),null!=h.timeoutId&&f.cancel(h.timeoutId),h.timeoutId=f(h.resize,100),i(this.transport)},this.$onDestroy=function(){h.msgTag&&c.unsubscribe(h.msgTag,null,a.$id),h.refreshTimer&&g.cancel(h.refreshTimer)};var i=function(a){"wss"==a?c.onReady.then(function(){c.subscribe(h.msgTag,h.consumeData.bind(h)),h.api&&h._apiParams?c.call(h.api,h._apiParams,h.msgTag).then(function(b,c){h.isLoading=!1,h.fetchDataInterval&&!h.refreshTimer&&(h.refreshTimer=g(function(){i.bind(h)(a)},1e3*h.fetchDataInterval)),h.consumeData(b)},function(a){console.log("reject published promise",a)}):h.consumeData(data)}):"https"==a&&h.api&&b.get(h.api,h._apiParams).then(function(a,b){h.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof h.onFormatData()&&(a=h.onFormatData()(a)),this.data=a,"object"==typeof a&&a&&a.data&&"string"==typeof a.data&&(this.data=a.data),"string"==typeof a&&(this.data=a)}}]}),angular.module("Thermometer",["angularThermometer"]),angular.module("Thermometer").component("scriptrThermometer",{bindings:{displayMetricValue:"@",displayMetricParam:"@",defaultMetricValue:"@",defaultMetricParam:"@",availableUnits:"<?",isScaled:"@",onLoad:"&onLoad",api:"@",value:"<?",data:"<?",step:"<?",customSectors:"<?",outOfRangeColor:"@",ticks:"<?",percent:"@",unit:"@",height:"@",transport:"@",msgTag:"@",apiParams:"<?",onFormatData:"&",fetchDataInterval:"@"},templateUrl:"/UIComponents/dashboard/frontend/components/thermometer/thermometer.html",controller:["$rootScope","$scope","$window","$element","$timeout","httpClient","wsClient","_","$interval",function(a,b,c,d,e,f,g,h,i){var j=this;j.showSelectStream=!j.api,this.$onInit=function(){this._apiParams=this.apiParams?angular.copy(this.apiParams):[],this.fetchDataInterval=this.fetchDataInterval?parseInt(this.fetchDataInterval):null,this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=a.currentDashboardUnit,this.defaultMetricParam=this.defaultMetricParam?this.defaultMetricParam:"default_metric",this.defaultMetricValue=this.defaultMetricValue?this.defaultMetricValue:null,this.customSectors=this.customSectors&&this.customSectors.length>0?this.customSectors:[{color:"#005588",lo:0,hi:30},{color:"#aa241d",lo:30,hi:60},{color:"#ffa500",lo:60,hi:90}],this.customSectors&&(this.customSectors=h.reject(this.customSectors,h.isEmpty)),(!this.isScaled||"false"==this.isScaled)&&this.defaultMetricValue&&this.displayMetricValue&&this.defaultMetricValue!=this.displayMetricValue&&this.availableUnits&&Object.keys(this.availableUnits).length>=2&&this.runMetricTransformation(),this.outOfRangeColor=this.outOfRangeColor?this.outOfRangeColor:"#5fc100",this.value=this.value?this.value>100?100:this.value:this.data?this.data:0,this.isScaled&&"false"!=this.isScaled?this.thermoUnit=this.availableUnits?this.availableUnits.scaled:this.unit?this.unit:"":this.thermoUnit=this.availableUnits?this.availableUnits[this.displayMetricValue]:this.unit?this.unit:"",this.height=this.height?this.height:"100",this.mercuryColor=this.evaluateColor(this.value),this.step=this.step?this.step:"30";var b=this.getLowestTick(),d=this.getHighestTick(),f=parseInt(b);for(this.sectors=[],this.sectors.push(f);f<d;)f+=parseInt(this.step),this.sectors.push(f);this.sectors=this.sectors?this.sectors:[0,30,60,90],this.mercuryMax=h.max(this.sectors),this.minSectorValue=h.min(this.sectors),this.ticks=[];for(var g=0;g<this.sectors.length;g++){var i={};i.tick=this.sectors[g],i.percent=(this.sectors[g]-this.minSectorValue)*this.height/(this.mercuryMax-this.minSectorValue),this.ticks.push(i)}this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null,this.style={},angular.element(c).on("resize",function(){return null!=j.timeoutId&&e.cancel(j.timeoutId),j.timeoutId=e(j.resize,500)}),k(this.transport)},this.runMetricTransformation=function(){if("si"!=this.defaultMetricValue)var a=this.availableUnits.us,b=this.availableUnits.si;else var a=this.availableUnits.si,b=this.availableUnits.us;if(this.customSectors)for(var c=0;c<this.customSectors.length;c++){var d=this.customSectors[c].lo,e=this.customSectors[c].hi;this.customSectors[c].lo=getConversionFunction(a,b)(d),this.customSectors[c].hi=getConversionFunction(a,b)(e)}},j.resize=function(){j.timeoutId=null,j.style["margin-top"]=j.noResults?0:d.parent().outerHeight(!0)/2-$(d.find(".tg-thermometer")).innerHeight()/2,j.style["margin-left"]=j.noResults?0:d.parent().outerWidth(!0)/2-50},this.$postLink=function(){e(j.resize,100),null!=j.timeoutId&&e.cancel(j.timeoutId),j.timeoutId=e(j.resize,100),b.$watch(function(a){return a.$ctrl.value},function(a){!isNaN(parseFloat(a))&&isFinite(a)&&(a=a>b.$ctrl.mercuryMax?b.$ctrl.mercuryMax:a,j.percent=parseInt((a-b.$ctrl.minSectorValue)*b.$ctrl.height/(b.$ctrl.mercuryMax-b.$ctrl.minSectorValue)))})},this.$onDestroy=function(){console.log("destory Thermometer"),j.msgTag&&g.unsubscribe(j.msgTag,null,b.$id),j.refreshTimer&&i.cancel(j.refreshTimer)};var k=function(a){"wss"==a?g.onReady.then(function(){j.msgTag&&g.subscribe(j.msgTag,j.consumeData.bind(j),b.$id),j.api&&g.call(j.api,j._apiParams,j.msgTag).then(function(b,c){j.showSelectStream=!1,j.fetchDataInterval&&!j.refreshTimer&&(j.refreshTimer=i(function(){k.bind(j)(a)},1e3*j.fetchDataInterval)),j.consumeData(b)},function(a){console.log("reject published promise",a),j.consumeData()})}):"https"==a&&j.api&&f.get(j.api,j._apiParams).then(function(a,b){j.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof this.onFormatData()&&(a=this.onFormatData()(a)),null!=a?(this.noResults=!1,this.value=parseFloat(a),this.mercuryColor=this.evaluateColor(a)):this.noResults=!0,j.style["margin-top"]=j.noResults?0:d.parent().outerHeight(!0)/2-$(d.find(".tg-thermometer")).innerHeight()/2,j.style["margin-left"]=j.noResults?0:d.parent().outerWidth(!0)/2-50},this.evaluateColor=function(a){var b=j.outOfRangeColor;return h.some(j.customSectors,function(c){if(c.lo<=a&&a<=c.hi)return b=c.color,!0}),b},this.getLowestTick=function(){return h.min(h.pluck(this.customSectors,"lo"))},this.getHighestTick=function(){return h.max(h.pluck(this.customSectors,"hi"))}}]}),agGrid.initialiseAgGridWithAngular1(angular),angular.module("Grid",["agGrid","ui.bootstrap"]),angular.module("Grid").component("scriptrGrid",{bindings:{displayMetricValue:"@",defaultMetricValue:"@",availableUnits:"<?",labelsMapping:"<?",fetchDataInterval:"@",fetchPeriod:"@",onLoad:"&onLoad",columnsDefinition:"<columnsDefinition",rowHeight:"<?",enableServerSideSorting:"<?",enableServerSideFilter:"<?",refreshOnEdit:"<?",enableColResize:"<?",pagination:"@",enableDeleteRow:"<?",fixedHeight:"<?",enableAddRow:"<?",cellEditable:"<?",enableClientSideSorting:"<?",api:"@",onInsertRowScript:"@",onDeleteRowScript:"@",transport:"@",enableClientSideFilter:"<?",rowModelType:"@",rowModelSelection:"@",rowDeselection:"<?",onSelectionChanged:"&?",rowData:"<?",suppressFilter:"<?",gridHeight:"@",paginationPageSize:"<?",paginationOverflowSize:"<?",maxConcurrentDatasourceRequests:"<?",paginationInitialRowCount:"<?",maxPagesInCache:"<?",apiParams:"<?",deleteParams:"<?",addParams:"<?",editParams:"<?",onFormatData:"&",onCellValueChanged:"&",onCellClicked:"&",msgTag:"@",class:"@",defaultCellRenderer:"&",onGridReady:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/grid/grid.html",controller:["$scope","$window","$uibModal","$timeout","wsClient","dataService","$filter","$interval",function(a,b,c,d,e,f,g,h){var i=this;i.broadcastData=null,i.msgTag="grid",i.noData=!1,i.showSelectStream=!i.api,i.gridParams={},this.dataSource={getRows:function(a){if(null!=i.broadcastData){if(null!=i.broadcastData.api)var b=i.broadcastData.api;else var b=i.api;if(null!=i.broadcastData.params&&(i.apiParams=i.broadcastData.params),null!=i.broadcastData.transport)var c=i.broadcastData.transport;else var c=i.transport}else var b=i.api,c=(i.apiParams,i.transport);i.gridParams=i.buildParams(a);var d=null;"function"==typeof i.onFormatData()&&(d=function(a){return i.onFormatData()(a)}),i.gridOptions.api.showLoadingOverlay(),f.getGridData(b,i.gridParams,c,d,i.fetchDataInterval).then(function(e,g){i.processFetchedData(e,g,a),i.fetchDataInterval&&!i.refreshTimer&&(i.refreshTimer=h(function(){f.getGridData.bind(i)(b,i.gridParams,c,d,i.fetchDataInterval).then(function(b,c){i.processFetchedData(b,c,a)},function(a){console.log("reject",a)})},1e3*i.fetchDataInterval))},function(a){console.log("reject",a)})}},this.processFetchedData=function(a,b,c){if(i.showSelectStream=!1,a&&a.documents){i.timeZone=a.timeZone;for(var d=a.documents,e=_.pluck(i.labelsMapping,"keys"),f=_.pluck(i.labelsMapping,"labels"),g=0;g<d.length;g++)d[g].label=-1!=e.indexOf(d[g].label)?f[e.indexOf(d[g].label)]:d[g].label,"-"!=d[g].date&&(d[g].date=moment(d[g].date).utcOffset(i.timeZone));0!=d.length||i.gridParams.filterColumnName&&0!=i.gridParams.filterColumnName.length?i.noData=!1:i.noData=!0;var h=parseInt(a.count),j=i.cleanRows(d);if(c.successCallback(j,h),i.gridOptions.api.sizeColumnsToFit(),null==j||0==j.length){i.gridOptions.api.showNoRowsOverlay();angular.element(document.querySelector("#btNext")).attr("disabled","true")}else i.gridOptions.api.hideOverlay();i.gridOptions.api.hideOverlay()}else c.failCallback(),i.gridOptions.api.showNoRowsOverlay()},this.$onDestroy=function(){i.msgTag&&e.unsubscribe(i.msgTag,null,a.$id),i.cancelRefreshTimer()},this.cleanRows=function(a){Array.isArray(a)||(a=[a]);for(var b=!1,c=0;c<a.length;c++)for(row in a[c])if("key"!=row){b=!1;for(var d=0;d<i.gridOptions.columnDefs.length;d++)if(row==i.gridOptions.columnDefs[d].field){b=!0;break}b||delete a[c][row]}return a},this._createNewDatasource=function(){this.gridOptions.api.setDatasource(this.dataSource)},this.setGridPaginationIcons=function(){$("button[ref=btPrevious]").html('<img src="'+cdnImagesPath+'/6309fad6/images/previous.png" />'),$("button[ref=btFirst]").html('<img src="'+cdnImagesPath+'/6309fad6/images/first.png" />'),$("button[ref=btNext]").html('<img src="'+cdnImagesPath+'/6309fad6/images/next.png" />'),$("button[ref=btLast]").html('<img src="'+cdnImagesPath+'/6309fad6/images/last.png" />')},this.$onInit=function(){this.gridId=a.$id;for(var b=0;b<this.columnsDefinition.length;b++)this.columnsDefinition[b].streamTitle&&this.availableUnits&&this.columnsDefinition[b].streamValue&&(this.columnsDefinition[b].headerName=this.columnsDefinition[b].streamTitle+" ("+this.availableUnits[this.columnsDefinition[b].streamValue][this.displayMetricValue]+")"),this.columnsDefinition[b].filterParams={filterOptions:["equals","notEqual","lessThanOrEqual","greaterThan","greaterThanOrEqual"],defaultOption:"equals",applyButton:!0,clearButton:!0};this.gridOptions={unSortIcon:!0,icons:{sortAscending:'<i class="fa fa-sort-up" aria-hidden="true"></i>',sortDescending:'<i class="fa fa-sort-desc" aria-hidden="true"></i>',sortUnSort:'<span class="unsort-state"><i class="fa fa-angle-up" aria-hidden="true"></i><i class="fa fa-angle-down" aria-hidden="true"></i></span>'},domLayout:"autoHeight",angularCompileRows:!0,rowHeight:this.rowHeight?this.rowHeight:25,enableSorting:void 0!==this.enableClientSideSorting&&this.enableClientSideSorting,enableServerSideSorting:void 0!==this.enableServerSideSorting&&this.enableServerSideSorting,enableServerSideFilter:void 0!==this.enableServerSideFilter&&this.enableServerSideFilter,enableColResize:void 0!==this.enableColResize&&this.enableColResize,suppressMovableColumns:void 0===this.suppressMovableColumns||this.suppressMovableColumns,enableFilter:void 0!==this.enableServerSideFilter&&this.enableServerSideFilter,columnDefs:this.columnsDefinition,editType:"fullRow",pagination:void 0!==this.pagination&&this.pagination,cacheBlockSize:this.paginationPageSize?this.paginationPageSize:50,rowData:this.rowData?this.rowData:null,rowModelType:this.api?"infinite":"",rowSelection:this.rowModelSelection?this.rowModelSelection:"multiple",paginationPageSize:this.paginationPageSize?this.paginationPageSize:50,overlayLoadingTemplate:'<span class="ag-overlay-loading-center"><i class="fa fa-spinner fa-spin fa-3x"></i></span>',defaultColDef:{filterParams:{applyButton:!0,clearButton:!0},filter:"text",suppressFilter:void 0!==this.suppressFilter&&this.suppressFilter,editable:void 0===this.cellEditable||this.cellEditable,cellRenderer:"function"==typeof this.defaultCellRenderer()?this.defaultCellRenderer():null},onSelectionChanged:function(){if(null!=i.onSelectionChanged&&"function"==typeof i.onSelectionChanged())return i.onSelectionChanged()(i.gridOptions,i.gridApi)},onCellClicked:function(){if(null!=i.onCellClicked&&"function"==typeof i.onCellClicked())return i.onCellClicked()(i.gridOptions,i.gridApi)},onRowValueChanged:function(a){i.cellEditable&&(null!=i.onCellValueChanged&&"function"==typeof i.onCellValueChanged()&&i.onCellValueChanged()(i.gridOptions),"infinite"==i.gridOptions.rowModelType&&(i.api?(i.gridOptions.api.showLoadingOverlay(),i._saveData(a)):(i.undoChanges(),i.showAlert("danger","No script defined for cell edit"))))},onGridReady:function(a){if(d(function(){i.gridOptions.api=a.api,i.gridApi=a.api},3e3),"function"==typeof i.onGridReady()&&i.onGridReady()(i),a.api.filterManager.availableFilters.text.CONTAINS="startsWith",void 0===i.rowData||null==i.rowData||i.rowData&&0==i.rowData.length?i.api?i._createNewDatasource():a.api.setRowData([]):a.api.sizeColumnsToFit(),i.columnsDefinition)for(var b=0;b<i.columnsDefinition.length;b++)i.columnsDefinition[b].hasOwnProperty("type")&&"numeric"==i.columnsDefinition[b].type&&(i.columnsDefinition[b].filter="number");i.setGridPaginationIcons()},onGridSizeChanged:function(a){for(var b=document.getElementById("grid-"+i.gridId).offsetWidth,c=[],d=[],e=0,f=i.gridOptions.columnApi.getAllColumns(),g=0;g<f.length;g++){var h=f[g];e+=h.getMinWidth(),e>b?d.push(h.colId):c.push(h.colId)}i.gridOptions.columnApi.setColumnsVisible(c,!0),i.gridOptions.columnApi.setColumnsVisible(d,!1),i.gridOptions.api.sizeColumnsToFit()}},this.fixedHeight=void 0===this.fixedHeight||this.fixedHeight,this.style={},this.fixedHeight&&(this.gridHeight=this.gridHeight?this.gridHeight:"500",this.style.clear="left",this.style.width="100%"),this.refreshOnEdit=void 0!==this.refreshOnEdit&&this.refreshOnEdit,this.transport=this.transport?this.transport:"wss",this.enableDeleteRow=1!=this.enableDeleteRow,this.enableAddRow=1!=this.enableAddRow,this.mode="infinite"==this.gridOptions.rowModelType?"infinite":"normal",i.msgTag&&f.subscribe(this.onServerCall,i.msgTag,a),a.$on("updateGridData",function(a,b){i.broadcastData=b,i._createNewDatasource()})},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){i.message={type:a,content:b},i.showError=!0,d(function(){i.showError=!1},5e3)},this._saveData=function(a){if(a.data&&a.data.key){var b=a.data;if(b.action="edit",this.editParams)for(var c in this.editParams)b[c]=this.editParams[c];f.gridHelper(i.api,b).then(function(a,b){i.gridOptions.api.hideOverlay(),!a||"success"!=a.result&&"success"!=a.status?(i.undoChanges(),a&&a.errorDetail?i.showAlert("danger",a.errorDetail):i.showAlert("danger","An error has occured")):i.refreshOnEdit&&i.onServerCall(a)},function(a){i.gridOptions.api.hideOverlay(),console.log("reject",a),i.showAlert("danger","An error has occured")})}else{var b=a.data;if(b.action="add",this.addParams)for(var c in this.addParams)b[c]=this.addParams[c];f.gridHelper(i.api,a.data).then(function(a,b){i.gridOptions.api.hideOverlay(),!a||"success"!=a.result&&"success"!=a.status?(i.undoChanges(),a&&a.errorDetail?i.showAlert("danger",a.errorDetail):i.showAlert("danger","An error has occured")):i.refreshOnEdit&&i.onServerCall(a)},function(a){i.gridOptions.api.hideOverlay(),console.log("reject",a),i.showAlert("danger","An error has occured")})}},this.onAddRow=function(){for(var a={},b=0;b<i.gridOptions.columnDefs.length;b++)a[i.gridOptions.columnDefs[b].field]="";i.gridOptions.api.insertItemsAtIndex(0,[a]),i.gridOptions.api.setFocusedCell(0,i.gridOptions.columnDefs[0].field),i.gridOptions.api.startEditingCell({rowIndex:0,colKey:i.gridOptions.columnDefs[0].field,charPress:i.gridOptions.columnDefs[0].field})},this.openConfirmationPopUp=function(){if(i.gridOptions.api.getSelectedNodes().length>0){c.open({animation:!0,component:"deleteConfirmation",size:"md",resolve:{grid:function(){return i}}})}},this.onRemoveRow=function(a){if("infinite"==i.gridOptions.rowModelType)if(i.api){for(var b=i.gridOptions.api.getSelectedNodes(),c=[],d=0;d<b.length;d++)c.push(b[d].data.key);if(c.length>0){i.gridOptions.api.showLoadingOverlay();var e={keys:c,action:"delete"};if(this.deleteParams)for(var a in this.deleteParams)e[a]=this.deleteParams[a];f.gridHelper(i.api,e).then(function(a,b){i.gridOptions.api.hideOverlay(),!a||"success"!=a.result&&"success"!=a.status?a&&a.errorDetail?i.showAlert("danger",a.errorDetail):i.showAlert("danger","An error has occured"):i.onServerCall(a)},function(a){i.gridOptions.api.hideOverlay(),console.log("reject",a),i.showAlert("danger","An error has occured")})}}else i.showAlert("danger","No script defined for delete row");else{var b=i.gridOptions.api.getSelectedNodes();i.gridOptions.api.removeItems(b)}},this.onServerCall=function(a){i.gridOptions.api.refreshInfiniteCache()},this.undoChanges=function(a){if(i.oldEditedValue){i.gridOptions.api.forEachNode(function(a){a.childIndex!=i.editedChildIndex&&a.id!=i.editedChildIndex||a.setSelected(!0,!0)});i.gridOptions.api.getSelectedNodes()[0].data[i.editedColumn]=i.oldEditedValue,i.gridOptions.api.refreshView()}else i.gridOptions.api.refreshInfiniteCache()},this.onFilterChanged=function(){this.gridOptions.enableServerSideFilter=!1,this.gridOptions.api.setQuickFilter(this.quickFilterValue),this.gridOptions.enableServerSideFilter=!0},this.onServerFilterChanged=function(){i._createNewDatasource()},this.buildParams=function(a){var b=i.serverFilterText,c=null,d=a.endRow/this.gridOptions.paginationPageSize;if(a.sortModel&&a.sortModel.length>0){var e=a.sortModel[0].sort,f=a.sortModel[0].colId;c=this.gridOptions.api.getColumnDef(f).type?this.gridOptions.api.getColumnDef(f).type:null}if(a.filterModel){b=_.pluck(a.filterModel,"filter");var g=_.pluck(a.filterModel,"type"),h=_.keys(a.filterModel)}var j={resultsPerPage:this.gridOptions.paginationPageSize,pageNumber:d};if(f&&(j.sortingColumnName=f),h&&(j.filterColumnName=h),e&&(j.sort=e),c&&(j.sortType=c),b&&(j.queryFilter=b),g&&(j.queryType=g),j.startRow=a.startRow,j.endRow=a.endRow,this.apiParams)for(var k in this.apiParams)j[k]=this.apiParams[k];return j},this.cancelRefreshTimer=function(){i.refreshTimer&&h.cancel(i.refreshTimer)}}]}),angular.module("Grid").service("dataService",["httpClient","wsClient","$q","$timeout","$interval",function(a,b,c,d,e){var f=this;this.subscribe=function(a,c,d){b.onReady.then(function(){b.subscribe(c,a.bind(f),d.$id)})},this.cancelRefreshTimer=function(){f.refreshTimer&&e.cancel(f.refreshTimer)},this.gridHelper=function(b,d){var e=c.defer();return a.get(b,d,"grid").then(function(a,b){e.resolve(a,b)},function(a){e.reject(a)}),e.promise},this.getGridData=function(d,e,f,g,h){var i=c.defer();return"https"==f?(a.get(d,e).then(function(a,b){if(g&&(a=g(a)),a&&a.documents){var a={documents:a.documents,count:a.count,timeZone:a.timeZone};i.resolve(a,b)}else i.resolve(null,b)},function(a){i.resolve(null),i.reject(a)}),i.promise):"wss"==f?d&&void 0!==d?(b.onReady.then(function(){b.call(d,e,"grid").then(function(a,b){if(g&&(a=g(a)),a&&a.documents){var a={documents:a.documents,count:a.count,timeZone:a.timeZone};i.resolve(a,b)}else i.resolve(null,b)},function(a){i.resolve(null),i.reject(a)})}),i.promise):(b.onReady.then(function(){b.publish(e,"publish").then(function(a,b){if(a&&a.documents){var a={documents:a.documents,count:a.count,timeZone:a.timeZone};i.resolve(a,b)}else i.resolve(null,b)},function(a){i.resolve(null),i.reject(a)})}),i.promise):void 0}}]),angular.module("Grid").component("deleteConfirmation",{bindings:{resolve:"<",close:"&",dismiss:"&"},
templateUrl:"/UIComponents/dashboard/frontend/components/grid/popup.html",controller:["$scope",function(a){this.onSubmit=function(){this.resolve.grid.onRemoveRow(),this.close({$value:!0})},this.onCancel=function(){this.dismiss({$value:!1})}}]}),angular.module("ACL",["ui.bootstrap","List"]),angular.module("ACL").component("scriptrAcl",{bindings:{users:"<?",defaultSetObject:"<?",onSave:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/ACL/ACL.html",controller:["$uibModal",function(a){var b=this;this.$onInit=function(){console.log("$onInit initialized"),b.accessType=1==b.users.length&&"anonymous"==b.users[0].code?"Anonymous access":"Restricted access"},this.$postLink=function(){console.log("$postLink initialized")},this.openModal=function(){a.open({animation:!0,size:"lg",component:"aclPopup",resolve:{widget:function(){return{parent:b,users:b.users,defaultSetObject:b.defaultSetObject,onSave:b.onSave}}}}).result.then(function(a){console.log("selectedItem: "+a)},function(){})}}]}),angular.module("ACL").component("aclPopup",{bindings:{resolve:"<",users:"<?",defaultSetObject:"<?",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/ACL/myModalContent.html",controller:["$scope","$sce",function(a,b){var c=this;c.listScope,this.$onInit=function(){c.users=c.resolve.widget.users,c.defaultSetObject=c.resolve.widget.defaultSetObject,c.popoverContent=b.trustAsHtml("<span style='color: #323232;'><strong>Scriptr.io provides the following predefined groups:</strong><div class='mt10 mb5'><i class='fa fa-caret-right text-primary'></i> authenticated represents anyone with a valid token.</div><div class='mb5'><i class='fa fa-caret-right text-primary'></i> anonymous represents everyone.</div><div class='mb5'><i class='fa fa-caret-right text-primary'></i> nobody represents no one.</div></span>")},this.onSelect=function(a){c.resolve.modalScope=this,"anonymous"==a.originalObject[this.titleField]&&(this.disableInput=!0,this.hideObjects=!0,c.showMsg=!0)},this.removeAnonymousAccess=function(){c.showMsg=!1,c.resolve.modalScope.disableInput=!1,c.resolve.modalScope.hideObjects=!1;var b=[{code:"anonymous",icon:"fa fa-group"}];a.$broadcast("angucomplete-alt:addObjectToList",c.id,b)},this.addAnonymousAccess=function(){c.showMsg=!1,c.resolve.modalScope.disableInput=!1,c.resolve.modalScope.hideObjects=!1;for(var b=[],d=0;d<c.resolve.modalScope.objects.length;d++)"anonymous"!=c.resolve.modalScope.objects[d].code&&b.push(c.resolve.modalScope.objects[d]);a.$broadcast("angucomplete-alt:addObjectToList",c.id,b)},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){this.closeAlert(),this.message={type:a,content:b},this.show=!0},this.updateFileACL=function(){c.listScope||(c.listScope=a.$broadcast("angucomplete-alt:getSetObjects",c.id));var b=c.listScope.targetScope.$$childTail.$ctrl;if("function"==typeof c.resolve.widget.onSave()){var d=[];if(void 0===b.objects&&(b.objects=c.resolve.modalScope.objects),b.objects.length>0)var e=b.objects;else var e=c.resolve.widget.defaultSetObject;for(var f=0;f<e.length;f++)d.push(e[f].code);b.showList=!1,c.resolve.widget.onSave()(d).then(function(a,d){b.showList=!0,c.showAlert("success","The Access Control List is saved successfully."),c.resolve.widget.parent.users=b.objects,c.resolve.widget.parent.accessType=1==b.objects.length&&"anonymous"==b.objects[0].code?"Anonymous access":"Restricted access",console.log("success")},function(a){b.showList=!0,c.showMsg("danger",a.data.response.metadata.errorDetail),console.log("reject",a)})}},this.onCancel=function(a){this.dismiss({$value:"cancel"}),console.log("Dissmisseddd")}}]}),angular.module("List",["angucomplete-alt"]).component("scriptrAutocomplete",{bindings:{id:"@",objects:"<?",hideObjects:"<?",listSelectedObject:"<?",defaultSetObject:"<?",placeholder:"@",maxlength:"@",pause:"@",selectedObject:"<?",selectedObjectData:"<?",titleField:"@",descriptionField:"@",imageField:"@",minlength:"@",inputName:"@",inputClass:"@",matchClass:"@",localData:"<?",searchFields:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"@",fieldRequiredClass:"@",textSearching:"@",textNoResults:"@",initialValue:"@",inputChanged:"&",autoMatch:"@",focusIn:"&",focusOut:"&",disableInput:"@",focusFirst:"@",fieldTabindex:"@",parseInput:"&",localSearch:"&",transport:"@",msgTag:"@",api:"@",onFormatData:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/list/autocomplete.html",controller:["$scope","wsClient","httpClient",function(a,b,c){var d=this;this.$onInit=function(){this.localData=this.localData?this.localData:[],this.fieldRequired=void 0!==this.fieldRequired&&this.fieldRequired,this.textSearching=void 0!==this.textSearching&&this.textSearching,this.transport=this.transport?this.transport:"wss",this.objects=this.objects?this.objects:[],this.listSelectedObject&&this.objects.length>0&&!d.api&&(a.$broadcast("angucomplete-alt:setData",d.id,this.localData),a.$broadcast("angucomplete-alt:setSelectedObjects",d.id,this.objects)),d.api&&(d.showList=!1,e(this.transport))},d.addObjectToList=function(b){a.$broadcast("angucomplete-alt:addObjectToList",d.id,b),0==this.objects.length&&void 0!==this.defaultSetObject&&(this.objects=JSON.parse(JSON.stringify(this.defaultSetObject)))};var e=function(a){"wss"==a?b.onReady.then(function(){b.subscribe(d.msgTag,d.consumeData.bind(d)),d.api&&b.call(d.api,d.apiParams,d.msgTag).then(function(a,b){d.consumeData(a)})}):"https"==a&&d.api&&c.get(d.api,d.apiParams).then(function(a,b){d.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(b,c){d.showList=!0,"function"==typeof d.onFormatData()&&(b=d.onFormatData()(b)),this.localData=b,this.listSelectedObject&&this.objects.length>0&&(a.$broadcast("angucomplete-alt:setData",d.id,this.localData),a.$broadcast("angucomplete-alt:setSelectedObjects",d.id,this.objects))}}]}),angular.module("Dygraphs",["angular-dygraphs"]),angular.module("Dygraphs").component("scriptrDygraphs",{bindings:{displayMetricValue:"@",displayMetricParam:"@",defaultMetricValue:"@",defaultMetricParam:"@",availableUnits:"<?",isScaled:"@",onLoad:"&onLoad",api:"@",transport:"@",msgTag:"@",apiParams:"<?",onFormatData:"&",resize:"<?",data:"<?",legend:"<?",drawX1Axis:"@",drawYAxis:"@",drawY2Axis:"@",colors:"<?",x1AxisLabelFontSize:"@",yAxisLabelFontSize:"@",y2AxisLabelFontSize:"@",yAxisLabelsKmb:"@",y2AxisLabelsKmb:"@",x1AxisLabelWidth:"@",yAxisLabelWidth:"@",y2AxisLabelWidth:"@",x1AxisLineColor:"@",yAxisLineColor:"@",y2AxisLineColor:"@",x1AxisLineWidth:"@",yAxisLineWidth:"@",y2AxisLineWidth:"@",x1AxisTickSize:"@",yAxisTickSize:"@",y2AxisTickSize:"@",yAxisIncludeZero:"@",y2AxisIncludeZero:"@",x1AxisLabel:"@",yAxisLabel:"@",y2AxisLabel:"@",showRangeSelector:"@",rangeSelectorAlpha:"@",rangeSelectorBackgroundLineWidth:"@",rangeSelectorBackgroundStrokeColor:"@",rangeSelectorForegroundLineWidth:"@",rangeSelectorForegroundStrokeColor:"@",rangeSelectorHeight:"@",rangeSelectorPlotFillColor:"@",rangeSelectorPlotFillGradientColor:"@",rangeSelectorPlotLineWidth:"@",rangeSelectorPlotStrokeColor:"@",goals:"<?",goalLineColors:"<?",events:"<?",eventLineColors:"<?",legendPosition:"@",showLegend:"@",x1DrawGrid:"@",yDrawGrid:"@",y2DrawGrid:"@",x1GridLineColor:"@",yGridLineColor:"@",y2GridLineColor:"@",x1GridLineWidth:"@",yGridLineWidth:"@",y2GridLineWidth:"@",legendLabels:"<?",independentTicks:"@",legendMapping:"<?",customGoals:"<?",colorsMapping:"<?",fetchFromDateParam:"@",fetchFromDateValue:"@",fetchToDateParam:"@",fetchToDateValue:"@",fetchDataInterval:"@",fetchPeriod:"@"},templateUrl:"/UIComponents/dashboard/frontend/components/dygraphs/dygraphs.html",controller:["$rootScope","httpClient","wsClient","$scope","$timeout","$interval",function(a,b,c,d,e,f){var g=this;g.showSelectStream=!g.api,this.$onInit=function(){if(this._apiParams=this.apiParams?angular.copy(this.apiParams):[],void 0===this.api&&void 0===this.msgTag&&(this.data&&0==this.data.length||null==this.data)&&(this.noResults=!0),this.drawX1Axis=!this.drawX1Axis||JSON.parse(this.drawX1Axis),this.drawYAxis=!this.drawYAxis||JSON.parse(this.drawYAxis),this.drawY2Axis=!this.drawY2Axis||JSON.parse(this.drawY2Axis),this.colors=this.colors?this.colors:["#005588","#aa241d"],this.colorsMapping&&(this.colors=_.pluck(this.colorsMapping,"colors")),this.colorsMapping){this.legendLabels=["x"],this.legendLabels=this.legendLabels.concat(_.pluck(this.colorsMapping,"labels"));for(var b=0;b<this.legendLabels.length;b++){for(var c=[],d=0;d<this.legendLabels.length;d++)d!=b&&this.legendLabels[b]==this.legendLabels[d]&&c.push(d);for(var d=1;d<=c.length;d++)this.legendLabels[c[d-1]]+="("+d+")"}}if(this.colorsMapping&&(this.legendMapping=["X"],this.legendMapping=this.legendMapping.concat(_.pluck(this.colorsMapping,"axisSelection")),this.legendUnitsMapping=_.pluck(this.colorsMapping,"unit"),this.scaledStreams=_.pluck(this.colorsMapping,"isScaled"),this.displayMetricValue))for(var b=1;b<this.legendLabels.length;b++)this.scaledStreams&&this.scaledStreams[b-1]?this.legendLabels[b]=this.legendLabels[b]+" ("+this.legendUnitsMapping[b-1].scaled+")":this.legendLabels[b]=this.legendLabels[b]+" ("+this.legendUnitsMapping[b-1][this.displayMetricValue]+")";this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=a.currentDashboardUnit,this.defaultMetricParam=this.defaultMetricParam?this.defaultMetricParam:"default_metric",this.defaultMetricValue=this.defaultMetricValue?this.defaultMetricValue:null,(!this.isScaled||"false"==this.isScaled)&&this.defaultMetricValue&&this.displayMetricValue&&this.defaultMetricValue!=this.displayMetricValue&&this.availableUnits&&Object.keys(this.availableUnits).length>=2&&this.runMetricTransformation(),this.customGoals=this.customGoals?_.reject(this.customGoals,function(a){return""===a.goals||null==a.goals}):[],this.goalLineColors=_.pluck(this.customGoals,"goal-line-colors"),this.goals=_.pluck(this.customGoals,"goals"),this.events=this.events?this.events:[],this.eventLineColors=this.eventLineColors?this.eventLineColors:["#ffffff"],this.x1AxisLabelFontSize=this.x1AxisLabelFontSize?JSON.parse(this.x1AxisLabelFontSize):14,this.yAxisLabelFontSize=this.yAxisLabelFontSize?JSON.parse(this.yAxisLabelFontSize):14,this.y2AxisLabelFontSize=this.y2AxisLabelFontSize?JSON.parse(this.y2AxisLabelFontSize):14,this.yAxisLabelsKmb=!!this.yAxisLabelsKmb&&JSON.parse(this.yAxisLabelsKmb),this.y2AxisLabelsKmb=!!this.y2AxisLabelsKmb&&JSON.parse(this.y2AxisLabelsKmb),this.x1AxisLabelWidth=this.x1AxisLabelWidth?JSON.parse(this.x1AxisLabelWidth):60,this.yAxisLabelWidth=this.yAxisLabelWidth?JSON.parse(this.yAxisLabelWidth):50,this.y2AxisLabelWidth=this.y2AxisLabelWidth?JSON.parse(this.y2AxisLabelWidth):50,this.x1AxisLineColor=this.x1AxisLineColor?this.x1AxisLineColor:"#000000",this.yAxisLineColor=this.yAxisLineColor?this.yAxisLineColor:"#000000",this.y2AxisLineColor=this.y2AxisLineColor?this.y2AxisLineColor:"#000000",this.showLegend=!this.showLegend||JSON.parse(this.showLegend),this.x1AxisLabel=this.x1AxisLabel?this.x1AxisLabel:"",this.yAxisLabel=this.yAxisLabel?this.yAxisLabel:"",this.y2AxisLabel=this.y2AxisLabel?this.y2AxisLabel:"",this.x1AxisLineWidth=this.x1AxisLineWidth?JSON.parse(this.x1AxisLineWidth):.3,this.yAxisLineWidth=this.yAxisLineWidth?JSON.parse(this.yAxisLineWidth):.3,this.y2AxisLineWidth=this.y2AxisLineWidth?JSON.parse(this.y2AxisLineWidth):.3,this.x1AxisTickSize=this.x1AxisTickSize?JSON.parse(this.x1AxisTickSize):3,this.yAxisTickSize=this.yAxisTickSize?JSON.parse(this.yAxisTickSize):3,this.y2AxisTickSize=this.y2AxisTickSize?JSON.parse(this.y2AxisTickSize):3,this.yAxisIncludeZero=!!this.yAxisIncludeZero&&JSON.parse(this.yAxisIncludeZero),this.y2AxisIncludeZero=!!this.y2AxisIncludeZero&&JSON.parse(this.y2AxisIncludeZero),this.showRangeSelector=!!this.showRangeSelector&&JSON.parse(this.showRangeSelector),this.rangeSelectorAlpha=this.rangeSelectorAlpha?JSON.parse(this.rangeSelectorAlpha):.6,this.rangeSelectorBackgroundLineWidth=this.rangeSelectorBackgroundLineWidth?JSON.parse(this.rangeSelectorBackgroundLineWidth):1,this.rangeSelectorBackgroundStrokeColor=this.rangeSelectorBackgroundStrokeColor?this.rangeSelectorBackgroundStrokeColor:"#808080",this.rangeSelectorForegroundLineWidth=this.rangeSelectorForegroundLineWidth?JSON.parse(this.rangeSelectorForegroundLineWidth):1,this.rangeSelectorForegroundStrokeColor=this.rangeSelectorForegroundStrokeColor?this.rangeSelectorForegroundStrokeColor:"#000000",this.rangeSelectorHeight=this.rangeSelectorHeight?JSON.parse(this.rangeSelectorHeight):40,this.rangeSelectorPlotFillColor=this.rangeSelectorPlotFillColor?this.rangeSelectorPlotFillColor:"#A7B1C4",this.rangeSelectorPlotFillGradientColor=this.rangeSelectorPlotFillGradientColor?this.rangeSelectorPlotFillGradientColor:"#FFFFFF",this.rangeSelectorPlotLineWidth=this.rangeSelectorPlotLineWidth?JSON.parse(this.rangeSelectorPlotLineWidth):1.5,this.rangeSelectorPlotStrokeColor=this.rangeSelectorPlotStrokeColor?this.rangeSelectorPlotStrokeColor:"#808FAB",this.x1DrawGrid=!this.x1DrawGrid||JSON.parse(this.x1DrawGrid),this.yDrawGrid=!this.yDrawGrid||JSON.parse(this.yDrawGrid),this.y2DrawGrid=!!this.y2DrawGrid&&JSON.parse(this.y2DrawGrid),this.x1GridLineColor=this.x1GridLineColor?this.x1GridLineColor:"#000000",this.yGridLineColor=this.yGridLineColor?this.yGridLineColor:"#000000",this.y2GridLineColor=this.y2GridLineColor?this.y2GridLineColor:"#000000",this.x1GridLineWidth=this.x1GridLineWidth?JSON.parse(this.x1GridLineWidth):.3,this.yGridLineWidth=this.yGridLineWidth?JSON.parse(this.yGridLineWidth):.3,this.y2GridLineWidth=this.y2GridLineWidth?JSON.parse(this.y2GridLineWidth):.3,this.xDrawGrid=!this.xDrawGrid||JSON.parse(this.xDrawGrid),this.independentTicks=this.independentTicks?this.independentTicks:"y-primary",this.legendLabels=this.legendLabels?this.legendLabels:["X","Y1","Y2","Y3","Y4"],this.legendMapping=this.legendMapping?this.legendMapping:["x","y","y","y2","y2"],this.options={},this.options.axes={},this.x1AxisLabel&&""!=this.x1AxisLabel&&(this.options.xlabel=this.x1AxisLabel),this.yAxisLabel&&""!=this.yAxisLabel&&(this.options.ylabel=this.yAxisLabel),this.y2AxisLabel&&""!=this.y2AxisLabel&&(this.options.y2label=this.y2AxisLabel),this.legendLabels&&""!=this.legendLabels&&(this.options.labels=this.legendLabels),this.options.yRangePad="10",this.options.axes.x={},this.options.axes.x.drawAxis=JSON.parse(this.drawX1Axis),this.options.axes.x.axisLabelFontSize=JSON.parse(this.x1AxisLabelFontSize),this.options.axes.x.axisLabelWidth=JSON.parse(this.x1AxisLabelWidth),this.options.axes.x.axisLineColor=this.x1AxisLineColor,this.options.axes.x.axisLineWidth=JSON.parse(this.x1AxisLineWidth),this.options.axes.x.axisTickSize=JSON.parse(this.x1AxisTickSize),this.options.axes.x.independentTicks=!0,this.options.axes.x.ticker=Dygraph.dateTicker,this.options.xValueParser=function(a){return g.timeZone?moment(a).utcOffset(g.timeZone).format("YYYY-MM-DD kk:mm"):moment(a).format("YYYY-MM-DD kk:mm")},this.options.labelsUTC=!0,this.options.offset=moment.tz(g._apiParams.fetchTimeZone).utcOffset(),this.options.axes.x.axisLabelFormatter=function(a,b,c){return Dygraph.dateAxisLabelFormatter(new Date(a),b,c)},"past_day"==this.fetchPeriod?this.options.axes.x.valueFormatter=function(a){return g.timeZone?moment(a).utcOffset(g.timeZone).format("HH:mm"):moment(a).format("HH:mm")}:this.options.axes.x.valueFormatter=function(a){return g.timeZone?moment(a).utcOffset(g.timeZone).format("DD MMM"):moment(a).format("DD MMM")},this.options.axes.y={},this.options.axes.y.drawAxis=JSON.parse(this.drawYAxis),this.options.axes.y.axisLabelFontSize=JSON.parse(this.yAxisLabelFontSize),this.options.axes.y.axisLineColor=this.yAxisLineColor,this.options.axes.y.axisLineWidth=JSON.parse(this.yAxisLineWidth),this.options.axes.y.axisTickSize=JSON.parse(this.yAxisTickSize),this.options.axes.y.includeZero=JSON.parse(this.yAxisIncludeZero),this.options.axes.y.labelsKMB=JSON.parse(this.yAxisLabelsKmb);this.options.digitsAfterDecimal=4;var e=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c};this.options.axes.y.ticker=Dygraph.numericLinearTicks,this.options.axes.y.axisLabelFormatter=function(a){return e(a,4)},this.options.axes.y2={},this.options.axes.y2.drawAxis=JSON.parse(this.drawY2Axis),this.options.axes.y2.axisLabelFontSize=JSON.parse(this.y2AxisLabelFontSize),this.options.axes.y2.axisLabelWidth=JSON.parse(this.y2AxisLabelWidth),this.options.axes.y2.axisLineColor=this.y2AxisLineColor,this.options.axes.y2.axisLineWidth=JSON.parse(this.y2AxisLineWidth),this.options.axes.y2.axisTickSize=JSON.parse(this.y2AxisTickSize),this.options.axes.y2.includeZero=JSON.parse(this.y2AxisIncludeZero),this.options.axes.y2.labelsKMB=JSON.parse(this.y2AxisLabelsKmb),this.options.axes.y2.ticker=Dygraph.numericLinearTicks,this.options.axes.y2.axisLabelFormatter=function(a){return e(a,4)},this.options.showRangeSelector=JSON.parse(this.showRangeSelector),this.options.rangeSelectorAlpha=JSON.parse(this.rangeSelectorAlpha),this.options.rangeSelectorBackgroundLineWidth=JSON.parse(this.rangeSelectorBackgroundLineWidth),this.options.rangeSelectorBackgroundStrokeColor=this.rangeSelectorBackgroundStrokeColor,this.options.rangeSelectorForegroundLineWidth=JSON.parse(this.rangeSelectorForegroundLineWidth),this.options.rangeSelectorForegroundStrokeColor=this.rangeSelectorForegroundStrokeColor,this.options.rangeSelectorHeight=JSON.parse(this.rangeSelectorHeight),this.options.rangeSelectorPlotFillColor=this.rangeSelectorPlotFillColor,this.options.rangeSelectorPlotFillGradientColor=this.rangeSelectorPlotFillGradientColor,this.options.rangeSelectorPlotLineWidth=JSON.parse(this.rangeSelectorPlotLineWidth),this.options.rangeSelectorPlotStrokeColor=this.rangeSelectorPlotStrokeColor,this.options.colors=this.colors,this.showLegend?(this.options.showLabelsOnHighlight=!0,this.options.legend="always"):(this.options.showLabelsOnHighlight=!1,this.options.hideOverlayOnMouseOut=!0),this.options.legendPosition=this.legendPosition?this.legendPosition:"top",this.options.axes.x.drawGrid=JSON.parse(this.x1DrawGrid),this.options.axes.y.drawGrid=JSON.parse(this.yDrawGrid),this.options.axes.y2.drawGrid=JSON.parse(this.y2DrawGrid),this.options.axes.x.gridLineColor=this.x1GridLineColor,this.options.axes.y.gridLineColor=this.yGridLineColor,this.options.axes.y2.gridLineColor=this.y2GridLineColor,this.options.axes.x.gridLineWidth=JSON.parse(this.x1GridLineWidth),this.options.axes.y.gridLineWidth=JSON.parse(this.yGridLineWidth),this.options.axes.y2.gridLineWidth=JSON.parse(this.y2GridLineWidth),"y-primary"==this.independentTicks?(this.options.axes.y.independentTicks=!0,this.options.axes.y2.independentTicks=!1):"y2-primary"==this.independentTicks?(this.options.axes.y.independentTicks=!1,this.options.axes.y2.independentTicks=!0):"independent"==this.independentTicks&&(this.options.axes.y.independentTicks=!0,this.options.axes.y2.independentTicks=!0),this.options.goals=this.goals?this.goals:[],this.options.goalLineColors=this.goalLineColors?this.goalLineColors:["#ffffff"],this.options.events=this.events?this.events:[],this.options.eventLineColors=this.eventLineColors?this.eventLineColors:["#ffffff"],this.options.connectSeparatedPoints=!0,this.options.series={};for(var f=0;f<this.legendLabels.length;f++){var h=this.legendLabels[f];0!=f&&"y2"==this.legendMapping[f]&&this.drawY2Axis&&(h?this.options.series[h]={axis:this.legendMapping[f]}:this.options.series["Y"+f]={axis:this.legendMapping[f]})}this.resize=!this.resize||this.resize,this.transport=this.transport?this.transport:"wss",this.msgTag=this.msgTag?this.msgTag:null,this.fetchFromDateParam=this.fetchFromDateParam?this.fetchFromDateParam:"from_date",this.fetchToDateParam=this.fetchToDateParam?this.fetchToDateParam:"to_date",this.fetchToDateValue=this.fetchToDateValue?this.fetchToDateValue:null,this.fetchFromDateValue=this.fetchFromDateValue?this.fetchFromDateValue:null,this.fetchFromDateValue&&(this._apiParams[this.fetchFromDateParam]=this.fetchFromDateValue),this.fetchToDateValue&&(this._apiParams[this.fetchToDateParam]=this.fetchToDateValue),this.fetchDataInterval=this.fetchDataInterval?parseInt(this.fetchDataInterval):null,this.delta=!1},this.runMetricTransformation=function(){if("si"!=this.defaultMetricValue)var a=this.availableUnits.us,b=this.availableUnits.si;else var a=this.availableUnits.si,b=this.availableUnits.us;if(this.customGoals)for(var c=0;c<this.customGoals.length;c++){var d=this.customGoals[c].goals;if(null!=d){var e=getConversionFunction(a,b);void 0!==e&&(this.customGoals[c].goals=e(d))}}},this.$postLink=function(){h(this.transport),this.data&&!this.api?(g.timeout=!1,e(function(){g.consumeData(g.data)},2e3)):g.timeout=!0,d.$watch(function(a){if(a.$ctrl.data&&1==g.timeout)return a.$ctrl.data},function(a){a&&(g.datas=a,g.noResults=!1)})},this.$onDestroy=function(){console.log("destory chart",g.msgTag,d.$id),g.msgTag&&c.unsubscribe(g.msgTag,null,d.$id),g.refreshTimer&&f.cancel(g.refreshTimer)};var h=function(a){"wss"==a?c.onReady.then(function(){g.msgTag&&c.subscribe(g.msgTag,g.consumeData.bind(g),d.$id),g.api&&c.call(g.api,g._apiParams,g.msgTag).then(function(a,b){g.showSelectStream=!1,g.fetchDataInterval&&!g.refreshTimer&&(g.refreshTimer=f(function(){g.fetchPeriod&&"past_day"!=g.fetchPeriod?("past_week"==g.fetchPeriod&&(g._apiParams[g.fetchFromDateParam]=moment().add(-7,"days").valueOf()),"past_month"==g.fetchPeriod&&(g._apiParams[g.fetchFromDateParam]=moment().add(-30,"days").valueOf())):(g.delta=!0,g.datas&&g.datas.length>0?g._apiParams[g.fetchFromDateParam]=g.datas[g.datas.length-1][0]:g._apiParams[g.fetchFromDateParam]=moment().add(-1,"days").startOf("hour").valueOf()),h(g.transport)},1e3*g.fetchDataInterval)),g.consumeData(a)},function(a){console.log("reject published promise",a),g.consumeData()})}):"https"==a&&g.api&&b.get(g.api,g._apiParams).then(function(a,b){g.consumeData(a)},function(a){console.log("reject published promise",a),g.consumeData()})};this.consumeData=function(a,b){a.timeZone&&(g.timeZone=a.timeZone,g.options.offset=a.timeZone,a=a.data),g.timeout=!0,"function"==typeof g.onFormatData()&&(a=g.onFormatData()(a)),a&&a.length>0&&"object"==typeof a?this.fetchDataInterval&&this.fetchDataInterval>0&&this.datas&&this.delta?this.datas=this.datas.concat(a):(this.datas=a,this.noResults=!1):this.api&&a&&0==a.length&&(!this.datas||this.datas&&0==this.datas.length)&&(this.datas=[],this.noResults=!0)}}]}),angular.module("plotly",["angularPlotly"]),angular.module("plotly").component("scriptrPlotly",{bindings:{fetchPeriod:"@",displayMetricValue:"@",displayMetricParam:"@",defaultMetricValue:"@",defaultMetricParam:"@",availableUnits:"<?",isScaled:"@",fetchFromDateParam:"@",fetchFromDateValue:"@",fetchToDateParam:"@",fetchToDateValue:"@",fetchDataInterval:"@",onLoad:"&onLoad",api:"@",retrievedData:"<?",customRanges:"<?",layout:"<?",options:"<?",transport:"@",showLegend:"@",fontSize:"@",msgTag:"@",apiParams:"<?",onFormatData:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/plotly/plotly.html",controller:["$rootScope","$scope","$window","$element","$timeout","httpClient","wsClient","_","$interval",function(a,b,c,d,e,f,g,h,i){var j=this;this.directions=["N","NNE","ENE","E","ESE","SSE","S","SSW","WSW","W","WNW","NNW"],this.speedUnit="m/s",this.noResults=!1,this.showSelectStream=!j.api,this.$onInit=function(){this._apiParams=this.apiParams?angular.copy(this.apiParams):[],this.apiParams&&this.apiParams.streams&&this.apiParams.streams.length<2&&(this.showSelectStream=!0),this.plotCustomRanges=this.customRanges&&this.customRanges.length>0?this.customRanges:[{color:"#00476b",lo:0,hi:2},{color:"#005487",lo:2,hi:4},{color:"#006699",lo:4,hi:6},{color:"#0082b5",lo:6,hi:8},{color:"#0294c1",lo:8,hi:10},{color:"#06a9ce",lo:10,hi:20}],this.fetchFromDateParam=this.fetchFromDateParam?this.fetchFromDateParam:"from_date",this.fetchToDateParam=this.fetchToDateParam?this.fetchToDateParam:"to_date",this.fetchToDateValue=this.fetchToDateValue?this.fetchToDateValue:null,this.fetchFromDateValue=this.fetchFromDateValue?this.fetchFromDateValue:null,this.fetchFromDateValue&&(this._apiParams[this.fetchFromDateParam]=this.fetchFromDateValue),this.fetchToDateValue&&(this._apiParams[this.fetchToDateParam]=this.fetchToDateValue),this.displayMetricParam=this.displayMetricParam?this.displayMetricParam:"display_metric",this.displayMetricValue=a.currentDashboardUnit,this.defaultMetricParam=this.defaultMetricParam?this.defaultMetricParam:"default_metric",this.defaultMetricValue=this.defaultMetricValue?this.defaultMetricValue:null,this.retrievedData=this.retrievedData?this.retrievedData:[],this.staticData=angular.copy(this.retrievedData),(!this.isScaled||"false"==this.isScaled)&&this.defaultMetricValue&&this.displayMetricValue&&this.defaultMetricValue!=this.displayMetricValue&&this.availableUnits&&Object.keys(this.availableUnits).length>=2&&this.runMetricTransformation(),this.showLegend=this.showLegend?this.showLegend:"true",this.fontSize=this.fontSize?this.fontSize:"12",this.layout={title:"",font:{size:this.fontSize},radialaxis:{ticksuffix:"%"},orientation:270},this.maxRange=h.max(h.pluck(this.plotCustomRanges,"hi")),this.listOfMinRanges=h.pluck(this.plotCustomRanges,"lo"),this.listOfMaxRanges=h.pluck(this.plotCustomRanges,"hi"),this.listOfColors=h.pluck(this.plotCustomRanges,"color"),this.listOfColors.push("#10c3e0"),this.isScaled&&"false"!=this.isScaled?this.speedUnit=this.availableUnits?this.availableUnits.scaled:this.speedUnit?this.speedUnit:"":this.speedUnit=this.availableUnits?this.availableUnits[this.displayMetricValue]:this.speedUnit?this.speedUnit:"",this.style={},angular.element(c).on("resize",j.scheduleResize),k(this.transport)},j.resize=function(){j.timeoutId=null,c.matchMedia(a.mobileBreakPoint).matches?(j.style.height="300",j.style.width=d.parent()[0].clientWidth):null==j.showLegend||"true"!=j.showLegend?(j.style.height=d.parent()[0].clientHeight,j.style.width=d.parent()[0].clientWidth):(j.style.height=d.parent()[0].clientHeight,j.style.width=d.parent()[0].clientWidth-d.find(".plotly-chart-legend").outerWidth(!0)-10,j.style.width<=0&&(j.style.width=d.parent()[0].clientWidth)),j.layout={title:"",font:{size:j.fontSize},radialaxis:{ticksuffix:"%"},orientation:270,width:j.style.width,height:j.style.height}},this.runMetricTransformation=function(){if("si"!=this.defaultMetricValue)var a=this.availableUnits.us,b=this.availableUnits.si;else var a=this.availableUnits.si,b=this.availableUnits.us;var c=getConversionFunction(a,b);if(this.plotCustomRanges)for(var d=0;d<this.plotCustomRanges.length;d++){var e=this.plotCustomRanges[d].lo,f=this.plotCustomRanges[d].hi;if("function"==typeof c){var g=c(e);this.plotCustomRanges[d].lo=Number.isInteger(parseFloat(g))?g:parseFloat(g).toFixed(2);var h=c(f);this.plotCustomRanges[d].hi=Number.isInteger(parseFloat(h))?h:parseFloat(h).toFixed(2)}}},this.$postLink=function(){null!=j.timeoutId&&e.cancel(j.timeoutId),j.timeoutId=e(j.resize,100),b.$watch(function(a){return a.$ctrl.retrievedData},function(a){j.retrievedData=a})},this.$onDestroy=function(){angular.element(c).off("resize",j.scheduleResize),console.log("destory wind rose"),j.msgTag&&g.unsubscribe(j.msgTag,null,b.$id),j.refreshTimer&&i.cancel(j.refreshTimer)},j.scheduleResize=function(){return null!=j.timeoutId&&e.cancel(j.timeoutId),j.timeoutId=e(j.resize,100)};var k=function(a){"wss"==a?g.onReady.then(function(){j.msgTag&&g.subscribe(j.msgTag,j.consumeData.bind(j),b.$id),j.api&&j._apiParams&&j._apiParams.streams&&j._apiParams.streams.length>=2?g.call(j.api,j._apiParams,j.msgTag).then(function(b,c){j.showSelectStream=!1,j.fetchDataInterval&&!j.refreshTimer&&(j.refreshTimer=i(function(){j.fetchPeriod&&"past_day"!=j.fetchPeriod?(j.delta=!1,"past_week"==j.fetchPeriod&&(j._apiParams[j.fetchFromDateParam]=moment().add(-7,"days").valueOf()),"past_month"==j.fetchPeriod&&(j._apiParams[j.fetchFromDateParam]=moment().add(-30,"days").valueOf())):(j.delta=!0,j.retrievedData&&j.latestRetrievedDataDate?j._apiParams[j.fetchFromDateParam]=j.latestRetrievedDataDate:j._apiParams[j.fetchFromDateParam]=moment().add(-1,"days").startOf("hour").valueOf()),k.bind(j)(a)},1e3*j.fetchDataInterval)),j.consumeData(b)},function(a){console.log("reject published promise",a),j.consumeData()}):j.buildWindRoseData()}):"https"==a&&j.api&&f.get(j.api,j._apiParams).then(function(a,b){j.consumeData(a)},function(a){console.log("reject published promise",a)})};this.consumeData=function(a,b){if(h.isEqual(this.retrievedData.data,this.staticData)&&(this.retrievedData=[]),"function"==typeof this.onFormatData()&&(a=this.onFormatData()(a)),a&&a.data&&a.data.length>0){if(this.fetchDataInterval&&this.fetchDataInterval>0&&this.retrievedData&&this.retrievedData.length>0&&this.delta)for(var c=0;c<a.data.length;c++)this.retrievedData[c].speeds=this.retrievedData[c].speeds.concat(a.data[c].speeds),this.retrievedData[c].dates=this.retrievedData[c].dates.concat(a.data[c].dates);else this.retrievedData=a.data;a.latestDate&&(this.latestRetrievedDataDate=a.latestDate),this.buildWindRoseData()}else this.api&&0==a.length&&(!this.retrievedData||this.retrievedData&&0==this.retrievedData.length)&&(this.retrievedData=[],this.noResults=!0)},this.buildWindRoseData=function(){var a=h.pluck(j.retrievedData,"speeds");j.totalSpeeds=0;for(var b=0;b<a.length;b++)j.totalSpeeds+=a[b].length;0==j.totalSpeeds?j.noResults=!0:j.noResults=!1,j.speedRangeDirectionObj={};for(var b=0;b<j.listOfMinRanges.length;b++)j.speedRangeDirectionObj[j.listOfMinRanges[b]+"-"+j.listOfMaxRanges[b]]=[];j.speedRangeDirectionObj[">="+j.maxRange]=[];for(var b=0;j.retrievedData&&b<j.retrievedData.length;b++){for(var c=j.retrievedData[b].direction,d=j.retrievedData[b].speeds,e=0;e<j.plotCustomRanges.length;e++){var f=this.plotCustomRanges[e],g=h.filter(d,function(a){return a>=f.lo&&a<f.hi}).length;j.speedRangeDirectionObj[j.plotCustomRanges[e].lo+"-"+j.plotCustomRanges[e].hi].push({direction:c,percentage:g/j.totalSpeeds*100})}var i=j.maxRange,k=h.filter(d,function(a){return a>=i}).length;j.speedRangeDirectionObj[">="+j.maxRange].push({direction:c,percentage:k/j.totalSpeeds*100})}for(var l=Object.keys(j.speedRangeDirectionObj),m=Object.keys(j.speedRangeDirectionObj)[0],n=(j.speedRangeDirectionObj[m],JSON.parse(JSON.stringify(j.speedRangeDirectionObj))[m]),b=0;b<l.length;b++){var o=l[b],p=j.speedRangeDirectionObj[o];if(o!=m){for(var e=0;e<p.length;e++)n[e].percentage=p[e].percentage+n[e].percentage,0!=p[e].percentage&&(p[e].percentage=n[e].percentage);j.speedRangeDirectionObj[o]=p}}j.data=[],l=Object.keys(j.speedRangeDirectionObj);for(var b=l.length-1;b>=0;b--){var q=h.pluck(j.speedRangeDirectionObj[l[b]],"percentage"),r=l[b],s=j.listOfColors[b],t={r:q,t:j.directions,name:r+" "+j.speedUnit,marker:{color:s},type:"area",showlegend:!1};j.data.push(t)}}}]}),angular.module("MenuLayout",["ui.bootstrap","ngAnimate","ngSanitize","ngCookies"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}]).component("menu",{bindings:{menuOpened:"<?",transport:"@",api:"@",msgTag:"@",apiParams:"<?",user:"<?"},templateUrl:"/UIComponents/layout/frontend/components/onsetmenu/menu.html",controller:["$scope","$window","httpClient","wsClient","$cookies",function(a,b,c,d,e){this.opened=!0,this.firstLoad=!0,this.webVersion=!0;var f=this;this.menuArray=[],this.cdnImagesPath=cdnImagesPath,this.changeIsCollapsed=function(b){a["isCollapsed"+b]=!a["isCollapsed"+b]},this.$onInit=function(){this.windowWidth=b.innerWidth,this.windowWidth>=992?this.webVersion=!0:this.webVersion=!1,this.webVersion||(this.opened=!1),this.initDataService(),a.$on("reload-menu",function(){f.initDataService()}),a.$watch(function(a){return f.menuOpened},function(a){f.webVersion?a?f.setMenuStateCookie("large"):f.setMenuStateCookie("small"):a?f.setMenuStateCookie("small"):f.setMenuStateCookie("hidden")})},this.logout=function(){c.get("app/api/users/revokeToken",{}).then(function(a,b){"success"==a.data.metadata.status&&($.removeCookie("token",{path:"/"}),
window.localStorage.removeItem("user"),window.localStorage.removeItem("dataMapping"),window.localStorage.removeItem("dataStream"),window.location=onsetLoginUrl+"/?action=logout")},function(a){})},this.openCloseChild=function(a){this.opened=!this.opened,this.firstLoad=!1,a.stopPropagation()},this.closeChild=function(a){this.opened=!1,this.firstLoad=!1,a.stopPropagation()},this.initDataService=function(){"wss"==this.transport?d.onReady.then(function(){f.msgTag&&d.subscribe(f.msgTag,f.consumeData.bind(f),a.$id),f.api&&d.call(f.api,f.apiParams,f.msgTag).then(function(a,b){f.consumeData(a)},function(a){f.consumeData()})}):"https"==this.transport&&this.api&&c.get(f.api,f.apiParams).then(function(a,b){f.consumeData(a)},function(a){})},this.consumeData=function(a,b){if(a){if(this.menuArray=a.menuArray,this.user=a.userName,this.logoLink=a.logoLink,this.helpLink=a.helpLink,this.preferredUnit=a.preferredUnit,null!=this.preferredUnit){var c=window.localStorage.user;c&&(c=JSON.parse(c),c.preferredUnit=this.preferredUnit,window.localStorage.setItem("user",JSON.stringify(c)))}this.prepareMenuParams()}},this.prepareMenuParams=function(){for(var b=0;b<this.menuArray.length;b++)a["isCollapsed"+b]=!0},this.triggerLogoClick=function(){null!=this.logoLink&&(window.location=onsetLoginUrl+this.logoLink)},angular.element(b).bind("resize",function(){a.$apply(function(){a.windowWidth=b.innerWidth,a.windowWidth>=992?(f.webVersion=!0,f.menuOpened?f.setMenuStateCookie("large"):f.setMenuStateCookie("small")):(f.webVersion=!1,f.menuOpened?f.setMenuStateCookie("small"):f.setMenuStateCookie("hidden"))})}),this.setMenuStateCookie=function(a){e.put("menuState",a,{path:"/",domain:".hobolink.com"})}}]}),angular.module("MenuLayout").component("headerTop",{bindings:{menuOpened:"="},templateUrl:"/UIComponents/layout/frontend/components/header/header.html",controller:["$scope",function(a){this.cdnImagesPath=cdnImagesPath,this.$onInit=function(){if(window.localStorage.user){var a=JSON.parse(window.localStorage.user);this.systemStatus=a.systemStatus,this.systemMessage=a.systemMessage,this.banner_message=a.bannerMessage}},this.getGoogleTranslate=function(){new google.translate.TranslateElement({pageLanguage:"en",includedLanguages:"en,ja,ko",layout:google.translate.TranslateElement.InlineLayout.SIMPLE,autoDisplay:!1},"google_translate_element")},this.openCloseNav=function(){this.menuOpened=!this.menuOpened}}]});var underscore=angular.module("underscore",[]);underscore.factory("_",["$window",function(a){return a._}]),angular.module("DashboardBuilder",["underscore","schemaForm","ACL","Grid","Message","xeditable","ui.bootstrap","ngRoute","slickCarousel","ngAnimate","ngSanitize","WsClient","HttpClient","Chart","gridster","DashboardBuilder","Gauge","Speedometer","Odometer","SearchBox","ngMaterial","ngMessages","material.svgAssetsCache","Thermometer","angularSpectrumColorpicker","angular-underscore/filters","pascalprecht.translate","ui.select","ui.codemirror","Display","Dygraphs","plotly","ngSchemaFormFile","mgcrea.ngStrap","mgcrea.ngStrap.modal","mgcrea.ngStrap.select","MenuLayout","ToggleSwitch","ngclipboard","hl.sticky"]),angular.module("DashboardBuilder").constant("calculatedChannelsConfig",{name:"calculatedChannel",label:"Calculated Channels",show:!0,defaults:{},form:[{type:"section",htmlClass:"row",title:"Calculated Channel",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"calculatedChannelName",title:"Set channel label as",type:"string",placeholder:" "}]}]},{type:"section",htmlClass:"row",title:"Calculated Channel Formula",placeholder:" ",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"calculatedChannelFormula",type:"uiselect",placeholder:" ",options:{closeOnSelect:!0,callback:"loadCalculatedChannelFormulasCallback"},onFieldLoad:"onCalculatedChannelFormulaLoad(modelValue, form, model);",onChange:"changeCalculatedChannelType(modelValue, form, model);"}]}]},{type:"section",htmlClass:"row",title:"variables",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"rainfallrain",htmlClass:"col-md-3",title:"Accumulated Rainfall",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_streams.indexOf('rainfallrain') > -1",placeholder:"Set rain channel",type:"uiselect",onChange:function(a,b,c){c.calculatedChannelParent=a},options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"Rain"}},{key:"ETtemperature",htmlClass:"col-xs-6",title:"Temperature",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},onChange:function(a,b,c){c.calculatedChannelParent=a},condition:"model.formula_streams.indexOf('ETtemperature') > -1",placeholder:"Set temperature channel",type:"uiselect",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"Temperature"}},{key:"ETRH",htmlClass:"col-xs-6",title:"Relative Humidity",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_streams.indexOf('ETRH') > -1",placeholder:"Set relative humidity channel",type:"uiselect",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"RH"}},{key:"ETRn",htmlClass:"col-xs-6",title:"Solar Radiation",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_streams.indexOf('ETRn') > -1",placeholder:"Set solar radiation channel",type:"uiselect",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"Solar Radiation"}},{key:"dpTemperature",htmlClass:"col-xs-6",title:"Temperature",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_streams.indexOf('dpTemperature') > -1",placeholder:"Set temperature channel",type:"uiselect",onChange:function(a,b,c){c.calculatedChannelParent=a},options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"Temperature"}},{key:"ETwindSpeed",htmlClass:"col-xs-6",title:"Wind Speed",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_streams.indexOf('ETwindSpeed') > -1",placeholder:"Set wind speed channel",type:"uiselect",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"Wind Speed"}},{key:"rainfallTimeframe",type:"uiselect",title:"Time frame",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_userInputs.indexOf('rainfallTimeframe') > -1",placeholder:"Select time frame",titleMap:[{value:"hour",name:"Hourly"},{value:"day",name:"Daily"},{value:"week",name:"Weekly"},{value:"month",name:"Monthly"}]},{key:"ETtimeframe",type:"uiselect",title:"Time frame",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_userInputs.indexOf('ETtimeframe') > -1",placeholder:"Select time frame",titleMap:[{value:"hour",name:"Hourly"},{value:"day",name:"Daily"}]}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"ETLatitude",type:"number",title:"Latitude",onFieldLoad:function(a,b,c){c.key&&(b.readonly=!0)},condition:"model.formula_userInputs.indexOf('ETLatitude') > -1",placeholder:"Enter a value between -90.0 and 90.0 degrees"},{key:"ETLongitude",type:"number",title:"Longitude",onFieldLoad:function(a,b,c){c.key&&(b.readonly=!0)},condition:"model.formula_userInputs.indexOf('ETLongitude') > -1",placeholder:"Enter a value between -180.0 and 180.0 degrees"},{key:"ETElevation",type:"number",title:"Elevation",onFieldLoad:function(a,b,c){c.key&&(b.readonly=!0)},condition:"model.formula_userInputs.indexOf('ETElevation') > -1",placeholder:"Enter a value in meters"},{key:"dpRelativeHumidity",htmlClass:"col-xs-6",title:"RH",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_streams.indexOf('dpRelativeHumidity') > -1",placeholder:"Set RH channel",type:"uiselect",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"calculatedChannel",widgetField:"RH"}},{key:"timezone",type:"uiselect",title:"Time zone",onFieldLoad:function(a,b,c){c.key&&(b.disabled=!0)},condition:"model.formula_userInputs.indexOf('timezone') > -1",placeholder:"Select timezone",titleMap:[{value:"UTC",name:"UTC"},{value:"America/New_York",name:"USA & Canada, Eastern Time"},{value:"America/Indiana/Indianapolis",name:"USA, Indiana (East)"},{value:"America/Chicago",name:"USA & Canada, Central Time"},{value:"America/Denver",name:"USA & Canada, Mountain Time"},{value:"America/Phoenix",name:"USA, Arizona"},{value:"America/Los_Angeles",name:"USA & Canada, Pacific Time"},{value:"America/Juneau",name:"USA, Alaska"},{value:"Pacific/Honolulu",name:"USA, Hawaii"},{value:"America/Argentina/Buenos_Aires",name:"Argentina, Buenos Aires"},{value:"Asia/Yerevan",name:"Armenia, Yerevan"},{value:"Australia/Brisbane",name:"Australia, Brisbane"},{value:"Australia/Hobart",name:"Australia, Hobart"},{value:"Australia/Melbourne",name:"Australia, Melbourne"},{value:"Australia/Perth",name:"Australia, Perth"},{value:"Australia/Sydney",name:"Australia, Sydney"},{value:"Europe/Vienna",name:"Austria, Vienna"},{value:"Asia/Baku",name:"Azerbaijan, Baku"},{value:"Atlantic/Azores",name:"Azores"},{value:"Asia/Dhaka",name:"Bangladesh, Dhaka"},{value:"Europe/Minsk",name:"Belarus, Minsk"},{value:"Europe/Brussels",name:"Belgium, Brussels"},{value:"America/La_Paz",name:"Bolivia, La Paz"},{value:"Europe/Sarajevo",name:"Bosnia & Herzegovina, Sarajevo"},{value:"Europe/Sofia",name:"Bulgaria, Sofia"},{value:"America/Halifax",name:"Canada, Atlantic Time"},{value:"America/Regina",name:"Canada, Saskatchewan"},{value:"Atlantic/Cape_Verde",name:"Cape Verde Islands"},{value:"America/Guatemala",name:"Central America"},{value:"America/Santiago",name:"Chile, Santiago"},{value:"Asia/Shanghai",name:"China, Beijing"},{value:"Asia/Chongqing",name:"China, Chongqing"},{value:"Asia/Hong_Kong",name:"China, Hong Kong"},{value:"Asia/Taipei",name:"China, Taipei"},{value:"Asia/Urumqi",name:"China, Urumqi"},{value:"America/Bogota",name:"Colombia, Bogota"},{value:"Europe/Zagreb",name:"Croatia, Zagreb"},{value:"Europe/Prague",name:"Czech Republic, Prague"},{value:"Europe/Copenhagen",name:"Denmark, Copenhagen"},{value:"Africa/Cairo",name:"Egypt, Cairo"},{value:"Europe/Tallinn",name:"Estonia, Tallinn"},{value:"Pacific/Fiji",name:"Fiji"},{value:"Europe/Helsinki",name:"Finland, Helsinki"},{value:"Europe/Paris",name:"France, Paris"},{value:"Asia/Tbilisi",name:"Georgia, Tbilisi"},{value:"Europe/Berlin",name:"Germany, Berlin"},{value:"Europe/Athens",name:"Greece, Athens"},{value:"America/Godthab",name:"Greenland"},{value:"Pacific/Guam",name:"Guam"},{value:"America/Guyana",name:"Guyana, Georgetown"},{value:"Europe/Budapest",name:"Hungary, Budapest"},{value:"Asia/Jakarta",name:"Indonesia, Jakarta"},{value:"Asia/Baghdad",name:"Iraq, Baghdad"},{value:"Europe/Dublin",name:"Ireland, Dublin"},{value:"Asia/Jerusalem",name:"Israel, Jerusalem"},{value:"Europe/Rome",name:"Italy, Rome"},{value:"Asia/Tokyo",name:"Japan, Tokyo"},{value:"Asia/Almaty",name:"Kazakhstan, Almaty"},{value:"Africa/Nairobi",name:"Kenya, Nairobi"},{value:"Asia/Seoul",name:"Korea, Seoul"},{value:"Asia/Kuwait",name:"Kuwait"},{value:"Europe/Riga",name:"Latvia, Riga"},{value:"Africa/Monrovia",name:"Liberia, Monrovia"},{value:"Europe/Vilnius",name:"Lithuania, Vilnius"},{value:"Europe/Skopje",name:"Macedonia, Skopje"},{value:"Asia/Kuala_Lumpur",name:"Malaysia, Kuala Lumpur"},{value:"Pacific/Majuro",name:"Marshall Islands"},{value:"America/Chihuahua",name:"Mexico, Chihuahua"},{value:"America/Mazatlan",name:"Mexico, Mazatlan"},{value:"America/Mexico_City",name:"Mexico, Mexico City"},{value:"America/Monterrey",name:"Mexico, Monterrey"},{value:"America/Tijuana",name:"Mexico, Tijuana"},{value:"Atlantic/South_Georgia",name:"Mid-Atlantic"},{value:"Pacific/Midway",name:"Midway Island"},{value:"Asia/Ulaanbaatar",name:"Mongolia, Ulaan Bataar"},{value:"Africa/Casablanca",name:"Morocco, Casablanca"},{value:"Europe/Amsterdam",name:"The Netherlands, Amsterdam"},{value:"Pacific/Noumea",name:"New Caledonia"},{value:"Pacific/Auckland",name:"New Zealand, Auckland"},{value:"Asia/Muscat",name:"Oman, Muscat"},{value:"Pacific/Port_Moresby",name:"Papua New Guinea, Port Moresby"},{value:"Asia/Karachi",name:"Pakistan, Karachi"},{value:"America/Lima",name:"Peru, Lima"},{value:"Europe/Warsaw",name:"Poland, Warsaw"},{value:"Europe/Lisbon",name:"Portugal, Lisbon"},{value:"Europe/Bucharest",name:"Romania, Bucharest"},{value:"Asia/Yekaterinburg",name:"Russia, Ekaterinburg"},{value:"Asia/Kamchatka",name:"Russia, Kamchatka"},{value:"Asia/Magadan",name:"Russia, Magadan"},{value:"Europe/Moscow",name:"Russia, Moscow"},{value:"Asia/Novosibirsk",name:"Russia, Novosibirsk"},{value:"Asia/Vladivostok",name:"Russia, Vladivostok"},{value:"Asia/Yakutsk",name:"Russia, Yakutsk"},{value:"Pacific/Pago_Pago",name:"Samoa"},{value:"Asia/Riyadh",name:"Saudi Arabia, Riyadh"},{value:"Europe/Belgrade",name:"Serbia, Belgrade"},{value:"Asia/Irkutsk",name:"Siberia, Irkutsk"},{value:"Asia/Krasnoyarsk",name:"Siberia, Krasnoyarsk"},{value:"Asia/Singapore",name:"Singapore"},{value:"Europe/Bratislava",name:"Slovakia, Bratislava"},{value:"Europe/Ljubljana",name:"Slovenia, Ljubljana"},{value:"Africa/Johannesburg",name:"South Africa, Pretoria"},{value:"Europe/Madrid",name:"Spain, Madrid"},{value:"Europe/Stockholm",name:"Sweden, Stockholm"},{value:"Asia/Bangkok",name:"Thailand, Bangkok"},{value:"Pacific/Tongatapu",name:"Tonga, Nuku'alofa"},{value:"Europe/Istanbul",name:"Turkey, Istanbul"},{value:"Europe/Kiev",name:"Ukraine, Kyev"},{value:"Europe/London",name:"United Kingdom, London"},{value:"Asia/Tashkent",name:"Uzbekistan, Tashkent"},{value:"America/Caracas",name:"Venezuela, Caracas"},{value:"Africa/Algiers",name:"West Central Africa"},{value:"Africa/Harare",name:"Zimbabwe, Harare"},{value:"Etc/GMT+12",name:"GMT-12:00"},{value:"Etc/GMT+11",name:"GMT-11:00"},{value:"Etc/GMT+10",name:"GMT-10:00"},{value:"Etc/GMT+9",name:"GMT-09:00"},{value:"Etc/GMT+8",name:"GMT-08:00"},{value:"Etc/GMT+7",name:"GMT-07:00"},{value:"Etc/GMT+6",name:"GMT-06:00"},{value:"Etc/GMT+5",name:"GMT-05:00"},{value:"Etc/GMT+4",name:"GMT-04:00"},{value:"Etc/GMT+3",name:"GMT-03:00"},{value:"Etc/GMT+2",name:"GMT-02:00"},{value:"Etc/GMT+1",name:"GMT-01:00"},{value:"Etc/GMT",name:"GMT+00:00"},{value:"Etc/GMT-1",name:"GMT+01:00"},{value:"Etc/GMT-2",name:"GMT+02:00"},{value:"Etc/GMT-3",name:"GMT+03:00"},{value:"Etc/GMT-4",name:"GMT+04:00"},{value:"Etc/GMT-5",name:"GMT+05:00"},{value:"Etc/GMT-6",name:"GMT+06:00"},{value:"Etc/GMT-7",name:"GMT+07:00"},{value:"Etc/GMT-8",name:"GMT+08:00"},{value:"Etc/GMT-9",name:"GMT+09:00"},{value:"Etc/GMT-10",name:"GMT+10:00"},{value:"Etc/GMT-11",name:"GMT+11:00"},{value:"Etc/GMT-12",name:"GMT+12:00"},{value:"Etc/GMT-13",name:"GMT+13:00"},{value:"Etc/GMT-14",name:"GMT+14:00"}]}]}]}],schema:{type:"object",title:"Schema",properties:{calculatedChannelParent:{title:"Stream parent",type:"hidden"},archived:{title:"archived",type:"hidden"},calculatedChannelFormula:{title:"Select Formula",type:"string",description:"",placeholder:" ",validationMessage:"Required."},ETElevation:{title:"Elevation",type:"number",default:0,validationMessage:"Required.",description:"Define your widget number font size."},ETtemperature:{title:"Temperature DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},dpTemperature:{title:"Temperature DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},dpRelativeHumidity:{title:"Relative Humidity DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},ETRn:{title:"Radiation DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},ETwindSpeed:{title:"Wind Speed DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},ETRH:{title:"ET-0 Relative Humidity DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},rainfallrain:{title:"Rainfall Rain DataStream",type:"string",validationMessage:"Required.",description:"",placeholder:" "},ETLatitude:{title:"Latitude",type:"number",validationMessage:"Required. Must be between -90.0 and 90.0 degrees.",description:"",minimum:-90,maximum:90},ETLongitude:{title:"Longitude",type:"number",validationMessage:"Required. Must be between -180.0 and 180.0 degrees.",description:"",minimum:-180,maximum:180},ETElevation:{title:"Elevation",type:"number",validationMessage:"Required.",description:""},timezone:{title:"TimeZone",type:"string",validationMessage:"Required.",description:""},ETtimeframe:{title:"ET-0 Timeframe",type:"string",validationMessage:"Required.",description:""},rainfallTimeframe:{title:"Rainfall Timeframe",type:"string",validationMessage:"Required.",description:""},dpTimeframe:{title:"Dew Point Timeframe",type:"string",validationMessage:"Required.",description:""},calculatedChannelName:{title:"Calculated Channel Name",type:"string",description:"",maxLength:30,validationMessage:{201:"Maximum number of characters allowed is 30."}}},required:["calculatedChannelFormula","ETtemperature","dpTemperature","dpRelativeHumidity","ETRn","ETwindSpeed","ETRH","rainfallrain","ETtimeframe","ETLatitude","ETLongitude","ETElevation","timezone","rainfallTimeframe","dpTimeframe","calculatedChannelName"]}}),angular.module("DashboardBuilder").component("calculatedChannel",{bindings:{resolve:"<",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/calculatedChannel.html",controller:["$rootScope","$scope","httpClient","$q","$http","calculatedChannelsConfig","scriptrService",function(a,b,c,d,e,f,g){var h=this;this.isSaving=!1,b.multiSelectCallBack=function(b,c){return a.multiSelectCallBack(b,c)},b.loadCalculatedChannelFormulasCallback=function(a,b){return JSON.parse(window.localStorage.calculatedChannelformulaMapping)},b.changeCalculatedChannelType=function(a,b,c){for(var d=0;d<b.titleMap.length;d++){var e=b.titleMap[d];if(e.value==a){var f=e.value.replace("'","");f=f.replace("'",""),c.formula_streams=JSON.parse(window.localStorage.calculatedChannelFieldConfig)[f].streamsFields,c.formula_userInputs=JSON.parse(window.localStorage.calculatedChannelFieldConfig)[f].userInputsFields}}h.descriptionMessage="'1'"==a?"*Please allow up to an hour for Hourly ET and after midnight for Daily ET to populate under Devices.":"*Please allow up to 10 minutes for this new calculated channel to populate under Devices."},b.onCalculatedChannelFormulaLoad=function(a,b,c){if(c.key)b.disabled=!0;else for(var d=JSON.parse(window.localStorage.calculatedChannelformulaMapping),e=0;e<d.length;e++){var f=d[e];if(f.value==c.calculatedChannelFormula){var g=f.value.replace("'","");g=g.replace("'",""),c.formula_streams=JSON.parse(window.localStorage.calculatedChannelFieldConfig)[g].streamsFields,c.formula_userInputs=JSON.parse(window.localStorage.calculatedChannelFieldConfig)[g].userInputsFields}}"'1'"==c.calculatedChannelFormula?h.descriptionMessage="*Please allow up to an hour for Hourly ET and after midnight for Daily ET to populate under Devices.":h.descriptionMessage="*Please allow up to 10 minutes for this new calculated channel to populate under Devices."},this.$onInit=function(){if(this.model=this.resolve.model,b.$broadcast("schemaFormRedraw"),this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!1}},f.schema){this.schema=angular.copy(f.schema);for(var a=JSON.parse(window.localStorage.calculatedChannelformulaMapping),c=0;c<a.length;c++){var d=a[c];if("true"==d.is_default){this.schema.properties.calculatedChannelFormula.default=d.value;break}}}f.form&&(this.form=angular.copy(f.form)),f.label&&(this.label=angular.copy(f.label)),this.model=this.model?this.model:{}},this.saveCalculatedChannel=function(a){var c=this;if(b.$broadcast("schemaFormValidate"),a&&a.$valid){var e={};this.model.key&&(e.key=this.model.key);var f=this.model.calculatedChannelFormula.replace("'",""),f=parseInt(f);e.calculatedChannelFormula=f,e.calculatedChannelName=this.model.calculatedChannelName,e.calculatedChannelParent=this.model.calculatedChannelParent;var h={},h=angular.copy(this.model);delete h.calculatedChannelName,delete h.calculatedChannelFormula,e.formula_data=JSON.stringify(h),e.key&&(e.update=!0);var i=new FormData;for(var j in e)i.append(j,e[j]);var k=d.defer();return g.saveCalculatedChannel(i).then(function(a,b){"failure"==a.status?(c.isSaving=!1,"CALCULATED_CHANNEL_ALREADY_EXISTS"==a.errorCode?c.showAlert("danger",a.errorDetail,a.statusCode):c.showAlert("danger","The Calculated Channel could not be saved. Please try again")):"success"==a.status&&(c.showAlert("success","The Calculated Channel is saved successfully."),c.close({$value:c.model}))},function(a){c.isSaving=!1,c.hideLoadingModalInstance(),c.showAlert("danger",a.data.response.metadata.errorDetail,a.data.response.metadata.statusCode),console.log("reject",a.data.response.metadata.errorDetail),k.reject(a)}),k.promise}c.isSaving=!1},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b,c){"401"!=c&&"429"!=c&&(this.closeAlert(),this.message={type:a,content:b},this.show=!0)},this.onSubmit=function(a){this.isSaving=!0,b.$broadcast("schemaFormValidate"),a.$valid?this.saveCalculatedChannel(a):this.isSaving=!1},this.onCancel=function(a){this.schema={},this.form={},this.model=angular.copy(f.defaults),this.dismiss({$value:"cancel"})}}]}),angular.module("DashboardBuilder").constant("alarmsConfig",{form:[{type:"tabs",tabs:[{title:"Format",items:[{type:"section",htmlClass:"col-xs-12 row",items:[{key:"number-text-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"number-background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-12 row",items:[{key:"message-text-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"message-background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]}]}],schema:{type:"object",title:"Schema",properties:{"widget-layout":{title:"Layout",type:"string",default:"horizontal",placeholder:" ",description:"Define your widget's layout."},"number-cell-size":{title:"Numbers Cell Size",type:"string",default:"medium",placeholder:" ",description:"Define your widget's numbers cell size."},message:{title:"Message",type:"string",default:"Items",description:"Define your widget message."},"number-font-family":{title:"Number Font family",type:"string",description:"Define your widget number font family.",default:"Arial",placeholder:" "},"message-font-family":{title:"Message Font family",type:"string",description:"Define your widget message font family.",default:"Arial",placeholder:" "},"number-font-size":{title:"Number Font Size",type:"number",default:42,description:"Define your widget number font size."},"message-font-size":{title:"Message Font Size",type:"number",default:18,description:"Define your widget message font size."},"number-font-weight":{title:"Number Font Weight",type:"number",default:600,description:"Define your widget number font weight."},"message-font-weight":{title:"Message Font Weight",type:"number",default:600,description:"Define your widget message font weight."},"number-text-color":{title:"Number Text Color",type:"string",description:"",format:"color",default:"#ffffff",validationMessage:"Invalid Color"},"message-text-color":{title:"Message Text Color",type:"string",description:"",format:"color",default:"#686868",validationMessage:"Invalid Color"},"number-background-color":{title:"Number Background Color",type:"string",description:"",format:"color",default:"#005588",validationMessage:"Invalid Color"},"message-background-color":{title:"Message Background Color",type:"string",description:"",format:"color",default:"white",validationMessage:"Invalid Color"},"message-Text-Alignment":{title:"Message Text Alignment",type:"string",default:"center",placeholder:" ",description:"Define your widget message text alignment."},"number-Text-Alignment":{title:"Number Text Alignment",type:"string",default:"center",placeholder:" ",description:"Define your widget number text alignment."},"border-size":{title:"Border Weight",type:"number",default:1,description:"Define your widget border weight."},"border-color":{title:"Border Color",type:"string",description:"Define your widget border color.",format:"color",default:"#d7d7d7",validationMessage:"Invalid Color"},data:{title:"Count",type:"string",description:"Count to display."}},required:[]}}),angular.module("DashboardBuilder").constant("common",{formTab:{title:"Data",hidden:!0,items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"transport",notitle:!1,type:"strapselect",titleMap:[{value:"wss",name:"wss"},{value:"https",name:"https"}]}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"msg-tag",condition:"model.transport=='wss'"},{key:"http-method",notitle:!1,type:"strapselect",titleMap:[{value:"GET",name:"GET"}],condition:"model.transport=='https'"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"api",condition:"model.stream.length > 0 "}]},{type:"section",htmlClass:"col-xs-6",items:["api-params"]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"data-type"},{key:"data-format"},{key:"schema-for"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"columns-definition",condition:"model['schema-for'] == 'grid'"},{key:"row-data",condition:"model['schema-for'] == 'grid'"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"data"},{key:"on-format-data",type:"codemirror",codemirrorOptions:{value:"return",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,matchBrackets:!0,theme:"neo",mode:"javascript",readOnly:!1,autoRefresh:!0}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"help",helpvalue:"<hr>"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"help",helpvalue:'<div class="alert alert-info"><ul><li>Messages published over the subscibe channel need to have the following format in order to be consumed by a widget:<ul><li>{“id”: “&lt;message tag value&gt;”, “result”: “&lt;static data structure&gt;”}</li></ul></li><li>A script would publish a message  over the subscribe channel as follow:<ul><li>publish(“responseChannel”, {“id”: “&lt;message tag value&gt;”, “result”: “&lt;static data structure&gt;”});</li></ul></li><li>Whether https or wss transport is used, Sciptr API should return the static data structure for widget initial load:<ul><li>return &lt;static data structure&gt;;</li></ul></li></ul></div>'}]}]}]},schemaFields:{api:{title:"Api",type:"string",description:"Name of the scriptr api (script name) responsible for publishing or returning the widget data.",default:"app/api/dashboard/GetUserData"},"api-params":{title:"Api params",type:"string",description:"A JSON formatted object containing the parameters to be sent to the scriptr api.","x-schema-form":{type:"textarea",placeholder:"Ex: {'id' : '599865'}"}},"http-method":{title:"Http method",type:"string",description:"Method to be used when calling the scriptr api over https. Default: GET.",default:"GET",placeholder:" "},transport:{title:"Transport",type:"string",description:"Protocol used to call the  scriptr api. Use wss for real time communication whenever your widget needs to update its data live by consuming messages published from scriptr over the subscribe channel defined in settings.",placeholder:""},"msg-tag":{title:"Message tag",type:"string",description:"The dashboard widgets consume messages published over the subscribe channel defined in dashboard settings. Message tag is an identifier sent as part of the published message. The widget uses it to know which messages to consume or ignore."},"on-format-data":{title:"Format data",default:"return data;",type:"string",description:"Callback function to be called after data is returned from backend."},"data-type":{title:"Data Type",type:"string",description:"Set the data type if raw, aggregate, latest.",enum:["raw","aggregate","latest"]},"aggregation-range":{title:"Aggregation Range",type:"string",description:"Select the aggregation data range.",default:"10"},"data-format":{title:"Data Format",type:"string",enum:["dygraphs","grid","live","morris","windrose"]},"schema-for":{title:"Widget Class",type:"string",enum:["line","bar","area","donut","gauge","grid","thermometer","odometer","displaycount","windrose"]},"available-units":{title:"Main Stream Units",type:"string"},"is-scaled":{title:"Main Stream Scaled Check",type:"string",default:"false"}}}),angular.module("DashboardBuilder").constant("config",{script:{form:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-md-1 file-attachment",items:[{key:"image",type:"nwpFileUpload",i18n:{add:"Open file browser",preview:"Preview Upload",filename:"File Name",progress:"Progress Status",upload:"Upload",dragorclick:"Drag and drop your file here or click here"},notitle:!0}]},{type:"section",htmlClass:"col-xs-12 col-md-4",items:[{key:"dashboardName",notitle:!0,placeholder:"Dashboard Name"}]},{type:"section",htmlClass:"col-xs-12 col-md-2 period-select-box",items:[{key:"period",type:"strapselect",notitle:!0,placeholder:"Period",titleMap:[{value:"past_day",name:"Past day"},{value:"past_week",name:"Past week"},{value:"past_month",name:"Past month"}],onChange:"changeDisplayPeriod(modelValue, form);"}]},{type:"section",htmlClass:"col-xs-12 col-md-2 unit-select-box",items:[{key:"unit",notitle:!0,placeholder:"Unit",type:"strapselect",titleMap:[{value:"si",name:"SI units"},{value:"us",name:"US units"}],onChange:"changeDisplayMetric(modelValue, form);"}]},{type:"section",htmlClass:"col-xs-12 col-md-3 pdl0 time-select-box",items:[{key:"timeZone",notitle:!0,placeholder:"Time Zone",type:"strapselect",titleMap:[{value:"UTC",name:"UTC"},{value:"America/New_York",name:"USA & Canada, Eastern Time"},{value:"America/Indiana/Indianapolis",name:"USA, Indiana (East)"},{value:"America/Chicago",name:"USA & Canada, Central Time"},{value:"America/Denver",name:"USA & Canada, Mountain Time"},{value:"America/Phoenix",name:"USA, Arizona"},{value:"America/Los_Angeles",name:"USA & Canada, Pacific Time"},{value:"America/Juneau",name:"USA, Alaska"},{value:"Pacific/Honolulu",name:"USA, Hawaii"},{value:"America/Argentina/Buenos_Aires",name:"Argentina, Buenos Aires"},{value:"Asia/Yerevan",name:"Armenia, Yerevan"},{value:"Australia/Brisbane",name:"Australia, Brisbane"},{value:"Australia/Hobart",name:"Australia, Hobart"},{value:"Australia/Melbourne",name:"Australia, Melbourne"},{value:"Australia/Perth",name:"Australia, Perth"},{value:"Australia/Sydney",name:"Australia, Sydney"},{value:"Europe/Vienna",name:"Austria, Vienna"},{value:"Asia/Baku",name:"Azerbaijan, Baku"},{value:"Atlantic/Azores",name:"Azores"},{value:"Asia/Dhaka",name:"Bangladesh, Dhaka"},{value:"Europe/Minsk",name:"Belarus, Minsk"},{value:"Europe/Brussels",name:"Belgium, Brussels"},{value:"America/La_Paz",name:"Bolivia, La Paz"},{value:"Europe/Sarajevo",name:"Bosnia & Herzegovina, Sarajevo"},{value:"Europe/Sofia",name:"Bulgaria, Sofia"},{value:"America/Halifax",name:"Canada, Atlantic Time"},{
value:"America/Regina",name:"Canada, Saskatchewan"},{value:"Atlantic/Cape_Verde",name:"Cape Verde Islands"},{value:"America/Guatemala",name:"Central America"},{value:"America/Santiago",name:"Chile, Santiago"},{value:"Asia/Shanghai",name:"China, Beijing"},{value:"Asia/Chongqing",name:"China, Chongqing"},{value:"Asia/Hong_Kong",name:"China, Hong Kong"},{value:"Asia/Taipei",name:"China, Taipei"},{value:"Asia/Urumqi",name:"China, Urumqi"},{value:"America/Bogota",name:"Colombia, Bogota"},{value:"Europe/Zagreb",name:"Croatia, Zagreb"},{value:"Europe/Prague",name:"Czech Republic, Prague"},{value:"Europe/Copenhagen",name:"Denmark, Copenhagen"},{value:"Africa/Cairo",name:"Egypt, Cairo"},{value:"Europe/Tallinn",name:"Estonia, Tallinn"},{value:"Pacific/Fiji",name:"Fiji"},{value:"Europe/Helsinki",name:"Finland, Helsinki"},{value:"Europe/Paris",name:"France, Paris"},{value:"Asia/Tbilisi",name:"Georgia, Tbilisi"},{value:"Europe/Berlin",name:"Germany, Berlin"},{value:"Europe/Athens",name:"Greece, Athens"},{value:"America/Godthab",name:"Greenland"},{value:"Pacific/Guam",name:"Guam"},{value:"America/Guyana",name:"Guyana, Georgetown"},{value:"Europe/Budapest",name:"Hungary, Budapest"},{value:"Asia/Jakarta",name:"Indonesia, Jakarta"},{value:"Asia/Baghdad",name:"Iraq, Baghdad"},{value:"Europe/Dublin",name:"Ireland, Dublin"},{value:"Asia/Jerusalem",name:"Israel, Jerusalem"},{value:"Europe/Rome",name:"Italy, Rome"},{value:"Asia/Tokyo",name:"Japan, Tokyo"},{value:"Asia/Almaty",name:"Kazakhstan, Almaty"},{value:"Africa/Nairobi",name:"Kenya, Nairobi"},{value:"Asia/Seoul",name:"Korea, Seoul"},{value:"Asia/Kuwait",name:"Kuwait"},{value:"Europe/Riga",name:"Latvia, Riga"},{value:"Africa/Monrovia",name:"Liberia, Monrovia"},{value:"Europe/Vilnius",name:"Lithuania, Vilnius"},{value:"Europe/Skopje",name:"Macedonia, Skopje"},{value:"Asia/Kuala_Lumpur",name:"Malaysia, Kuala Lumpur"},{value:"Pacific/Majuro",name:"Marshall Islands"},{value:"America/Chihuahua",name:"Mexico, Chihuahua"},{value:"America/Mazatlan",name:"Mexico, Mazatlan"},{value:"America/Mexico_City",name:"Mexico, Mexico City"},{value:"America/Monterrey",name:"Mexico, Monterrey"},{value:"America/Tijuana",name:"Mexico, Tijuana"},{value:"Atlantic/South_Georgia",name:"Mid-Atlantic"},{value:"Pacific/Midway",name:"Midway Island"},{value:"Asia/Ulaanbaatar",name:"Mongolia, Ulaan Bataar"},{value:"Africa/Casablanca",name:"Morocco, Casablanca"},{value:"Europe/Amsterdam",name:"The Netherlands, Amsterdam"},{value:"Pacific/Noumea",name:"New Caledonia"},{value:"Pacific/Auckland",name:"New Zealand, Auckland"},{value:"Asia/Muscat",name:"Oman, Muscat"},{value:"Pacific/Port_Moresby",name:"Papua New Guinea, Port Moresby"},{value:"Asia/Karachi",name:"Pakistan, Karachi"},{value:"America/Lima",name:"Peru, Lima"},{value:"Europe/Warsaw",name:"Poland, Warsaw"},{value:"Europe/Lisbon",name:"Portugal, Lisbon"},{value:"Europe/Bucharest",name:"Romania, Bucharest"},{value:"Asia/Yekaterinburg",name:"Russia, Ekaterinburg"},{value:"Asia/Kamchatka",name:"Russia, Kamchatka"},{value:"Asia/Magadan",name:"Russia, Magadan"},{value:"Europe/Moscow",name:"Russia, Moscow"},{value:"Asia/Novosibirsk",name:"Russia, Novosibirsk"},{value:"Asia/Vladivostok",name:"Russia, Vladivostok"},{value:"Asia/Yakutsk",name:"Russia, Yakutsk"},{value:"Pacific/Pago_Pago",name:"Samoa"},{value:"Asia/Riyadh",name:"Saudi Arabia, Riyadh"},{value:"Europe/Belgrade",name:"Serbia, Belgrade"},{value:"Asia/Irkutsk",name:"Siberia, Irkutsk"},{value:"Asia/Krasnoyarsk",name:"Siberia, Krasnoyarsk"},{value:"Asia/Singapore",name:"Singapore"},{value:"Europe/Bratislava",name:"Slovakia, Bratislava"},{value:"Europe/Ljubljana",name:"Slovenia, Ljubljana"},{value:"Africa/Johannesburg",name:"South Africa, Pretoria"},{value:"Europe/Madrid",name:"Spain, Madrid"},{value:"Europe/Stockholm",name:"Sweden, Stockholm"},{value:"Asia/Bangkok",name:"Thailand, Bangkok"},{value:"Pacific/Tongatapu",name:"Tonga, Nuku'alofa"},{value:"Europe/Istanbul",name:"Turkey, Istanbul"},{value:"Europe/Kiev",name:"Ukraine, Kyev"},{value:"Europe/London",name:"United Kingdom, London"},{value:"Asia/Tashkent",name:"Uzbekistan, Tashkent"},{value:"America/Caracas",name:"Venezuela, Caracas"},{value:"Africa/Algiers",name:"West Central Africa"},{value:"Africa/Harare",name:"Zimbabwe, Harare"},{value:"Etc/GMT+12",name:"GMT-12:00"},{value:"Etc/GMT+11",name:"GMT-11:00"},{value:"Etc/GMT+10",name:"GMT-10:00"},{value:"Etc/GMT+9",name:"GMT-09:00"},{value:"Etc/GMT+8",name:"GMT-08:00"},{value:"Etc/GMT+7",name:"GMT-07:00"},{value:"Etc/GMT+6",name:"GMT-06:00"},{value:"Etc/GMT+5",name:"GMT-05:00"},{value:"Etc/GMT+4",name:"GMT-04:00"},{value:"Etc/GMT+3",name:"GMT-03:00"},{value:"Etc/GMT+2",name:"GMT-02:00"},{value:"Etc/GMT+1",name:"GMT-01:00"},{value:"Etc/GMT",name:"GMT+00:00"},{value:"Etc/GMT-1",name:"GMT+01:00"},{value:"Etc/GMT-2",name:"GMT+02:00"},{value:"Etc/GMT-3",name:"GMT+03:00"},{value:"Etc/GMT-4",name:"GMT+04:00"},{value:"Etc/GMT-5",name:"GMT+05:00"},{value:"Etc/GMT-6",name:"GMT+06:00"},{value:"Etc/GMT-7",name:"GMT+07:00"},{value:"Etc/GMT-8",name:"GMT+08:00"},{value:"Etc/GMT-9",name:"GMT+09:00"},{value:"Etc/GMT-10",name:"GMT+10:00"},{value:"Etc/GMT-11",name:"GMT+11:00"},{value:"Etc/GMT-12",name:"GMT+12:00"},{value:"Etc/GMT-13",name:"GMT+13:00"},{value:"Etc/GMT-14",name:"GMT+14:00"}],onChange:"changeTimeZone(modelValue, form);"}]}]}],schema:{type:"object",title:"Schema",properties:{scriptName:{type:"hidden",fieldHtmlClass:"script-name-input"},dashboardName:{type:"string",fieldHtmlClass:"script-name-input",maxLength:30,pattern:"^[A-Za-z0-9 -]+$",validationMessage:{202:"Dashboard name can only contain letters, numbers and hyphens.",201:"Maximum number of characters allowed is 30."}},image:{title:"Image",type:"array",format:"singlefile",default:"default-icon.svg","x-schema-form":{type:"array"},pattern:{mimeType:"image/*",validationMessage:"Wrong File Type. Allowed types "},maxSize:{maximum:"1MB",validationMessage:"File exceeded allowed size of "}},period:{title:"Period",type:"string",description:"",default:"past_day"},unit:{title:"Unit",type:"string",description:"",default:"si",placeholder:" "},timeZone:{title:"Time Zone",type:"string",description:"",placeholder:"Time Zone "}},required:["dashboardName","period","unit"]}},metricselector:{form:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-md-3 col-lg-2 period-select-box",items:[{key:"period",type:"strapselect",notitle:!0,placeholder:"Period",titleMap:[{value:"past_day",name:"Past day"},{value:"past_week",name:"Past week"},{value:"past_month",name:"Past month"}],onChange:"changeDisplayPeriod(modelValue, form);"}]},{type:"section",htmlClass:"col-xs-12 col-md-3 col-lg-2 unit-select-box",items:[{key:"unit",notitle:!0,placeholder:"Unit",type:"strapselect",titleMap:[{value:"si",name:"SI units"},{value:"us",name:"US units"}],onChange:"changeDisplayMetric(modelValue, form);"}]},{type:"section",htmlClass:"col-xs-12 col-md-3 time-select-box",items:[{key:"timeZone",notitle:!0,placeholder:"Time Zone",type:"strapselect",titleMap:[{value:"UTC",name:"UTC"},{value:"America/New_York",name:"USA & Canada, Eastern Time"},{value:"America/Indiana/Indianapolis",name:"USA, Indiana (East)"},{value:"America/Chicago",name:"USA & Canada, Central Time"},{value:"America/Denver",name:"USA & Canada, Mountain Time"},{value:"America/Phoenix",name:"USA, Arizona"},{value:"America/Los_Angeles",name:"USA & Canada, Pacific Time"},{value:"America/Juneau",name:"USA, Alaska"},{value:"Pacific/Honolulu",name:"USA, Hawaii"},{value:"America/Argentina/Buenos_Aires",name:"Argentina, Buenos Aires"},{value:"Asia/Yerevan",name:"Armenia, Yerevan"},{value:"Australia/Brisbane",name:"Australia, Brisbane"},{value:"Australia/Hobart",name:"Australia, Hobart"},{value:"Australia/Melbourne",name:"Australia, Melbourne"},{value:"Australia/Perth",name:"Australia, Perth"},{value:"Australia/Sydney",name:"Australia, Sydney"},{value:"Europe/Vienna",name:"Austria, Vienna"},{value:"Asia/Baku",name:"Azerbaijan, Baku"},{value:"Atlantic/Azores",name:"Azores"},{value:"Asia/Dhaka",name:"Bangladesh, Dhaka"},{value:"Europe/Minsk",name:"Belarus, Minsk"},{value:"Europe/Brussels",name:"Belgium, Brussels"},{value:"America/La_Paz",name:"Bolivia, La Paz"},{value:"Europe/Sarajevo",name:"Bosnia & Herzegovina, Sarajevo"},{value:"Europe/Sofia",name:"Bulgaria, Sofia"},{value:"America/Halifax",name:"Canada, Atlantic Time"},{value:"America/Regina",name:"Canada, Saskatchewan"},{value:"Atlantic/Cape_Verde",name:"Cape Verde Islands"},{value:"America/Guatemala",name:"Central America"},{value:"America/Santiago",name:"Chile, Santiago"},{value:"Asia/Shanghai",name:"China, Beijing"},{value:"Asia/Chongqing",name:"China, Chongqing"},{value:"Asia/Hong_Kong",name:"China, Hong Kong"},{value:"Asia/Taipei",name:"China, Taipei"},{value:"Asia/Urumqi",name:"China, Urumqi"},{value:"America/Bogota",name:"Colombia, Bogota"},{value:"Europe/Zagreb",name:"Croatia, Zagreb"},{value:"Europe/Prague",name:"Czech Republic, Prague"},{value:"Europe/Copenhagen",name:"Denmark, Copenhagen"},{value:"Africa/Cairo",name:"Egypt, Cairo"},{value:"Europe/Tallinn",name:"Estonia, Tallinn"},{value:"Pacific/Fiji",name:"Fiji"},{value:"Europe/Helsinki",name:"Finland, Helsinki"},{value:"Europe/Paris",name:"France, Paris"},{value:"Asia/Tbilisi",name:"Georgia, Tbilisi"},{value:"Europe/Berlin",name:"Germany, Berlin"},{value:"Europe/Athens",name:"Greece, Athens"},{value:"America/Godthab",name:"Greenland"},{value:"Pacific/Guam",name:"Guam"},{value:"America/Guyana",name:"Guyana, Georgetown"},{value:"Europe/Budapest",name:"Hungary, Budapest"},{value:"Asia/Jakarta",name:"Indonesia, Jakarta"},{value:"Asia/Baghdad",name:"Iraq, Baghdad"},{value:"Europe/Dublin",name:"Ireland, Dublin"},{value:"Asia/Jerusalem",name:"Israel, Jerusalem"},{value:"Europe/Rome",name:"Italy, Rome"},{value:"Asia/Tokyo",name:"Japan, Tokyo"},{value:"Asia/Almaty",name:"Kazakhstan, Almaty"},{value:"Africa/Nairobi",name:"Kenya, Nairobi"},{value:"Asia/Seoul",name:"Korea, Seoul"},{value:"Asia/Kuwait",name:"Kuwait"},{value:"Europe/Riga",name:"Latvia, Riga"},{value:"Africa/Monrovia",name:"Liberia, Monrovia"},{value:"Europe/Vilnius",name:"Lithuania, Vilnius"},{value:"Europe/Skopje",name:"Macedonia, Skopje"},{value:"Asia/Kuala_Lumpur",name:"Malaysia, Kuala Lumpur"},{value:"Pacific/Majuro",name:"Marshall Islands"},{value:"America/Chihuahua",name:"Mexico, Chihuahua"},{value:"America/Mazatlan",name:"Mexico, Mazatlan"},{value:"America/Mexico_City",name:"Mexico, Mexico City"},{value:"America/Monterrey",name:"Mexico, Monterrey"},{value:"America/Tijuana",name:"Mexico, Tijuana"},{value:"Atlantic/South_Georgia",name:"Mid-Atlantic"},{value:"Pacific/Midway",name:"Midway Island"},{value:"Asia/Ulaanbaatar",name:"Mongolia, Ulaan Bataar"},{value:"Africa/Casablanca",name:"Morocco, Casablanca"},{value:"Europe/Amsterdam",name:"The Netherlands, Amsterdam"},{value:"Pacific/Noumea",name:"New Caledonia"},{value:"Pacific/Auckland",name:"New Zealand, Auckland"},{value:"Asia/Muscat",name:"Oman, Muscat"},{value:"Pacific/Port_Moresby",name:"Papua New Guinea, Port Moresby"},{value:"Asia/Karachi",name:"Pakistan, Karachi"},{value:"America/Lima",name:"Peru, Lima"},{value:"Europe/Warsaw",name:"Poland, Warsaw"},{value:"Europe/Lisbon",name:"Portugal, Lisbon"},{value:"Europe/Bucharest",name:"Romania, Bucharest"},{value:"Asia/Yekaterinburg",name:"Russia, Ekaterinburg"},{value:"Asia/Kamchatka",name:"Russia, Kamchatka"},{value:"Asia/Magadan",name:"Russia, Magadan"},{value:"Europe/Moscow",name:"Russia, Moscow"},{value:"Asia/Novosibirsk",name:"Russia, Novosibirsk"},{value:"Asia/Vladivostok",name:"Russia, Vladivostok"},{value:"Asia/Yakutsk",name:"Russia, Yakutsk"},{value:"Pacific/Pago_Pago",name:"Samoa"},{value:"Asia/Riyadh",name:"Saudi Arabia, Riyadh"},{value:"Europe/Belgrade",name:"Serbia, Belgrade"},{value:"Asia/Irkutsk",name:"Siberia, Irkutsk"},{value:"Asia/Krasnoyarsk",name:"Siberia, Krasnoyarsk"},{value:"Asia/Singapore",name:"Singapore"},{value:"Europe/Bratislava",name:"Slovakia, Bratislava"},{value:"Europe/Ljubljana",name:"Slovenia, Ljubljana"},{value:"Africa/Johannesburg",name:"South Africa, Pretoria"},{value:"Europe/Madrid",name:"Spain, Madrid"},{value:"Europe/Stockholm",name:"Sweden, Stockholm"},{value:"Asia/Bangkok",name:"Thailand, Bangkok"},{value:"Pacific/Tongatapu",name:"Tonga, Nuku'alofa"},{value:"Europe/Istanbul",name:"Turkey, Istanbul"},{value:"Europe/Kiev",name:"Ukraine, Kyev"},{value:"Europe/London",name:"United Kingdom, London"},{value:"Asia/Tashkent",name:"Uzbekistan, Tashkent"},{value:"America/Caracas",name:"Venezuela, Caracas"},{value:"Africa/Algiers",name:"West Central Africa"},{value:"Africa/Harare",name:"Zimbabwe, Harare"},{value:"Etc/GMT+12",name:"GMT-12:00"},{value:"Etc/GMT+11",name:"GMT-11:00"},{value:"Etc/GMT+10",name:"GMT-10:00"},{value:"Etc/GMT+9",name:"GMT-09:00"},{value:"Etc/GMT+8",name:"GMT-08:00"},{value:"Etc/GMT+7",name:"GMT-07:00"},{value:"Etc/GMT+6",name:"GMT-06:00"},{value:"Etc/GMT+5",name:"GMT-05:00"},{value:"Etc/GMT+4",name:"GMT-04:00"},{value:"Etc/GMT+3",name:"GMT-03:00"},{value:"Etc/GMT+2",name:"GMT-02:00"},{value:"Etc/GMT+1",name:"GMT-01:00"},{value:"Etc/GMT",name:"GMT+00:00"},{value:"Etc/GMT-1",name:"GMT+01:00"},{value:"Etc/GMT-2",name:"GMT+02:00"},{value:"Etc/GMT-3",name:"GMT+03:00"},{value:"Etc/GMT-4",name:"GMT+04:00"},{value:"Etc/GMT-5",name:"GMT+05:00"},{value:"Etc/GMT-6",name:"GMT+06:00"},{value:"Etc/GMT-7",name:"GMT+07:00"},{value:"Etc/GMT-8",name:"GMT+08:00"},{value:"Etc/GMT-9",name:"GMT+09:00"},{value:"Etc/GMT-10",name:"GMT+10:00"},{value:"Etc/GMT-11",name:"GMT+11:00"},{value:"Etc/GMT-12",name:"GMT+12:00"},{value:"Etc/GMT-13",name:"GMT+13:00"},{value:"Etc/GMT-14",name:"GMT+14:00"}],onChange:"changeTimeZone(modelValue, form);"}]}]}],schema:{type:"object",title:"Schema",properties:{period:{title:"Period",type:"string",description:"",default:"past_day"},unit:{title:"Unit",type:"string",description:"",default:"si",placeholder:" "},timeZone:{title:"Time Zone",type:"string",description:"",placeholder:"Time Zone "}},required:["unit"]}},transport:{label:"Transport configuration",defaults:{publishChannel:"requestChannel",subscribeChannel:"responseChannel"},form:["*"],schema:{type:"object",title:"Schema",properties:{publishChannel:{title:"Publish channel",type:"string",description:"Widgets use the publish channel to publish messages that will be distributed to its subscribers."},subscribeChannel:{title:"Subscribe channel",type:"string",description:"Widgets use the subscribe channel to consume the messages published over that channel as a data source."}},required:["token","baseUrl","publishChannel","subscribeChannel"]}},defaultWidget:{name:"displaybox"},widgets:[{name:"line",label:"Line Chart",class:"scriptr-dygraphs",commonData:!0,show:!0,defaults:{type:"line","on-format-data":"return data;","data-type":"raw","data-format":"dygraphs","schema-for":"line","aggregation-range":"10","fetch-from-date-param":"from_date","fetch-to-date-param":"to_date","display-metric-param":"display_metric","fetch-data-interval":300,boxLabel:"Line Chart",boxBorder:!0,transport:"wss",data:"[[1519312895840,10,26,16,20],[1519312896840,11,25,16,20],[1519312897840,10,26,16,20],[1519312898840,11,25,15,20],[1519312899840,10,26,16,21]]","grid-text-family":"Source Sans Pro","x1-axis-label-font-size":12,"x1-axis-label-width":60,"y2-axis-label-width":95,"y-axis-label-width":95,"y2-axis-label-font-size":12,"y-axis-label-font-size":12,"independent-ticks":"independent"},box:{sizeX:3,sizeY:3,minSizeX:2,minSizeY:2},imgSrc:"line-chart.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"stream",type:"uiselectmultiple",placeholder:"",options:{closeOnSelect:!1,groupBy:"dataStream",multiple:"true",callback:"multiSelectCallBack",widgetName:"line",limit:20},onChange:function(a,b,c){for(var d=["#1B1B1B","#2243B6","#299617","#FF3855","#FFDB00","#AF6E4D","#5946B2","#FF9966","#FF007C","#BFAFB2","#5DADEC","#A7F432","#FA5B3D","#A83731","#9C51B6","#EE34D2","#0A7E8C","#FFD12A","#76D7EA","#84DE02"],e={},f=c["colors-mapping"],g=0;g<f.length;g++)f[g].ykeys&&(e[f[g].ykeys]={labels:f[g].labels,colors:f[g].colors,axisSelection:f[g].axisSelection,unit:f[g].unit,isScaled:f[g].isScaled});for(var h=[],i=0;i<a.length;i++)if(e[a[i].value])h.push({ykeys:a[i].value,labels:e[a[i].value].labels,colors:e[a[i].value].colors,axisSelection:e[a[i].value].axisSelection,unit:e[a[i].value].unit,isScaled:e[a[i].value].isScaled});else{for(var j=0;j<d.length;j++){for(var k=!1,l=d[j],m=0;m<h.length;m++){var n=h[m].colors;if(n==l){k=!0;break}}if(!k)break}var o=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[i].value.split("-")[0]}).sensors,{selectedStreamValue:a[i].value});h.push({ykeys:a[i].value,labels:a[i].name,colors:k?d[0]:d[j],axisSelection:"y",unit:o.selectedStreamUnits,isScaled:o.is_scaled})}0==h.length&&(h=[{}]),c["colors-mapping"]=h;for(var p='["x",',q='["X",',i=0;i<a.length;i++)p+="'y'"+(i<a.length-1?" , ":""),q+='"'+a[i].name.replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/=/g,"\\=").replace(/\+/g,"\\+").replace(/~/g,"\\~")+'"'+(i<a.length-1?" , ":"");if(c["legend-labels"]=q+"]",c["legend-Mapping"]=p+"]",a.length>0&&delete c.data,a&&a.length>0)for(var j=0;j<a.length;j++){var o=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[j].value.split("-")[0]}).sensors,{selectedStreamValue:a[j].value});c["available-units"]={si:o.si_unit,us:o.us_unit,scaled:o.scaled_unit},o.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false";break}}}]},{type:"section",htmlClass:"col-xs-12",items:[{key:"aggregation-range",type:"strapselect",placeholder:"Select the aggregation range for the streams data you are charting.",titleMap:[{value:"10",name:"10 minutes"},{value:"30",name:"30 minutes"},{value:"60",name:"1 hour"},{value:"1440",name:"1 day"}]}]}]},{title:"X",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["x1-axis-label","x1-axis-label-font-size"]},{type:"section",htmlClass:"col-xs-12",items:[{key:"x1-axis-line-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"x1-axis-line-width",step:"1"}]}]}]},{title:"Y",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["y-axis-label","y-axis-label-font-size"]},{type:"section",htmlClass:"col-xs-12",items:[{key:"y-axis-line-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"y-axis-line-width",step:"1"},{type:"radios-inline",key:"y-axis-include-zero",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]}]}]}]},{title:"Y2",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"radios-inline",key:"draw-y2-axis",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},"y2-axis-label","y2-axis-label-font-size"]},{type:"section",htmlClass:"col-xs-12",items:[{key:"y2-axis-line-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"y2-axis-line-width",step:"1"},{type:"radios-inline",key:"y2-axis-include-zero",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]}]}]}]},{title:"Legend",items:[{type:"section",htmlClass:"",items:[{key:"colors-mapping",title:"Legend Details",add:null,remove:null,items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6 col-sm-3",items:[{key:"colors-mapping[].ykeys",title:"Channel"}]},{type:"section",htmlClass:"col-xs-6 col-sm-3",items:[{key:"colors-mapping[].labels",title:"Legend Label"}]},{type:"section",htmlClass:"col-xs-6 col-sm-3",items:[{key:"colors-mapping[].colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-6 col-sm-3",items:[{key:"colors-mapping[].axisSelection",title:"Legend Axis",notitle:!1,type:"strapselect",titleMap:[{value:"y",name:"Y"},{value:"y2",name:"Y2"}]}]}]}]}]}]},{title:"Grid",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-4",items:[{type:"radios-inline",key:"x1-draw-grid",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},{key:"x1-grid-line-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"x1-grid-line-width",step:"1"}]},{type:"section",htmlClass:"col-xs-4",items:[{type:"radios-inline",key:"y-draw-grid",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},{key:"y-grid-line-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"y-grid-line-width",step:"1"}]},{type:"section",htmlClass:"col-xs-4",items:[{type:"radios-inline",key:"y2-draw-grid",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},{key:"y2-grid-line-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"y2-grid-line-width",step:"1"}]}]}]},{title:"Slider",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"radios-inline",key:"show-range-selector",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},"range-selector-foreground-line-width"]},{type:"section",htmlClass:"col-xs-12",items:[{key:"range-selector-foreground-stroke-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},"range-selector-height",{key:"range-selector-plot-fill-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]}]},{title:"Goals",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"custom-goals",startEmpty:!0,title:"Fill Colors & Goals",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"custom-goals[].goal-line-colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"custom-goals[].goals",title:"Goal",onFieldLoad:function(a,b,c){if(!isNaN(a)&&c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]]))}}}]}]}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{required:["stream"],type:"object",title:"Schema",properties:{"show-legend":{title:"Show Legend",default:"true",type:"string",description:""},stream:{title:"Channels",type:"array",items:{type:"object",properties:{label:{type:"string",title:"Channel"}}},validationMessage:"Required.",description:"",placeholder:" "},"legend-position":{title:"Legend Position ",type:"string",default:"bottom",description:"Determines the legend position relative to the graph.",placeholder:" "},"draw-x1-axis":{title:"Draw X-axis",type:"string",default:"true",description:"Determines whether to draw the X-axis. Setting this to false also prevents x-axis ticks from being drawn and reclaims the space for the chart grid/lines."},"draw-y-axis":{title:"Draw Y-axis",type:"string",default:"true",description:"Determines whether to draw the Y-axis. Setting this to false also prevents y-axis ticks from being drawn and reclaims the space for the chart grid/lines."},"draw-y2-axis":{title:"Draw Y2-axis",type:"string",default:"false",description:"When turned off this prevents the y2-axis from being drawn and reclaims the space for the grid lines."},"colors-mapping":{title:"Colors",type:"array",default:[],description:"",items:{type:"object",properties:{colors:{title:"Colors",type:"string",format:"color",validationMessage:"Invalid Color"},labels:{title:"Labels",type:"string"},ykeys:{title:"Channel",readonly:!0,type:"string"},axisSelection:{title:"Legend Axis",type:"string",placeholder:" "}}}},"custom-goals":{title:"Goals",type:"array",default:[{"goal-line-colors":"#f0f0f0",goals:""}],description:"Color: Color of goal line.<br/>Goal: Y value to draw as horizontal 'goal' line.",items:{type:"object",properties:{"goal-line-colors":{title:"Colors",type:"string",format:"color",validationMessage:"Invalid Color",default:"#F0F0F0"},goals:{title:"Goals",type:"number",default:0}}}},events:{title:"Events",type:"array",default:["2010-02-02"],description:"List of x-values to draw as vertical 'event' lines on the chart.",items:{type:"string"}},"event-line-colors":{title:"Event Line Colors",type:"array",default:["#ffffff"],description:"List of color values to use for the event line colors.",items:{format:"color",type:"string",validationMessage:"Invalid Color"}},colors:{title:"Lines' Colors",type:"array",default:["#005588","#aa241d"],description:"Array containing colors for the series lines.",items:{format:"color",type:"string",validationMessage:"Invalid Color"}},"x1-axis-label-font-size":{title:"X-axis Label Font Size",type:"number",default:12,description:"Pixel size of the font for the x-axis label.",minimum:8,maximum:28},"y-axis-label-font-size":{title:"Y-axis Label Font Size",type:"number",default:12,description:"Pixel size of the font for the y-axis label.",minimum:8,maximum:28},"y2-axis-label-font-size":{title:"Y2-axis Label Font Size",type:"number",default:12,description:"Pixel size of font for the y2-axis label.",minimum:8,maximum:28},"x1-axis-label-width":{title:"Axis Label Width",type:"number",default:60,description:"Width (in pixels) of the axis label width."},"y-axis-label-width":{title:"Axis Label Width",type:"number",default:95,description:"Width (in pixels) of the axis label width. This also controls the width of the y-axis."},"y2-axis-label-width":{title:"Axis Label Width",type:"number",default:95,description:"Width (in pixels) of the axis label width. This also controls the width of the y-axis."},"x1-axis-line-color":{title:"X-axis Line Color",type:"string",default:"#000000",format:"color",description:"",validationMessage:"Invalid Color"},"y-axis-line-color":{title:"Y-axis Line Color",type:"string",default:"#000000",format:"color",description:"",validationMessage:"Invalid Color"},"y2-axis-line-color":{title:"Y2-axis Line Color",type:"string",default:"#000000",format:"color",description:"",validationMessage:"Invalid Color"},"x1-axis-line-width":{title:"X-axis Line Width",type:"number",default:1,description:"Pixel thickness of the x-axis line.",minimum:1,maximum:30},"y-axis-line-width":{title:"Y-axis Line Width",type:"number",default:1,description:"Pixel thickness of the y-axis line.",minimum:1,maximum:30},"y2-axis-line-width":{title:"Y2-axis Line Width",type:"number",default:1,description:"Pixel thickness of the y2-axis line.",minimum:1,maximum:30},"y-axis-include-zero":{title:"Include Zero",type:"string",default:"false",description:"Determines if the y-axis will include zero, typically the lowest value. This can be used to avoid exaggerating the variance in the data."},"y2-axis-include-zero":{title:"Include Zero",type:"string",default:"false",description:"Determines if the y2-axis will include zero, typically the lowest value. This can be used to avoid exaggerating the variance in the data."},"y-axis-labels-kmb":{title:"Labels KMB",type:"string",default:"false",description:"Show K/M/B for thousands/millions/billions on y-axis."},"y2-axis-labels-kmb":{title:"Labels KMB",type:"string",default:"false",description:"Show K/M/B for thousands/millions/billions on y-axis."},"show-range-selector":{title:"Show Slider",type:"string",default:"false",description:""},"range-selector-alpha":{title:"Alpha",type:"number",default:.6,description:"The transparency of the veil that is drawn over the unselected portions of the slider mini plot. A value of 0 represents full transparency and the unselected portions of the mini plot will appear as normal. A value of 1 represents full opacity and the unselected portions of the mini plot will be hidden."},"range-selector-background-line-width":{title:"Background Line Width",type:"number",default:1,description:"The width of the lines below and on both sides of the slider mini plot."},"range-selector-background-stroke-color":{title:"Background Stroke Color",type:"string",default:"#808080",format:"color",description:"The color of the lines below and on both sides of the slider mini plot.",validationMessage:"Invalid Color"},"range-selector-foreground-line-width":{title:"Foreground Line Width",type:"number",default:1,description:"The width of the lines in the interactive layer of the slider.",minimum:1,maximum:10},"range-selector-foreground-stroke-color":{title:"Foreground Line Color",type:"string",default:"#000000",format:"color",description:"The color of the lines in the interactive layer of the slider.",validationMessage:"Invalid Color"},"range-selector-height":{title:"Height",type:"number",default:40,description:"Pixel height of the slider.",minimum:10,maximum:100},"range-selector-plot-fill-color":{title:"Plot Fill Color",type:"string",default:"#A7B1C4",format:"color",description:"The slider mini plot fill color.",validationMessage:"Invalid Color"},"range-selector-plot-fill-gradient-color":{title:"Plot Fill Gradient Color",type:"string",default:"#FFFFFF",format:"color",description:"The top color for the slider mini plot fill color gradient.",validationMessage:"Invalid Color"},"range-selector-plot-line-width":{title:"Plot Line Width",type:"number",default:1.5,description:"The width of the slider mini plot line."},"range-selector-plot-stroke-color":{title:"Plot Stroke Color",type:"string",default:"#808FAB",format:"color",description:"The slider mini plot stroke color.",validationMessage:"Invalid Color"},"x1-draw-grid":{title:"Draw X-axis Grid Lines",type:"string",default:"true",description:""},"y-draw-grid":{title:"Draw Y-axis Grid Lines",type:"string",default:"true",description:""},"y2-draw-grid":{title:"Draw Y2-axis Grid Lines",type:"string",default:"false",description:""},"x1-grid-line-color":{title:"X-axis Grid Line Color",type:"string",default:"#000000",format:"color",description:"",validationMessage:"Invalid Color"},"y-grid-line-color":{title:"Y-axis Grid Line Color",type:"string",default:"#000000",format:"color",description:"",validationMessage:"Invalid Color"},"y2-grid-line-color":{title:"Y2-axis Grid Line Color",type:"string",default:"#000000",format:"color",description:"",validationMessage:"Invalid Color"},"x1-grid-line-width":{title:"X-axis Grid Line Width",type:"number",default:1,description:"Pixel thickness of the x-axis line.",minimum:1,maximum:30},"y-grid-line-width":{title:"Y-axis Grid Line Width",type:"number",default:1,description:"Pixel thickness of the y-axis line.",
minimum:1,maximum:30},"y2-grid-line-width":{title:"Y2-axis Grid Line Width",type:"number",default:1,description:"Pixel thickness of the y2-axis line.",minimum:1,maximum:30},"independent-ticks":{title:"Y Axes Alignment",type:"string",default:"independent",description:"This option defines whether the y axes should align their ticks or if they should be independent.",placeholder:" "},data:{title:"Data",type:"string",description:"Data series in case of static data.","x-schema-form":{type:"textarea",placeholder:'[["2009-12-31T22:00:00.000Z",1,99,1039600.0000000001,1960400],["2010-01-01T22:00:00.000Z",2,98,1078400,1921600]]'}},"x1-axis-label":{title:"X-axis Label",type:"string",default:"",description:"",maxLength:40},"y-axis-label":{title:"Y-axis Label",type:"string",default:"",description:"",maxLength:40},"y2-axis-label":{title:"Y2-axis Label",type:"string",default:"",description:"",maxLength:40},"legend-labels":{title:"Legend Labels",type:"string",default:"['X', 'Y1', 'Y2', 'Y3', 'Y4']",description:"A name for each data series, including the independent (X) series."},"legend-Mapping":{title:"Legend Mapping",type:"string",default:"['x', 'y', 'y', 'y2', 'y2']",description:"Mapping the legends to their corresponding axis."},boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."}}}},{name:"bar",label:"Bar Chart",class:"scriptr-chart",commonData:!0,show:!0,defaults:{type:"bar",boxLabel:"Bar Chart",boxBorder:!0,stacked:"true","data-type":"aggregate","aggregation-range":"60","parse-time":"true","data-format":"barMorris","schema-for":"bar","xlabel-angle":0,"fetch-from-date-param":"from_date","fetch-to-date-param":"to_date","display-metric-param":"display_metric","fetch-data-interval":300,xkey:"date",labels:'["Serie A", "Serie B"]',colors:["#aa241d","#edcfce"],transport:"wss","on-format-data":"return data;",data:'[{"date":"2006","a":88,"b":20},{"date":"2007","a":30,"b":34},{"date":"2008","a":90,"b":42},{"date":"2009","a":89,"b":59},{"date":"2010","a":43,"b":61},{"date":"2011","a":85,"b":69},{"date":"2012","a":29,"b":65}]',"grid-text-family":"Arial","hide-hover":"auto","show-legend":"true"},box:{sizeX:2,sizeY:3,minSizeX:2,minSizeY:2},imgSrc:"bar-chart.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"stream",type:"uiselectmultiple",placeholder:"",onChange:function(a,b,c){for(var d=["#1B1B1B","#2243B6","#299617","#FF3855","#FFDB00","#AF6E4D","#5946B2","#FF9966","#FF007C","#BFAFB2","#5DADEC","#A7F432","#FA5B3D","#A83731","#9C51B6","#EE34D2","#0A7E8C","#FFD12A","#76D7EA","#84DE02"],e={},f=c["colors-mapping"],g=0;g<f.length;g++)f[g].ykeys&&(e[f[g].ykeys]={labels:f[g].labels,colors:f[g].colors,unit:f[g].unit,isScaled:f[g].isScaled});for(var h=[],i=0;i<a.length;i++)if(e[a[i].value])h.push({ykeys:a[i].value,labels:e[a[i].value].labels,colors:e[a[i].value].colors,unit:e[a[i].value].unit,isScaled:e[a[i].value].isScaled});else{for(var j=0;j<d.length;j++){for(var k=!1,l=d[j],m=0;m<h.length;m++){var n=h[m].colors;if(n==l){k=!0;break}}if(!k)break}var o=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[i].value.split("-")[0]}).sensors,{selectedStreamValue:a[i].value});h.push({ykeys:a[i].value,labels:a[i].name,colors:k?d[0]:d[j],unit:o.selectedStreamUnits,isScaled:o.is_scaled})}if(0==h.length&&(h=[{}]),c["colors-mapping"]=h,c.xkey="date",a.length>0&&delete c.data,a&&a.length>0)for(var j=0;j<a.length;j++){var o=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[j].value.split("-")[0]}).sensors,{selectedStreamValue:a[j].value});c["available-units"]={si:o.si_unit,us:o.us_unit,scaled:o.scaled_unit},o.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false";break}},options:{closeOnSelect:!1,groupBy:"dataStream",multiple:"true",callback:"multiSelectCallBack",widgetName:"bar",limit:20}}]}]},{title:"X",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["xlabel-angle"]}]}]},{title:"Y",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["pre-units",{key:"stacked",type:"radios-inline",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]}]}]}]},{title:"Legend",items:[{type:"section",htmlClass:"",items:[{key:"colors-mapping",title:"Legend Details",add:null,remove:null,items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].ykeys",title:"Channel"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].labels",title:"Legend Label"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]}]}]}]},{title:"Goals",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"custom-goals",title:"Fill Colors & Goals",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"custom-goals[].goal-line-colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"custom-goals[].goals",onFieldLoad:function(a,b,c){if(!isNaN(a)&&c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]]))}}}]}]}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},stream:{title:"Channels",type:"array",items:{type:"object",properties:{label:{type:"string",title:"Channel"}}},validationMessage:"Required.",description:"",placeholder:" "},data:{title:"Data",type:"string",description:"Data to plot in case of static data.This is an array of objects, containing x and y attributes as described by the xkey and ykeys options. The order in which you provide the data is the order in which the bars are displayed.","x-schema-form":{type:"textarea",placeholder:"[{ y: '2006', a: 100, b: 90 },{ y: '2007', a: 75,  b: 65 }, { y: '2008', a: 50,  b: 40 }]"}},"parse-time":{title:"Parse time",type:"hidden",default:"true",description:"Set to false to skip time/date parsing for X values, instead treating them as an equally-spaced series."},xkey:{title:"X key",type:"string",description:"A string containing the name of the attribute that contains X labels.",default:"date"},"colors-mapping":{title:"Colors",type:"array",default:[],description:"",items:{type:"object",properties:{colors:{title:"Colors",type:"string",format:"color",validationMessage:"Invalid Color"},labels:{title:"Labels",type:"string"},ykeys:{title:"Channel",readonly:!0,type:"string"}}}},stacked:{title:"Vertically Stack Values",type:"string",default:"false",description:""},"hide-hover":{title:"Hide hover",default:"auto",type:"hidden",description:"Set to Never to always show a hover legend. Set to 'auto' to only show the hover legend when the mouse cursor is over the chart. Set to 'always' to never show a hover legend."},"show-legend":{title:"Show Legend",type:"string",default:"true",description:"Set visibility of the legend."},"hover-callback":{title:"Hover callback",type:"string",description:"Provide a function on this option to generate custom hover legends. The function will be called with the index of the row under the hover legend, the options object passed to the constructor as arguments, a string containing the default generated hover legend content HTML, and an object containing the original data for the row as passed in the data option. hoverCallback: function (index, options, content, row) {return 'sin(' + row.x + ')='+ row.y}"},axes:{title:"Axes",type:"string",description:"Set to false to disable drawing the x and y axes.",default:"true"},grid:{title:"Grid",type:"string",description:"Set to false to disable drawing the horizontal grid lines.",default:"true"},"grid-text-color":{title:"Grid text color",type:"string",description:"Set the color of the axis labels (default: #888).",format:"color",default:"#888",validationMessage:"Invalid Color"},"grid-text-size":{title:"Grid text size",type:"number",description:"Set the point size of the axis labels (default: 12).",default:12},"grid-text-family":{title:"Grid text family",type:"string",description:"Set the font family of the axis labels (default: sans-serif).",default:"Source Sans Pro",placeholder:" "},"grid-text-weight":{title:"Grid text weight",type:"string",description:"Set the font weight of the axis labels (default: normal).",default:"normal",placeholder:" "},ymax:{title:"Y maximum value",type:"string",default:"auto",description:"Max. bound for Y-values. Alternatively, set this to 'auto' to compute automatically, or 'auto [num]' to automatically compute and ensure that the max y-value is at least [num]."},ymin:{title:"Y minimum value",type:"string",default:"auto 0",description:"Min. bound for Y-values. Alternatively, set this to 'auto' to compute automatically, or 'auto [num]' to automatically compute and ensure that the min y-value is at most [num]. You can use this to create graphs with false origins."},"post-units":{title:"Post units",type:"string",description:"Set to a string value (eg: '%') to add a label suffix all y-labels."},"pre-units":{title:"Y-axis Label Prefix",type:"string",description:"Example: Set to '$' to prefix all y labels with a dollar sign."},"xlabel-angle":{title:"X-axis Label Angle",type:"number",default:0,description:"The angle in degrees from horizontal to draw x-axis labels.",minimum:0,maximum:90},"ylabel-format":{title:"Y label Format",type:"string",description:"A function that accepts y-values and formats them for display as y-axis labels. function (y) { return y.toString() + 'km'; }"},"goal-stroke-width":{title:"Goal stroke width",type:"number",default:1,description:"Width, in pixels, of the goal lines."},"custom-goals":{title:"Goals",type:"array",description:"Color: Color of the goal line. <br/> Goal: Y value to draw as a horizontal 'goal' line.",default:[{"goal-line-colors":"#F0F0F0",goals:""}],items:{type:"object",properties:{"goal-line-colors":{title:"Goal Line Colors",type:"string",format:"color",validationMessage:"Invalid Color",default:"#666633"},goals:{title:"Goal",type:"number"}}}}},required:["stream","xkey","ykeys","labels"]}},{name:"area",label:"Area Chart",class:"scriptr-chart",commonData:!0,show:!0,defaults:{type:"area","on-format-data":"return data;","parse-time":"true","data-type":"raw","data-format":"morris","schema-for":"area","aggregation-range":"30","fetch-from-date-param":"from_date","fetch-to-date-param":"to_date","display-metric-param":"display_metric","fetch-data-interval":300,boxLabel:"Area Chart",boxBorder:!0,xkey:"y",labels:'["Serie A", "Serie B"]',colors:["#5fc100","#005487"],transport:"wss","grid-text-family":"Arial",data:'[{"y":2000,"a":64,"b":82},{"y":2003,"a":53,"b":48},{"y":2004,"a":81,"b":58},{"y":2005,"a":68,"b":72},{"y":2008,"a":52,"b":60},{"y":20011,"a":55,"b":30},{"y":2013,"a":79,"b":40}]',"hide-hover":"auto","show-legend":"true"},box:{sizeX:2,sizeY:3,minSizeX:2,minSizeY:2},imgSrc:"area-chart.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"stream",type:"uiselectmultiple",placeholder:"",onChange:function(a,b,c){for(var d=["#1B1B1B","#2243B6","#299617","#FF3855","#FFDB00","#AF6E4D","#5946B2","#FF9966","#FF007C","#BFAFB2","#5DADEC","#A7F432","#FA5B3D","#A83731","#9C51B6","#EE34D2","#0A7E8C","#FFD12A","#76D7EA","#84DE02"],e={},f=c["colors-mapping"],g=0;g<f.length;g++)f[g].ykeys&&(e[f[g].ykeys]={labels:f[g].labels,colors:f[g].colors,unit:f[g].unit,isScaled:f[g].isScaled});for(var h=[],i=0;i<a.length;i++)if(e[a[i].value])h.push({ykeys:a[i].value,labels:e[a[i].value].labels,colors:e[a[i].value].colors,unit:e[a[i].value].unit,isScaled:e[a[i].value].isScaled});else{for(var j=0;j<d.length;j++){for(var k=!1,l=d[j],m=0;m<h.length;m++){var n=h[m].colors;if(n==l){k=!0;break}}if(!k)break}var o=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[i].value.split("-")[0]}).sensors,{selectedStreamValue:a[i].value});h.push({ykeys:a[i].value,labels:a[i].name.replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/=/g,"\\=").replace(/\+/g,"\\+").replace(/~/g,"\\~"),colors:k?d[0]:d[j],unit:o.selectedStreamUnits,isScaled:o.is_scaled})}0==h.length&&(h=[{}]),c["colors-mapping"]=h;for(var p="[",q="[",i=0;i<a.length;i++)p+='"'+a[i].value+'"'+(i<a.length-1?" , ":""),q+='"'+a[i].name.replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/=/g,"\\=").replace(/\+/g,"\\+").replace(/~/g,"\\~")+'"'+(i<a.length-1?" , ":"");if(c.ykeys=p+"]",c.labels=q+"]",c.xkey="date",a.length>0&&delete c.data,a&&a.length>0)for(var j=0;j<a.length;j++){var o=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[j].value.split("-")[0]}).sensors,{selectedStreamValue:a[j].value});c["available-units"]={si:o.si_unit,us:o.us_unit,scaled:o.scaled_unit},o.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false";break}},options:{closeOnSelect:!1,groupBy:"dataStream",multiple:"true",callback:"multiSelectCallBack",widgetName:"area",limit:20}}]},{type:"section",htmlClass:"col-xs-12",items:[{key:"aggregation-range",type:"strapselect",placeholder:"Select the aggregation range for the streams data you are charting.",titleMap:[{value:"10",name:"10 minutes"},{value:"30",name:"30 minutes"},{value:"60",name:"1 hour"},{value:"1440",name:"1 day"}]}]}]},{title:"X",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["xlabel-angle"]}]}]},{title:"Y",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["pre-units"]},{type:"section",htmlClass:"col-xs-12",items:["post-units"]}]}]},{title:"Legend",items:[{type:"section",htmlClass:"",items:[{key:"colors-mapping",title:"Legend Details",add:null,remove:null,items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].ykeys",title:"Channel"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].labels",title:"Legend Label"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]}]}]}]},{title:"Goals",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"custom-goals",title:"Fill Color & Goals",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"custom-goals[].goal-line-colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"custom-goals[].goals",onFieldLoad:function(a,b,c){if(!isNaN(a)&&c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]]))}}}]}]}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},stream:{title:"Channels",type:"array",items:{type:"object",properties:{label:{type:"string",title:"Channel"}}},validationMessage:"Required.",description:"",placeholder:" "},data:{title:"Data",type:"string",description:"Data series in case of static data.","x-schema-form":{type:"textarea",placeholder:"[{ y: '2006', a: 100, b: 90 },{ y: '2007', a: 75,  b: 65 }, { y: '2008', a: 50,  b: 40 }]"}},"parse-time":{title:"Parse time",type:"hidden",default:"true",description:"Set to false to skip time/date parsing for X values, instead treating them as an equally-spaced series."},xkey:{title:"X key",type:"string",description:"A string containing the name of the attribute that contains date (X) values. Timestamps are accepted in the form of millisecond timestamps (as returned by Date.getTime() or as strings in the following formats: 2012, 2012 Q1, 2012 W1, 2012-02, 2012-02-24, 2012-02-24 15:00, 2012-02-24 15:00:00, 2012-02-24 15:00:00.000. date/time strings can optionally contain a T between the date and time parts, and/or a Z suffix, for compatibility with ISO-8601 dates.",default:"date"},"colors-mapping":{title:"Colors",type:"array",default:[],description:"",items:{type:"object",properties:{colors:{title:"Colors",type:"string",format:"color",validationMessage:"Invalid Color"},labels:{title:"labels",type:"string"},ykeys:{title:"Channel",readonly:!0,type:"string"}}}},"line-width":{title:"Line width",type:"number",default:2,description:"Width of the series lines, in pixels."},"point-size":{title:"Point size",type:"number",default:4,description:"Diameter of the series points, in pixels."},"point-fill-colors":{title:"Point fill colors",type:"array",description:"Colors for the series points. By default uses the same values as lineColors.",items:{format:"color",type:"string",validationMessage:"Invalid Color"}},"point-stroke-colors":{title:"Point Stroke Colors",type:"array",default:["#fff"],description:"Colors for the outlines of the series points. (#ffffff by default).",items:{format:"color",type:"string",validationMessage:"Invalid Color"}},ymax:{title:"Y maximum value",type:"string",default:"auto",description:"Max. bound for Y-values. Alternatively, set this to 'auto' to compute automatically, or 'auto [num]' to automatically compute and ensure that the max y-value is at least [num]."},ymin:{title:"Y minimum value",type:"string",default:"auto 0",description:"Min. bound for Y-values. Alternatively, set this to 'auto' to compute automatically, or 'auto [num]' to automatically compute and ensure that the min y-value is at most [num]. You can use this to create graphs with false origins."},smooth:{title:"Smooth",type:"string",default:"true",description:"Set to false to disable line smoothing."},"hide-hover":{title:"Hide hover",default:"auto",type:"hidden",description:"Set to Never to always show a hover legend. Set to 'auto' to only show the hover legend when the mouse cursor is over the chart. Set to 'always' to never show a hover legend."},"show-legend":{title:"Show Legend",type:"string",default:"true",description:"Set visibility of the legend."},"hover-callback":{title:"Hover callback",type:"string",description:"Provide a function on this option to generate custom hover legends. The function will be called with the index of the row under the hover legend, the options object passed to the constructor as arguments, a string containing the default generated hover legend content HTML, and an object containing the original data for the row as passed in the data option. hoverCallback: function (index, options, content, row) {return 'sin(' + row.x + ')='+ row.y}"},"post-units":{title:"Y-axis Label Suffix",type:"string",description:"Example: Set to '%' to suffix all y labels with a percent sign."},"pre-units":{title:"Y-axis Label Prefix",type:"string",description:"Example: Set to '$' to prefix all y labels with a dollar sign."},xlabels:{title:"X labels",type:"string",default:"auto",description:"Sets the x axis labelling interval. By default the interval will be automatically computed.",format:"uiselect",placeholder:" ",items:[{value:"auto",label:"auto"},{value:"decade",label:"decade"},{value:"year",label:"year"},{value:"month",label:"month"},{value:"week",label:"week"},{value:"day",label:"day"},{value:"hour",label:"hour"},{value:"30min",label:"30min"},{value:"15min",label:"15min"},{value:"10min",label:"10min"},{value:"5min",label:"5min"},{value:"minute",label:"minute"},{value:"30sec",label:"30sec"},{value:"15sec",label:"15sec"},{value:"10sec",label:"10sec"},{value:"5sec",label:"5sec"},{value:"second",label:"second"}]},"xlabel-angle":{title:"X-axis Label Angle",type:"number",default:0,description:"The angle in degrees from horizontal to draw x-axis labels.",minimum:0,maximum:90},"xlabel-format":{title:"X label format",type:"string",description:"A function that accepts Date objects and formats them for display as x-axis labels. Overrides the default formatter chosen by the automatic labeller or the xLabels option. function (x) { return x.toString(); }"},"ylabel-format":{title:"Y label format",type:"string",description:"A function that accepts y-values and formats them for display as y-axis labels. function (y) { return y.toString() + 'km'; }"},"goal-stroke-width":{title:"Goal stroke width",type:"number",default:1,description:"Width, in pixels, of the goal lines."},"custom-goals":{title:"Goals",type:"array",description:"Color: Color of the goal line. <br/> Goal: Y value to draw as a horizontal 'goal' line.",default:[{"goal-line-colors":"#F0F0F0",goals:""}],items:{type:"object",properties:{"goal-line-colors":{title:"Goal Line Colors",type:"string",format:"color",validationMessage:"Invalid Color",default:"#666633"},goals:{title:"Goal",type:"number"}}}},"event-stroke-width":{title:"Event stroke width",type:"number",default:1,description:"Width, in pixels, of the event lines."},"custom-events":{title:"Events",type:"array",description:"Events: A list of x-values to draw as vertical 'event' lines on the chart. ex: ['2012-01-01', '2012-02-01'] <br/>Colors: Array of color values to use for the event line colors.",default:[{"event-line-colors":"#666633",events:""},{"event-line-colors":"#999966",events:""},{"event-line-colors":"#cc6666",events:""},{"event-line-colors":"#663333",events:""}],items:{type:"object",properties:{"event-line-colors":{title:"Event Line Colors",type:"string",format:"color",validationMessage:"Invalid Color"},events:{title:"Events",type:"string"}}}},axes:{title:"Axes",type:"string",description:"Set to false to disable drawing the x and y axes.",default:"true"},grid:{title:"Grid",type:"string",description:"Set to false to disable drawing the horizontal grid lines.",default:"true"},"grid-text-color":{title:"Grid text color",type:"string",description:"Set the color of the axis labels (default: #888).",format:"color",default:"#888",validationMessage:"Invalid Color"},"grid-text-size":{title:"Grid text size",type:"number",description:"Set the point size of the axis labels (default: 12).",default:12},"grid-text-family":{title:"Grid text family",type:"string",description:"Set the font family of the axis labels (default: sans-serif).",default:"Source Sans Pro",placeholder:" "},"grid-text-weight":{title:"Grid text weight",type:"string",description:"Set the font weight of the axis labels (default: normal).",default:"normal",placeholder:" "},"fill-opacity":{title:"Fill opacity",type:"number",default:1,description:"Change the opacity of the area fill color. Accepts values between 0.0 (for completely transparent) and 1.0 (for completely opaque).",minimum:0,maximum:1},"behave-like-line":{title:"Behave like Line",type:"string",default:"false",description:"Set to true to overlay the areas on top of each other instead of stacking them."},"date-format":{title:"Date format",type:"string",description:"A function that accepts millisecond timestamps and formats them for display as chart labels. default is function (x) { return new Date(x).toString() }."}},required:["stream","xkey","ykeys"]}},{name:"donut",label:"Donut Chart",class:"scriptr-chart",commonData:!0,show:!1,defaults:{type:"donut","data-type":"latest","data-format":"morris","schema-for":"donut","fetch-from-date-param":"from_date","fetch-to-date-param":"to_date","fetch-data-interval":300,"on-format-data":"return data;",boxLabel:"Donut Chart",boxBorder:!0,transport:"wss",colors:["#005487","#fba723","#aa241d"],data:'[{label: "Serie A", value: 70}, {label: "Serie B",value: 30 }]',ykeys:["Serie A","Serie B"],"show-legend":"true"},box:{sizeX:2,sizeY:3,minSizeX:2,minSizeY:3},imgSrc:"donut-chart.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"stream",type:"uiselectmultiple",placeholder:"",options:{closeOnSelect:!0,groupBy:"dataStream",multiple:"false",callback:"multiSelectCallBack",widgetName:"donut"},onChange:function(a,b,c){for(var d=["#CC5464","#FCC717","#38B9D6","#1DBC68","#E90088"],e={},f=c["colors-mapping"],g=0;g<f.length;g++)f[g].ykeys&&(e[f[g].ykeys]={labels:f[g].labels,colors:f[g].colors});for(var h=[],i=0;i<a.length;i++)if(e[a[i].value])h.push({ykeys:a[i].value,labels:e[a[i].value].labels,colors:e[a[i].value].colors});else{for(var j=0;j<d.length;j++){for(var k=!1,l=d[j],m=0;m<h.length;m++){var n=h[m].colors;if(n==l){k=!0;break}}if(!k)break}h.push({ykeys:a[i].value,labels:a[i].name,colors:k?d[0]:d[j]})}0==h.length&&(h=[{}]),c["colors-mapping"]=h}}]}]},{title:"Format",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}},{key:"label-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]}]},{title:"Legend",items:[{type:"radios-inline",key:"show-legend",titleMap:[{value:"true",name:"True"},{value:"false",name:"False"}]},{type:"section",htmlClass:"",items:[{key:"colors-mapping",title:"Legend Details",add:null,remove:null,items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].ykeys",title:"Channel"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].labels",title:"Legend Label"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"colors-mapping[].colors",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{"show-legend":{title:"Show Legend",default:"true",type:"string",description:"Set visibility of the legend."},"hover-callback":{title:"Hover callback",type:"string",description:"Provide a function on this option to generate custom hover legends. The function will be called with the index of the row under the hover legend, the options object passed to the constructor as arguments, a string containing the default generated hover legend content HTML, and an object containing the original data for the row as passed in the data option. hoverCallback: function (index, options, content, row) {return 'sin(' + row.x + ')='+ row.y}"},stream:{title:"Channels",type:"array",items:{type:"object",properties:{label:{type:"string",title:"Channel"}}},validationMessage:"Required.",description:"",placeholder:" "},boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},data:{title:"Data",type:"string",description:"Data series in case of static data.","x-schema-form":{type:"textarea",placeholder:"[{ y: '2006', a: 100, b: 90 },{ y: '2007', a: 75,  b: 65 }, { y: '2008', a: 50,  b: 40 }]"}},"colors-mapping":{title:"Colors",type:"array",default:[],description:"An array of strings containing HTML-style hex colors for each of the donut segments. Note: if there are fewer colors than segments, the colors will cycle back to the start of the array when exhausted.",items:{type:"object",properties:{colors:{title:"Colors",type:"string",format:"color",validationMessage:"Invalid Color"},labels:{title:"labels",type:"string"},ykeys:{title:"Channel",readonly:!0,type:"string"}}}},"label-color":{title:"Donut Label Color",type:"string",description:"Donut label color.",format:"color",default:"#eeeeee",validationMessage:"Invalid Color"},"background-color":{title:"Donut Background Color",type:"string",description:"Donut background color.",format:"color",default:"#ffffff",validationMessage:"Invalid Color"}},required:["stream"]}},{name:"gauge",label:"Gauge",class:"scriptr-gauge",commonData:!0,show:!0,defaults:{transport:"wss","on-format-data":"if(data && data.length > 0) return data[0].value; else return data;","data-type":"latest","data-format":"live","schema-for":"gauge","display-metric-param":"display_metric","fetch-data-interval":300,boxLabel:"Gauge",boxBorder:!0,data:[{value:30}],"value-font-color":"#005588",height:"99","height-unit":"%",min:0,max:100,"level-colors":["#008877"],"custom-sectors":{percents:"false",ranges:[]}},box:{sizeX:1,sizeY:2,minSizeX:1,minSizeY:2},imgCls:"gauge-img",imgSrc:"gauge.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"",items:[{key:"stream",type:"uiselect",placeholder:"",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"gauge"},onChange:function(a,b,c){if(a&&a.length>0){var d=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a.split("-")[0]}).sensors,{selectedStreamValue:a});c["available-units"]={si:d.si_unit,us:d.us_unit,scaled:d.scaled_unit},d.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false"}}}]}]},{title:"Format",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"value-font-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["label"]},{type:"section",htmlClass:"col-xs-12",items:[{key:"label-font-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"gauge-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["decimals"]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"level-colors",items:[{key:"level-colors[]",title:"",colorFormat:"hex3",
spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}],style:{add:"btn-primary btn-sm pull-left"}}]}]}]},{title:"Min/Max",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"min",onFieldLoad:function(a,b,c){if(c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]]=getConversionFunction(d,e)(c[b.key[0]])),c.unit&&c.unit!=e&&(c.unit=e)}}}]},{type:"section",htmlClass:"col-xs-12",items:[{key:"max",onFieldLoad:function(a,b,c){if(c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]]=getConversionFunction(d,e)(c[b.key[0]])),c.unit&&c.unit!=e&&(c.unit=e)}}},{key:"hide-min-max",type:"radios-inline",titleMap:[{value:"false",name:"Yes"},{value:"true",name:"No"}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},data:{title:"Static data",type:"number",description:"Gauge static value to show"},stream:{title:"Channel",type:"string",description:"",placeholder:" ",validationMessage:"Required."},"value-font-color":{title:"Gauge Value Text Color",type:"string",default:"#005386",format:"color",description:"",validationMessage:"Invalid Color"},min:{title:"Minimum Gauge Value",type:"number",default:0,description:""},max:{title:"Maximum Gauge Value",type:"number",default:100,description:""},"hide-min-max":{title:"Show Minimum/Maximum Values",type:"string",default:"false",description:""},"hide-value":{title:"Hide value",type:"string",default:"false",description:"Select true to hide gauge value"},"show-inner-shadow":{title:"Show shadow",type:"string",default:"false",description:"Show gauge inner shadow"},"gauge-color":{title:"Gauge Background Color",type:"string",format:"color",description:"",validationMessage:"Invalid Color"},"custom-sectors":{title:"Custom sectors",type:"object",properties:{percents:{title:"Percents",type:"string",default:"false",description:"Set to true for to have percent based sectors."},ranges:{type:"array",items:{type:"object",properties:{color:{title:"Sector Color",type:"string",format:"color",required:!0,validationMessage:"Invalid Color"},lo:{title:"Low",type:"number",required:!0},hi:{title:"High",type:"number",required:!0}}}}}},"shadow-size":{title:"Shadow size",type:"number",default:5,description:"Gauge inner shadow size."},"shadow-opacity":{title:"Shadow opacity",type:"number",default:.2,description:"Shadow opacity, values 0 ~ 1",minimum:0,maximum:1},label:{title:"Label",type:"string",description:"Text to show below gauge value."},"label-font-color":{title:"Label Color",type:"string",description:"Color of label under the gauge value.",format:"color",validationMessage:"Invalid Color",default:"#333"},"start-animation-type":{title:"Start animation",type:"string",default:"linear",description:"Select type of initial animation.",placeholder:" "},"refresh-animation-type":{title:"Refresh animation",type:"string",default:"linear",description:"Select type of refresh animation.",placeholder:" "},"value-font-family":{title:"Gauge font family",type:"string",default:"Arial",placeholder:" ",description:"Font family of the gauge."},"value-min-font-size":{title:"Value size",type:"number",default:12,description:"Minimum font size for the value."},"label-min-font-size":{title:"Label size",type:"number",default:12,description:"Minimum font size for the label."},"min-label-min-font-size":{title:"Min label size",type:"number",default:12,description:"Minimum font size for the minimum label."},"max-label-min-font-size":{title:"Max label size",type:"number",default:12,description:"Minimum font size for the maximum label."},"gauge-width-scale":{title:"Width scale",type:"number",default:1,description:"Gauge width scale."},"shadow-vertical-offset":{title:"Shadow vertical offset",type:"number",default:3,description:"Defines how much is shadow offset from top."},"level-colors":{title:"Level Colors",type:"array",minItems:1,items:{type:"string",format:"color",validationMessage:"Invalid Color"},format:"color",default:["#005588"],description:"Color of indicators, from lower to upper."},"relative-gauge-size":{title:"Relative gauge size",type:"string",default:"true",description:"Set to true to use sector-based color change, false to use gradual color change."},"no-gradient":{title:"No gradient",type:"string",default:"true",description:"Set to true to use sector-based color change, false to use gradual color change."},"start-animation-time":{title:"Start animation time",type:"number",default:700,description:"Duration of initial load animation in ms."},"refresh-animation-time":{title:"Refresh animation time",type:"number",default:700,description:"Length of refresh animation in ms."},donut:{title:"Donut",type:"string",default:"false",description:"Turn the gauge into a full circle donut."},"donut-start-angle":{title:"Donut start angle",type:"number",default:90,description:"Angle to start from when in donut mode."},width:{title:"Width",type:"number",description:"Gauge width"},height:{title:"Height",type:"number",description:"Gauge height."},reverse:{title:"Reverse",type:"string",default:"false",description:"Set to trueto swap max and min (with max appearing on the left, min on the right)."},decimals:{title:"Decimals",type:"number",default:0,description:"Quantity of decimal numbers to show."},symbol:{title:"Symbol",type:"string",description:"Unit of measure that will be appended to value."},"format-number":{title:"Format number",type:"string",default:"false",description:"Set to true to format numbers."},"human-friendly":{title:"Human friendly",type:"string",default:"false",description:"Set to true to show shorthand big numbers (300K instead of 300XXX)."},"human-friendly-decimal":{title:"Human friendly decimals",type:"number",default:0,description:"Number of decimal places for our human friendly number to contain."},pointer:{title:"Pointer",type:"string",default:"false",description:"Set to true to show value pointer."},counter:{title:"Counter",type:"string",default:"false",description:"Set to true to increase numbers one by one."}},required:["stream","level-colors"]}},{name:"thermometer",label:"Thermometer",class:"scriptr-thermometer",commonData:!0,show:!0,defaults:{transport:"wss","on-format-data":"if(data) return data[0].value; else return data;","data-type":"latest","data-format":"live","schema-for":"thermometer","display-metric-param":"display_metric","fetch-data-interval":300,data:[{value:0}],value:80,boxLabel:"Thermometer",boxBorder:!0,step:40,unit:"°C","custom-sectors":[{color:"#005588",lo:0,hi:40},{color:"#00953c",lo:40,hi:80},{color:"#ce2029",lo:80,hi:120}]},box:{sizeX:1,sizeY:3,minSizeX:1,minSizeY:3,maxSizeX:1},imgCls:"thermometer-img",imgSrc:"thermometer.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"",items:[{key:"stream",type:"uiselect",placeholder:"",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"thermometer"},onChange:function(a,b,c){if(a&&a.length>0){var d=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a.split("-")[0]}).sensors,{selectedStreamValue:a});c["available-units"]={si:d.si_unit,us:d.us_unit,scaled:d.scaled_unit},d.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false"}}}]}]},{title:"Format",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"section",htmlClass:"",items:["step"]},{type:"section",htmlClass:"",items:[{key:"custom-sectors",title:"Temperature Level Fill Colors",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-4",items:[{key:"custom-sectors[].color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-4",items:[{key:"custom-sectors[].lo",onFieldLoad:function(a,b,c){if(c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]])),c.unit&&c.unit!=e&&(c.unit=e)}}}]},{type:"section",htmlClass:"col-xs-4",items:[{key:"custom-sectors[].hi",onFieldLoad:function(a,b,c){if(c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]])),c.unit&&c.unit!=e&&(c.unit=e)}}}]}]}]}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{data:{title:"Thermometer Value",type:"string",description:"Thermometer Value (0 to 100)"},stream:{title:"Channel",type:"string",description:"",placeholder:" ",validationMessage:"Required."},height:{title:"Height",type:"number",description:"Set the height of Thermometer."},unit:{title:"Unit",type:"hidden",default:"°C",description:"Set the unit value of Thermometer."},"out-of-range-color":{title:"Out Of Range Color",type:"string",description:"Set the default color for out of range values (default: #005588).",format:"color",default:"#ffef00",validationMessage:"Invalid Color"},"custom-sectors":{title:"Custom sectors",type:"array",items:{type:"object",properties:{color:{title:"Color",type:"string",format:"color",required:!0,validationMessage:"Invalid Color"},lo:{title:"Low",type:"number",required:!0},hi:{title:"High",type:"number",required:!0}}}},step:{title:"Interval",type:"number",description:"Set the interval value between ticks."},boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."}},required:["stream"]}},{name:"plotly",label:"Wind Rose",class:"scriptr-plotly",commonData:!0,show:!0,defaults:{transport:"wss","data-type":"raw","schema-for":"windrose","data-format":"windrose","fetch-from-date-param":"from_date","fetch-to-date-param":"to_date","display-metric-param":"display_metric","fetch-data-interval":300,"on-format-data":"return data;",boxLabel:"Wind Rose",boxBorder:!0,"retrieved-data":[{direction:"E",speeds:[2,3,15,17]},{direction:"ESE",speeds:[24,8,4]},{direction:"SSE",speeds:[2.5,7,16]},{direction:"S",speeds:[3,8,2,1,9,11]},{direction:"SSW",speeds:[13,3,7.5,8]},{direction:"WSW",speeds:[21,14,9]},{direction:"W",speeds:[7,0,8,9,15,19,11]},{direction:"WNW",speeds:[4,17,21]},{direction:"NNW",speeds:[14,7]},{direction:"N",speeds:[20,0,5,9,7]},{direction:"NNE",speeds:[1,.5,6.5]},{direction:"ENE",speeds:[3.5,30,15]}]},box:{sizeX:2,sizeY:4,minSizeX:2,minSizeY:4},imgCls:"",imgSrc:"wind-rose.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"windDirection",type:"uiselect",placeholder:"",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"plotly",widgetField:"Wind Direction"},onChange:function(a,b,c){var d=[];a&&""!=a&&d.push(a),c.windSpeed&&("string"==typeof c.windSpeed&&""!=c.windSpeed||"object"==typeof c.windSpeed&&c.windSpeed.length>0)&&("object"==typeof c.windSpeed?d.push(c.windSpeed[0]):d.push(c.windSpeed)),c.stream=d}}]},{type:"section",htmlClass:"col-xs-12",items:[{key:"windSpeed",type:"uiselect",placeholder:"",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"plotly",widgetField:"Wind Speed"},onChange:function(a,b,c){var d=[];if(a&&""!=a){var e=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a.split("-")[0]}).sensors,{selectedStreamValue:a});c["available-units"]={si:e.si_unit,us:e.us_unit,scaled:e.scaled_unit},e.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false",d.push(a)}c.windDirection&&("string"==typeof c.windDirection&&""!=c.windDirection||"object"==typeof c.windDirection&&c.windDirection.length>0)&&("object"==typeof c.windDirection?d.push(c.windDirection[0]):d.push(c.windDirection)),c.stream=d}}]},{type:"section",htmlClass:"col-xs-12",items:[{key:"aggregation-range",type:"strapselect",placeholder:"Select the aggregation range for the streams data you are charting.",titleMap:[{value:"10",name:"10 minutes"},{value:"30",name:"30 minutes"},{value:"60",name:"1 hour"},{value:"1440",name:"1 day"}]}]}]}]},{title:"Format",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"custom-ranges",title:"Fill Colors & Ranges",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-4",items:[{key:"custom-ranges[].color",title:"Color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!1,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#fce94f","#fcaf3e","#e9b96e"],["#8ae234","#729fcf","#ad7fa8"],["#ef2929","#888a85","#deface"]]}}]},{type:"section",htmlClass:"col-xs-4",items:[{key:"custom-ranges[].lo",onFieldLoad:function(a,b,c){if(c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]])),c.unit&&c.unit!=e&&(c.unit=e)}}}]},{type:"section",htmlClass:"col-xs-4",items:[{key:"custom-ranges[].hi",onFieldLoad:function(a,b,c){if(c["default-metric-value"]&&c["default-metric-value"]!=c["display-metric-value"]&&c["available-units"]&&"false"==c["is-scaled"]){var d=c["available-units"][c["default-metric-value"]],e=c["available-units"][c["display-metric-value"]];d!==e&&(c[b.key[0]][b.key[1]][b.key[2]]=getConversionFunction(d,e)(c[b.key[0]][b.key[1]][b.key[2]])),c.unit&&c.unit!=e&&(c.unit=e)}}}]}]}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{stream:{title:"Stream",type:"hidden"},windDirection:{title:"Wind Direction Channel",type:"string",description:"",placeholder:" ",validationMessage:"Required."},windSpeed:{title:"Wind Speed Channel",type:"string",description:"",placeholder:" ",validationMessage:"Required."},"font-size":{title:"Font Size",type:"number",default:16,description:"Set the font size of the wind rose (in px)."},"show-legend":{title:"Show Legend",type:"string",default:"true",description:"Set visibility of the legend."},boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},"custom-ranges":{title:"Custom Ranges",type:"array",default:[{color:"#00476b",lo:0,hi:2},{color:"#005487",lo:2,hi:4},{color:"#006699",lo:4,hi:6},{color:"#0082b5",lo:6,hi:8},{color:"#0294c1",lo:8,hi:10},{color:"#06a9ce",lo:10,hi:20}],items:{type:"object",properties:{color:{title:"Sector Color",type:"string",format:"color",required:!0,validationMessage:"Invalid Color"},lo:{title:"Low",type:"number",required:!0},hi:{title:"High",type:"number",required:!0}}}}},required:["stream","windSpeed","windDirection"]}},{name:"grid",label:"Grid",class:"scriptr-grid",show:!1,commonData:!0,defaults:{"columns-definition":'[{headerName: "Name", field: "name", "minWidth": 110},{headerName: "Model", field: "model", "minWidth": 110},{headerName: "Price", field: "price", "minWidth": 110}]',"row-data":'[{name: "Toyota", model: "Celica", price: 35000},{name: "Ford", model: "Mondeo", price: 32000},{name: "Porsche", model: "Boxter", price: 72000}]',"data-type":"raw","data-format":"grid","schema-for":"grid","fetch-data-interval":300,boxLabel:"Grid",boxBorder:!0,"fixed-height":"false","on-format-data":"return data;","pagination-page-size":"20",transport:"wss","cell-editable":!1,"enable-client-side-sorting":!1,"enable-client-side-sorting":!1,pagination:"true","enable-server-side-sorting":"false","enable-server-side-filter":"false","enable-col-resize":"true"},box:{sizeX:2,sizeY:3,minSizeX:2,minSizeY:3},imgCls:"grid-img",imgSrc:"grid.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"",items:[{key:"stream",type:"uiselectmultiple",placeholder:"",onChange:function(a,b,c){var e=[];c["available-units"]={},e.push({headerName:"Date",field:"date",minWidth:110,cellRenderer:function(a,b){return moment(d).format("YYYY-MM-DD HH:mm")}}),_.forEach(a,function(a){var b={streamTitle:a.name,field:a.value,minWidth:110,streamValue:a.value};if(c["display-metric-value"]){var d=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a.value.split("-")[0]}).sensors,{selectedStreamValue:a.value});c["available-units"][a.value]={si:d.si_unit,us:d.us_unit,scaled:d.scaled_unit},d.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false"}e.push(b)}),e.length>0&&(c["columns-definition"]=JSON.stringify(e),delete c["row-data"])},options:{closeOnSelect:!1,groupBy:"dataStream",multiple:"true",callback:"multiSelectCallBack",widgetName:"grid"}}]}]},{title:"Format",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"pagination",type:"radios-inline",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["pagination-page-size",{key:"enable-server-side-sorting",type:"radios-inline",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},{key:"enable-server-side-filter",type:"radios-inline",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]},{key:"enable-col-resize",type:"radios-inline",titleMap:[{value:"true",name:"Yes"},{value:"false",name:"No"}]}]}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},stream:{title:"Channels",type:"array",items:{type:"object",properties:{label:{type:"string",title:"Channel"}}},validationMessage:"Required.",description:"",placeholder:" "},"columns-definition":{title:"Columns definition",type:"string",description:"Series of data (Each column in the grid is defined using a column definition).","x-schema-form":{type:"textarea",placeholder:"[{'headerName': 'Name', 'field': 'name'}, {'headerName': 'Model', 'field': 'model'}, {'headerName': 'Price', 'field': 'price', 'type': 'numeric'}]"}},"row-data":{title:"Row data",type:"string",description:"You pass static data to the grid.","x-schema-form":{type:"textarea",placeholder:"[{'name': 'Golf', 'model': 'GT', 'price' : '10000'}, {'name': 'BMW', 'model': 'Z3', 'price' : '20000'}]"}},"enable-client-side-sorting":{title:"Enable client Side Sorting",type:"string",description:"Turn on client sorting for the grid."},"enable-client-side-filter":{title:"Enable Client Side Filter",type:"string",description:"Turn on client side filter."},"enable-add-row":{title:"Enable Add Row",type:"hidden",description:"Turn on insert row."},"enable-delete-row":{title:"Enable Delete Row",type:"hidden",description:"Turn on delete row."},"cell-editable":{title:"Cell Editable",type:"hidden",description:"Turn on cell editing."},"row-model-selection":{title:"Row Model Selection",type:"hidden",description:"Set to either 'single' or 'multiple' in case of backend data.",default:"Source Sans Pro",placeholder:" "},"suppress-filter":{title:"Suppress filer",type:"hidden",description:"Hide column filter."},"add-params":{title:"on-add API Params",type:"hidden",description:"On add API params.","x-schema-form":{placeholder:"Ex: {'id' : '599865'}"}},"delete-params":{title:"on-delete API Params",type:"hidden",description:"On delete API params.","x-schema-form":{placeholder:"Ex: {'id' : '599865'}"}},"edit-params":{title:"on-edit API Params",type:"hidden",description:"On edit API params.","x-schema-form":{placeholder:"Ex: {'id' : '599865'}"}},"enable-server-side-sorting":{title:"Enable Sorting",type:"string",description:"",default:"false"},"enable-server-side-filter":{title:"Enable Filtering",type:"string",description:"",default:"false"},"enable-col-resize":{title:"Enable Column Resize",type:"string",description:""},pagination:{title:"Enable Pagination",type:"string",description:""},"row-model-type":{title:"Row Model Type",type:"string",description:"The supported ways are 'virtual' and 'pagination' for only non-static data",default:"pagination",placeholder:" "},"pagination-page-size":{title:"Number of Rows Per Page",type:"string",description:""}},required:["stream","columns-definition"]}},{name:"odometer",label:"Odometer",class:"scriptr-odometer",commonData:!0,show:!0,defaults:{transport:"wss",boxLabel:"Odometer","on-format-data":"if(data) return data[0].value; else return data;","data-type":"latest","data-format":"live","display-metric-param":"display_metric",boxBorder:!0,"schema-for":"odometer","fetch-data-interval":300,data:[{value:28022017}],animation:"count",duration:1e3,size:2},box:{sizeX:1,sizeY:2,minSizeX:1,minSizeY:2},imgCls:"odometer-img",imgSrc:"odometer.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"",items:[{key:"stream",type:"uiselect",placeholder:"",options:{closeOnSelect:!0,groupBy:"dataStream",callback:"multiSelectCallBack",widgetName:"odometer"},onChange:function(a,b,c){if(a&&a.length>0){var d=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a.split("-")[0]}).sensors,{selectedStreamValue:a});c["available-units"]={si:d.si_unit,us:d.us_unit,scaled:d.scaled_unit},d.is_scaled?c["is-scaled"]="true":c["is-scaled"]="false"}}}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},stream:{title:"Channel",type:"string",description:"",placeholder:" ",validationMessage:"Required."},data:{title:"Static data",type:"number",description:"Set a static value for Odometer."},duration:{title:"Duration",type:"number",description:"Animation duration"},size:{title:"Size",type:"number",description:"Recommended size between 0 & 5."},animation:{title:"Animation",type:"string",description:"Count is a simpler animation method which just increments the value,use it when you're looking for something more subtle."}},required:["stream"]}},{name:"separator",show:!1},{name:"alarms",label:"Alarms",class:"scriptr-displaycount",commonData:!1,show:!1,defaults:{"on-format-data":"return data;",transport:"wss",data:"12",message:"Alarms","number-background-color":"#005588","fetch-data-interval":300,api:"app/api/dashboard/getUserAlarms","api-params":'{"alarm_type": "total","fetchPeriod":"past_day"}',"alarm-type":"total","number-cell-size":"medium"},box:{sizeX:1,sizeY:1,minSizeX:1,minSizeY:1},imgCls:"alarms-img",imgSrc:"alarms.svg",isAlarm:!0},{name:"connectedDevices",label:"Connected Devices",class:"scriptr-displaycount",commonData:!1,show:!0,defaults:{"on-format-data":"return data;",transport:"wss",data:"12","number-background-color":"#005588",message:"Connected Devices","fetch-data-interval":300,api:"app/api/dashboard/getUserAlarms","api-params":'{"alarm_type": "successful_connections","fetchPeriod":"past_day"}',"alarm-type":"successful_connections","number-cell-size":"medium"},box:{sizeX:1,sizeY:1,minSizeX:1,minSizeY:1},imgCls:"connected-img",imgSrc:"connected-devices.svg",isAlarm:!0},{name:"connectionIssues",label:"Connection Issues",class:"scriptr-displaycount",commonData:!1,show:!0,defaults:{"on-format-data":"return data;",transport:"wss",message:"Connection Issues","number-background-color":"#005588",data:"12","fetch-data-interval":300,api:"app/api/dashboard/getUserAlarms","api-params":'{"alarm_type": "failed_connections","fetchPeriod":"past_day"}',"alarm-type":"failed_connections","number-cell-size":"medium"},box:{sizeX:1,sizeY:1,minSizeX:1,minSizeY:1},imgCls:"connection-img",imgSrc:"connection-issues.svg",isAlarm:!0},{name:"totalDevices",label:"Total Devices",class:"scriptr-displaycount",commonData:!1,show:!0,defaults:{"on-format-data":"return data;",transport:"wss",message:"Total Devices","number-background-color":"#005588",data:"12","fetch-data-interval":300,api:"app/api/dashboard/getUserAlarms","api-params":'{"alarm_type": "number_of_stations","fetchPeriod":"past_day"}',"alarm-type":"number_of_stations","number-cell-size":"medium"},box:{sizeX:1,sizeY:1,minSizeX:1,minSizeY:1},imgCls:"connected-img",imgSrc:"total-devices.svg",isAlarm:!0},{name:"latestConditions",label:"Latest Conditions",class:"scriptr-grid",show:!0,commonData:!0,defaults:{"columns-definition":'[{headerName: "Date", field: "date", "minWidth": 50, valueFormatter: "((value != \\"-\\") ? moment(value).format(\\"MM/DD/YYYY HH:mm\\") : \\"-\\")"}, {headerName: "Channel", field: "label", "minWidth": 50},{headerName: "Value", field: "value", "minWidth": 50}]',"row-data":'[{label: "Channel 1", value: "23"},{label: "Channel 2", value: "34"}]',"data-type":"latest","data-format":"latestconditions","schema-for":"grid","fetch-data-interval":300,boxLabel:"Latest Conditions",boxBorder:!0,"fixed-height":"false","on-format-data":'return {"documents":data.data, "count": data.data.length, "timeZone":data.timeZone};',transport:"wss","cell-editable":!1,"enable-client-side-sorting":!1,pagination:"false","enable-server-side-sorting":!1,"enable-server-side-filter":!1,"enable-col-resize":"false"},box:{sizeX:3,sizeY:3,minSizeX:3,minSizeY:3},imgCls:"latest-img",imgSrc:"latest-conditions.svg",form:[{type:"tabs",tabs:[{title:"Data",items:[{type:"section",htmlClass:"",items:[{key:"stream",type:"uiselectmultiple",placeholder:"",options:{closeOnSelect:!1,groupBy:"dataStream",multiple:"true",callback:"multiSelectCallBack",widgetName:"grid",limit:20},onChange:function(a,b,c){for(var d={},e=c["labels-mapping"],f=0;f<e.length;f++)e[f].keys&&(d[e[f].keys]={labels:e[f].labels});for(var g=[],h=0;h<a.length;h++)if(d[a[h].value])g.push({keys:a[h].value,labels:d[a[h].value].labels});else{var i=_.findWhere(_.findWhere(JSON.parse(window.localStorage.dataStream),{logger_sn:a[h].value.split("-")[0]}).sensors,{selectedStreamValue:a[h].value});g.push({keys:a[h].value,labels:i.display})}0==g.length&&(g=[{}]),c["labels-mapping"]=g,delete c["row-data"]}}]}]},{title:"Box Properties",items:["boxLabel"]}]}],schema:{type:"object",title:"Schema",properties:{"labels-mapping":{title:"Labels",type:"hidden",default:[],description:"",items:{type:"object",properties:{labels:{title:"Labels",type:"string"},keys:{title:"Key",type:"string"}}}},boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxBorder:{title:"Box Border",type:"hidden",default:"true",description:"Define your widget box border."},stream:{title:"Channels",type:"array",items:{type:"object",properties:{label:{type:"string",title:"Channel"}}},validationMessage:"Required.",description:"",placeholder:" "},"columns-definition":{title:"Columns definition",type:"string",description:"Series of data (Each column in the grid is defined using a column definition).","x-schema-form":{type:"textarea",placeholder:"[{'headerName': 'Channel', 'field': 'label'}, {'headerName': 'Value', 'field': 'value'}]"}},"row-data":{title:"Row data",type:"string",description:"You pass static data to the grid.","x-schema-form":{type:"textarea",placeholder:"[{label: 'Channel 1', value: '23'},{label: 'Channel 2', value: '34'}]"}}},required:["stream","columns-definition"]}}]}),angular.module("DashboardBuilder").component("dashboardsList",{bindings:{dashboard:"<",layout:"@"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/dashboardsList.html",controller:["$scope","$rootScope","$filter","$timeout","$sce","$window","httpClient","wsClient","$cookies","config","$uibModal","scriptrService","$route","$routeParams","$q","_",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.wsClient=h;var q=this;q.acls,q.hideEditBtn=!1,q.cdnImagesPath=cdnImagesPath,this.$onInit=function(){q.user=window.localStorage.user?JSON.parse(window.localStorage.user):null,null!=q.user&&q.user.favDashboardKey&&(q.favDashboardKey=q.user.favDashboardKey),q.loading=!0,q.showPanelMsg=!1,null!=q.user&&q.user.preferredLayout?q.layout=q.user.preferredLayout:q.layout="grid",q.users=[{code:"anonymous",icon:"fa fa-group"}],this.urlParams=[],this.transport=angular.copy(j.transport),this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!0}},this.gridOptions={columnDefs:[{headerName:"",field:"star",valueGetter:function(a){return a.data},cellRenderer:function(a){return'<a href="" ng-click="$ctrl.setFavoriteDashboard(\''+a.value.key+'\')" class="favorite-star" uib-tooltip="Star this dashboard for easy access from the menu. You can star one dashboard at a time." tooltip-placement="auto" tooltip-append-to-body="true"><i ng-class="$ctrl.favDashboardKey == \''+a.value.key+"' ? 'fas fa-star' : 'far fa-star'\" aria-hidden=\"true\"></i></a>"},width:f.innerWidth<=450?65:35,cellStyle:{paddingTop:8,textAlign:"center"}},{headerName:"Name",unSortIcon:!0,icons:{sortAscending:'<i class="fas fa-sort-up" aria-hidden="true"></i>',sortDescending:'<i class="fas fa-sort-down" aria-hidden="true"></i>',sortUnSort:'<span class="unsort-state"><i class="fas fa-angle-up" aria-hidden="true"></i><i class="fas fa-angle-down" aria-hidden="true"></i></span>'},field:"dashboardName",comparator:function(a,b,c,d){return a.dashboardName.localeCompare(b.dashboardName)},cellStyle:{paddingTop:6},valueGetter:function(a){return a.data},cellRenderer:function(a){return'<span class="img-thumb"><div class="table-display"><div class="cell-display">'+(a.value.viewFile?'<img class="img-responsive grid-img" src="'+a.value.viewFile+'" />':'<img class="img-responsive" src="'+cdnImagesPath+'default-icon.svg" />')+'</div></div></span><span class="grid-name"><a href="#/dockey/'+a.value.key+'">'+a.value.dashboardName+"</a></span>"}},{headerName:"Modified",field:"lastModifiedDate",cellRenderer:function(a){return c("date")(a.value,"MMMM dd, yyyy HH:mm")},unSortIcon:!0,icons:{sortAscending:'<i class="fas fa-sort-up" aria-hidden="true"></i>',sortDescending:'<i class="fas fa-sort-down" aria-hidden="true"></i>',sortUnSort:'<span class="unsort-state"><i class="fas fa-angle-up" aria-hidden="true"></i><i class="fas fa-angle-down" aria-hidden="true"></i></span>'},cellStyle:{paddingTop:6}},{headerName:"",field:"isPublic",valueGetter:function(a){return a.data},cellRenderer:function(a){return'<span ng-show="{{'+a.value.isPublic+'}}" class="badge badge-warning mt5"><i class="fa fa-eye" aria-hidden="true"></i> Public</span>'},cellStyle:{textAlign:"right",paddingTop:2}},{headerName:"",field:"key",cellRenderer:function(a){return'<a ng-show="!$ctrl.hideEditBtn" title="Configure this dashboard" ng-href="#/dockey/'+a.value+'/edit"><img class="icon-img" src="'+cdnImagesPath+'blue-wrench.svg" /></a>'},width:35,cellStyle:{
textAlign:"center",paddingTop:5}},{headerName:"",field:"dashboard",valueGetter:function(a){return a.data},cellRenderer:function(a){return'<a title="Remove this dashboard" ng-click="$ctrl.deleteDashboardConfirmation(\''+a.value.dashboardName+"', '"+a.value.key+'\')"><img class="icon-img pointer" src="'+cdnImagesPath+'blue-bin.svg" /></a>'},width:55,cellStyle:{textAlign:"center",paddingTop:4}}],rowData:null,rowHeight:34,headerHeight:37,angularCompileRows:!0,enableSorting:!0,animateRows:!0,domLayout:"autoHeight",pagination:!0,paginationPageSize:10,onGridSizeChanged:function(a){if(f.innerWidth<=768){var b=["star","dashboardName","dashboard","key"],c=["lastModifiedDate","public"];q.gridOptions.columnApi.setColumnsVisible(b,!0),q.gridOptions.columnApi.setColumnsVisible(c,!1)}else q.gridOptions.columnApi.setColumnsVisible(["star","dashboardName","dashboard","key","lastModifiedDate","public"],!0);f.innerWidth<=450?q.gridOptions.columnDefs[0].width=65:q.gridOptions.columnDefs[0].width=35,d(q.gridOptions.api.sizeColumnsToFit(),1e3)},onGridReady:function(a){l.loadDashboards({}).then(function(a,b){a?(q.customDashboards=a,q.gridOptions.api.setRowData(a),q.setGridPaginationIcons(),q.loading=!1,0==a.length&&(q.noDashboards=!0),q.gridOptions.api.sizeColumnsToFit()):q.loading=!1},function(a){q.loading=!1})}},a.$watch(function(a){return f.innerWidth},function(a){q.hideEditBtn=a<768}),a.$watch(function(a){return a.query},function(a){var b=[];if(void 0!==a&&null!=a&&""!=a)for(var c=0;c<q.customDashboards.length;c++)-1!=q.customDashboards[c].dashboardName.toLowerCase().indexOf(a.toLowerCase())&&b.push(q.customDashboards[c]);else q.customDashboards&&(b=q.customDashboards);q.customDashboards&&(0==b.length?q.noDashboards=!0:(q.noDashboards=!1,q.gridOptions.api.setRowData(b),q.setGridPaginationIcons()))})},this.updateUserPreferences=function(a){var b={layout:a};l.updateUserPreferences(b).then(function(a,b){},function(a){})},this.setGridPaginationIcons=function(){$("button[ref=btPrevious]").html('<img src="'+cdnImagesPath+'previous.png" />'),$("button[ref=btFirst]").html('<img src="'+cdnImagesPath+'first.png" />'),$("button[ref=btNext]").html('<img src="'+cdnImagesPath+'next.png" />'),$("button[ref=btLast]").html('<img src="'+cdnImagesPath+'last.png" />')},this.deleteDashboardConfirmation=function(a,b){k.open({controller:"PopupCont",templateUrl:"/UIComponents/dashboardBuilder/javascript/components/deletePopup.html",backdrop:"static",resolve:{dashboard:function(){return q},name:function(){return a},key:function(){return b}}})},this.checkCreateDashboardEligibility=function(b){if(this.customDashboards&&10==this.customDashboards.length){b.preventDefault();k.open({animation:!0,component:"confirmationModal",backdrop:"static",size:"md",scope:a,resolve:{data:function(){return{title:"Information Message",body:"You can save a maximum of 10 dashboards.",btnCancelTitle:"Ok"}}}})}},this.setFavoriteDashboard=function(b){var c=!1;q.favDashboardKey&&b==q.favDashboardKey&&(c=!0);var d={dockey:c?null:b};l.setFavoriteDashboard(d).then(function(b,d){b&&b.status&&"success"==b.status&&(q.favDashboardKey=b.favDashboardKey,null!=q.user&&(c?delete q.user.favDashboardKey:q.user.favDashboardKey=q.favDashboardKey,window.localStorage.setItem("user",JSON.stringify(q.user))),a.$emit("render-menu"))},function(a){q.showMsg("danger","An error has occured")})},this.deleteDashboard=function(b){q.user=window.localStorage.user?JSON.parse(window.localStorage.user):null,null!=q.user&&q.user.favDashboardKey&&(q.favDashboardKey=q.user.favDashboardKey);var c={dockey:b};q=this,l.deleteDashboard(c).then(function(c,d){if(c&&c.status&&"success"==c.status){if(q.customDashboards=c.documents,q.gridOptions.api.setRowData(c.documents),q.setGridPaginationIcons(),0==c.documents.length?q.noDashboards=!0:q.noDashboards=!1,q.favDashboardKey&&b&&b==q.favDashboardKey){var e=JSON.parse(window.localStorage.user);delete e.favDashboardKey,window.localStorage.setItem("user",JSON.stringify(e)),a.$emit("render-menu")}}else c&&c.errorDetail?q.showMsg("danger",c.errorDetail):q.showMsg("danger","An error occurred while deleting the dashboard. Please try again later")},function(a){q.showMsg("danger","An error has occured")})},this.changeLayout=function(a){this.layout=a,b.layout=this.layout;var c=JSON.parse(window.localStorage.user);c.preferredLayout=this.layout,window.localStorage.setItem("user",JSON.stringify(c)),this.updateUserPreferences(this.layout),"grid"==this.layout&&d(function(){q.gridOptions.api.sizeColumnsToFit()},500)},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){this.closeAlert(),this.message={type:a,content:b},this.show=!0},this.closeMsg=function(){this.showPanelMsg=!1},this.showMsg=function(a,b){this.closeMsg(),this.message={type:a,content:b},this.showPanelMsg=!0}}]}),angular.module("DashboardBuilder").controller("PopupCont",["$scope","$uibModalInstance",function(a,b){a.name=a.$resolve.name,a.close=function(){b.dismiss("cancel")},a.ondeleteDashboard=function(){this.$resolve.dashboard.deleteDashboard(this.$resolve.key),b.dismiss("cancel")}}]),angular.module("DashboardBuilder").service("scriptrService",["httpClient","$cookies",function(a,b){this.saveScript=function(b,c){return a.post("app/api/dashboard/save",b,null,!0)},this.getDashboardDocument=function(b){return a.get("app/api/dashboard/get",b)},this.loadDashboards=function(b){return a.get("app/api/dashboard/list",{})},this.deleteDashboard=function(b){return a.get("app/api/dashboard/delete",b)},this.setFavoriteDashboard=function(b){return a.get("app/api/dashboard/favorite",b)},this.setDashboardPublicName=function(b){return a.get("app/api/dashboard/setPublicName",b)},this.setDashboardPublicAccess=function(b){return a.get("app/api/dashboard/setRevokePublicAccess",b)},this.saveCalculatedChannel=function(b,c){return a.post("app/api/calculatedChannel/save",b,null,!0)},this.loadCalculatedChannels=function(b){return a.get("app/api/calculatedChannel/list",{})},this.consolidateCalculatedChannels=function(b){return a.get("app/api/calculatedChannel/consolidation/queueConsolidation",{})},this.getCalculatedChannelFormulaMapping=function(b){return a.get("app/api/calculatedChannel/getFormulaMapping",{})},this.deleteCalculatedChannel=function(b){return a.get("app/api/calculatedChannel/delete",b)},this.getCalculatedChannelDocument=function(b){return a.get("app/api/calculatedChannel/get",b)},this.updateUserPreferences=function(b){return a.get("app/api/users/updateUserPreference",b)}}]),angular.module("DashboardBuilder").component("dashboard",{bindings:{widgets:"<",dashboard:"<",treeSearchCriteria:"@",iconExpand:"@",iconCollapse:"@",loadTree:"<?",showTree:"<",devicesModel:"@",cdnImagesPath:"@"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/dashboard.html",controller:["$scope","$rootScope","$timeout","$sce","$window","httpClient","wsClient","$cookies","common","alarmsConfig","config","$uibModal","scriptrService","$route","$routeParams","$q","_","$filter","$element",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){this.wsClient=g;var t=this;t.acls,t.hideEditBtn=!1,b.multiSelectCallBack=function(a,b){var c=a.widgetName,d=a.widgetField,e=window.localStorage.getItem("dataStream"),f=window.localStorage.getItem("dataMapping"),g=[];f&&e&&(f=JSON.parse(f),e=JSON.parse(e));for(var h=0;h<e.length;h++)for(var i=e[h].label,j=e[h].sensors,k=0;k<j.length;k++){var l=j[k].measurement_type,m=f[l]?f[l].allowed:f.Default.allowed;if((m.indexOf(c)>-1||"calculatedChannel"==c)&&(!d||l==d||"Wind Speed"==d&&"Gust Speed"==l)){var n=j[k].selectedStreamValue;g.push({value:n,name:j[k].display,dataStream:i,availableUnits:{si:j[k].si_unit,us:j[k].us_unit,scaled:j[k].scaled_unit}})}}return g},this.$onInit=function(){this.defaultImage=this.cdnImagesPath+"default-icon.svg";window.localStorage.user&&JSON.parse(window.localStorage.user).id;this.publicDashboardUrl=window.location.origin+"/public/";var c=new UAParser,d=c.getResult(),f=d.device&&"tablet"===d.device.type;t.tablet=!1,(f||window.matchMedia(b.tabletBreakPoint).matches)&&(t.tablet=!0),t.ranchIsOpen=!1,t.showTree=void 0===this.showTree||this.showTree,t.loading=!0,t.showPanelMsg=!1,t.isEdit=!1,t.users=[{code:"anonymous",icon:"fa fa-group"}],this.urlParams=[],this.transport=angular.copy(k.transport),this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!1},validationMessage:{302:"Required field."}},this.initializeDashboard();var g="si",h=window.localStorage.user?JSON.parse(window.localStorage.user):null;h&&null!=h.preferredUnit&&""!=h.preferredUnit&&(g="SI (Metric)"==h.preferredUnit?"si":"us"),this.schema=angular.copy(k.script.schema),this.form=angular.copy(k.script.form),this.model={period:"past_day",unit:g},this.metric_schema=angular.copy(k.metricselector.schema),this.metric_form=angular.copy(k.metricselector.form),this.metric_model={},a.$root&&a.$root.isNew?(this.isEdit=!0,this.isNew=a.$root.isNew):(this.isEdit=!!o.edit,this.isNew=!1),a.$root&&a.$root.isPresentationMode?this.isPresentationMode=a.$root.isPresentationMode:this.isPresentationMode=!1,this.setDefaultTimeZone(),this.isNew?(this.setDefaultDashboardName(),b.currentDashboardUnit=g,b.fetchPeriod=this.model.period,this.model.timeZone&&(b.fetchTimeZone=this.model.timeZone)):(this.dashboardKey=o.dockey?o.dockey:b.dockey,this.getDashboard(this.dashboardKey)),this.slickConfig={enabled:!0,autoplay:!0,draggable:!1,autoplaySpeed:3e3,method:{},event:{beforeChange:function(a,b,c,d){},afterChange:function(a,b,c,d){}}},this.gridsterOptions={defaultSizeY:200,defaultSizeX:200,minRows:1,maxRows:100,floating:!0,columns:(t.tablet,5),colWidth:"auto",rowHeight:"83",margins:[10,10],defaultSizeX:1,defaultSizeY:2,mobileBreakPoint:480,minColumns:1,sparse:!1,resizable:{enabled:t.isEdit,handle:".my-class",start:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)},resize:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)},stop:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}},draggable:{enabled:t.isEdit,handle:".drag-box",start:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)},drag:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)},stop:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}}},a.$on("gridster-resized",function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}),a.$on("gridster-item-initialized",function(a){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}),this.widgetsConfig=k.widgets,this.widgetsCommon=i,this.dataLoaded=!0,a.$watch(function(a){return e.innerWidth},function(a){t.hideEditBtn=a<768})},this.trustSrc=function(a){return d.trustAsResourceUrl(a)},this.setDefaultDashboardName=function(){this.model.dashboardName="Dashboard "+r("date")(new Date,"MM-dd-yyyy")},this.enableEditDashboard=function(){t.model.timeZone&&"undefined"!=t.model.timeZone||this.setDefaultTimeZone(),this.closeAlert(),this.isEdit=!0,this.gridsterOptions.draggable.enabled=this.isEdit,this.gridsterOptions.resizable.enabled=this.isEdit,a.changeDisplayMetric(t.model.unit,null,!0),a.changeDisplayPeriod(t.model.period,null,!0),a.changeTimeZone(t.model.timeZone,null,!0),a.$broadcast("period_metric_change"),setTimeout(function(){t.ranchIsOpen=!1},100)},this.disableEditMode=function(){this.isNew?window.location.href="#/dashboardsList":(t.model.timeZone&&"undefined"!=t.model.timeZone||this.setDefaultTimeZone(),this.dashboard.widgets=angular.copy(this.dashboard.originalWidgets),this.dashboard.counter=angular.copy(this.dashboard.originalCounter),this.model=angular.copy(this.originalModel),a.changeDisplayMetric(this.model.unit,null,!0),a.changeDisplayPeriod(this.model.period,null,!0),a.changeTimeZone(t.model.timeZone,null,!0),a.$broadcast("period_metric_change"),this.metric_model&&(this.metric_model.unit=this.model.unit,this.metric_model.period=this.model.period,this.metric_model.timeZone=this.model.timeZone),this.isEdit=!1,this.gridsterOptions.draggable.enabled=this.isEdit,this.gridsterOptions.resizable.enabled=this.isEdit)},this.deleteDashboardConfirmation=function(){var a=this.model.dashboardName;l.open({controller:"PopupCont",templateUrl:"/UIComponents/dashboardBuilder/javascript/components/deletePopup.html",backdrop:"static",resolve:{dashboard:function(){return t},name:function(){return a}}})},this.deleteDashboard=function(){t.user=window.localStorage.user?JSON.parse(window.localStorage.user):null,null!=t.user&&t.user.favDashboardKey&&(t.favDashboardKey=t.user.favDashboardKey);var b={dockey:t.model.key};m.deleteDashboard(b).then(function(b,c){if(b&&b.status&&"success"==b.status&&(window.location.href="#/dashboardsList",t.favDashboardKey&&t.model.key==t.favDashboardKey)){var d=JSON.parse(window.localStorage.user);delete d.favDashboardKey,window.localStorage.setItem("user",JSON.stringify(d)),a.$emit("render-menu")}},function(a){})},b.fetchFromDate=moment().add(-1,"days").startOf("hour").valueOf(),b.fetchToDate=moment().valueOf(),this.setDefaultTimeZone=function(){moment().utcOffset()/60>0?b.fetchTimeZone="Etc/GMT"+-1*Math.floor(moment().utcOffset()/60):b.fetchTimeZone="Etc/GMT+"+-1*Math.floor(moment().utcOffset()/60),this.model.timeZone=b.fetchTimeZone},a.changeDisplayPeriod=function(c,d,e){"past_day"==c&&(b.fetchFromDate=moment().add(-1,"days").startOf("hour").valueOf()),"past_week"==c&&(b.fetchFromDate=moment().add(-7,"days").valueOf()),"past_month"==c&&(b.fetchFromDate=moment().add(-30,"days").valueOf()),b.fetchPeriod=c,e||a.$broadcast("period_change")},a.changeDisplayMetric=function(c,d,e){b.currentDashboardUnit=c,e||a.$broadcast("unit_change")},a.changeTimeZone=function(c,d,e){c&&"undefined"!=c&&(b.fetchTimeZone=c),e||a.$broadcast("time_zone_change")},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b,c){"401"!=c&&"429"!=c&&(this.closeAlert(),this.message={type:a,content:b},this.show=!0)},this.closeMsg=function(){this.showPanelMsg=!1},this.showMsg=function(a,b){this.closeMsg(),this.message={type:a,content:b},this.showPanelMsg=!0},this.initializeDashboard=function(){this.dashboard={widgets:[],counter:0},this.widgets&&(this.dashboard.widgets=this.widgets),this.dashboard.counter=this.dashboard.widgets.length},this.clear=function(){var b=this;l.open({animation:!0,component:"confirmationModal",backdrop:"static",size:"md",scope:a,resolve:{data:function(){return{title:"Clear this dashboard?",body:"Are you sure you want to remove all the widgets?",btnCancelTitle:"Cancel",btnSubmitTitle:"Clear dashboard"}}}}).result.then(function(a){a&&b.clearWidgets()},function(){})},this.clearWidgets=function(){this.dashboard.counter=0,this.dashboard.widgets=[]},this.logout=function(){$.scriptr.authorization({loginPage:login.loginTarget}).logout()};var u=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c};this.addWidget=function(a){if("string"==typeof a&&(a=JSON.parse(a)),a.url)return void window.open(a.url);if(this.dashboard.counter>=20)this.showInformationModel();else{a.defaults["default-metric-value"]||(a.defaults["default-metric-value"]=b.currentDashboardUnit),a.defaults["fetch-period"]||(a.defaults["fetch-period"]=b.fetchPeriod),a.defaults["fetch-time-zone"]||(a.defaults["fetch-time-zone"]=b.fetchTimeZone);var c=angular.copy(a.form),d=angular.copy(a.schema),e=q.findWhere(t.widgetsConfig,{name:a.name}),c=angular.copy(e.form),d=angular.copy(e.schema);if(e.commonData&&(c[0].tabs=angular.copy([i.formTab].concat(e.form[0].tabs)),c[0].selectedTabIndex=1,d.properties=u(e.schema.properties,i.schemaFields)),a.isAlarm&&(c=angular.copy(j.form),c[0].selectedTabIndex=0,d=angular.copy(j.schema)),a.selectedStreamValue&&a.selectedStreamFieldName){var f=[a.selectedStreamValue];a.defaults[a.selectedStreamFieldName]=f,a.defaults["available-units"]={si:a.selectedStreamUnits.si,us:a.selectedStreamUnits.us,scaled:a.selectedStreamUnits.scaled},a.defaults["is-scaled"]=a.isScaled?"true":"false",a.defaults.boxLabel=a.selectedStreamDisplay,a.defaults["colors-mapping"]=[{ykeys:a.selectedStreamValue,labels:a.selectedStreamDisplay,colors:"#1B1B1B",axisSelection:"y",unit:a.selectedStreamUnits,isScaled:a.isScaled}],a.defaults.data=[],a.defaults["fetch-from-date-value"]=b.fetchFromDate,a.defaults["fetch-to-date-value"]=b.fetchToDate,a.defaults["fetch-period"]=b.fetchPeriod,a.defaults["fetch-time-zone"]=b.fetchTimeZone,a.defaults["display-metric-value"]=b.currentDashboardUnit,a.defaults.api="app/api/dashboard/GetUserData",a.defaults["api-params"]=JSON.stringify({dataType:a.defaults["data-type"],streams:a.defaults[a.selectedStreamFieldName],dataFormat:a.defaults["data-format"],aggregationRange:a.defaults["aggregation-range"],display_metric:b.currentDashboardUnit,fetchPeriod:b.fetchPeriod,fetchTimeZone:b.fetchTimeZone})}var g=(t.tablet,0);a.selectedStreamValue=null,this.isManualAdd=!0,this.dashboard.widgets.push({name:a.name,sizeX:a.box&&a.box.sizeX?a.box.sizeX<3?a.box.sizeX+g:a.box.sizeX:2,sizeY:a.box&&a.box.sizeY?a.box.sizeY:2,minSizeX:a.box&&a.box.minSizeX?a.box.minSizeX<3?a.box.minSizeX+0:a.box.minSizeX:2,maxSizeX:a.box&&a.box.maxSizeX?a.box.maxSizeX+g:null,minSizeY:a.box&&a.box.minSizeY?a.box.minSizeY:2,maxSizeY:a.box&&a.box.maxSizeY?a.box.maxSizeY+g:null,label:a.label,type:a.class,options:a.defaults,schema:d,form:c})}},this.showInformationModel=function(){l.open({animation:!0,component:"confirmationModal",backdrop:"static",size:"md",scope:a,resolve:{data:function(){return{title:"Information Message",body:"You can add a maximum of 20 widgets.",btnCancelTitle:"Ok"}}}})},this.getDashboard=function(c){var d={dockey:c};m.getDashboardDocument(d).then(function(c,d){if(c.documents&&c.documents.length>0){if(t.dashboardDocument=angular.copy(c.documents[0]),t.model.dashboardName=t.dashboardDocument.dashboardName,t.model.unit=t.dashboardDocument.unit,t.model.period=t.dashboardDocument.period,t.model.image=t.dashboardDocument.viewFile,t.model.isPublic=t.dashboardDocument["document.readACL"].indexOf("anonymous")>-1,t.model.publicDashboardName=t.dashboardDocument.publicDashboardName?t.dashboardDocument.publicDashboardName:t.dashboardDocument.dashboardName,t.model.key=t.dashboardDocument.key,t.model.pluginData=t.dashboardDocument.pluginData,b.currentDashboardUnit=t.dashboardDocument.unit,b.fetchPeriod=t.dashboardDocument.period,t.dashboardDocument.timeZone&&"undefined"!=t.dashboardDocument.timeZone){t.model.timeZone=t.dashboardDocument.timeZone;["Asia/Katmandu","Asia/Tehran","Asia/Calcutta","Asia/Kolkata","America/St_Johns","Asia/Rangoon","Australia/Darwin","Australia/Adelaide","Asia/Kabul"].indexOf(t.dashboardDocument.timeZone)&&("Asia/Katmandu"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-5"),"Asia/Tehran"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-4"),"Asia/Calcutta"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-5"),"Asia/Kolkata"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-5"),"Asia/Rangoon"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-6"),"Asia/Kabul"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-4"),"America/St_Johns"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT+2"),"Australia/Darwin"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-9"),"Australia/Adelaide"==t.dashboardDocument.timeZone&&(t.model.timeZone="Etc/GMT-9")),b.fetchTimeZone=t.model.timeZone}a.changeDisplayPeriod(b.fetchPeriod,null),a.changeTimeZone(b.fetchTimeZone,null),t.originalModel=angular.copy(t.model),t.metric_model&&(t.metric_model.unit=t.model.unit,t.metric_model.period=t.model.period,t.metric_model.timeZone=t.model.timeZone)}t.model.key?t.postLoadScript(JSON.parse(t.model.pluginData)):t.setDefaultDashboardName()},function(a){t.showAlert("danger",a.data.response.metadata.errorDetail,a.data.response.metadata.statusCode)})},this.showLoading=function(){this.loadingModalInstance=l.open({controller:"LoadingCtrl",windowTemplateUrl:"/UIComponents/dashboardBuilder/javascript/components/loading.html",templateUrl:"/UIComponents/dashboardBuilder/javascript/components/loading.html",backdrop:"static",resolve:{title:function(){return"Loading ..."},cdnImagesPath:function(){return t.cdnImagesPath}}})},this.hideLoadingModalInstance=function(){this.loadingModalInstance.dismiss()},this.saveDashboard=function(b,c,d){var e=this;if(a.$broadcast("schemaFormValidate"),b&&b.$valid||d){if(!(this.dashboard.widgets.length>20)){this.showLoading();var f={},g=angular.copy(this.dashboard.widgets);f.items=q.map(g,function(a,b){return q.omit(a,["form","schema"])}),f.urlParams=angular.copy(this.urlParams);var h={};h.dashboardName=this.model.dashboardName,h.unit=this.model.unit,h.period=this.model.period,this.model.timeZone&&(h.timeZone=this.model.timeZone),b.uploadForm.file.$dirty&&(h.apsdb_attachments=b.uploadForm.file.$modelValue),h.pluginData=JSON.stringify({wdg:f.items,urlParams:f.urlParams,builtWithTablet:e.tablet}),e.isEdit&&!e.isNew&&(h.update=!0,h.dockey=this.model.key);var i=new FormData;for(var j in h)i.append(j,h[j]);var k=p.defer();return m.saveScript(i).then(function(a,b){"failure"==a.status?(e.isEdit=!0,e.showAlert("danger",a.errorDetail,a.statusCode),e.hideLoadingModalInstance()):(e.model.image=null,a&&a.document&&a.document.key&&e.getDashboard(a.document.key),e.dashboardKey=a.document.key,e.hideLoadingModalInstance(),e.isEdit=!1,e.isNew=!1,e.gridsterOptions.draggable.enabled=e.isEdit,e.gridsterOptions.resizable.enabled=e.isEdit,e.showAlert("info","Dashboard successfully saved."),k.resolve(a,b))},function(a){e.hideLoadingModalInstance(),e.showAlert("danger",a.data.response.metadata.errorDetail,a.data.response.metadata.statusCode),k.reject(a)}),k.promise}e.showAlert("danger","You can add a maximum of 20 widgets.")}},this.postLoadScript=function(a){if(a){this.widgets=[];var b=a.wdg;q.map(b,function(a,b){var c=q.findWhere(t.widgetsConfig,{name:a.name}),d=angular.copy(c.form),e=angular.copy(c.schema);angular.copy(c.defaults);if(c.commonData&&(d[0].tabs=angular.copy([i.formTab].concat(c.form[0].tabs)),d[0].selectedTabIndex=1,e.properties=u(c.schema.properties,i.schemaFields)),c.isAlarm&&(d=angular.copy(j.form),d[0].selectedTabIndex=0,e=angular.copy(j.schema)),a.form=angular.copy(d),a.schema=angular.copy(e),t.model.key){var f={};a.options["api-params"]&&(f=JSON.parse(a.options["api-params"])),f.dockey=t.model.key,a.options["api-params"]=JSON.stringify(f)}t.isManualAdd=!1,t.widgets.push(a)}),this.urlParams=a.urlParams,this.dashboard.widgets=this.widgets,this.dashboard.originalWidgets=angular.copy(this.dashboard.widgets),this.dashboard.counter=this.widgets.length,this.dashboard.originalCounter=this.dashboard.counter}},this.onClipboardCopySuccess=function(a){},this.onCancelSetPublicDashboardName=function(){$(".editable-buttons [type=button]").bind("click",function(a){a.stopPropagation()})},this.bindEventToCancelButton=function(){$(".editable-buttons [type=button]").bind("click",function(a){a.stopPropagation()})},this.unbindEventToCancelButton=function(a){$(".editable-buttons [type=button]").unbind("click")},this.setPublicDashboardName=function(a){var b=new RegExp(/^[A-Za-z0-9 \/:-]{1,80}$/);return a?b.test(a)?m.setDashboardPublicName({dockey:this.dashboardDocument.key,publicName:a}).then(function(a,b){if("failure"==a.status)return t.model.publicDashboardName=t.originalModel.publicDashboardName,a.errorDetail;t.originalModel=angular.copy(t.model)},function(a){return t.model.publicDashboardName=t.originalModel.publicDashboardName,a.errorDetail}):"Public dashboard name can be a maximum of 80 characters.":"Public dashboard name is required."},this.changingPublicAccess=!1,this.revokePublicAccessConfirmation=function(){if(this.changingPublicAccess=!0,this.model.isPublic)this.updatePublicStatus();else{var a=this.model.dashboardName,b=this.model.publicName;l.open({controller:"PopupCont",templateUrl:"/UIComponents/dashboardBuilder/javascript/components/revokeAccessPopup.html",backdrop:"static",resolve:{dashboard:function(){return t},publicName:function(){return b},name:function(){return a}}})}},this.cancelUpdatePublicStatus=function(){t.changingPublicAccess=!1,t.model.isPublic=t.dashboardDocument["document.readACL"].indexOf("anonymous")>-1},this.updatePublicStatus=function(){m.setDashboardPublicAccess({dockey:this.dashboardDocument.key,sharing:this.model.isPublic}).then(function(a,b){t.changingPublicAccess=!1,"failure"==a.status?(t.cancelUpdatePublicStatus(),t.showAlert("danger",a.errorDetail,a.statusCode)):(t.model["document.readACL"]=t.dashboardDocument["document.readACL"]=a["document.readACL"],t.model.publicDashboardName=t.dashboardDocument.publicDashboardName=a.publicDashboardName,t.originalModel=angular.copy(t.model))},function(a){t.cancelUpdatePublicStatus(),t.showAlert("danger",a.errorDetail,a.statusCode)})}}]}),angular.module("DashboardBuilder").component("box",{require:{parent:"^^dashboard"},bindings:{widget:"<",isEdit:"<?"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/box.html",controller:["$rootScope","$scope","$compile","$element","$uibModal",function(a,b,c,d,e){this.remove=function(a){var c=this;e.open({animation:!0,component:"confirmationModal",backdrop:"static",size:"md",scope:b,resolve:{data:function(){return{title:"Delete this widget?",body:'Are you sure you want to delete this widget "'+a.label+'"?',btnCancelTitle:"Cancel",btnSubmitTitle:"Delete"}}}}).result.then(function(b){b&&c.removeWidget(a)},function(){})},this.removeWidget=function(a){delete this[a.formatFunction],this.parent.dashboard.widgets.splice(this.parent.dashboard.widgets.indexOf(a),1),this.parent.dashboard.counter--},this.$postLink=function(){setTimeout(function(){var a=document.getElementsByClassName("gridster-item");if(a&&a.length>0){a[a.length-1]}},200)},this.updateWidgetTimeZone=function(){if(this.widget.options["fetch-time-zone"]=a.fetchTimeZone,this.widget.options["api-params"]){var b;b=JSON.parse(this.widget.options["api-params"]),b.fetchTimeZone=a.fetchTimeZone,this.widget.options["api-params"]=JSON.stringify(b)}},this.updateWidgetMetric=function(){if(this.widget.options["api-params"]){var a;"us"==JSON.parse(this.widget.options["api-params"]).display_metric?(a=JSON.parse(this.widget.options["api-params"]),a.display_metric="si"):(a=JSON.parse(this.widget.options["api-params"]),a.display_metric="us"),this.widget.options["api-params"]=JSON.stringify(a)}},this.updateWidgetPeriod=function(){if(this.widget.options["fetch-from-date-value"]=a.fetchFromDate,this.widget.options["fetch-to-date-value"]=a.fetchToDate,this.widget.options["fetch-period"]=a.fetchPeriod,this.widget.options["api-params"]){var b;b=JSON.parse(this.widget.options["api-params"]),b.fetchPeriod=a.fetchPeriod,this.widget.options["api-params"]=JSON.stringify(b)}},this.$onInit=function(){var c=this;a.mobileBreakPoint="(max-width: 480px)",a.tabletBreakPoint="(max-width: 991px)",b.$on("gridster-mobile-changed",function(b,c){c.isMobile&&(a.mobileBreakPoint="(max-width:"+$(window).innerWidth()+"px)")}),b.$on("period_metric_change",function(a){c.updateWidgetMetric(),c.updateWidgetPeriod(),c.updateWidgetTimeZone(),c.parent.isManualAdd=!1,c.updateWidget(c.widget.options)}),b.$on("unit_change",function(a){c.updateWidgetMetric(),c.parent.isManualAdd=!1,c.updateWidget(c.widget.options)}),b.$on("period_change",function(a){c.updateWidgetPeriod(),c.parent.isManualAdd=!1,c.updateWidget(c.widget.options)}),b.$on("time_zone_change",function(a){c.updateWidgetTimeZone(),c.parent.isManualAdd=!1,c.updateWidget(c.widget.options)}),b.$on("gridster-item-transition-end",function(a){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}),b.$on("gridster-item-resized",function(a){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}),this.widget&&this.addWidget(this.widget),b.$on("resize_widget",function(a,b){if(setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100),c.widget==b.element&&"scriptr-grid"==c.widget.type){var d=b.wdg.height();b.element.options["grid-height"]=d-110,c.updateWidget(b.element.options)}}),b.$on("drag_widget",function(a,b){})},this.openSettings=function(){var a=this;e.open({animation:!0,component:"modalComponent",backdrop:"static",size:"lg",scope:b,resolve:{widget:function(){return a.widget}}}).result.then(function(b){"cancel"!=b&&a.updateWidget(b)},function(){})},this.addWidget=function(e){var f=this;this.chart=angular.element(document.createElement(e.type)),angular.forEach(e.options,function(b,c){if(angular.isArray(b)||angular.isObject(b))f.chart.attr(c,JSON.stringify(b));else if("on-format-data"==c){this.parent.dashboard.counter||(this.parent.dashboard.counter=0);var d=!1;e.formatFunction&&(d=!0),d||(this.parent.dashboard.counter+=1);var g=this.parent.dashboard.counter,h=e.name+"FormatData"+g;f[h]=new Function("data",b),e.formatFunction=h,e.formatFunctionValue=b,f.chart.attr("on-format-data","$ctrl."+h)}else if("fetch-from-date-value"==c)f.chart.attr("fetch-from-date-value",a.fetchFromDate);else if("fetch-to-date-value"==c)f.chart.attr("fetch-to-date-value",a.fetchToDate);else if("fetch-period"==c)f.chart.attr("fetch-period",a.fetchPeriod);else if("fetch-time-zone"==c)f.chart.attr("fetch-time-zone",a.fetchTimeZone);else if("display-metric-value"==c)f.chart.attr("display-metric-value",a.currentDashboardUnit);else if("api-params"==c){var i=JSON.parse(b);i.display_metric&&(i.display_metric=a.currentDashboardUnit),i.fetchPeriod=a.fetchPeriod,i.fetchTimeZone=a.fetchTimeZone,f.chart.attr("api-params",JSON.stringify(i))}else f.chart.attr(c,b)},this);var g=c(this.chart)(b),h=angular.element(d.find(".box-content"));h.append(g),f.parent.isManualAdd&&setTimeout(function(){var a=h.offset().top,b=h.offset().top+h.outerHeight(!0),c=$(window).scrollTop()+window.innerHeight,d=$(window).scrollTop();c>a&&d<b||$("body").animate({scrollTop:h.offset().top+$(h.children()[0]).outerHeight(!0)},100)},200)},this.updateWidget=function(a){var b=this;angular.forEach(a,function(a,c){angular.isArray(a)||angular.isObject(a)?b.chart.attr(c,JSON.stringify(a)):"on-format-data"==c?(b[b.widget.formatFunction]=new Function("data",a),b[b.widget.formatFunctionValue]=a,b.chart.attr("on-format-data","$ctrl."+b.widget.formatFunction)):b.chart.attr(c,a)},this);var c=angular.copy(a),d=this.parent.dashboard.widgets.indexOf(this.widget),e=angular.copy(this.widget);e.options=angular.copy(c),-1!=d&&this.parent.dashboard.widgets.splice(d,1,e)}}]}),angular.module("DashboardBuilder").component("modalComponent",{bindings:{resolve:"<",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/myModalContent.html",controller:["$rootScope","$scope","httpClient","$q","$http",function(a,b,c,d,e){this.$onInit=function(){this.widget=this.resolve.widget,b.$broadcast("schemaFormRedraw"),this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!1}},this.widget&&(this.widget.schema&&(this.schema=angular.copy(this.widget.schema)),this.widget.form&&(this.form=angular.copy(this.widget.form)),this.widget.options["display-metric-value"]=a.currentDashboardUnit,this.model=this.widget.options?angular.copy(this.widget.options):{})},b.multiSelectCallBack=function(b,c){return a.multiSelectCallBack(b,c)},this.onSubmit=function(c){b.$broadcast("schemaFormValidate"),c.$valid&&(this.model.stream&&this.model.stream.length>0?(this.model["fetch-from-date-value"]=a.fetchFromDate,this.model["fetch-to-date-value"]=a.fetchToDate,this.model["fetch-period"]=a.fetchPeriod,this.model["fetch-time-zone"]=a.fetchTimeZone,this.model["default-metric-value"]=a.currentDashboardUnit,this.model["api-params"]=JSON.stringify({dataType:this.model["data-type"],streams:this.model.stream,
dataFormat:this.model["data-format"],aggregationRange:this.model["aggregation-range"],display_metric:a.currentDashboardUnit,fetchPeriod:a.fetchPeriod,fetchTimeZone:a.fetchTimeZone})):this.schema.properties.stream&&delete this.model.api,this.close({$value:this.model}))},this.onCancel=function(a){this.schema={},this.form={},this.model=angular.copy(this.widget.options),this.dismiss({$value:"cancel"})}}]}),angular.module("DashboardBuilder").component("sidetoolbar",{bindings:{},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/sideToolbar.html",controller:["$scope","$mdSidenav",function(a,b){this.close=function(){b("left").close().then(function(){})}}]}),angular.module("DashboardBuilder").component("confirmationModal",{bindings:{resolve:"<",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/confirmation.html",controller:["$scope",function(a){this.$onInit=function(){this.data=this.resolve.data},this.onSubmit=function(){this.close({$value:!0})},this.onCancel=function(){this.dismiss({$value:!1})}}]}),angular.module("DashboardBuilder").controller("PopupCont",["$scope","$uibModalInstance",function(a,b){a.name=a.$resolve.name,a.close=function(){this.$resolve.dashboard&&void 0!==this.$resolve.dashboard.cancelUpdatePublicStatus&&this.$resolve.dashboard.cancelUpdatePublicStatus();var a=this;setTimeout(function(){a.$resolve.dashboard.ranchIsOpen=!0},100),b.dismiss("cancel")},a.ondeleteDashboard=function(){this.$resolve.dashboard.deleteDashboard(this.$resolve.key),b.dismiss("cancel")},a.onrevokeAccess=function(){this.$resolve.dashboard.updatePublicStatus(),b.dismiss("cancel")},a.cancelRevokeAccess=function(){this.$resolve.dashboard.cancelUpdatePublicStatus();var a=this;setTimeout(function(){a.$resolve.dashboard.ranchIsOpen=!0},100),b.dismiss("cancel")}}]),angular.module("DashboardBuilder").controller("LoadingCtrl",["$scope","$uibModalInstance",function(a,b){a.title=a.$resolve.title,a.cdnImagesPath=a.$resolve.cdnImagesPath}]);